



SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoli record.
SKB181         SET ALTRI-IMM-NO              TO TRUE
SJD121         IF  W-F-EKFGT-SI

SJD121             MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121             MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121             MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121             MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121             MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121             MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121      MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121      MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121      MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121      MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182             MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182             MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182             MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182             MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
DEB>>>*            DISPLAY 'FX1707 PRE '
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(1):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(1):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(2):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(2):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(3):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(3):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(4):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(4):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(5):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(5)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(5):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121             PERFORM ORDINA-IMPORTI
SJD121
SJD121             EVALUATE TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182*SJD121                 SET AGRARIO-COINT      TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182*SJD121                 SET ABIT-PRIN-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182*SJD121                 SET ALTRI-IMM-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182*SJD121                 SET COST-RIST-COINT    TO TRUE
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182                 SET AGRARIO-COINT      TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET AGRARIO-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182                 SET ABIT-PRIN-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ABIT-PRIN-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182                 SET ALTRI-IMM-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ALTRI-IMM-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182                 SET COST-RIST-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET COST-RIST-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SOH203               IF W-FINALI-TOT = 1
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-AGRARI-IPO'
SOH203                    SET AGRARIO-COINT      TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQPRI-IPO'
SOH203                    SET ABIT-PRIN-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQALT-IPO'
SOH203                    SET ALTRI-IMM-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-RISPRI-IPO'
SOH203                    SET COST-RIST-COINT    TO TRUE
SOH203                 END-IF
SOH203               ELSE
SKC182                 SET ALTFIN-COINT       TO TRUE
SOH203               END-IF
DEB>>>                 DISPLAY 'FX1707 SET LIQUIDITA-COINT'
SJD121             END-EVALUATE
SKB181             IF ALTRI-IMM-INT
SKB181             AND W-I-AGRARI-IPO =  ZEROES
SKB181             AND W-I-ACQPRI-IPO =  ZEROES
SKB181             AND W-I-RISPRI-IPO =  ZEROES
SKB181                SET ALTRI-IMM-SI          TO TRUE
SKB181             END-IF
DEB>>>         ELSE
DEB>>>             DISPLAY 'TIPO MUTUO OLD'
SJD121         END-IF
DEB>>>         DISPLAY 'SO-TIPO-MUTUO-COINT: ' SO-TIPO-MUTUO-COINT
SHL121
SHA041         MOVE SPACES                    TO SO-PROPR-IMM-COINT
SHA041                                           W-C-PROPRI-IMM
SIB201*- Controllo eseguito SOLO PER STIPULATI/EROGATI POST 01/01/2017:
SIB201         SET PROP-CAL-NO                TO TRUE
SKC182         IF W-F-EKFGT-SI
SKC182            IF W-F-PROPRI-IMM = 'S'
SKC182               MOVE '1'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            ELSE
SKC182               MOVE '0'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            END-IF
SKC182            PERFORM ABITAZIONE-PRINCIPALE
SKC182         ELSE
SJB071*SIB201     IF W-D-STIPUL-ADE >= '2017-01-01'
SJB211*           IF W-D-STIPUL-ADE >= '2017-01-01'
SJB071            IF W-D-STIPUL-ADE >= '2019-01-01'
SHL121               PERFORM GESTIONE-PROPRIETA
SIB201            END-IF
SKC182         END-IF
SHL121         MOVE W-C-PROPRI-IMM            TO SO-PROPR-IMM-COINT
SHL121
SIB161*SHL121  MOVE '0'                       TO SO-FLAG-MISTO-COINT
SJB071         MOVE '0'                       TO SO-FLAG-MISTO-COINT
SHL121
SKB181         MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121         IF  W-F-EKFGT-SI
SJD121             EVALUATE TRUE
SJD121             WHEN  W-I-AGRARI-IPO > 0
SJD121                 MOVE '0'               TO SO-FLAG-MISTO-COINT
SJD121             WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181                 COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                          W-I-ALTFIN-IPO
SJD121                 IF (W-I-ACQPRI-IPO   > 0
SJD121                 AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121          AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182                 OR (W-I-ACQALT-IPO   > 0
SKC182                 AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121                 OR (W-I-RISPRI-IPO   > 0
SJD121                 AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121          AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181                 OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181                 AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                     MOVE '1'           TO SO-FLAG-MISTO-COINT
SLH051*                    Se ho solo una finalita certificabile
SLH051*                    non puÂ¦ essere misto
SLH051                     IF W-FINALI-TOT <= 1
SLH051                        MOVE '0'        TO SO-FLAG-MISTO-COINT
SLH051                     END-IF
DEB>>>*            DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>*            DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>*            DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>*            DISPLAY 'W-I-ALTIMM-TOT: ' W-I-ALTIMM-TOT
SJD121                 ELSE
SJD121                     MOVE '0'           TO SO-FLAG-MISTO-COINT
SJD121                 END-IF
SJD121              END-EVALUATE
SJD121         END-IF
S1C251         MOVE '2'                       TO SO-TIPO-REC
SHA041
SG0217         INITIALIZE SO-ID-MUTUO-COINT
SHL121*S1C251  MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SHL121*S1C251  MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SHL121*S1C251  MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SHL121*SG0217  MOVE SPACES                    TO SO-KEY-SPACE
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201      MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SJB071*SIB201      MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SJB071*SIB201         MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SJB071*SIB201         MOVE SPACES                    TO SO-KEY-SPACE
SHA041*        MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*        IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*           MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*        ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*           MOVE SPACES                     TO W-FINANZ-PRE
SHA041*           IF FCEI1-C-FINANZ-PRE = '09'
SHA041*              MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*           ELSE
SHA041*              MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*           END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*           MOVE ZEROES                 TO W-C-FINANZ-NUM
SHA041*           MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SHA041*           MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SHA041*           MOVE ALL ZEROES             TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*           MOVE 'IST  '                TO W-FILIA
SHA041*        END-IF
SHA041*        MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
SJB071         MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071         IF FCEI1-C-IDENTI-RAP > SPACES
SJB071            MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071         ELSE
SJB071            MOVE '-'                    TO W-CAR-FISSO
SJB071            IF FAN00-F-CARTOL-FIN = 'S'
SJB071               MOVE 'CAR'               TO W-MUTUO-TIP
SJB071            ELSE
SJB071               MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071            END-IF
SJB071            MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211            MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071            MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211            IF FCEI1-C-FINANZ-PRE = '09'
SJB211               STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            ELSE
SJB211               STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071            MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071            MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071            MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211            MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211            MOVE 'IST00'                TO W-FILIA
SJB071         END-IF
SJB071         MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
S1C251         MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-COINT
S1C251         MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-COINT
S1C251         MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-COINT
S1C251         MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-COINT
S1C251         MOVE W-I                       TO ID-COINT-COINT-APPO
S1C251         MOVE ID-COINT-COINT-APPO       TO SO-ID-COINT-COINT
S1C251         MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-COINT
S1C251         MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251         MOVE W-APPX-GG                 TO W-APP9-GG
S1C251         MOVE W-APPX-MM                 TO W-APP9-MM
S1C251         MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251         MOVE W-APP9-GG             TO SO-DATA-NASCITA-COINT(1:2)
S1C251         MOVE W-APP9-MM             TO SO-DATA-NASCITA-COINT(3:2)
S1C251         MOVE W-APP9-SSAA           TO SO-DATA-NASCITA-COINT(5:4)
S1C251         MOVE W-N-CONTA-IAN             TO TOTALE-COINT-APPO
S1C251         MOVE TOTALE-COINT-APPO         TO SO-TOTALE-COINT
S1C251
S1C251         IF TOTALE-COINT-APPO <= 1
DEB>>>            DISPLAY '|||||| ERRORE P019 NUM. COI: ' W-N-FINANZ-NUM
SKB261            CONTINUE
S1C251*           MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*           SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*           MOVE 'IL NUMERO DEI COINTESTATARI DEVE ESSERE > 1 '
S1C251*                                      TO EKERR-X-DES-ERRORE(1)
S1C251*           MOVE 'P019'                TO EKERR-C-RIF-ERRORE(1)
S1C251*           PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S1C251
SMK281         MOVE SPACES                    TO SO-FLAG-OPESOC-COINT
SMK281         MOVE SPACES                    TO SO-ID-MUTUO-CED-COINT
S1C251
SHB223*S1C251         IF IMP-INT-ONE-COINT-APPO  EQUAL ZEROES
SHB223*S1C251         AND IMP-RATE-PAG-COINT-APPO EQUAL ZEROES
SHB223         IF W-I-APPO-TOT-RATA = ZEROES
SHB223         AND APPO-INT-ONE-COINT = ZEROES
S1C251            MOVE ZEROES               TO SO-INT-ONE-PAG-COINT
SIB161*SHL121     MOVE ZEROES               TO SO-PEN-NON-DET-COINT
SJB071            MOVE ZEROES               TO SO-PEN-NON-DET-COINT
S1C251            MOVE ZEROES               TO SO-RATE-EFF-PAG-COINT
S1C251            IF W-I < W-N-CONTA-IAN
SJB071*             PERFORM VERIFICA-EKFDI
S1C251              COMPUTE W-P-PERC-SOMMA = (100 / W-N-CONTA-IAN
S1C251                                      + W-P-PERC-SOMMA)
SJB071*             IF W-F-EKFDI-SI
SJB071*                MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*             ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*             END-IF
S1C251            ELSE
S1C251              COMPUTE W-P-PERC-APPO ROUNDED = 100 - W-P-PERC-SOMMA
S1C251            END-IF
S1C251         ELSE
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251*            IF IMP-INT-ONE-COINT-APPO > ZEROES
S1C251*               COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
S1C251*                                  FCEI1-I-ANNUAL-INT-1 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (INT-ONE-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-INT-ONE-COINT-APPO
S1C251*            ELSE
S1C251*               COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
S1C251*                                 FCEI1-I-TOTANN-RAT-3 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (RATE-EFF-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-RATE-PAG-COINT-APPO
S1C251*            END-IF
SJB071*            PERFORM VERIFICA-EKFDI
SJB071*            IF W-F-EKFDI-SI
SJB071*               MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*            ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*            END-IF
S1C251
S1C251             COMPUTE W-P-PERC-SOMMA ROUNDED = W-P-PERC-APPO
S1C251                                            + W-P-PERC-SOMMA
S1C251          ELSE
S1C251             COMPUTE W-P-PERC-APPO  ROUNDED = 100 - W-P-PERC-SOMMA
S1C251          END-IF
SLH051          MOVE SO-IMP-RATE-PAG-COINT      TO W-I-APPO-TOT-RATA
SGB012*S1C251   COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
SGB012          COMPUTE RATE-EFF-PAG-COINT-ARRO ROUNDED =
S1G201*                                    (FCEI1-I-TOTANN-RAT-3 *
S1G201                                     (W-I-APPO-TOT-RATA    *
S1C251                                      W-P-PERC-APPO)       / 100
SGB012          MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251   COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
KKKKKK* QUA QUA QUA
SGB012          COMPUTE INT-ONE-PAG-COINT-ARRO  ROUNDED =
S1C251*                                    (FCEI1-I-ANNUAL-INT-1 *
S1C251                                     (APPO-INT-ONE-COINT   *
S1C251                                      W-P-PERC-APPO)       / 100
SKA292          MOVE ZEROES                  TO W-I-NONDET-IMP
SKB251          MOVE APPO-INT-ONE-COINT  TO W-INT-ONE-PAG-COINT-ARRO-TOT
SKB181          MOVE INT-ONE-PAG-COINT-ARRO  TO W-INT-ONE-PAG-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE per COINTESTATI:
SKA292          IF W-F-EKFGT-SI
SKB181            IF ALTRI-IMM-SI
SKB251            OR SO-FLAG-MISTO-COINT = '1'
SKB181             CONTINUE
SKB181            ELSE
DEB>>>*            DISPLAY 'QUI APPLICO DETRAZIONE COI'
SKA292             MOVE INT-ONE-PAG-COINT-ARRO TO W-I-DETRAZ-IMP
SKA292                                            W-I-DETRAZ-APP
SKA292             PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292             MOVE W-I-DETRAZ-IMP TO INT-ONE-PAG-COINT-ARRO
SKA292             COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                      W-I-DETRAZ-IMP
SKB181            END-IF
SKA292          END-IF
SGB012          MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COINT-APPO
SHL121
SHL121          MOVE ZEROES                   TO PEN-NON-DET-COINT-APPO
SHL121          IF APPO-PEN-COS-COINT > ZEROES
SHL121            COMPUTE PEN-NON-DET-COINT-ARRO  ROUNDED =
SHL121                                     (APPO-PEN-COS-COINT   *
SHL121                                      W-P-PERC-APPO)       / 100
SKB251            MOVE APPO-PEN-COS-COINT
SKB251                                 TO W-PEN-NON-DET-COINT-ARRO-TOT
SKB181            MOVE PEN-NON-DET-COINT-ARRO
SKB181                                     TO W-PEN-NON-DET-COINT-ARRO
SKA292            IF W-I-NONDET-IMP > ZEROES
SKA292              ADD W-I-NONDET-IMP        TO PEN-NON-DET-COINT-ARRO
SKA292            END-IF
SHL121            MOVE PEN-NON-DET-COINT-ARRO    TO W-I-IMPORT-ARR
SHL121            PERFORM ARROTONDA-IMPORTO
SHL121            MOVE IARRU-I-IMPORT-ARR-O   TO PEN-NON-DET-COINT-APPO
SHL121          ELSE
SHL121             MOVE ZEROES                TO PEN-NON-DET-COINT-APPO
SKB181                                         W-PEN-NON-DET-COINT-ARRO
SKB251                                     W-PEN-NON-DET-COINT-ARRO-TOT
SKA292             IF W-I-NONDET-IMP > ZEROES
SKA292              MOVE W-I-NONDET-IMP     TO W-I-IMPORT-ARR
SKA292              PERFORM ARROTONDA-IMPORTO
SKA292              MOVE IARRU-I-IMPORT-ARR-O TO PEN-NON-DET-COINT-APPO
SKA292             END-IF
SHL121          END-IF
S1C251
DEB>>>*         DISPLAY 'TOTALE-COINT-APPO: '
DEB>>>*                  TOTALE-COINT-APPO
DEB>>>*         DISPLAY 'ID-COINT-COINT-APPO: '
DEB>>>*                  ID-COINT-COINT-APPO
DEB>>>*         DISPLAY 'W-PEN-NON-DET-COINT-ARRO: '
DEB>>>*                  W-PEN-NON-DET-COINT-ARRO
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-RATE = W-SOMMA-IMP-RATE
S1C251                                     + RATE-EFF-PAG-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-INT  = W-SOMMA-IMP-INT
S1C251                                     + INT-ONE-PAG-COINT-APPO
S1C251          ELSE
SKA292*- Se ricalcolo la % detraibile pro-quota, non conosco il totale
SKA292*  a priori:
SKA292           IF W-F-EKFGT-SI
SKA292            CONTINUE
SKA292           ELSE
SLH051            MOVE SO-IMP-RATE-PAG-COINT
SLH051                         TO IMP-RATE-PAG-COINT-APPO
SGB012*S1C251     COMPUTE RATE-EFF-PAG-COINT-APPO =
SGB012            COMPUTE RATE-EFF-PAG-COINT-ARRO =
S1C251                                           IMP-RATE-PAG-COINT-APPO
S1C251                                           -
S1C251                                           W-SOMMA-IMP-RATE
SGB012            MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012            PERFORM ARROTONDA-IMPORTO
SGB012            MOVE IARRU-I-IMPORT-ARR-O   TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251     COMPUTE INT-ONE-PAG-COINT-APPO =
SGB012            COMPUTE INT-ONE-PAG-COINT-ARRO =
SGB012*S1C251                                     IMP-INT-ONE-COINT-APPO
SGB012                                            APPO-INT-ONE-COINT
S1C251                                           -
S1C251                                           W-SOMMA-IMP-INT
SGB012            MOVE INT-ONE-PAG-COINT-ARRO
SGB012                                         TO INT-ONE-PAG-COINT-APPO
SGB012*SGB012     MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012*SGB012     PERFORM ARROTONDA-IMPORTO
SGB012*SGB012     MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COI      NT-APPO
DEB>>>*           DISPLAY 'W-SOMMA-IMP-INT: '
DEB>>>*                    W-SOMMA-IMP-INT
DEB>>>*           DISPLAY 'INT-ONE-PAG-COINT-APPO POST ARROT 2: '
DEB>>>*                    INT-ONE-PAG-COINT-APPO
SKA292           END-IF
S1C251          END-IF
S1C251
S1C251          IF TROVATO-MINORE
SLH051          AND INT-ONE-PAG-COINT-ARRO > RATE-EFF-PAG-COINT-APPO
S1C251            MOVE INT-ONE-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
S1C251          ELSE
S1C251            MOVE RATE-EFF-PAG-COINT-APPO  TO SO-RATE-EFF-PAG-COINT
S1C251          END-IF
S1C251
S1C251          MOVE INT-ONE-PAG-COINT-APPO    TO SO-INT-ONE-PAG-COINT
SIB161*SHL121   MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
SJB071          MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
S1C251
SMB153          PERFORM VERIFICA-PENALE
S1C251         END-IF
S1C251
SLH051*        Il calcolo tramite proporzione delle rate pagate dai
SLH051*        singoli cointestatari ha problemi di arrotondamento
SLH051         MOVE SO-RATE-EFF-PAG-COINT     TO RATE-EFF-PAG-COINT-APPO
SLH051         ADD RATE-EFF-PAG-COINT-APPO    TO W-APPO-IMP-PAG
SLH051         IF W-APPO-IMP-PAG < W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-I-APPO-TOT-RATA - W-APPO-IMP-PAG
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SMB153*SLH051     AND W-APPO-IMP-PAG-DIFF <
SMB153*SLH051                       RATE-EFF-PAG-COINT-APPO
SMB153            AND W-APPO-IMP-PAG-DIFF <
SMB153                                (RATE-EFF-PAG-COINT-APPO - 1 )
SLH051               ADD W-APPO-IMP-PAG-DIFF  TO RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         IF W-APPO-IMP-PAG > W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-APPO-IMP-PAG - W-I-APPO-TOT-RATA
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SLH051            AND W-APPO-IMP-PAG-DIFF <
SLH051                              RATE-EFF-PAG-COINT-APPO
SLH051               SUBTRACT W-APPO-IMP-PAG-DIFF
SLH051                                      FROM RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         MOVE RATE-EFF-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
SKB261         MOVE SO-RATE-EFF-PAG-COINT     TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 3: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
FORZAA*        MOVE INT-ONE-PAG-COINT-APPO    TO W-SO-IMP-RATE-PAG-COINT
FORZAA*                                          SO-RATE-EFF-PAG-COINT
S1C251         MOVE W-P-PERC-APPO             TO W-V-PERCENT
S1C251         MOVE W-V-DATINT-VAL            TO SO-PERCENTUALE-COINT
S1C251         MOVE SPACES                    TO FILLER-COINT
S1C251         MOVE 'A'                       TO SO-CAR-CONTROLLO-COINT
S1C251         MOVE W-C-FINE-RIGA(2:1)    TO SO-CAR-FINE-RIGA-COINT(1:1)
S1C251         MOVE W-C-FINE-RIGA(4:1)    TO SO-CAR-FINE-RIGA-COINT(2:1)
SIB201
SKC182*- Se sto trattando l'ultimo NDG, elaboro PROPRIETA' (lo esegue
SKC182*  solo se non ho FGT):
SIB201         IF W-I = W-N-CONTA-IAN
SIB201         AND PROP-CAL-SI
SKC182         AND W-F-EKFGT-NO
SIB201            PERFORM PROPRIETA-COI
SIB201         END-IF
SKC182*SJD121         IF  W-F-EKFGT-SI
SKA292*SJD121           IF FGT9Q-F-PROPRI-IMM-O = 'S'
SKC182*SKA292           IF W-F-PROPRI-IMM = 'S'
SKC182*SJD121             MOVE '1'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           ELSE
SKC182*SJD121             MOVE '0'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           END-IF
SKC182*SJD121         END-IF
SIB201*
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo (CASO PARTICOLARE X COI):
DEB>>>*        DISPLAY 'FX07FAN9Q-D-STIPUL-OPE-O: ' FAN9Q-D-STIPUL-OPE-O
DEB>>>*        DISPLAY 'FX07FAN9Q-N-FINANZ-NUM-O: ' FAN9Q-N-FINANZ-NUM-O
SKA292         IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SLH051         OR W-F-EKFGT-SI
DEB>>>            DISPLAY 'SCRITTURA SONCO NUOVA'
SKA292*           PERFORM VERIFICA-IFICOINT
SKA292
SKA292            IF IFICOINT-SI
SKA292*- GESTIONE DEGLI IMPORTI TOTALI:
SKA292              IF W-I < W-N-CONTA-IAN
SKA292*- Scrivo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-C-PROPRI-IMM-COINT(W-Y)
SKC182                MOVE W-F-ABITAZ-PRI-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKA292              ELSE
SKA292*- Scrivo l'ultimo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKB261
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261                SET MUTUO-MISTO-2-NO     TO TRUE
SKB261                SET MUTUO-MISTO-3-NO     TO TRUE
SKB261                MOVE ZEROES              TO W-G
SKB261                PERFORM VARYING W-G FROM 1 BY 1
SKB261                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261                   IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(1) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(2) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(3) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(4) )
SKB261                      SET MUTUO-MISTO-2-SI TO TRUE
SKB261                   END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261                   IF W-F-ALTFIN-SOLO-SI
SKB261                   OR W-F-ALTFIN-COI-SI
SKB261                      SET MUTUO-MISTO-3-SI TO TRUE
SKB261                      SET MUTUO-MISTO-2-NO TO TRUE
SKB261                   END-IF
SKB261                END-PERFORM
SKC182                IF FINAL-MISTO-DIV
SLC102                OR FORZO-NON-MISTO-SI
DEB>>>*                  DISPLAY 'FX0709 SETTO NO|'
SKC182                   SET MUTUO-MISTO-3-SI TO TRUE
SKC182                   SET MUTUO-MISTO-2-NO TO TRUE
SKC182                END-IF
SKB261
SKB261                MOVE ZEROES              TO W-G
SKA292
SKB181*- Verifica "MUTUO MISTO":
SKB181                SET MUTUO-MISTO-NO       TO TRUE
SKB181                PERFORM VARYING W-G FROM 1 BY 1
SKB181                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB181                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB181                OR MUTUO-MISTO-SI
SKB181                   IF W-SO-FLAG-MISTO-COINT(W-G) = '1'
SKB261                   OR MUTUO-MISTO-2-SI
SKB181                      SET MUTUO-MISTO-SI TO TRUE
SKB181                   END-IF
SKB181                END-PERFORM
SKB251
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261*               SET MUTUO-MISTO-2-NO     TO TRUE
SKB261*               SET MUTUO-MISTO-3-NO     TO TRUE
SKB261*               MOVE ZEROES              TO W-G
SKB261*               PERFORM VARYING W-G FROM 1 BY 1
SKB261*               UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261*               OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261*                  IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(1) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(2) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(3) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(4) )
SKB261*                     SET MUTUO-MISTO-2-SI TO TRUE
SKB261*                  END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261*                  IF W-F-ALTFIN-SOLO-SI
SKB261*                  OR W-F-ALTFIN-COI-SI
SKB261*                     SET MUTUO-MISTO-3-SI TO TRUE
SKB261*                     SET MUTUO-MISTO-2-NO TO TRUE
SKB261*                  END-IF
SKB261*               END-PERFORM
SKB261*
SKB261*               MOVE ZEROES              TO W-G
SKC182
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale - tutti i COI devono essere
SKC182*  PROPRIETARI e solo ACQUISTO ABITAZIONE PRINCIPALE. Se supera
SKC182*  questo controllo, vado a testare l'abitazione principale:
SKC182                SET ABITAZ-PRI-NO        TO TRUE
SKC182                PERFORM VARYING W-G FROM 1 BY 1
SKC182                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                  IF  W-I-ACQPRI-IPO-COINT(W-G) =
SKC182                                 W-I-TOTFIN-IPO-COINT(W-G)
SKC182                  AND W-C-PROPRI-IMM-COINT(W-G) = '1'
SKC182                     SET ABITAZ-PRI-SI   TO TRUE
SKC182                  ELSE
SKC182                     SET ABITAZ-PRI-NO   TO TRUE
SKC182                  END-IF
SKC182                END-PERFORM
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale:
SKC182                IF ABITAZ-PRI-SI
SKC182                   PERFORM VARYING W-G FROM 1 BY 1
SKC182                   UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                   OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                      IF W-F-ABITAZ-PRI-COINT(W-G) = 'N'
SKC182                        MOVE '0'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      ELSE
SKC182                        MOVE '1'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      END-IF
SKC182                   END-PERFORM
SKC182                END-IF
SKB181
SMB153                MOVE ZEROES          TO W-I-PENALE
SKA292                PERFORM VARYING W-V FROM 1 BY 1
SKA292                UNTIL W-V > W-N-LUNGH-TAB-SONCO
SKA292                OR W-SO-C-NDGNDG-COD(W-V) NOT > SPACES
DEB>>>                  DISPLAY 'CICLO NUOVO PER NDG: '
DEB>>>                           W-SO-C-NDGNDG-COD(W-V)
SKA292*- Ciclo e scrivo SONCO effettivo:
SKA292                  MOVE W-SO-RECORD-DETTAGLIO-COINT(W-V)
SKA292                                         TO SONCORR2
SKA292                                            W-SONCO-APPO
SKA292*                 MOVE W-SO-INT-ONE-PAG-APPO
SKA292*                                        TO SO-IMP-INT-ONE-COINT
SKA292*                 MOVE W-SO-PEN-NON-DET-APPO
SKA292*                                        TO SO-IMP-PEN-COS-COINT
SKB251                  IF MUTUO-MISTO-2-SI
SKB251                     MOVE '1'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 1'
SKB251                  END-IF
SKB261                  IF MUTUO-MISTO-3-SI
SKB261                     MOVE '0'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 0'
SKB261                  END-IF
SKC182                  IF ABITAZ-PRI-SI
SKC182                     MOVE W-C-PROPRI-IMM-COINT(W-V) TO
SKC182                                               SO-PROPR-IMM-COINT
SKC182                  END-IF
SKB181                  IF MUTUO-MISTO-SI
SKB251                     MOVE W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-INT-ONE-COINT
SKB261                                     W-SO-IMP-INT-ONE-COINT-APPO
SKB251                     MOVE W-SO-PEN-NON-DET-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-PEN-COS-COINT
SKB261                                     W-SO-IMP-PEN-COS-COINT-APPO
SKB261                     MOVE W-SO-IMP-RPAG-COINT-PRE-TOT(W-V)
SKB261                                  TO W-SO-IMP-RATE-PAG-COINT-APPO
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-APPO: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-APPO
SKB181
SKB181                     MOVE W-I-ACQPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQPRI-IPO-APPO
SKB181                     MOVE W-I-ACQALT-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQALT-IPO-APPO
SKB181                     MOVE W-I-RISPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-RISPRI-IPO-APPO
SKB181                     MOVE W-I-ALTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-ALTFIN-IPO-APPO
SKB181                     MOVE W-I-AGRARI-IPO-COINT(W-V)
SKB181                                         TO W-I-AGRARI-IPO-APPO
SKB181                     MOVE W-I-TOTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-TOTFIN-IPO-APPO
SKB181                     MOVE W-SO-PEN-NON-DET-COINT-PRE(W-V)
SKB181                                         TO W-I-PENNON-PRE-APPO
SKB181                     MOVE W-SO-INT-ONE-PAG-COINT-PRE(W-V)
SKB181                                         TO W-I-INTONE-PRE-APPO
serena      display 'sm27 sono sotto data >2019 mutuo misto'
serena      display 'sm27 W-I-INTONE-PRE-APPO 1=' W-I-INTONE-PRE-APPO
SKB181                     PERFORM GESTIONE-MISTO-COI
SKC182                     IF FINAL-MISTO-DIV
SLC102                     OR FORZO-NON-MISTO-SI
DEB>>>*                       DISPLAY 'FX0709 SETTO NO| 22'
SKC182                        MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182                     END-IF
SKB181
SKB181                  ELSE
SKB181*- Li modifico solo se non sono "misto":
SKB181                     MOVE W-SO-INT-ONE-PAG-APPO
SKB181                                         TO SO-IMP-INT-ONE-COINT
SKB181                     MOVE W-SO-PEN-NON-DET-APPO
SKB181                                         TO SO-IMP-PEN-COS-COINT
SKB251*- Approssimazione degli importi:
SKB251                     PERFORM APPROSSIMA-DETRAZ
SKB251                     IF W-V = W-N-CONTA-IAN
SKB251                        PERFORM APPROSSIMA-DETRAZ-ULT
SKB251                     END-IF
SKB251                     IF W-SO-IMP-INT-ONE-COINT-9 > ZEROES
SKB251                        MOVE W-SO-IMP-INT-ONE-COINT-9
SKB251                                           TO SO-IMP-INT-ONE-COINT
SKB251                     END-IF
SKB181
SKC182                     IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182                     AND ACCOL-NOPROP-NO
DEB>>>                     DISPLAY 'SCRITTURA-SONCO 3'
SKA292                     PERFORM SCRITTURA-SONCO
SKC182                     END-IF
SKB181
SKB181                  END-IF
SKA292
SKA292                END-PERFORM
SKA292
SKA292                INITIALIZE               W-SO-RECORD
SKA292                                         W-SO-INT-ONE-PAG-APPO
SKA292                                         W-SO-PEN-NON-DET-APPO
SKB181                                         W-I-INTONE-PRE-APPO
SKB181                                         W-I-PENNON-PRE-APPO
SKA292
SKA292              END-IF
SKA292            ELSE
serena      display 'sm27 ificoint N'
SKB181              MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261              IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261              OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                 MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261              ELSE
SKB261                 IF FAN00-C-DESFIN-APP = '071A'
SKB261                 OR FAN00-C-DESFIN-APP = '071'
SKB261                 OR FAN00-C-DESFIN-APP = '081'
SKB261                    MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261                 IF FAN00-C-DESFIN-APP = '011A'
SKB261                 OR FAN00-C-DESFIN-APP = '011B'
SKB261                 OR FAN00-C-DESFIN-APP = '011'
SKB261                    MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261              END-IF
SKA292              MOVE SONCORR2               TO SONCOR22
serena              display 'sm27 scrivo sonco2'
SKA292              PERFORM SCRITTURA-SONC2
SKA292            END-IF
SKA292         ELSE
serena              display 'sm27 data < 2019'
DEB>>>            DISPLAY 'SCRITTURA SONCO STANDARD'
DEB>>>            DISPLAY 'SO-INT-ONE-PAG-COINT : '
DEB>>>                     SO-INT-ONE-PAG-COINT
DEB>>>            DISPLAY 'SO-TIPO-MUTUO-COINT  : '
DEB>>>                     SO-TIPO-MUTUO-COINT
DEB>>>            DISPLAY 'W-F-ACCOL-NOPROP     : '
DEB>>>                     W-F-ACCOL-NOPROP
SKC182            IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182            AND ACCOL-NOPROP-NO
DEB>>>            DISPLAY 'SCRITTURA-SONCO 4'
S1C251            PERFORM SCRITTURA-SONCO
SKC182            END-IF
SKA292         END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012         IF TRM-SI
SGB012            MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012            MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012         END-IF
S1C251        ELSE
S1C251           SET TROVATO-COINT-PG    TO TRUE
S1C251           DISPLAY '----ATTENZIONE---- '
S1C251                   'https://urldefense.com/v3/__http://FIN.TO__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ0qP69mN$  CON COINTESTATARIO PG -->  '
S1C251           FCEI1-C-FINANZ-PRE ' / ' FCEI1-N-FINANZ-NUM
S1C251        END-IF
S1C251       END-PERFORM
SKB251
SKB251*- Ordino e scrivo i mutui misti:
SKB251       MOVE ZEROES                    TO W-M
SKB251       IF MUTUO-MISTO-SI
DEB>>>          DISPLAY 'ELABORO MISTI|||'
SKB251          MOVE ZEROES          TO W-V
SKB251          PERFORM ORDINA-TIPO
SKB261
SKB261          MOVE ZEROES          TO W-V
SKB251          PERFORM VARYING W-V FROM 1 BY 1
SKB251          UNTIL W-V > W-N-LUNGH-TAB-MIS
SKB251          OR W-SO-TIPO-MUTUO-COINT-MIS(W-V) NOT > ZEROES
SKB251             MOVE W-SO-RECORD-DETTAGLIO-MIS(W-V) TO SONCORR2
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(1): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(1)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(2): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(2)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(3): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(3)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(4): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261
SKB261*- Sistemazione per importi TOTALI:
SKB261             IF SO-TIPO-MUTUO-COINT = '1'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(1) = '1'
DEB>>>*              DISPLAY 'FX0409 sistemazione 1'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(1)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 5: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(1)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 1: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(1)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '2'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(2) = '2'
DEB>>>*              DISPLAY 'FX0409 sistemazione 2'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(2)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 6: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(2)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 2: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '3'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(3) = '3'
DEB>>>*              DISPLAY 'FX0409 sistemazione 3'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(3)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 7: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(3)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 3: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(3) > ZEROES
SNC141               OR W-I-ACQALT-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(3)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '4'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(4) = '4'
DEB>>>*              DISPLAY 'FX0409 sistemazione 4'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(4)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 8: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(4)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 4: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(4) > ZEROES
SNC141               OR W-I-RISPRI-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SLH051*            Se ho solo una finalita certificabile vanno scritti
SLH051*            comunque tutti gli ndg (prima non scriveva i non
SLH051*            certificabili) ma deve essere segnato non misto.
SKC182             IF FINAL-MISTO-DIV
SLC102             OR FORZO-NON-MISTO-SI
SLH051             OR W-FINALI-TOT <= 1
DEB>>>*               DISPLAY 'FX0709 SETTO NO| 23'
SKC182                MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182             END-IF
SKB261
SLH051             IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051                MOVE SO-IMP-INIZ-COINT    TO SO-IMP-RATE-PAG-COINT
SLH051             END-IF
SLH051*
SMB153*            IF SO-PEN-NON-DET-COINT = '        0'
SMB153*               MOVE ZEROES               TO SO-IMP-PEN-COS-COINT
SMB153*            END-IF
SMB153*
SKC182             IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182             AND ACCOL-NOPROP-NO
DEB>>>             DISPLAY 'SCRITTURA-SONCO 5 misti'
SKB251             PERFORM SCRITTURA-SONCO
SKC182             END-IF
SKB251          END-PERFORM
SKB251       END-IF
SKB251
SKB251       PERFORM INIZIALIZZA-RICICLI
SKB251
S1C251      ELSE
SHL121*
SHL121*  2) Gestione Persone Fisiche:
SHL121*
DEB>>>       DISPLAY 'NON COINTESTATO: ' W-N-FINANZ-NUM ' - '
DEB>>>                IAN1I-C-NGIURI-COD-O
DEB>>>       IF IFICOINT-SI
DEB>>>          DISPLAY 'GIRO CON FGT'
DEB>>>       ELSE
DEB>>>          DISPLAY 'GIRO A VECCHIO'
DEB>>>       END-IF
DEB>>>*      IF ANA-SI
S1C251       PERFORM RECUPERA-PROV-NAS
SJD121
SJD121*- Accedo a tabella ANAGRAFE TRIBUTARIA per MONOINTESTATO:
SJD121       SET W-F-EKFGT-NO               TO TRUE
SKB261       SET W-F-ALTFIN-SOLO-NO         TO TRUE
SKA292       IF IFICOINT-SI
SKA292          MOVE IAN1I-C-NDGNDG-COD-O      TO W-C-NDGNDG-COD
SJD121          PERFORM VERIFICA-EKFGT
SKA292       END-IF
SJD121
DEB>>>*      END-IF
S1C251       MOVE 1                         TO  FANT1-N-COINTE-NUM
S1C251       MOVE 1                         TO  FANT1-N-COINTE-PRG
S1C251       MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO  FANT1-X-LOCNAS-NDG(6:55)
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251       PERFORM SCRITTURA-FANT1
S1C251*******************************************************
SGB012*
SGB012*- Scrittura flusso SONCO x ANAGRAFE TRIBUTARIA - NON COINTESTATO:
SGB012*
SGB012*- Gestione dati finanziamenti originari per Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE FAN00-G-AREA-FAN        TO WAFAN-AREA-TRM
SGB012          MOVE FAN9Q-G-AREA-O          TO WAFAN-AREA-FAN9-TRM
SGB012          MOVE FCEI1-C-FINANZ-PRE      TO W-C-FINANZ-PR2
SGB012          IF FCEI1-C-FINANZ-PRE = '41'
SGB012             MOVE '09'                 TO FCEI1-C-FINANZ-PRE
SGB012          ELSE
SGB012             MOVE '10'                 TO FCEI1-C-FINANZ-PRE
SGB012          END-IF
SGB012          PERFORM RICAVA-DATI-FAN
SGB012          MOVE W-C-FINANZ-PR2          TO FCEI1-C-FINANZ-PRE
SGB012       END-IF
S1C251       MOVE '1'                       TO SO-TIPO-REC
SHA041
SG0217       INITIALIZE SO-ID-MUTUO-INT
SHL121*S1C251       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SHL121*S1C251       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SHL121*S1C251       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SJB071*SIB201       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SJB071*SIB201       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SHA041*      MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*      IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*         MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*      ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*         MOVE SPACES                     TO W-FINANZ-PRE
SHA041*         IF FCEI1-C-FINANZ-PRE = '09'
SHA041*            MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*         ELSE
SHA041*            MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*         END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*         MOVE ALL ZEROES                TO W-C-FINANZ-NUM
SHA041*         MOVE FCEI1-N-FINANZ-NUM        TO W-N-FINANZ-NUM
SHA041*         MOVE W-C-FINANZ-NUM            TO W-FINANZ-NUM
SHA041*         MOVE ALL ZEROES                TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*         MOVE 'IST  '                   TO W-FILIA
SHA041*      END-IF
SHA041*      MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SHA041
SJB071
SJB071       MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071       IF FCEI1-C-IDENTI-RAP > SPACES
SJB071          MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071       ELSE
SJB071          MOVE '-'                    TO W-CAR-FISSO
SJB071          IF FAN00-F-CARTOL-FIN = 'S'
SJB071             MOVE 'CAR'               TO W-MUTUO-TIP
SJB071          ELSE
SJB071             MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071          END-IF
SJB071          MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211          MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071          MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211          IF FCEI1-C-FINANZ-PRE = '09'
SJB211             STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          ELSE
SJB211             STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071          MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071          MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071          MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211          MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211          MOVE 'IST00'                TO W-FILIA
SJB071       END-IF
SJB071       MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SJB071
S1C251       IF FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
CORRAD       OR FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
S1C251          MOVE FAN9Q-D-STIPUL-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
S1C251          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       ELSE
S1C251          MOVE FAN9Q-D-EROGAZ-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
SJB071*S1C251   COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-EROGAZ-FIN-O
SJB071          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       END-IF
S1G201*      COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
S1G201*                                             FCEI1-I-TOTANN-RAT-3
DEB>>>*      DISPLAY 'DATI NUOVI SONCO: '
S1G201       IF TROVATO-FIN-VALUTA
DEB>>>*         DISPLAY 'TROVATO-FIN-VALUTA'
S1G201          COMPUTE IMP-INIZ-INT-APPO ROUNDED =
S1G201                                            FCEI1-I-EROGAZ-FIN-VAL
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-VAL-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-VAL-3   TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-VAL-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP-VAL > ZEROES
SJB071          OR W-APPO-MORA            > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE-VAL > ZEROES
SNC091          OR W-I-NONTRAC-IMP-VAL    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                         FCEI1-I-NONDET-IMP-VAL +
SNC091                                         W-I-NONTRAC-IMP-VAL    +
SJB071                                         W-APPO-MORA            +
SJB071                                         FCEI1-I-ASSICU-ONE-VAL
SIB161*SHL121      MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071             MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       ELSE
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-3       TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP > ZEROES
SJB071          OR W-APPO-MORA        > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE > ZEROES
SNC091          OR W-I-NONTRAC-IMP    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                            FCEI1-I-NONDET-IMP +
SNC091                                            W-I-NONTRAC-IMP    +
SJB071                                            W-APPO-MORA        +
SJB071                                            FCEI1-I-ASSICU-ONE
SIB161*SHL121     MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071            MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       END-IF
SJD121*      IF  W-F-EKFGT-SI
SJD121*          COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
SJD121*                                           W-I-TOTIMP-TOT
SJD121*          MOVE IMP-INIZ-COINT-APPO       TO SO-IMP-INIZ-INT
SJD121*      END-IF
SGB012       MOVE IMP-RATE-PAG-INT-ARRO         TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O          TO IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'IMP-RATE-PAG-INT-APPO: '
DEB>>>*               IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'W-APPO-MORA          : '
DEB>>>*               W-APPO-MORA
S1C251       COMPUTE W-I-DELTA-MORA ROUNDED = IMP-RATE-PAG-INT-APPO
S1C251                                      - W-APPO-MORA
DEB>>>*      DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
displa*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' SO-IMP-RATE-PAG-INT
S1C251       MOVE IMP-RATE-PAG-INT-APPO       TO SO-IMP-RATE-PAG-INT
SLH051       IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051          MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051       END-IF
SLH051*
S2B161       IF   FCEI1-C-FINANZ-PRE NOT EQUAL '41'
S2B161       AND  FCEI1-C-FINANZ-PRE NOT EQUAL '42'
DEB>>>*        DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
DEB>>>*        DISPLAY 'IMP-INIZ-INT-APPO: ' IMP-INIZ-INT-APPO
S1C251         IF W-I-DELTA-MORA > IMP-INIZ-INT-APPO
DEB>>>          DISPLAY '|||||| ERRORE P020 PAG>MUTUO: ' W-N-FINANZ-NUM
SKB261          CONTINUE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'IMPORTO RATE PAGATE > https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  MUTUO'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P020'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S2B161       END-IF
DEB>>>*      DISPLAY 'FLUSSO SONCO X ANAGRAFE TRIBUTARIA - NON COI'
S1C251*      COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = FCEI1-I-ANNUAL-INT-1
SGB012
S1C251       COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = APPO-I-VOCE0  +
S1C251                                              APPO-I-VOCE2  +
S1C251                                              APPO-I-VOCE3  +
S1C251                                              APPO-I-VOCE7
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO: ' IMP-INT-ONE-INT-APPO
DEB>>>*      DISPLAY 'APPO-I-VOCE0: ' APPO-I-VOCE0
DEB>>>*      DISPLAY 'APPO-I-VOCE2: ' APPO-I-VOCE2
DEB>>>*      DISPLAY 'APPO-I-VOCE3: ' APPO-I-VOCE3
DEB>>>*      DISPLAY 'APPO-I-VOCE7: ' APPO-I-VOCE7
SGB012
SGB012       PERFORM IMPORTI-ANAGRAFE
SGB012       IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA-VAL +
SNB211*SGB012                                       W-I-SPERAT-ANA-VAL +
SGB012                                            W-I-SPEIST-ANA-VAL +
SGB012                                            W-I-IMPSOS-ANA-VAL +
SGB012                                            W-I-PENEST-ANA-VAL +
SGB012                                            W-I-COMINT-ANA-VAL +
SGB012                                            W-I-ONEACC-ANA-VAL +
SGB012                                            W-I-ONESAL-ANA-VAL +
SGB012                                            W-I-ONECER-ANA-VAL
SGB012       ELSE
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA +
SNB211*SGB012                                           W-I-SPERAT-ANA +
SGB012                                            W-I-SPEIST-ANA +
SGB012                                            W-I-IMPSOS-ANA +
SGB012                                            W-I-PENEST-ANA +
SGB012                                            W-I-COMINT-ANA +
SGB012                                            W-I-ONEACC-ANA +
SGB012                                            W-I-ONESAL-ANA +
SGB012                                            W-I-ONECER-ANA
DEB>>>          DISPLAY 'W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>          DISPLAY 'W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>          DISPLAY 'W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>          DISPLAY 'W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>          DISPLAY 'W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>          DISPLAY 'W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>          DISPLAY 'W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>          DISPLAY 'W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>          DISPLAY 'W-I-ONECER-ANA: ' W-I-ONECER-ANA
SGB012       END-IF
SKA292
SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoi record.
SKB181       SET ALTRI-IMM-NO              TO TRUE
SJD121       IF  W-F-EKFGT-SI
SJD121           MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121           MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121           MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121           MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121           MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121           MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121    MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121    MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121    MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121    MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182           MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182           MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182           MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182           MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121           PERFORM ORDINA-IMPORTI
SJD121
SJD121           EVALUATE TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SJD121               SET AGRARIO-INT      TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SJD121               SET ABIT-PRIN-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121    WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SJD121               SET ALTRI-IMM-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SJD121               SET COST-RIST-INT    TO TRUE
SKC182           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182               SET ALTFIN-INT       TO TRUE
SJD121           END-EVALUATE
SKB181           IF ALTRI-IMM-INT
SKB181           AND W-I-AGRARI-IPO =  ZEROES
SKB181           AND W-I-ACQPRI-IPO =  ZEROES
SKB181           AND W-I-RISPRI-IPO =  ZEROES
SKB181              SET ALTRI-IMM-SI          TO TRUE
SKB181           END-IF
SJD121       END-IF
SKB181
SKB181       MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-INT-ONE-PAG-COINT-ARRO
SKB181       MOVE IMP-PEN-COS-NONDET       TO W-PEN-NON-DET-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE MONO:
SKA292       IF W-F-EKFGT-SI
SKB181         IF ALTRI-IMM-SI
SKB181           CONTINUE
SKB181         ELSE
DEB>>>          DISPLAY 'APPLICO DETRAZIONE PF|'
SKA292          MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-I-DETRAZ-IMP
SKA292                                           W-I-DETRAZ-APP
SKA292          PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292          MOVE W-I-DETRAZ-IMP TO IMP-INT-ONE-INT-ARRO-NEW
SKA292          COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                   W-I-DETRAZ-IMP
SKA292          COMPUTE W-SO-IMP-PEN-NON-DET = IMP-PEN-COS-NONDET +
SKA292                                       W-I-NONDET-IMP
SKA292          MOVE W-SO-IMP-PEN-NON-DET    TO W-I-IMPORT-ARR
SKA292          PERFORM ARROTONDA-IMPORTO
SKA292          MOVE IARRU-I-IMPORT-ARR-O    TO SO-IMP-PEN-NON-DET
SKB181         END-IF
SKA292       END-IF
SKA292
SGB012       MOVE IMP-INT-ONE-INT-ARRO-NEW  TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O      TO IMP-INT-ONE-INT-APPO-NEW
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO    : '
DEB>>>*               IMP-INT-ONE-INT-APPO


SGB012*S1C251    MOVE IMP-INT-ONE-INT-APPO        TO SO-IMP-INT-ONE-INT
SGB012       MOVE IMP-INT-ONE-INT-APPO-NEW    TO SO-IMP-INT-ONE-INT
SGB012*S1C251       IF IMP-INT-ONE-INT-APPO > IMP-RATE-PAG-INT-APPO
SGB012       IF IMP-INT-ONE-INT-APPO-NEW > IMP-RATE-PAG-INT-APPO
DISPLA*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' IMP-INT-ONE-INT-APPO
DISPLA*           ' '  SO-IMP-INT-ONE-INT ' ' SO-IMP-RATE-PAG-INT
S1C251          MOVE SO-IMP-INT-ONE-INT       TO SO-IMP-RATE-PAG-INT
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121          IF RATE-A-ZERO-SI
SLC151*SLC121          AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151          IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121          END-IF
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
S1C251*      AND FAN9Q-D-ESTINZ-DAT-O ='0001-01-01'
S1C251*      AND FAN9Q-D-SCDPRI-DAT-O <= EKIFB-D-RIFERI-OPE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  INTERESSI E ONERI > IMPORTO RATE PAGATE'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P021'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251       END-IF
SKB281       MOVE SO-IMP-RATE-PAG-INT       TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 9: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
DEB>>>*      DISPLAY 'SO-IMP-INT-ONE-INT FINE: '
DEB>>>*               SO-IMP-INT-ONE-INT
SOE142*SHA041       MOVE FCEI1-F-ESTINZ-TIP        TO SO-FLAG-ESTINZ-INT
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP = 'E'
SOE142             MOVE '3'                   TO SO-FLAG-ESTINZ-INT
SOE142         ELSE
SOE142             MOVE FCEI1-F-ESTINZ-TIP    TO SO-FLAG-ESTINZ-INT
SOE142         END-IF
DEBUG>*        DISPLAY 'SO-FLAG-ESTINZ-INT>' SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 SO-FLAG-ESTINZ-INT: '
DEB>>>*                        SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
SKC182*- Se il MUTUO } ACCOLLATO (SO-FLAG-ESTINZ-INT a "4") ed il
SKC182*  flag PROPRIETA' non } valorizzato --> non lo comunico|
SKC182       SET ACCOL-NOPROP-NO            TO TRUE
SKC182       IF SO-FLAG-ESTINZ-INT = '4'
SKC182       AND W-F-PROPRI-IMM = 'N'
SKC182           SET ACCOL-NOPROP-SI        TO TRUE
DEB>>>*           DISPLAY 'SETTO ACCOL-NOPROP-SI|||'
SKC182       END-IF
SMK281
SMK281       MOVE SPACES                    TO SO-FLAG-OPESOC-INT
SMK281       MOVE SPACES                    TO SO-ID-MUTUO-CED-INT
SKB181
SKB181       IF  W-F-EKFGT-NO
SKB181
S1C251       SET NO-TROVATO-TIPO-FIN        TO TRUE
S1C251       IF FAN9Q-C-TIPO-FINAN-O = 'AGR'
SG0215       OR FAN9Q-C-TIPO-FINAN-O = 'MAG'
S1C251          MOVE 1                      TO SO-TIPO-MUTUO-INT
S1C251       ELSE
S1C251          IF (FAN9Q-C-TIPO-FINAN-O = 'MUT' OR 'VUT'
SIB201*SG0215          OR  'MAT')
SIB201          OR  'MAT' OR 'PIV' )
S1C251          AND FCEI1-C-GARANZ-TIP = 'I'
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '070'  OR '070A' OR
S1C251*                                         '070B' OR '071'  OR
S1C251*                                         '080A' OR '081'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '071A' OR '071'  OR
SG0215                                          '081'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 2                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '010' OR '010A' OR
S1C251*                                         '011' OR '130B' OR
S1C251*                                         '130C'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '011A' OR '011B' OR
SG0215                                          '011'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 4                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251            IF NO-TROVATO-TIPO-FIN
S1C251               MOVE 3                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251          END-IF
S1C251       END-IF
SKB181
SKB181       END-IF
SKB181
SHL121
SIB161*SHL121       MOVE '0'                       TO SO-FLAG-MISTO-INT
SJB071       MOVE '0'                       TO SO-FLAG-MISTO-INT
SKB181       SET MUTUO-MISTO-NO             TO TRUE
SKB181       MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121       IF  W-F-EKFGT-SI
SJD121           EVALUATE TRUE
SJD121           WHEN    W-I-AGRARI-IPO > 0
SJD121               MOVE '0'                 TO SO-FLAG-MISTO-INT
SKB181               SET MUTUO-MISTO-NO       TO TRUE
SJD121           WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181               COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                        W-I-ALTFIN-IPO
SJD121               IF (W-I-ACQPRI-IPO   > 0
SJD121               AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121        AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182               OR (W-I-ACQALT-IPO   > 0
SKC182               AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121               OR (W-I-RISPRI-IPO   > 0
SJD121               AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121        AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181        OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181        AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                   MOVE '1'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-SI   TO TRUE
SJD121               ELSE
SJD121                   MOVE '0'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-NO   TO TRUE
SJD121               END-IF
SJD121            END-EVALUATE
SJD121       END-IF
SHL121
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-INT
S1C251       MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-INT
S1C251       MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-INT
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-INT
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-INT
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251       MOVE W-APPX-GG                 TO W-APP9-GG
S1C251       MOVE W-APPX-MM                 TO W-APP9-MM
S1C251       MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251       MOVE W-APP9-GG              TO SO-DATA-NASCITA-INT(1:2)
S1C251       MOVE W-APP9-MM              TO SO-DATA-NASCITA-INT(3:2)
S1C251       MOVE W-APP9-SSAA            TO SO-DATA-NASCITA-INT(5:4)
S1C251       MOVE SPACES                 TO FILLER-INT
S1C251       MOVE 'A'                    TO SO-CAR-CONTROLLO-INT
S1C251       MOVE W-C-FINE-RIGA(2:1)     TO SO-CAR-FINE-RIGA-INT(1:1)
S1C251       MOVE W-C-FINE-RIGA(4:1)     TO SO-CAR-FINE-RIGA-INT(2:1)
SKA292
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo:
DEB>>>*      DISPLAY 'FX2007 FAN9Q-D-STIPUL-OPE-O: 'FAN9Q-D-STIPUL-OPE-O
DEB>>>*      DISPLAY 'FX2007 FAN9Q-N-FINANZ-NUM-O: 'FAN9Q-N-FINANZ-NUM-O
SKA292       IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SKA292          IF IFICOINT-SI
DEB>>>*      DISPLAY 'FX2007 IFICOINT-SI'
SKB181            IF MUTUO-MISTO-SI
DEB>>>               DISPLAY 'MUTUO MISTO|'
SKB181
SKB181               MOVE SONCORR2             TO W-SONCO-APPO
SKB181
SKB181               MOVE IAN1I-C-NDGNDG-COD-O TO W-C-NDGNDG-COD
SKB181               PERFORM REPERISCI-IMPORTI-FGT
SKB181               MOVE W-I-ACQPRI-IPO
SKB181                                   TO W-I-ACQPRI-IPO-APPO
SKB181               MOVE W-I-ACQALT-IPO
SKB181                                   TO W-I-ACQALT-IPO-APPO
SKB181               MOVE W-I-RISPRI-IPO
SKB181                                   TO W-I-RISPRI-IPO-APPO
SKB181               MOVE W-I-ALTFIN-IPO
SKB181                                   TO W-I-ALTFIN-IPO-APPO
SKB181               MOVE W-I-AGRARI-IPO
SKB181                                   TO W-I-AGRARI-IPO-APPO
SKB181               MOVE W-I-TOTFIN-IPO
SKB181                                   TO W-I-TOTFIN-IPO-APPO
SKB181               MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                                   TO W-I-INTONE-PRE-APPO
SKB181               MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                                   TO W-I-PENNON-PRE-APPO
SKB261               MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                                   TO W-I-TOTRAT-PAG-APPO
SKB181
SKB181               PERFORM GESTIONE-MISTO-PF
SKA292
SKB181               INITIALIZE             W-I-INTONE-PRE-APPO
SKB181                                      W-I-PENNON-PRE-APPO
SKB281                                      W-I-TOTRAT-PAG-APPO
SKB181
SKB181            ELSE
SKC182*             IF W-F-ALTFIN-SOLO-NO
DEB>>>*             DISPLAY 'SO-TIPO-MUTUO-INT: '
DEB>>>*                      SO-TIPO-MUTUO-INT
DEB>>>*             DISPLAY 'W-F-ACCOL-NOPROP: '
DEB>>>*                      W-F-ACCOL-NOPROP
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281              IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281                 MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281              END-IF
SLC043              IF SO-TIPO-MUTUO-INT NOT = '5'
SLC043              AND ACCOL-NOPROP-NO
DEB>>>                DISPLAY 'SCRITTURA-SONCO 6'
SKA292                PERFORM SCRITTURA-SONCO
SLC043              END-IF
SKC182*             END-IF
SKB181            END-IF
SKA292          ELSE
SKB181             MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261             IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261             OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261             ELSE
SKB261                IF FAN00-C-DESFIN-APP = '071A'
SKB261                OR FAN00-C-DESFIN-APP = '071'
SKB261                OR FAN00-C-DESFIN-APP = '081'
SKB261                   MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261                IF FAN00-C-DESFIN-APP = '011A'
SKB261                OR FAN00-C-DESFIN-APP = '011B'
SKB261                OR FAN00-C-DESFIN-APP = '011'
SKB261                   MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261             END-IF
SKA292             MOVE SONCORR2               TO SONCOR22
SKA292             PERFORM SCRITTURA-SONC2
SKA292          END-IF
SKA292       ELSE
DEB>>>          DISPLAY 'SCRITTURA-SONCO 7: 'SO-TIPO-MUTUO-INT
SKC182          IF SO-TIPO-MUTUO-INT NOT = '5'
SKC182          AND ACCOL-NOPROP-NO
DEB>>>          DISPLAY 'SCRITTURA-SONCO'
S1C251          PERFORM SCRITTURA-SONCO
SKC182          END-IF
SKA292       END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012          MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012       END-IF
S1C251      END-IF
S1C251     END-IF
SKB251
SKB251     PERFORM INIZIALIZZA-RICICLI
SJB071
SJB071*- Verifiche su flag propriet{ per cointestati:
SJB071     IF IAN1I-C-NGIURI-COD-O = 'COI'
SJB071        MOVE ZEROES                   TO W-X
SJB071        SET PRO-NO                    TO TRUE
SJB071        PERFORM VARYING W-X FROM 1 BY 1
SJB071         UNTIL W-K > 500
SJB071         OR W-C-NDGNDG-COD-COI(W-X) = SPACES OR LOW-VALUES
SJB071            IF W-C-PROPRI-IMM-COI(W-X) = '1'
SJB071               SET PRO-NO             TO TRUE
SJB071            END-IF
SJB071        END-PERFORM
SJB071
SJB071        IF PRO-NO
SJB071           MOVE '0231'                TO EKERR-C-COD-ERRORE(1)
SJB071           MOVE 'P024'                TO EKERR-C-RIF-ERRORE(1)
SJB071           MOVE 'FLAG PROPRIETA'' NON VALORIZZATO'
SJB071                                      TO EKERR-X-DES-ERRORE(1)
SJB071           PERFORM MESSAGGIO-WARNING
SJB071        END-IF
SJB071     END-IF
DEB>>>*    DISPLAY 'FINE FANT1 E SONCO'
090309     .

