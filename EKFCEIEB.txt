



SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoli record.
SKB181         SET ALTRI-IMM-NO              TO TRUE
SJD121         IF  W-F-EKFGT-SI
DEB>>>*            DISPLAY 'W-F-EKFGT-SI'
DEB>>>*            DISPLAY 'FX1707 W-I-AGRARI-IPO: '
DEB>>>*                            W-I-AGRARI-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ACQPRI-IPO: '
DEB>>>*                            W-I-ACQPRI-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ACQALT-IPO: '
DEB>>>*                            W-I-ACQALT-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ALTFIN-IPO: '
DEB>>>*                            W-I-ALTFIN-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-RISPRI-IPO: '
DEB>>>*                            W-I-RISPRI-IPO
SJD121             MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121             MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121             MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121             MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121             MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121             MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121      MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121      MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121      MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121      MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182             MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182             MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182             MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182             MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
DEB>>>*            DISPLAY 'FX1707 PRE '
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(1):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(1):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(2):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(2):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(3):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(3):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(4):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(4):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(5):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(5)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(5):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121             PERFORM ORDINA-IMPORTI
SJD121
DEB>>>*            DISPLAY 'FX1707 POST'
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(1):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(1):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(2):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(2):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(3):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(3):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(4):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(4):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(5):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(5)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(5):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(5)
SJD121             EVALUATE TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182*SJD121                 SET AGRARIO-COINT      TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182*SJD121                 SET ABIT-PRIN-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182*SJD121                 SET ALTRI-IMM-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182*SJD121                 SET COST-RIST-COINT    TO TRUE
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182                 SET AGRARIO-COINT      TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET AGRARIO-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182                 SET ABIT-PRIN-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ABIT-PRIN-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182                 SET ALTRI-IMM-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ALTRI-IMM-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182                 SET COST-RIST-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET COST-RIST-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SOH203               IF W-FINALI-TOT = 1
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-AGRARI-IPO'
SOH203                    SET AGRARIO-COINT      TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQPRI-IPO'
SOH203                    SET ABIT-PRIN-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQALT-IPO'
SOH203                    SET ALTRI-IMM-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-RISPRI-IPO'
SOH203                    SET COST-RIST-COINT    TO TRUE
SOH203                 END-IF
SOH203               ELSE
SKC182                 SET ALTFIN-COINT       TO TRUE
SOH203               END-IF
DEB>>>                 DISPLAY 'FX1707 SET LIQUIDITA-COINT'
SJD121             END-EVALUATE
SKB181             IF ALTRI-IMM-INT
SKB181             AND W-I-AGRARI-IPO =  ZEROES
SKB181             AND W-I-ACQPRI-IPO =  ZEROES
SKB181             AND W-I-RISPRI-IPO =  ZEROES
SKB181                SET ALTRI-IMM-SI          TO TRUE
SKB181             END-IF
DEB>>>         ELSE
DEB>>>             DISPLAY 'TIPO MUTUO OLD'
SJD121         END-IF
DEB>>>         DISPLAY 'SO-TIPO-MUTUO-COINT: ' SO-TIPO-MUTUO-COINT
SHL121
SHA041         MOVE SPACES                    TO SO-PROPR-IMM-COINT
SHA041                                           W-C-PROPRI-IMM
SIB201*- Controllo eseguito SOLO PER STIPULATI/EROGATI POST 01/01/2017:
SIB201         SET PROP-CAL-NO                TO TRUE
SKC182         IF W-F-EKFGT-SI
SKC182            IF W-F-PROPRI-IMM = 'S'
SKC182               MOVE '1'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            ELSE
SKC182               MOVE '0'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            END-IF
SKC182            PERFORM ABITAZIONE-PRINCIPALE
SKC182         ELSE
SJB071*SIB201     IF W-D-STIPUL-ADE >= '2017-01-01'
SJB211*           IF W-D-STIPUL-ADE >= '2017-01-01'
SJB071            IF W-D-STIPUL-ADE >= '2019-01-01'
SHL121               PERFORM GESTIONE-PROPRIETA
SIB201            END-IF
SKC182         END-IF
SHL121         MOVE W-C-PROPRI-IMM            TO SO-PROPR-IMM-COINT
SHL121
SIB161*SHL121  MOVE '0'                       TO SO-FLAG-MISTO-COINT
SJB071         MOVE '0'                       TO SO-FLAG-MISTO-COINT
SHL121
SKB181         MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121         IF  W-F-EKFGT-SI
SJD121             EVALUATE TRUE
SJD121             WHEN  W-I-AGRARI-IPO > 0
SJD121                 MOVE '0'               TO SO-FLAG-MISTO-COINT
SJD121             WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181                 COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                          W-I-ALTFIN-IPO
SJD121                 IF (W-I-ACQPRI-IPO   > 0
SJD121                 AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121          AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182                 OR (W-I-ACQALT-IPO   > 0
SKC182                 AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121                 OR (W-I-RISPRI-IPO   > 0
SJD121                 AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121          AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181                 OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181                 AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                     MOVE '1'           TO SO-FLAG-MISTO-COINT
SLH051*                    Se ho solo una finalita certificabile
SLH051*                    non puÂ¦ essere misto
SLH051                     IF W-FINALI-TOT <= 1
SLH051                        MOVE '0'        TO SO-FLAG-MISTO-COINT
SLH051                     END-IF
DEB>>>*            DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>*            DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>*            DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>*            DISPLAY 'W-I-ALTIMM-TOT: ' W-I-ALTIMM-TOT
SJD121                 ELSE
SJD121                     MOVE '0'           TO SO-FLAG-MISTO-COINT
SJD121                 END-IF
SJD121              END-EVALUATE
SJD121         END-IF
S1C251         MOVE '2'                       TO SO-TIPO-REC
SHA041
SG0217         INITIALIZE SO-ID-MUTUO-COINT
SHL121*S1C251  MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SHL121*S1C251  MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SHL121*S1C251  MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SHL121*SG0217  MOVE SPACES                    TO SO-KEY-SPACE
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201      MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SJB071*SIB201      MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SJB071*SIB201         MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SJB071*SIB201         MOVE SPACES                    TO SO-KEY-SPACE
SHA041*        MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*        IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*           MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*        ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*           MOVE SPACES                     TO W-FINANZ-PRE
SHA041*           IF FCEI1-C-FINANZ-PRE = '09'
SHA041*              MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*           ELSE
SHA041*              MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*           END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*           MOVE ZEROES                 TO W-C-FINANZ-NUM
SHA041*           MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SHA041*           MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SHA041*           MOVE ALL ZEROES             TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*           MOVE 'IST  '                TO W-FILIA
SHA041*        END-IF
SHA041*        MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
SJB071         MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071         IF FCEI1-C-IDENTI-RAP > SPACES
SJB071            MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071         ELSE
SJB071            MOVE '-'                    TO W-CAR-FISSO
SJB071            IF FAN00-F-CARTOL-FIN = 'S'
SJB071               MOVE 'CAR'               TO W-MUTUO-TIP
SJB071            ELSE
SJB071               MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071            END-IF
SJB071            MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211            MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071            MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211            IF FCEI1-C-FINANZ-PRE = '09'
SJB211               STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            ELSE
SJB211               STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071            MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071            MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071            MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211            MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211            MOVE 'IST00'                TO W-FILIA
SJB071         END-IF
SJB071         MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
S1C251         MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-COINT
S1C251         MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-COINT
S1C251         MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-COINT
S1C251         MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-COINT
S1C251         MOVE W-I                       TO ID-COINT-COINT-APPO
S1C251         MOVE ID-COINT-COINT-APPO       TO SO-ID-COINT-COINT
S1C251         MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-COINT
S1C251         MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251         MOVE W-APPX-GG                 TO W-APP9-GG
S1C251         MOVE W-APPX-MM                 TO W-APP9-MM
S1C251         MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251         MOVE W-APP9-GG             TO SO-DATA-NASCITA-COINT(1:2)
S1C251         MOVE W-APP9-MM             TO SO-DATA-NASCITA-COINT(3:2)
S1C251         MOVE W-APP9-SSAA           TO SO-DATA-NASCITA-COINT(5:4)
S1C251         MOVE W-N-CONTA-IAN             TO TOTALE-COINT-APPO
S1C251         MOVE TOTALE-COINT-APPO         TO SO-TOTALE-COINT
S1C251
S1C251         IF TOTALE-COINT-APPO <= 1
DEB>>>            DISPLAY '|||||| ERRORE P019 NUM. COI: ' W-N-FINANZ-NUM
SKB261            CONTINUE
S1C251*           MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*           SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*           MOVE 'IL NUMERO DEI COINTESTATARI DEVE ESSERE > 1 '
S1C251*                                      TO EKERR-X-DES-ERRORE(1)
S1C251*           MOVE 'P019'                TO EKERR-C-RIF-ERRORE(1)
S1C251*           PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S1C251
SMK281         MOVE SPACES                    TO SO-FLAG-OPESOC-COINT
SMK281         MOVE SPACES                    TO SO-ID-MUTUO-CED-COINT
S1C251
SHB223*S1C251         IF IMP-INT-ONE-COINT-APPO  EQUAL ZEROES
SHB223*S1C251         AND IMP-RATE-PAG-COINT-APPO EQUAL ZEROES
SHB223         IF W-I-APPO-TOT-RATA = ZEROES
SHB223         AND APPO-INT-ONE-COINT = ZEROES
S1C251            MOVE ZEROES               TO SO-INT-ONE-PAG-COINT
SIB161*SHL121     MOVE ZEROES               TO SO-PEN-NON-DET-COINT
SJB071            MOVE ZEROES               TO SO-PEN-NON-DET-COINT
S1C251            MOVE ZEROES               TO SO-RATE-EFF-PAG-COINT
S1C251            IF W-I < W-N-CONTA-IAN
SJB071*             PERFORM VERIFICA-EKFDI
S1C251              COMPUTE W-P-PERC-SOMMA = (100 / W-N-CONTA-IAN
S1C251                                      + W-P-PERC-SOMMA)
SJB071*             IF W-F-EKFDI-SI
SJB071*                MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*             ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*             END-IF
S1C251            ELSE
S1C251              COMPUTE W-P-PERC-APPO ROUNDED = 100 - W-P-PERC-SOMMA
S1C251            END-IF
S1C251         ELSE
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251*            IF IMP-INT-ONE-COINT-APPO > ZEROES
S1C251*               COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
S1C251*                                  FCEI1-I-ANNUAL-INT-1 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (INT-ONE-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-INT-ONE-COINT-APPO
S1C251*            ELSE
S1C251*               COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
S1C251*                                 FCEI1-I-TOTANN-RAT-3 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (RATE-EFF-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-RATE-PAG-COINT-APPO
S1C251*            END-IF
SJB071*            PERFORM VERIFICA-EKFDI
SJB071*            IF W-F-EKFDI-SI
SJB071*               MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*            ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*            END-IF
S1C251
S1C251             COMPUTE W-P-PERC-SOMMA ROUNDED = W-P-PERC-APPO
S1C251                                            + W-P-PERC-SOMMA
S1C251          ELSE
S1C251             COMPUTE W-P-PERC-APPO  ROUNDED = 100 - W-P-PERC-SOMMA
S1C251          END-IF
SLH051          MOVE SO-IMP-RATE-PAG-COINT      TO W-I-APPO-TOT-RATA
SGB012*S1C251   COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
SGB012          COMPUTE RATE-EFF-PAG-COINT-ARRO ROUNDED =
S1G201*                                    (FCEI1-I-TOTANN-RAT-3 *
S1G201                                     (W-I-APPO-TOT-RATA    *
S1C251                                      W-P-PERC-APPO)       / 100
SGB012          MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251   COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
KKKKKK* QUA QUA QUA
SGB012          COMPUTE INT-ONE-PAG-COINT-ARRO  ROUNDED =
S1C251*                                    (FCEI1-I-ANNUAL-INT-1 *
S1C251                                     (APPO-INT-ONE-COINT   *
S1C251                                      W-P-PERC-APPO)       / 100
SKA292          MOVE ZEROES                  TO W-I-NONDET-IMP
SKB251          MOVE APPO-INT-ONE-COINT  TO W-INT-ONE-PAG-COINT-ARRO-TOT
SKB181          MOVE INT-ONE-PAG-COINT-ARRO  TO W-INT-ONE-PAG-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE per COINTESTATI:
SKA292          IF W-F-EKFGT-SI
SKB181            IF ALTRI-IMM-SI
SKB251            OR SO-FLAG-MISTO-COINT = '1'
SKB181             CONTINUE
SKB181            ELSE
DEB>>>*            DISPLAY 'QUI APPLICO DETRAZIONE COI'
SKA292             MOVE INT-ONE-PAG-COINT-ARRO TO W-I-DETRAZ-IMP
SKA292                                            W-I-DETRAZ-APP
SKA292             PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292             MOVE W-I-DETRAZ-IMP TO INT-ONE-PAG-COINT-ARRO
SKA292             COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                      W-I-DETRAZ-IMP
SKB181            END-IF
SKA292          END-IF
SGB012          MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COINT-APPO
SHL121
SHL121          MOVE ZEROES                   TO PEN-NON-DET-COINT-APPO
SHL121          IF APPO-PEN-COS-COINT > ZEROES
SHL121            COMPUTE PEN-NON-DET-COINT-ARRO  ROUNDED =
SHL121                                     (APPO-PEN-COS-COINT   *
SHL121                                      W-P-PERC-APPO)       / 100
SKB251            MOVE APPO-PEN-COS-COINT
SKB251                                 TO W-PEN-NON-DET-COINT-ARRO-TOT
SKB181            MOVE PEN-NON-DET-COINT-ARRO
SKB181                                     TO W-PEN-NON-DET-COINT-ARRO
SKA292            IF W-I-NONDET-IMP > ZEROES
SKA292              ADD W-I-NONDET-IMP        TO PEN-NON-DET-COINT-ARRO
SKA292            END-IF
SHL121            MOVE PEN-NON-DET-COINT-ARRO    TO W-I-IMPORT-ARR
SHL121            PERFORM ARROTONDA-IMPORTO
SHL121            MOVE IARRU-I-IMPORT-ARR-O   TO PEN-NON-DET-COINT-APPO
SHL121          ELSE
SHL121             MOVE ZEROES                TO PEN-NON-DET-COINT-APPO
SKB181                                         W-PEN-NON-DET-COINT-ARRO
SKB251                                     W-PEN-NON-DET-COINT-ARRO-TOT
SKA292             IF W-I-NONDET-IMP > ZEROES
SKA292              MOVE W-I-NONDET-IMP     TO W-I-IMPORT-ARR
SKA292              PERFORM ARROTONDA-IMPORTO
SKA292              MOVE IARRU-I-IMPORT-ARR-O TO PEN-NON-DET-COINT-APPO
SKA292             END-IF
SHL121          END-IF
S1C251
DEB>>>*         DISPLAY 'TOTALE-COINT-APPO: '
DEB>>>*                  TOTALE-COINT-APPO
DEB>>>*         DISPLAY 'ID-COINT-COINT-APPO: '
DEB>>>*                  ID-COINT-COINT-APPO
DEB>>>*         DISPLAY 'W-PEN-NON-DET-COINT-ARRO: '
DEB>>>*                  W-PEN-NON-DET-COINT-ARRO
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-RATE = W-SOMMA-IMP-RATE
S1C251                                     + RATE-EFF-PAG-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-INT  = W-SOMMA-IMP-INT
S1C251                                     + INT-ONE-PAG-COINT-APPO
S1C251          ELSE
SKA292*- Se ricalcolo la % detraibile pro-quota, non conosco il totale
SKA292*  a priori:
SKA292           IF W-F-EKFGT-SI
SKA292            CONTINUE
SKA292           ELSE
SLH051            MOVE SO-IMP-RATE-PAG-COINT
SLH051                         TO IMP-RATE-PAG-COINT-APPO
SGB012*S1C251     COMPUTE RATE-EFF-PAG-COINT-APPO =
SGB012            COMPUTE RATE-EFF-PAG-COINT-ARRO =
S1C251                                           IMP-RATE-PAG-COINT-APPO
S1C251                                           -
S1C251                                           W-SOMMA-IMP-RATE
SGB012            MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012            PERFORM ARROTONDA-IMPORTO
SGB012            MOVE IARRU-I-IMPORT-ARR-O   TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251     COMPUTE INT-ONE-PAG-COINT-APPO =
SGB012            COMPUTE INT-ONE-PAG-COINT-ARRO =
SGB012*S1C251                                     IMP-INT-ONE-COINT-APPO
SGB012                                            APPO-INT-ONE-COINT
S1C251                                           -
S1C251                                           W-SOMMA-IMP-INT
SGB012            MOVE INT-ONE-PAG-COINT-ARRO
SGB012                                         TO INT-ONE-PAG-COINT-APPO
SGB012*SGB012     MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012*SGB012     PERFORM ARROTONDA-IMPORTO
SGB012*SGB012     MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COI      NT-APPO
DEB>>>*           DISPLAY 'W-SOMMA-IMP-INT: '
DEB>>>*                    W-SOMMA-IMP-INT
DEB>>>*           DISPLAY 'INT-ONE-PAG-COINT-APPO POST ARROT 2: '
DEB>>>*                    INT-ONE-PAG-COINT-APPO
SKA292           END-IF
S1C251          END-IF
S1C251
S1C251          IF TROVATO-MINORE
SLH051          AND INT-ONE-PAG-COINT-ARRO > RATE-EFF-PAG-COINT-APPO
S1C251            MOVE INT-ONE-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
S1C251          ELSE
S1C251            MOVE RATE-EFF-PAG-COINT-APPO  TO SO-RATE-EFF-PAG-COINT
S1C251          END-IF
S1C251
S1C251          MOVE INT-ONE-PAG-COINT-APPO    TO SO-INT-ONE-PAG-COINT
SIB161*SHL121   MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
SJB071          MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
S1C251
SMB153          PERFORM VERIFICA-PENALE
S1C251         END-IF
S1C251
SLH051*        Il calcolo tramite proporzione delle rate pagate dai
SLH051*        singoli cointestatari ha problemi di arrotondamento
SLH051         MOVE SO-RATE-EFF-PAG-COINT     TO RATE-EFF-PAG-COINT-APPO
SLH051         ADD RATE-EFF-PAG-COINT-APPO    TO W-APPO-IMP-PAG
SLH051         IF W-APPO-IMP-PAG < W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-I-APPO-TOT-RATA - W-APPO-IMP-PAG
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SMB153*SLH051     AND W-APPO-IMP-PAG-DIFF <
SMB153*SLH051                       RATE-EFF-PAG-COINT-APPO
SMB153            AND W-APPO-IMP-PAG-DIFF <
SMB153                                (RATE-EFF-PAG-COINT-APPO - 1 )
SLH051               ADD W-APPO-IMP-PAG-DIFF  TO RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         IF W-APPO-IMP-PAG > W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-APPO-IMP-PAG - W-I-APPO-TOT-RATA
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SLH051            AND W-APPO-IMP-PAG-DIFF <
SLH051                              RATE-EFF-PAG-COINT-APPO
SLH051               SUBTRACT W-APPO-IMP-PAG-DIFF
SLH051                                      FROM RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         MOVE RATE-EFF-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
SKB261         MOVE SO-RATE-EFF-PAG-COINT     TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 3: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
FORZAA*        MOVE INT-ONE-PAG-COINT-APPO    TO W-SO-IMP-RATE-PAG-COINT
FORZAA*                                          SO-RATE-EFF-PAG-COINT
S1C251         MOVE W-P-PERC-APPO             TO W-V-PERCENT
S1C251         MOVE W-V-DATINT-VAL            TO SO-PERCENTUALE-COINT
S1C251         MOVE SPACES                    TO FILLER-COINT
S1C251         MOVE 'A'                       TO SO-CAR-CONTROLLO-COINT
S1C251         MOVE W-C-FINE-RIGA(2:1)    TO SO-CAR-FINE-RIGA-COINT(1:1)
S1C251         MOVE W-C-FINE-RIGA(4:1)    TO SO-CAR-FINE-RIGA-COINT(2:1)
SIB201
SKC182*- Se sto trattando l'ultimo NDG, elaboro PROPRIETA' (lo esegue
SKC182*  solo se non ho FGT):
SIB201         IF W-I = W-N-CONTA-IAN
SIB201         AND PROP-CAL-SI
SKC182         AND W-F-EKFGT-NO
SIB201            PERFORM PROPRIETA-COI
SIB201         END-IF
SKC182*SJD121         IF  W-F-EKFGT-SI
SKA292*SJD121           IF FGT9Q-F-PROPRI-IMM-O = 'S'
SKC182*SKA292           IF W-F-PROPRI-IMM = 'S'
SKC182*SJD121             MOVE '1'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           ELSE
SKC182*SJD121             MOVE '0'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           END-IF
SKC182*SJD121         END-IF
SIB201*
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo (CASO PARTICOLARE X COI):
DEB>>>*        DISPLAY 'FX07FAN9Q-D-STIPUL-OPE-O: ' FAN9Q-D-STIPUL-OPE-O
DEB>>>*        DISPLAY 'FX07FAN9Q-N-FINANZ-NUM-O: ' FAN9Q-N-FINANZ-NUM-O
SKA292         IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SLH051         OR W-F-EKFGT-SI
DEB>>>            DISPLAY 'SCRITTURA SONCO NUOVA'
SKA292*           PERFORM VERIFICA-IFICOINT
SKA292
SKA292            IF IFICOINT-SI
SKA292*- GESTIONE DEGLI IMPORTI TOTALI:
SKA292              IF W-I < W-N-CONTA-IAN
SKA292*- Scrivo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-C-PROPRI-IMM-COINT(W-Y)
SKC182                MOVE W-F-ABITAZ-PRI-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKA292              ELSE
SKA292*- Scrivo l'ultimo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKB261
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261                SET MUTUO-MISTO-2-NO     TO TRUE
SKB261                SET MUTUO-MISTO-3-NO     TO TRUE
SKB261                MOVE ZEROES              TO W-G
SKB261                PERFORM VARYING W-G FROM 1 BY 1
SKB261                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261                   IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(1) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(2) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(3) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(4) )
SKB261                      SET MUTUO-MISTO-2-SI TO TRUE
SKB261                   END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261                   IF W-F-ALTFIN-SOLO-SI
SKB261                   OR W-F-ALTFIN-COI-SI
SKB261                      SET MUTUO-MISTO-3-SI TO TRUE
SKB261                      SET MUTUO-MISTO-2-NO TO TRUE
SKB261                   END-IF
SKB261                END-PERFORM
SKC182                IF FINAL-MISTO-DIV
SLC102                OR FORZO-NON-MISTO-SI
DEB>>>*                  DISPLAY 'FX0709 SETTO NO|'
SKC182                   SET MUTUO-MISTO-3-SI TO TRUE
SKC182                   SET MUTUO-MISTO-2-NO TO TRUE
SKC182                END-IF
SKB261
SKB261                MOVE ZEROES              TO W-G
SKA292
SKB181*- Verifica "MUTUO MISTO":
SKB181                SET MUTUO-MISTO-NO       TO TRUE
SKB181                PERFORM VARYING W-G FROM 1 BY 1
SKB181                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB181                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB181                OR MUTUO-MISTO-SI
SKB181                   IF W-SO-FLAG-MISTO-COINT(W-G) = '1'
SKB261                   OR MUTUO-MISTO-2-SI
SKB181                      SET MUTUO-MISTO-SI TO TRUE
SKB181                   END-IF
SKB181                END-PERFORM
SKB251
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261*               SET MUTUO-MISTO-2-NO     TO TRUE
SKB261*               SET MUTUO-MISTO-3-NO     TO TRUE
SKB261*               MOVE ZEROES              TO W-G
SKB261*               PERFORM VARYING W-G FROM 1 BY 1
SKB261*               UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261*               OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261*                  IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(1) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(2) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(3) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(4) )
SKB261*                     SET MUTUO-MISTO-2-SI TO TRUE
SKB261*                  END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261*                  IF W-F-ALTFIN-SOLO-SI
SKB261*                  OR W-F-ALTFIN-COI-SI
SKB261*                     SET MUTUO-MISTO-3-SI TO TRUE
SKB261*                     SET MUTUO-MISTO-2-NO TO TRUE
SKB261*                  END-IF
SKB261*               END-PERFORM
SKB261*
SKB261*               MOVE ZEROES              TO W-G
SKC182
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale - tutti i COI devono essere
SKC182*  PROPRIETARI e solo ACQUISTO ABITAZIONE PRINCIPALE. Se supera
SKC182*  questo controllo, vado a testare l'abitazione principale:
SKC182                SET ABITAZ-PRI-NO        TO TRUE
SKC182                PERFORM VARYING W-G FROM 1 BY 1
SKC182                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                  IF  W-I-ACQPRI-IPO-COINT(W-G) =
SKC182                                 W-I-TOTFIN-IPO-COINT(W-G)
SKC182                  AND W-C-PROPRI-IMM-COINT(W-G) = '1'
SKC182                     SET ABITAZ-PRI-SI   TO TRUE
SKC182                  ELSE
SKC182                     SET ABITAZ-PRI-NO   TO TRUE
SKC182                  END-IF
SKC182                END-PERFORM
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale:
SKC182                IF ABITAZ-PRI-SI
SKC182                   PERFORM VARYING W-G FROM 1 BY 1
SKC182                   UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                   OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                      IF W-F-ABITAZ-PRI-COINT(W-G) = 'N'
SKC182                        MOVE '0'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      ELSE
SKC182                        MOVE '1'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      END-IF
SKC182                   END-PERFORM
SKC182                END-IF
SKB181
SMB153                MOVE ZEROES          TO W-I-PENALE
SKA292                PERFORM VARYING W-V FROM 1 BY 1
SKA292                UNTIL W-V > W-N-LUNGH-TAB-SONCO
SKA292                OR W-SO-C-NDGNDG-COD(W-V) NOT > SPACES
DEB>>>                  DISPLAY 'CICLO NUOVO PER NDG: '
DEB>>>                           W-SO-C-NDGNDG-COD(W-V)
SKA292*- Ciclo e scrivo SONCO effettivo:
SKA292                  MOVE W-SO-RECORD-DETTAGLIO-COINT(W-V)
SKA292                                         TO SONCORR2
SKA292                                            W-SONCO-APPO
SKA292*                 MOVE W-SO-INT-ONE-PAG-APPO
SKA292*                                        TO SO-IMP-INT-ONE-COINT
SKA292*                 MOVE W-SO-PEN-NON-DET-APPO
SKA292*                                        TO SO-IMP-PEN-COS-COINT
SKB251                  IF MUTUO-MISTO-2-SI
SKB251                     MOVE '1'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 1'
SKB251                  END-IF
SKB261                  IF MUTUO-MISTO-3-SI
SKB261                     MOVE '0'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 0'
SKB261                  END-IF
SKC182                  IF ABITAZ-PRI-SI
SKC182                     MOVE W-C-PROPRI-IMM-COINT(W-V) TO
SKC182                                               SO-PROPR-IMM-COINT
SKC182                  END-IF
SKB181                  IF MUTUO-MISTO-SI
SKB251                     MOVE W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-INT-ONE-COINT
SKB261                                     W-SO-IMP-INT-ONE-COINT-APPO
SKB251                     MOVE W-SO-PEN-NON-DET-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-PEN-COS-COINT
SKB261                                     W-SO-IMP-PEN-COS-COINT-APPO
SKB261                     MOVE W-SO-IMP-RPAG-COINT-PRE-TOT(W-V)
SKB261                                  TO W-SO-IMP-RATE-PAG-COINT-APPO
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-APPO: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-APPO
SKB181
SKB181                     MOVE W-I-ACQPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQPRI-IPO-APPO
SKB181                     MOVE W-I-ACQALT-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQALT-IPO-APPO
SKB181                     MOVE W-I-RISPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-RISPRI-IPO-APPO
SKB181                     MOVE W-I-ALTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-ALTFIN-IPO-APPO
SKB181                     MOVE W-I-AGRARI-IPO-COINT(W-V)
SKB181                                         TO W-I-AGRARI-IPO-APPO
SKB181                     MOVE W-I-TOTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-TOTFIN-IPO-APPO
SKB181                     MOVE W-SO-PEN-NON-DET-COINT-PRE(W-V)
SKB181                                         TO W-I-PENNON-PRE-APPO
SKB181                     MOVE W-SO-INT-ONE-PAG-COINT-PRE(W-V)
SKB181                                         TO W-I-INTONE-PRE-APPO
serena      display 'sm27 sono sotto data >2019 mutuo misto'
serena      display 'sm27 W-I-INTONE-PRE-APPO 1=' W-I-INTONE-PRE-APPO
SKB181                     PERFORM GESTIONE-MISTO-COI
SKC182                     IF FINAL-MISTO-DIV
SLC102                     OR FORZO-NON-MISTO-SI
DEB>>>*                       DISPLAY 'FX0709 SETTO NO| 22'
SKC182                        MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182                     END-IF
SKB181
SKB181                  ELSE
SKB181*- Li modifico solo se non sono "misto":
SKB181                     MOVE W-SO-INT-ONE-PAG-APPO
SKB181                                         TO SO-IMP-INT-ONE-COINT
SKB181                     MOVE W-SO-PEN-NON-DET-APPO
SKB181                                         TO SO-IMP-PEN-COS-COINT
SKB251*- Approssimazione degli importi:
SKB251                     PERFORM APPROSSIMA-DETRAZ
SKB251                     IF W-V = W-N-CONTA-IAN
SKB251                        PERFORM APPROSSIMA-DETRAZ-ULT
SKB251                     END-IF
SKB251                     IF W-SO-IMP-INT-ONE-COINT-9 > ZEROES
SKB251                        MOVE W-SO-IMP-INT-ONE-COINT-9
SKB251                                           TO SO-IMP-INT-ONE-COINT
SKB251                     END-IF
SKB181
SKC182                     IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182                     AND ACCOL-NOPROP-NO
DEB>>>                     DISPLAY 'SCRITTURA-SONCO 3'
SKA292                     PERFORM SCRITTURA-SONCO
SKC182                     END-IF
SKB181
SKB181                  END-IF
SKA292
SKA292                END-PERFORM
SKA292
SKA292                INITIALIZE               W-SO-RECORD
SKA292                                         W-SO-INT-ONE-PAG-APPO
SKA292                                         W-SO-PEN-NON-DET-APPO
SKB181                                         W-I-INTONE-PRE-APPO
SKB181                                         W-I-PENNON-PRE-APPO
SKA292
SKA292              END-IF
SKA292            ELSE
serena      display 'sm27 ificoint N'
SKB181              MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261              IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261              OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                 MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261              ELSE
SKB261                 IF FAN00-C-DESFIN-APP = '071A'
SKB261                 OR FAN00-C-DESFIN-APP = '071'
SKB261                 OR FAN00-C-DESFIN-APP = '081'
SKB261                    MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261                 IF FAN00-C-DESFIN-APP = '011A'
SKB261                 OR FAN00-C-DESFIN-APP = '011B'
SKB261                 OR FAN00-C-DESFIN-APP = '011'
SKB261                    MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261              END-IF
SKA292              MOVE SONCORR2               TO SONCOR22
serena              display 'sm27 scrivo sonco2'
SKA292              PERFORM SCRITTURA-SONC2
SKA292            END-IF
SKA292         ELSE
serena              display 'sm27 data < 2019'
DEB>>>            DISPLAY 'SCRITTURA SONCO STANDARD'
DEB>>>            DISPLAY 'SO-INT-ONE-PAG-COINT : '
DEB>>>                     SO-INT-ONE-PAG-COINT
DEB>>>            DISPLAY 'SO-TIPO-MUTUO-COINT  : '
DEB>>>                     SO-TIPO-MUTUO-COINT
DEB>>>            DISPLAY 'W-F-ACCOL-NOPROP     : '
DEB>>>                     W-F-ACCOL-NOPROP
SKC182            IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182            AND ACCOL-NOPROP-NO
DEB>>>            DISPLAY 'SCRITTURA-SONCO 4'
S1C251            PERFORM SCRITTURA-SONCO
SKC182            END-IF
SKA292         END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012         IF TRM-SI
SGB012            MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012            MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012         END-IF
S1C251        ELSE
S1C251           SET TROVATO-COINT-PG    TO TRUE
S1C251           DISPLAY '----ATTENZIONE---- '
S1C251                   'https://urldefense.com/v3/__http://FIN.TO__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ0qP69mN$  CON COINTESTATARIO PG -->  '
S1C251           FCEI1-C-FINANZ-PRE ' / ' FCEI1-N-FINANZ-NUM
S1C251        END-IF
S1C251       END-PERFORM
SKB251
SKB251*- Ordino e scrivo i mutui misti:
SKB251       MOVE ZEROES                    TO W-M
SKB251       IF MUTUO-MISTO-SI
DEB>>>          DISPLAY 'ELABORO MISTI|||'
SKB251          MOVE ZEROES          TO W-V
SKB251          PERFORM ORDINA-TIPO
SKB261
SKB261          MOVE ZEROES          TO W-V
SKB251          PERFORM VARYING W-V FROM 1 BY 1
SKB251          UNTIL W-V > W-N-LUNGH-TAB-MIS
SKB251          OR W-SO-TIPO-MUTUO-COINT-MIS(W-V) NOT > ZEROES
SKB251             MOVE W-SO-RECORD-DETTAGLIO-MIS(W-V) TO SONCORR2
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(1): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(1)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(2): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(2)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(3): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(3)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(4): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261
SKB261*- Sistemazione per importi TOTALI:
SKB261             IF SO-TIPO-MUTUO-COINT = '1'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(1) = '1'
DEB>>>*              DISPLAY 'FX0409 sistemazione 1'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(1)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 5: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(1)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 1: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(1)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '2'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(2) = '2'
DEB>>>*              DISPLAY 'FX0409 sistemazione 2'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(2)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 6: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(2)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 2: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '3'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(3) = '3'
DEB>>>*              DISPLAY 'FX0409 sistemazione 3'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(3)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 7: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(3)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 3: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(3) > ZEROES
SNC141               OR W-I-ACQALT-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(3)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '4'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(4) = '4'
DEB>>>*              DISPLAY 'FX0409 sistemazione 4'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(4)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 8: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(4)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 4: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(4) > ZEROES
SNC141               OR W-I-RISPRI-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SLH051*            Se ho solo una finalita certificabile vanno scritti
SLH051*            comunque tutti gli ndg (prima non scriveva i non
SLH051*            certificabili) ma deve essere segnato non misto.
SKC182             IF FINAL-MISTO-DIV
SLC102             OR FORZO-NON-MISTO-SI
SLH051             OR W-FINALI-TOT <= 1
DEB>>>*               DISPLAY 'FX0709 SETTO NO| 23'
SKC182                MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182             END-IF
SKB261
SLH051             IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051                MOVE SO-IMP-INIZ-COINT    TO SO-IMP-RATE-PAG-COINT
SLH051             END-IF
SLH051*
SMB153*            IF SO-PEN-NON-DET-COINT = '        0'
SMB153*               MOVE ZEROES               TO SO-IMP-PEN-COS-COINT
SMB153*            END-IF
SMB153*
SKC182             IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182             AND ACCOL-NOPROP-NO
DEB>>>             DISPLAY 'SCRITTURA-SONCO 5 misti'
SKB251             PERFORM SCRITTURA-SONCO
SKC182             END-IF
SKB251          END-PERFORM
SKB251       END-IF
SKB251
SKB251       PERFORM INIZIALIZZA-RICICLI
SKB251
S1C251      ELSE
SHL121*
SHL121*  2) Gestione Persone Fisiche:
SHL121*
DEB>>>       DISPLAY 'NON COINTESTATO: ' W-N-FINANZ-NUM ' - '
DEB>>>                IAN1I-C-NGIURI-COD-O
DEB>>>       IF IFICOINT-SI
DEB>>>          DISPLAY 'GIRO CON FGT'
DEB>>>       ELSE
DEB>>>          DISPLAY 'GIRO A VECCHIO'
DEB>>>       END-IF
DEB>>>*      IF ANA-SI
S1C251       PERFORM RECUPERA-PROV-NAS
SJD121
SJD121*- Accedo a tabella ANAGRAFE TRIBUTARIA per MONOINTESTATO:
SJD121       SET W-F-EKFGT-NO               TO TRUE
SKB261       SET W-F-ALTFIN-SOLO-NO         TO TRUE
SKA292       IF IFICOINT-SI
SKA292          MOVE IAN1I-C-NDGNDG-COD-O      TO W-C-NDGNDG-COD
SJD121          PERFORM VERIFICA-EKFGT
SKA292       END-IF
SJD121
DEB>>>*      END-IF
S1C251       MOVE 1                         TO  FANT1-N-COINTE-NUM
S1C251       MOVE 1                         TO  FANT1-N-COINTE-PRG
S1C251       MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO  FANT1-X-LOCNAS-NDG(6:55)
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251       PERFORM SCRITTURA-FANT1
S1C251*******************************************************
SGB012*
SGB012*- Scrittura flusso SONCO x ANAGRAFE TRIBUTARIA - NON COINTESTATO:
SGB012*
SGB012*- Gestione dati finanziamenti originari per Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE FAN00-G-AREA-FAN        TO WAFAN-AREA-TRM
SGB012          MOVE FAN9Q-G-AREA-O          TO WAFAN-AREA-FAN9-TRM
SGB012          MOVE FCEI1-C-FINANZ-PRE      TO W-C-FINANZ-PR2
SGB012          IF FCEI1-C-FINANZ-PRE = '41'
SGB012             MOVE '09'                 TO FCEI1-C-FINANZ-PRE
SGB012          ELSE
SGB012             MOVE '10'                 TO FCEI1-C-FINANZ-PRE
SGB012          END-IF
SGB012          PERFORM RICAVA-DATI-FAN
SGB012          MOVE W-C-FINANZ-PR2          TO FCEI1-C-FINANZ-PRE
SGB012       END-IF
S1C251       MOVE '1'                       TO SO-TIPO-REC
SHA041
SG0217       INITIALIZE SO-ID-MUTUO-INT
SHL121*S1C251       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SHL121*S1C251       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SHL121*S1C251       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SJB071*SIB201       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SJB071*SIB201       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SHA041*      MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*      IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*         MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*      ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*         MOVE SPACES                     TO W-FINANZ-PRE
SHA041*         IF FCEI1-C-FINANZ-PRE = '09'
SHA041*            MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*         ELSE
SHA041*            MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*         END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*         MOVE ALL ZEROES                TO W-C-FINANZ-NUM
SHA041*         MOVE FCEI1-N-FINANZ-NUM        TO W-N-FINANZ-NUM
SHA041*         MOVE W-C-FINANZ-NUM            TO W-FINANZ-NUM
SHA041*         MOVE ALL ZEROES                TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*         MOVE 'IST  '                   TO W-FILIA
SHA041*      END-IF
SHA041*      MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SHA041
SJB071
SJB071       MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071       IF FCEI1-C-IDENTI-RAP > SPACES
SJB071          MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071       ELSE
SJB071          MOVE '-'                    TO W-CAR-FISSO
SJB071          IF FAN00-F-CARTOL-FIN = 'S'
SJB071             MOVE 'CAR'               TO W-MUTUO-TIP
SJB071          ELSE
SJB071             MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071          END-IF
SJB071          MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211          MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071          MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211          IF FCEI1-C-FINANZ-PRE = '09'
SJB211             STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          ELSE
SJB211             STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071          MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071          MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071          MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211          MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211          MOVE 'IST00'                TO W-FILIA
SJB071       END-IF
SJB071       MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SJB071
S1C251       IF FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
CORRAD       OR FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
S1C251          MOVE FAN9Q-D-STIPUL-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
S1C251          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       ELSE
S1C251          MOVE FAN9Q-D-EROGAZ-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
SJB071*S1C251   COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-EROGAZ-FIN-O
SJB071          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       END-IF
S1G201*      COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
S1G201*                                             FCEI1-I-TOTANN-RAT-3
DEB>>>*      DISPLAY 'DATI NUOVI SONCO: '
S1G201       IF TROVATO-FIN-VALUTA
DEB>>>*         DISPLAY 'TROVATO-FIN-VALUTA'
S1G201          COMPUTE IMP-INIZ-INT-APPO ROUNDED =
S1G201                                            FCEI1-I-EROGAZ-FIN-VAL
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-VAL-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-VAL-3   TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-VAL-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP-VAL > ZEROES
SJB071          OR W-APPO-MORA            > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE-VAL > ZEROES
SNC091          OR W-I-NONTRAC-IMP-VAL    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                         FCEI1-I-NONDET-IMP-VAL +
SNC091                                         W-I-NONTRAC-IMP-VAL    +
SJB071                                         W-APPO-MORA            +
SJB071                                         FCEI1-I-ASSICU-ONE-VAL
SIB161*SHL121      MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071             MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       ELSE
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-3       TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP > ZEROES
SJB071          OR W-APPO-MORA        > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE > ZEROES
SNC091          OR W-I-NONTRAC-IMP    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                            FCEI1-I-NONDET-IMP +
SNC091                                            W-I-NONTRAC-IMP    +
SJB071                                            W-APPO-MORA        +
SJB071                                            FCEI1-I-ASSICU-ONE
SIB161*SHL121     MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071            MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       END-IF
SJD121*      IF  W-F-EKFGT-SI
SJD121*          COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
SJD121*                                           W-I-TOTIMP-TOT
SJD121*          MOVE IMP-INIZ-COINT-APPO       TO SO-IMP-INIZ-INT
SJD121*      END-IF
SGB012       MOVE IMP-RATE-PAG-INT-ARRO         TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O          TO IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'IMP-RATE-PAG-INT-APPO: '
DEB>>>*               IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'W-APPO-MORA          : '
DEB>>>*               W-APPO-MORA
S1C251       COMPUTE W-I-DELTA-MORA ROUNDED = IMP-RATE-PAG-INT-APPO
S1C251                                      - W-APPO-MORA
DEB>>>*      DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
displa*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' SO-IMP-RATE-PAG-INT
S1C251       MOVE IMP-RATE-PAG-INT-APPO       TO SO-IMP-RATE-PAG-INT
SLH051       IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051          MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051       END-IF
SLH051*
S2B161       IF   FCEI1-C-FINANZ-PRE NOT EQUAL '41'
S2B161       AND  FCEI1-C-FINANZ-PRE NOT EQUAL '42'
DEB>>>*        DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
DEB>>>*        DISPLAY 'IMP-INIZ-INT-APPO: ' IMP-INIZ-INT-APPO
S1C251         IF W-I-DELTA-MORA > IMP-INIZ-INT-APPO
DEB>>>          DISPLAY '|||||| ERRORE P020 PAG>MUTUO: ' W-N-FINANZ-NUM
SKB261          CONTINUE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'IMPORTO RATE PAGATE > https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  MUTUO'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P020'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S2B161       END-IF
DEB>>>*      DISPLAY 'FLUSSO SONCO X ANAGRAFE TRIBUTARIA - NON COI'
S1C251*      COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = FCEI1-I-ANNUAL-INT-1
SGB012
S1C251       COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = APPO-I-VOCE0  +
S1C251                                              APPO-I-VOCE2  +
S1C251                                              APPO-I-VOCE3  +
S1C251                                              APPO-I-VOCE7
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO: ' IMP-INT-ONE-INT-APPO
DEB>>>*      DISPLAY 'APPO-I-VOCE0: ' APPO-I-VOCE0
DEB>>>*      DISPLAY 'APPO-I-VOCE2: ' APPO-I-VOCE2
DEB>>>*      DISPLAY 'APPO-I-VOCE3: ' APPO-I-VOCE3
DEB>>>*      DISPLAY 'APPO-I-VOCE7: ' APPO-I-VOCE7
SGB012
SGB012       PERFORM IMPORTI-ANAGRAFE
SGB012       IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA-VAL +
SNB211*SGB012                                       W-I-SPERAT-ANA-VAL +
SGB012                                            W-I-SPEIST-ANA-VAL +
SGB012                                            W-I-IMPSOS-ANA-VAL +
SGB012                                            W-I-PENEST-ANA-VAL +
SGB012                                            W-I-COMINT-ANA-VAL +
SGB012                                            W-I-ONEACC-ANA-VAL +
SGB012                                            W-I-ONESAL-ANA-VAL +
SGB012                                            W-I-ONECER-ANA-VAL
SGB012       ELSE
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA +
SNB211*SGB012                                           W-I-SPERAT-ANA +
SGB012                                            W-I-SPEIST-ANA +
SGB012                                            W-I-IMPSOS-ANA +
SGB012                                            W-I-PENEST-ANA +
SGB012                                            W-I-COMINT-ANA +
SGB012                                            W-I-ONEACC-ANA +
SGB012                                            W-I-ONESAL-ANA +
SGB012                                            W-I-ONECER-ANA
DEB>>>          DISPLAY 'W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>          DISPLAY 'W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>          DISPLAY 'W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>          DISPLAY 'W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>          DISPLAY 'W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>          DISPLAY 'W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>          DISPLAY 'W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>          DISPLAY 'W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>          DISPLAY 'W-I-ONECER-ANA: ' W-I-ONECER-ANA
SGB012       END-IF
SKA292
SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoi record.
SKB181       SET ALTRI-IMM-NO              TO TRUE
SJD121       IF  W-F-EKFGT-SI
SJD121           MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121           MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121           MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121           MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121           MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121           MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121    MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121    MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121    MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121    MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182           MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182           MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182           MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182           MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121           PERFORM ORDINA-IMPORTI
SJD121
SJD121           EVALUATE TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SJD121               SET AGRARIO-INT      TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SJD121               SET ABIT-PRIN-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121    WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SJD121               SET ALTRI-IMM-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SJD121               SET COST-RIST-INT    TO TRUE
SKC182           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182               SET ALTFIN-INT       TO TRUE
SJD121           END-EVALUATE
SKB181           IF ALTRI-IMM-INT
SKB181           AND W-I-AGRARI-IPO =  ZEROES
SKB181           AND W-I-ACQPRI-IPO =  ZEROES
SKB181           AND W-I-RISPRI-IPO =  ZEROES
SKB181              SET ALTRI-IMM-SI          TO TRUE
SKB181           END-IF
SJD121       END-IF
SKB181
SKB181       MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-INT-ONE-PAG-COINT-ARRO
SKB181       MOVE IMP-PEN-COS-NONDET       TO W-PEN-NON-DET-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE MONO:
SKA292       IF W-F-EKFGT-SI
SKB181         IF ALTRI-IMM-SI
SKB181           CONTINUE
SKB181         ELSE
DEB>>>          DISPLAY 'APPLICO DETRAZIONE PF|'
SKA292          MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-I-DETRAZ-IMP
SKA292                                           W-I-DETRAZ-APP
SKA292          PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292          MOVE W-I-DETRAZ-IMP TO IMP-INT-ONE-INT-ARRO-NEW
SKA292          COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                   W-I-DETRAZ-IMP
SKA292          COMPUTE W-SO-IMP-PEN-NON-DET = IMP-PEN-COS-NONDET +
SKA292                                       W-I-NONDET-IMP
SKA292          MOVE W-SO-IMP-PEN-NON-DET    TO W-I-IMPORT-ARR
SKA292          PERFORM ARROTONDA-IMPORTO
SKA292          MOVE IARRU-I-IMPORT-ARR-O    TO SO-IMP-PEN-NON-DET
SKB181         END-IF
SKA292       END-IF
SKA292
SGB012       MOVE IMP-INT-ONE-INT-ARRO-NEW  TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O      TO IMP-INT-ONE-INT-APPO-NEW
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO    : '
DEB>>>*               IMP-INT-ONE-INT-APPO
DEB>>>*      DISPLAY ' -->   APPO-I-VOCE0  : ' APPO-I-VOCE0
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE2  : ' APPO-I-VOCE2
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE3  : ' APPO-I-VOCE3
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE7  : ' APPO-I-VOCE7
DEB>>>       DISPLAY 'IMP-INT-ONE-INT-ARRO-NEW 2: '
DEB>>>                IMP-INT-ONE-INT-ARRO-NEW
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO-NEW: '
DEB>>>*               IMP-INT-ONE-INT-APPO-NEW
DEB>>>*      IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-ANA-VAL: ' W-I-INTVAR-ANA-VAL
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-TOT-VAL: ' W-I-INTVAR-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-ANA-VAL: ' W-I-SPERAT-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-TOT-VAL: ' W-I-SPERAT-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-ANA-VAL: ' W-I-SPEIST-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-TOT-VAL: ' W-I-SPEIST-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-ANA-VAL: ' W-I-IMPSOS-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-TOT-VAL: ' W-I-IMPSOS-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-PENEST-ANA-VAL: ' W-I-PENEST-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-PENEST-TOT-VAL: ' W-I-PENEST-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-COMINT-ANA-VAL: ' W-I-COMINT-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-COMINT-TOT-VAL: ' W-I-COMINT-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-ANA-VAL: ' W-I-ONEACC-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-TOT-VAL: ' W-I-ONEACC-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-ANA-VAL: ' W-I-ONESAL-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-TOT-VAL: ' W-I-ONESAL-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONECER-ANA-VAL: ' W-I-ONECER-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONECER-TOT-VAL: ' W-I-ONECER-TOT-VAL
DEB>>>*      DISPLAY '****'
DEB>>>*      ELSE
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-TOT: ' W-I-INTVAR-TOT
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-TOT: ' W-I-SPERAT-TOT
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-TOT: ' W-I-SPEIST-TOT
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-TOT: ' W-I-IMPSOS-TOT
DEB>>>*      DISPLAY ' --> + W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>*      DISPLAY ' --> + W-I-PENEST-TOT: ' W-I-PENEST-TOT
DEB>>>*      DISPLAY ' --> + W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>*      DISPLAY ' --> + W-I-COMINT-TOT: ' W-I-COMINT-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-TOT: ' W-I-ONEACC-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-TOT: ' W-I-ONESAL-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONECER-ANA: ' W-I-ONECER-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONECER-TOT: ' W-I-ONECER-TOT
DEB>>>*      DISPLAY '****'
DEB>>>*      END-IF
DEB>>>*      DISPLAY 'IMPORTI APPO '  APPO-I-VOCE0 ' '  APPO-I-VOCE2
DEB>>>*          ' '  APPO-I-VOCE3 ' ' APPO-I-VOCE7
SGB012*S1C251    MOVE IMP-INT-ONE-INT-APPO        TO SO-IMP-INT-ONE-INT
SGB012       MOVE IMP-INT-ONE-INT-APPO-NEW    TO SO-IMP-INT-ONE-INT
SGB012*S1C251       IF IMP-INT-ONE-INT-APPO > IMP-RATE-PAG-INT-APPO
SGB012       IF IMP-INT-ONE-INT-APPO-NEW > IMP-RATE-PAG-INT-APPO
DISPLA*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' IMP-INT-ONE-INT-APPO
DISPLA*           ' '  SO-IMP-INT-ONE-INT ' ' SO-IMP-RATE-PAG-INT
S1C251          MOVE SO-IMP-INT-ONE-INT       TO SO-IMP-RATE-PAG-INT
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121          IF RATE-A-ZERO-SI
SLC151*SLC121          AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151          IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121          END-IF
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
S1C251*      AND FAN9Q-D-ESTINZ-DAT-O ='0001-01-01'
S1C251*      AND FAN9Q-D-SCDPRI-DAT-O <= EKIFB-D-RIFERI-OPE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  INTERESSI E ONERI > IMPORTO RATE PAGATE'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P021'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251       END-IF
SKB281       MOVE SO-IMP-RATE-PAG-INT       TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 9: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
DEB>>>*      DISPLAY 'SO-IMP-INT-ONE-INT FINE: '
DEB>>>*               SO-IMP-INT-ONE-INT
SOE142*SHA041       MOVE FCEI1-F-ESTINZ-TIP        TO SO-FLAG-ESTINZ-INT
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP = 'E'
SOE142             MOVE '3'                   TO SO-FLAG-ESTINZ-INT
SOE142         ELSE
SOE142             MOVE FCEI1-F-ESTINZ-TIP    TO SO-FLAG-ESTINZ-INT
SOE142         END-IF
DEBUG>*        DISPLAY 'SO-FLAG-ESTINZ-INT>' SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 SO-FLAG-ESTINZ-INT: '
DEB>>>*                        SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
SKC182*- Se il MUTUO } ACCOLLATO (SO-FLAG-ESTINZ-INT a "4") ed il
SKC182*  flag PROPRIETA' non } valorizzato --> non lo comunico|
SKC182       SET ACCOL-NOPROP-NO            TO TRUE
SKC182       IF SO-FLAG-ESTINZ-INT = '4'
SKC182       AND W-F-PROPRI-IMM = 'N'
SKC182           SET ACCOL-NOPROP-SI        TO TRUE
DEB>>>*           DISPLAY 'SETTO ACCOL-NOPROP-SI|||'
SKC182       END-IF
SMK281
SMK281       MOVE SPACES                    TO SO-FLAG-OPESOC-INT
SMK281       MOVE SPACES                    TO SO-ID-MUTUO-CED-INT
SKB181
SKB181       IF  W-F-EKFGT-NO
SKB181
S1C251       SET NO-TROVATO-TIPO-FIN        TO TRUE
S1C251       IF FAN9Q-C-TIPO-FINAN-O = 'AGR'
SG0215       OR FAN9Q-C-TIPO-FINAN-O = 'MAG'
S1C251          MOVE 1                      TO SO-TIPO-MUTUO-INT
S1C251       ELSE
S1C251          IF (FAN9Q-C-TIPO-FINAN-O = 'MUT' OR 'VUT'
SIB201*SG0215          OR  'MAT')
SIB201          OR  'MAT' OR 'PIV' )
S1C251          AND FCEI1-C-GARANZ-TIP = 'I'
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '070'  OR '070A' OR
S1C251*                                         '070B' OR '071'  OR
S1C251*                                         '080A' OR '081'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '071A' OR '071'  OR
SG0215                                          '081'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 2                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '010' OR '010A' OR
S1C251*                                         '011' OR '130B' OR
S1C251*                                         '130C'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '011A' OR '011B' OR
SG0215                                          '011'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 4                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251            IF NO-TROVATO-TIPO-FIN
S1C251               MOVE 3                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251          END-IF
S1C251       END-IF
SKB181
SKB181       END-IF
SKB181
SHL121
SIB161*SHL121       MOVE '0'                       TO SO-FLAG-MISTO-INT
SJB071       MOVE '0'                       TO SO-FLAG-MISTO-INT
SKB181       SET MUTUO-MISTO-NO             TO TRUE
SKB181       MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121       IF  W-F-EKFGT-SI
SJD121           EVALUATE TRUE
SJD121           WHEN    W-I-AGRARI-IPO > 0
SJD121               MOVE '0'                 TO SO-FLAG-MISTO-INT
SKB181               SET MUTUO-MISTO-NO       TO TRUE
SJD121           WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181               COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                        W-I-ALTFIN-IPO
SJD121               IF (W-I-ACQPRI-IPO   > 0
SJD121               AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121        AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182               OR (W-I-ACQALT-IPO   > 0
SKC182               AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121               OR (W-I-RISPRI-IPO   > 0
SJD121               AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121        AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181        OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181        AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                   MOVE '1'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-SI   TO TRUE
SJD121               ELSE
SJD121                   MOVE '0'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-NO   TO TRUE
SJD121               END-IF
SJD121            END-EVALUATE
SJD121       END-IF
SHL121
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-INT
S1C251       MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-INT
S1C251       MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-INT
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-INT
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-INT
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251       MOVE W-APPX-GG                 TO W-APP9-GG
S1C251       MOVE W-APPX-MM                 TO W-APP9-MM
S1C251       MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251       MOVE W-APP9-GG              TO SO-DATA-NASCITA-INT(1:2)
S1C251       MOVE W-APP9-MM              TO SO-DATA-NASCITA-INT(3:2)
S1C251       MOVE W-APP9-SSAA            TO SO-DATA-NASCITA-INT(5:4)
S1C251       MOVE SPACES                 TO FILLER-INT
S1C251       MOVE 'A'                    TO SO-CAR-CONTROLLO-INT
S1C251       MOVE W-C-FINE-RIGA(2:1)     TO SO-CAR-FINE-RIGA-INT(1:1)
S1C251       MOVE W-C-FINE-RIGA(4:1)     TO SO-CAR-FINE-RIGA-INT(2:1)
SKA292
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo:
DEB>>>*      DISPLAY 'FX2007 FAN9Q-D-STIPUL-OPE-O: 'FAN9Q-D-STIPUL-OPE-O
DEB>>>*      DISPLAY 'FX2007 FAN9Q-N-FINANZ-NUM-O: 'FAN9Q-N-FINANZ-NUM-O
SKA292       IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SKA292          IF IFICOINT-SI
DEB>>>*      DISPLAY 'FX2007 IFICOINT-SI'
SKB181            IF MUTUO-MISTO-SI
DEB>>>               DISPLAY 'MUTUO MISTO|'
SKB181
SKB181               MOVE SONCORR2             TO W-SONCO-APPO
SKB181
SKB181               MOVE IAN1I-C-NDGNDG-COD-O TO W-C-NDGNDG-COD
SKB181               PERFORM REPERISCI-IMPORTI-FGT
SKB181               MOVE W-I-ACQPRI-IPO
SKB181                                   TO W-I-ACQPRI-IPO-APPO
SKB181               MOVE W-I-ACQALT-IPO
SKB181                                   TO W-I-ACQALT-IPO-APPO
SKB181               MOVE W-I-RISPRI-IPO
SKB181                                   TO W-I-RISPRI-IPO-APPO
SKB181               MOVE W-I-ALTFIN-IPO
SKB181                                   TO W-I-ALTFIN-IPO-APPO
SKB181               MOVE W-I-AGRARI-IPO
SKB181                                   TO W-I-AGRARI-IPO-APPO
SKB181               MOVE W-I-TOTFIN-IPO
SKB181                                   TO W-I-TOTFIN-IPO-APPO
SKB181               MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                                   TO W-I-INTONE-PRE-APPO
SKB181               MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                                   TO W-I-PENNON-PRE-APPO
SKB261               MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                                   TO W-I-TOTRAT-PAG-APPO
SKB181
SKB181               PERFORM GESTIONE-MISTO-PF
SKA292
SKB181               INITIALIZE             W-I-INTONE-PRE-APPO
SKB181                                      W-I-PENNON-PRE-APPO
SKB281                                      W-I-TOTRAT-PAG-APPO
SKB181
SKB181            ELSE
SKC182*             IF W-F-ALTFIN-SOLO-NO
DEB>>>*             DISPLAY 'SO-TIPO-MUTUO-INT: '
DEB>>>*                      SO-TIPO-MUTUO-INT
DEB>>>*             DISPLAY 'W-F-ACCOL-NOPROP: '
DEB>>>*                      W-F-ACCOL-NOPROP
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281              IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281                 MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281              END-IF
SLC043              IF SO-TIPO-MUTUO-INT NOT = '5'
SLC043              AND ACCOL-NOPROP-NO
DEB>>>                DISPLAY 'SCRITTURA-SONCO 6'
SKA292                PERFORM SCRITTURA-SONCO
SLC043              END-IF
SKC182*             END-IF
SKB181            END-IF
SKA292          ELSE
SKB181             MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261             IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261             OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261             ELSE
SKB261                IF FAN00-C-DESFIN-APP = '071A'
SKB261                OR FAN00-C-DESFIN-APP = '071'
SKB261                OR FAN00-C-DESFIN-APP = '081'
SKB261                   MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261                IF FAN00-C-DESFIN-APP = '011A'
SKB261                OR FAN00-C-DESFIN-APP = '011B'
SKB261                OR FAN00-C-DESFIN-APP = '011'
SKB261                   MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261             END-IF
SKA292             MOVE SONCORR2               TO SONCOR22
SKA292             PERFORM SCRITTURA-SONC2
SKA292          END-IF
SKA292       ELSE
DEB>>>          DISPLAY 'SCRITTURA-SONCO 7: 'SO-TIPO-MUTUO-INT
SKC182          IF SO-TIPO-MUTUO-INT NOT = '5'
SKC182          AND ACCOL-NOPROP-NO
DEB>>>          DISPLAY 'SCRITTURA-SONCO'
S1C251          PERFORM SCRITTURA-SONCO
SKC182          END-IF
SKA292       END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012          MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012       END-IF
S1C251      END-IF
S1C251     END-IF
SKB251
SKB251     PERFORM INIZIALIZZA-RICICLI
SJB071
SJB071*- Verifiche su flag propriet{ per cointestati:
SJB071     IF IAN1I-C-NGIURI-COD-O = 'COI'
SJB071        MOVE ZEROES                   TO W-X
SJB071        SET PRO-NO                    TO TRUE
SJB071        PERFORM VARYING W-X FROM 1 BY 1
SJB071         UNTIL W-K > 500
SJB071         OR W-C-NDGNDG-COD-COI(W-X) = SPACES OR LOW-VALUES
SJB071            IF W-C-PROPRI-IMM-COI(W-X) = '1'
SJB071               SET PRO-NO             TO TRUE
SJB071            END-IF
SJB071        END-PERFORM
SJB071
SJB071        IF PRO-NO
SJB071           MOVE '0231'                TO EKERR-C-COD-ERRORE(1)
SJB071           MOVE 'P024'                TO EKERR-C-RIF-ERRORE(1)
SJB071           MOVE 'FLAG PROPRIETA'' NON VALORIZZATO'
SJB071                                      TO EKERR-X-DES-ERRORE(1)
SJB071           PERFORM MESSAGGIO-WARNING
SJB071        END-IF
SJB071     END-IF
DEB>>>*    DISPLAY 'FINE FANT1 E SONCO'
090309     .

AGGTRI RECUPERA-PROV-NAS.
AGGTRI     MOVE 'RECUPERA-PROV-NAS'         TO IDBGU-X-LABEL-TRAC
AGGTRI     MOVE 3                           TO IDBGU-C-LIVELL-TRA
AGGTRI     PERFORM R-TRACE-LABEL.
AGGTRI
AGGTRI* CHIAMATA AD ANAGRAFE PER AVERE I DATI DELL'NDG DEL MUTUO
AGGTRI* NB: CHIAMO DIRETTAMENTE I MODLULI DI ANAGRAFE AGR033 E AGR080
AGGTRI* PERCHE' MI SERVONO DEI DATI CHE I MODULI INTERFACCIA ELISE DI
AGGTRI* CHIAMATA ALL'ANAGRAFE (EKIAN...) NON RESTITUISCONO.
AGGTRI
AGGTRI**** CHIAMATA A AGR0033
AGGTRI     INITIALIZE                          AGR33-AREA
AGGTRI     MOVE IAN1I-C-NDGNDG-COD-O        TO AGR33-I-NDG
AGGTRI     PERFORM CL-AGR0033
AGGTRI
AGGTRI     EVALUATE AGR33-S-FLAG
AGGTRI      WHEN '0'
AGGTRI        IF AGR33-O-NGIURI = 'PF   '
S1C251*          MOVE AGR33-O-PRNAS    TO     SO-PROV-NASCITA
S1C251           MOVE AGR33-O-PRNAS    TO     SO-PROVINCIA-COINT
S1C251                                        SO-PROVINCIA-INT
S1C251*          MOVE AGR33-O-PRNAS    TO     S1-PROV-NASCITA
AGGTRI           MOVE AGR33-O-PRNAS    TO     FANT1-X-LOCNAS-NDG(1:2)
                 IF AGR33-O-PRNAS EQUAL SPACES
                 IF IAN1I-C-FISCAL-COD-O(12:1) = 'Z'
S1C251*            MOVE 'EE'             TO     SO-PROV-NASCITA
S1C251             MOVE 'EE'             TO     SO-PROVINCIA-COINT
S1C251                                          SO-PROVINCIA-INT
S1C251*            MOVE 'EE'             TO     S1-PROV-NASCITA
TTTTTT             MOVE 'EE'             TO     FANT1-X-LOCNAS-NDG(1:2)
                 ELSE
                DISPLAY  'NON TROVATA PROVINCIA  DI NASCITA '
                         'PER  CITTADINI ITALIANO: 'IAN1I-C-FISCAL-COD-O
                 END-IF
                 END-IF
AGGTRI        END-IF
AGGTRI      WHEN '1'
AGGTRI        MOVE '0414'                   TO EKERR-C-COD-ERRORE(1)
AGGTRI        SET EKERR-ERR-GENERICO        TO TRUE
AGGTRI*  NDG NON PRESENTE IN ANAGRAFE
AGGTRI        MOVE AGR33-I-NDG              TO EKERR-X-DES-ERRORE(1)
AGGTRI        MOVE 'AGR33-I-NDG'            TO EKERR-X-DAT-ERRATO(1)
AGGTRI        MOVE '0001'                   TO EKERR-C-RIF-ERRORE(1)
AGGTRI        PERFORM ERRORE-GRAVE
AGGTRI      WHEN OTHER
AGGTRI         MOVE '0410'                  TO EKERR-C-COD-ERRORE(1)
AGGTRI         SET EKERR-ERR-GENERICO       TO TRUE
AGGTRI         STRING AGR33-S-FLAG
AGGTRI                ': ERRORE DI MODULO'
AGGTRI                DELIMITED BY SIZE
AGGTRI                                    INTO EKERR-X-DES-ERRORE(1)
AGGTRI         MOVE 'AGR33-I-NDG'           TO EKERR-X-DAT-ERRATO(1)
SHL121*AGGTRI  MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
SHL121         MOVE '0004'                  TO EKERR-C-RIF-ERRORE(1)
AGGTRI         PERFORM ERRORE-GRAVE
AGGTRI     END-EVALUATE
AGGTRI     .
090309*
090309 ESTRAI-NDG-COLLEGATI.
090309     MOVE 'ESTRAI-NDG-COLLEGATI'    TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     INITIALIZE IAN3I-G-GROUP-AREA
090309     SET IAN3I-LISTA-LEGAMI         TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN3I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN3I-C-CODICE-ABI-I
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO IAN3I-C-NDGNDG-COD-I
090309     EVALUATE IAN1I-C-NGIURI-COD-O
090309*    EVALUATE W-C-NGIURI-COD
090309     WHEN 'COI'
090309       MOVE '01'                    TO IAN3I-C-LEGAME-TIP-I
090309     WHEN 'DI'
090309*- 7 PER DITTA
090309       MOVE '07'                    TO IAN3I-C-LEGAME-TIP-I
090309     WHEN OTHER
090309*- 16 PER SOCIETA'
090309       MOVE '16'                    TO IAN3I-C-LEGAME-TIP-I
090309     END-EVALUATE.
090309
090309     PERFORM CL-EKIAN3IB
090309
090309     IF IAN3I-ERR-NON-TROVATO
090309     AND IAN1I-C-NGIURI-COD-O NOT = 'COI'
090309        MOVE '7'                   TO IAN3I-C-LEGAME-TIP-I
090309        PERFORM CL-EKIAN3IB
090309     END-IF
090309
090309     IF NOT IAN3I-OK
090309     AND NOT IAN3I-ERR-NON-TROVATO
090309         MOVE IAN3I-G-ESITO-AREA    TO EKERR-G-ESITO-AREA
090309         MOVE IAN3I-C-TIPO-ESITO    TO EKERR-C-TIPO-ESITO
090309         PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF.
090309*
090309 REPER-INTEST.
090309     MOVE 'REPER-INTEST'            TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL
090309
090309     INITIALIZE IAN1I-G-GROUP-AREA
090309     SET IAN1I-CTRL-NDGNDG          TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN1I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN1I-C-CODICE-ABI-I
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO IAN1I-C-NDGNDG-COD-I
080526     MOVE FAN9Q-G-AREA-O            TO IAN1I-G-AREA-FAN
090309
090309     PERFORM CL-EKIAN1IB
090309
090309     IF NOT IAN1I-OK
090309        MOVE IAN1I-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT    TO TRUE
090309        PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF
090309     .
090309*
090309 REPER-INTEST-COI.
090309     MOVE 'REPER-INTEST-COI'        TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL
090309
090309     INITIALIZE IAN1I-G-GROUP-AREA
090309     SET IAN1I-CTRL-NDGNDG          TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN1I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN1I-C-CODICE-ABI-I
090309     MOVE IAN3I-C-NDGNDG-COD-O(W-I) TO IAN1I-C-NDGNDG-COD-I
080526     MOVE FAN9Q-G-AREA-O            TO IAN1I-G-AREA-FAN
090309
090309     PERFORM CL-EKIAN1IB
090309
090309     IF NOT IAN1I-OK
090309        MOVE IAN1I-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT    TO TRUE
090309        PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF
090309*    DISPLAY 'IAN1I-X-NDGNDG-DES-O ' IAN1I-X-NDGNDG-DES-O
090309*    DISPLAY 'IAN1I-C-NDGNDG-COD-O 'IAN1I-C-NDGNDG-COD-O
090309*    DISPLAY 'IAN1I-C-LINGUA-COD-O 'IAN1I-C-LINGUA-COD-O
090309*    DISPLAY 'IAN1I-C-RESIDE-VIA-O 'IAN1I-C-RESIDE-VIA-O
090309*    DISPLAY 'IAN1I-C-RESIDE-NUM-O 'IAN1I-C-RESIDE-NUM-O
090309*    DISPLAY 'IAN1I-C-RESIDE-COM-O 'IAN1I-C-RESIDE-COM-O
090309*    DISPLAY 'IAN1I-C-RESIDE-CAP-O 'IAN1I-C-RESIDE-CAP-O
090309*    DISPLAY 'IAN1I-C-RESIDE-PRO-O 'IAN1I-C-RESIDE-PRO-O
090309*    DISPLAY 'IAN1I-C-RESIDE-NAZ-O 'IAN1I-C-RESIDE-NAZ-O
090309*    DISPLAY 'IAN1I-C-LINGUA-OPE-O 'IAN1I-C-LINGUA-OPE-O
090309     .
S1G201*
S1G201 IMPORTI-EKFER-VALUTA.
S1G201     MOVE 'IMPORTI-EKFER-VALUTA'    TO IDBGU-X-LABEL-TRAC
S1G201     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S1G201     PERFORM R-TRACE-LABEL.
S1G201*
S1G201     INITIALIZE FER9Q-G-GROUP-AREA
S1G201     SET FER9Q-SELECT-002               TO TRUE
S1G201     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FER9Q-C-GRUPPO-ABI-I
S1G201     MOVE FAN9Q-C-CODICE-ABI-O          TO FER9Q-C-CODICE-ABI-I
S1G201     MOVE FAN9Q-C-FINANZ-PRE-O          TO FER9Q-C-FINANZ-PRE-I
S1G201     MOVE FAN9Q-N-FINANZ-NUM-O          TO FER9Q-N-FINANZ-NUM-I
S1G201     MOVE 'DEF'                         TO FER9Q-C-EROGAZ-TIP-I
S1G201     PERFORM CL-EKFER9QB
S1G201
S1G201     IF NOT FER9Q-OK
S1G201        MOVE FER9Q-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
S1G201        SET EKERR-ERR-DATI-INPUT        TO TRUE
S1G201        PERFORM R-ERRORE-NON-GESTIBILE
S1G201     END-IF
S1G201     .
S1G201*
S5B091
S5B091 REPERIMENTO-LEGAMI-FIN.
S5B091     MOVE 'REPERIMENTO-LEGAMI-FIN'  TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL.
S5B091
S5B091     MOVE 1                         TO W-L
S5B091
S5B091*- ACCESSO NELLA EKFLF (TABELLA LEGAMI TRA FINANZIAMENTI)
S5B091*- PER RECUPERARE EVENTUALI LDF LEGATI AL FINANZIAMENTO
S5B091*- PRINCIPALE
S5B091     PERFORM VERIFICA-ESISTENZA-LEGAMI
S5B091
S5B091     IF FLF9Q-OK
S5B091        PERFORM UNTIL FLF9Q-ERR-NON-TROVATO
S5B091            PERFORM CTRL-DEFINIZIONE-LEGAME
S5B091*- CARICO NELLA TABELLA D'APPOGGIO SOLO I FINANZIAMENTI CHE
S5B091*- PREVEDONO LA CERTIFICAZIONE INTERESSI IN SINCRONIZZAZIONE:
S5B091            IF EKP10-C-SINCRO-CER = 'P'
S5B091              SET SI-LEGAMI-FIN         TO TRUE
S5B091              MOVE FLF9Q-C-FINANZ-PR2-O TO WAPPO-C-FINANZ-PRE(W-L)
S5B091              MOVE FLF9Q-N-FINANZ-NU2-O TO WAPPO-N-FINANZ-NUM(W-L)
S5B091              MOVE FLF9Q-C-MULTIL-COD-O TO WAPPO-C-MULTIL-COD(W-L)
S5B091              ADD 1                     TO W-L
S5B091            END-IF
S5B091
S5B091            SET FLF9Q-FETCUR-001        TO TRUE
S5B091            PERFORM CL-EKFLF9QB
S5B091        END-PERFORM
S5B091     END-IF
S5B091     SET FLF9Q-CLOCUR-001               TO TRUE
S5B091     PERFORM CL-EKFLF9QB.

S5B091
S5B091 VERIFICA-ESISTENZA-LEGAMI.
S5B091     MOVE 'VERIFICA-ESISTENZA-LEGAMI'   TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                             TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL
S5B091
S5B091     INITIALIZE                            FLF9Q-G-GROUP-AREA
S5B091     MOVE FAN9Q-C-CODICE-ABI-O          TO FLF9Q-C-GRUPPO-ABI-I
S5B091     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FLF9Q-C-CODICE-ABI-I
S5B091     MOVE FAN9Q-C-FINANZ-PRE-O          TO FLF9Q-C-CONTRA-PRE-I
S5B091     MOVE FAN9Q-N-FINANZ-NUM-O          TO FLF9Q-N-CONTRA-NUM-I
SOJ311*S5B091     MOVE EKSYS-D-SYSTEM-OPE    TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
S5B091     SET FLF9Q-OPEFET-001               TO TRUE
S5B091
S5B091     PERFORM CL-EKFLF9QB
S5B091
S5B091     IF  NOT FLF9Q-OK
S5B091     AND NOT FLF9Q-ERR-NON-TROVATO
S5B091        MOVE FLF9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
S5B091        SET EKERR-ERR-DATI-INPUT    TO TRUE
S5B091        PERFORM R-ERRORE-GESTIBILE
S5B091     END-IF.
S5B091*
SND171 VERIFICA-RINEGOZIATO.
SND171     MOVE 'VERIFICA-RINEGOZIATO     '   TO IDBGU-X-LABEL-TRAC
SND171     MOVE 3                             TO IDBGU-C-LIVELL-TRA
SND171     PERFORM R-TRACE-LABEL
SND171
SND171     INITIALIZE                            FLF9Q-G-GROUP-AREA
SND171                                           W-C-FINANZ-PRE-RIN
SND171                                           W-N-FINANZ-NUM-RIN
SND171     MOVE FAN9Q-C-CODICE-ABI-O          TO FLF9Q-C-GRUPPO-ABI-I
SND171     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FLF9Q-C-CODICE-ABI-I
SND171     MOVE FAN9Q-C-FINANZ-PRE-O          TO FLF9Q-C-FINANZ-PR2-I
SND171     MOVE FAN9Q-N-FINANZ-NUM-O          TO FLF9Q-N-FINANZ-NU2-I
SOJ311*SND171     MOVE EKSYS-D-SYSTEM-OPE     TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
SND171     MOVE '00002'                       TO FLF9Q-C-MULTIL-COD-I
SND171     SET FLF9Q-SELECT-004               TO TRUE
SND171     PERFORM CL-EKFLF9QB
SND171*
SND171     IF  FLF9Q-OK
SND171     AND FLF9Q-C-MULTIL-COD-O = '00002'
DEB>>>*       DISPLAY 'SONO IL COFINANZIAMENTO COLLEGATO'
SND171        MOVE FLF9Q-C-FINANZ-PRE-O   TO W-C-FINANZ-PRE-RIN
SND171        MOVE FLF9Q-N-FINANZ-NUM-O   TO W-N-FINANZ-NUM-RIN
SND171     END-IF
SND171     .
S5B091
S5B091 CTRL-DEFINIZIONE-LEGAME.
S5B091     MOVE 'CTRL-DEFINIZIONE-LEGAME'     TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                             TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL
S5B091
S5B091*-- RECUPERO LA MODALITA' DI ACCENSIONE PREVISTA PER IL COD.LEGAME
S5B091     INITIALIZE                         ITB9Q-G-GROUP-AREA
S5B091     INITIALIZE                         EKP10-G-GROUP-AREA
S5B091     MOVE FAN9Q-C-CODICE-ABI-O      TO  EKP10-C-GRUPPO-ABI
S5B091     MOVE FAN9Q-C-GRUPPO-ABI-O      TO  EKP10-C-CODICE-ABI
S5B091     MOVE 'EKP10'                   TO  EKP10-C-NOME-TABEL
S5B091     MOVE FLF9Q-C-MULTIL-COD-O      TO  EKP10-C-MULTIL-COD
S5B091     MOVE EKP10-G-CHIAVE            TO  ITB9Q-G-CHIAVE
S5B091     SET ITB9Q-SELECT-001           TO TRUE
S5B091
S5B091     PERFORM CL-EKITB9QB
S5B091
S5B091     IF NOT ITB9Q-OK
S5B091        MOVE ITB9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
S5B091        SET EKERR-ERR-DATI-INPUT    TO TRUE
S5B091        PERFORM R-ERRORE-GESTIBILE
S5B091     ELSE
S5B091        MOVE ITB9Q-X-DATI-TABEL     TO EKP10-X-DATI-TABEL
S5B091     END-IF.
S5B091*

SGB012 GESTIONE-DETTAGLIO.
SGB012     MOVE 'GESTIONE-DETTAGLIO'      TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL
DEB>>>*    DISPLAY 'GESTIONE-DETTAGLIO'
SGB012
SGB012*-Tipo record:
090309     MOVE 'S'          TO PAPY-TIPO-REC OF PAPYRUS-REC-STP
SGB012*-Numero Finanziamento:
SGB012     MOVE FCEI1-N-FINANZ-NUM        TO NEW-NUMFIN-S
SGB012
SGB012*-Interessi
SGB012     IF  IMP-INT      <= ZEROES
SGB012     AND IMP-INT-EURO <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '01'                      TO ORD-STP
SGB012        MOVE 'Interessi'               TO DES-STP
SGB012        MOVE IMP-INT                   TO IMP-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        MOVE ZEROES                    TO IMP-STP-EURO
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012           MOVE IMP-INT-EURO           TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012        PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese incasso rata
SNC201*SGB012     IF  IMP-SPE-INC     <= ZEROES
SNC201*SGB012     AND IMP-SPE-INC-VAL <= ZEROES
SNC201*SGB012        CONTINUE
SNC201*SGB012     ELSE
SNC201*SGB012        INITIALIZE                        PAPY-IMPORTI
SNC201*SGB012        MOVE '02'                      TO ORD-STP
SNC201*SGB012        MOVE 'Spese incasso rata'      TO DES-STP
SNC201*SGB012        MOVE SPACES                    TO STR-STP
SNC201*SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SNC201*SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SNC201*SGB012           MOVE IMP-SPE-INC-VAL        TO IMP-STP
SNC201*SGB012           MOVE IMP-SPE-INC            TO IMP-STP-EURO
SNC201*SGB012           MOVE 'pari a euro '         TO STR-STP
SNC201*SGB012        ELSE
SNC201*SGB012           MOVE IMP-SPE-INC            TO IMP-STP
SNC201*SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SNC201*SGB012        END-IF
SNC201*SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SNC201*SGB012      ADD 1                          TO W-N-CONTA-PAPYR-STP
SNC201*SGB012        PERFORM SCRITTURA-PAPYR
SNC201*SGB012     END-IF
SGB012
SGB012*-Spese di istruttoria
SGB012     IF  IMP-SPE-IST     <= ZEROES
SGB012     AND IMP-SPE-IST-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '03'                      TO ORD-STP
SGB012        MOVE 'Spese di istruttoria'    TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-SPE-IST-VAL        TO IMP-STP
SGB012           MOVE IMP-SPE-IST            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-SPE-IST            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese erogazione mutuo a Stato Avanzamento Lavori
SGB012     IF  IMP-ONE-SAL     <= ZEROES
SGB012     AND IMP-ONE-SAL-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '04'                      TO ORD-STP
SGB012        MOVE 'Spese erogazione mutuo a Stato Avanzamento Lavori'
SGB012                                       TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-SAL-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-SAL            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-SAL            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SGB012*090309         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Compenso sostenuto per estinzione/riduzione anticipata del mutuo
SGB012     IF  IMP-PEN-EST     <= ZEROES
SGB012     AND IMP-PEN-EST-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '05'                      TO ORD-STP
SGB012        STRING 'Compenso sostenuto per estinzione/riduzione '
SGB012               'anticipata del mutuo'
SGB012                   DELIMITED BY SIZE
SGB012                                     INTO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-PEN-EST-VAL        TO IMP-STP
SGB012           MOVE IMP-PEN-EST            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-PEN-EST            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese accollo mutuo
SGB012     IF  IMP-ONE-ACC     <= ZEROES
SGB012     AND IMP-ONE-ACC-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '06'                      TO ORD-STP
SGB012        MOVE 'Spese accollo mutuo'     TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-ACC-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-ACC            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-ACC            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese e oneri connessi al mutuo
SGB012     IF  IMP-ONE-VAR     <= ZEROES
SGB012     AND IMP-ONE-VAR-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                                PAPY-IMPORTI
SGB012        MOVE '07'                              TO ORD-STP
SGB012        MOVE 'Spese e oneri connessi al mutuo' TO DES-STP
SGB012        MOVE SPACES                            TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-VAR-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-VAR            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-VAR            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP                   TO REC-PAPYRUS
SGB012        ADD 1                               TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Imposta sostitutiva
SGB012     IF  IMP-IMP-SOS     <= ZEROES
SGB012     AND IMP-IMP-SOS-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '08'                      TO ORD-STP
SGB012        STRING 'Imposta sostitutiva (D.P.R. 29/09/1973, n. 601 '
SGB012               'e s.m.)'
SGB012                   DELIMITED BY SIZE
SGB012                                     INTO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-IMP-SOS-VAL        TO IMP-STP
SGB012           MOVE IMP-IMP-SOS            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-IMP-SOS            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Commissioni di intervento
SGB012     IF  COM-INT     <= ZEROES
SGB012     AND COM-INT-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                          PAPY-IMPORTI
SGB012        MOVE '09'                        TO ORD-STP
SGB012        MOVE 'Commissioni di intervento' TO DES-STP
SGB012        MOVE SPACES                      TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE COM-INT-VAL              TO IMP-STP
SGB012           MOVE COM-INT                  TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '           TO STR-STP
SGB012        ELSE
SGB012           MOVE COM-INT                  TO IMP-STP
SGB012           MOVE ZEROES                   TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP             TO REC-PAPYRUS
SGB012        ADD 1                            TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012     .

SGB012 IMPORTI-ANAGRAFE.
SGB012     MOVE 'IMPORTI-ANAGRAFE'        TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'FX1515 IMPORTI-ANAGRAFE'
SGB012
SGB012*- Per i conteggi di Anagrafe Tributaria utilizziamo solo valori
SGB012*- positivi.
SGB012     MOVE ZEROES                    TO W-I-INTVAR-ANA
SGB012                                       W-I-SPERAT-ANA
SGB012                                       W-I-SPEIST-ANA
SGB012                                       W-I-IMPSOS-ANA
SGB012                                       W-I-PENEST-ANA
SGB012                                       W-I-ONESAL-ANA
SGB012                                       W-I-ONEACC-ANA
SGB012                                       W-I-ONECER-ANA
SGB012                                       W-I-COMINT-ANA
SGB012                                       W-I-INTVAR-ANA-VAL
SGB012                                       W-I-SPERAT-ANA-VAL
SGB012                                       W-I-SPEIST-ANA-VAL
SGB012                                       W-I-IMPSOS-ANA-VAL
SGB012                                       W-I-PENEST-ANA-VAL
SGB012                                       W-I-ONESAL-ANA-VAL
SGB012                                       W-I-ONEACC-ANA-VAL
SGB012                                       W-I-ONECER-ANA-VAL
SGB012                                       W-I-COMINT-ANA-VAL
SGB012
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-ANA pre: ' W-I-INTVAR-ANA
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-TOT pre: ' W-I-INTVAR-TOT
SGB012     IF W-I-INTVAR-TOT > ZEROES
SGB012        MOVE W-I-INTVAR-TOT         TO W-I-INTVAR-ANA
SGB012     END-IF
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-ANA pos: ' W-I-INTVAR-ANA
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-TOT pos: ' W-I-INTVAR-TOT
SGB012     IF W-I-SPERAT-TOT > ZEROES
SGB012        MOVE W-I-SPERAT-TOT         TO W-I-SPERAT-ANA
SGB012     END-IF
SGB012     IF W-I-SPEIST-TOT > ZEROES
SGB012        MOVE W-I-SPEIST-TOT         TO W-I-SPEIST-ANA
SGB012     END-IF
SGB012     IF W-I-IMPSOS-TOT > ZEROES
SGB012        MOVE W-I-IMPSOS-TOT         TO W-I-IMPSOS-ANA
SGB012     END-IF
SGB012     IF W-I-PENEST-TOT > ZEROES
SGB012        MOVE W-I-PENEST-TOT         TO W-I-PENEST-ANA
SGB012     END-IF
SGB012     IF W-I-ONESAL-TOT > ZEROES
SGB012        MOVE W-I-ONESAL-TOT         TO W-I-ONESAL-ANA
SGB012     END-IF
SGB012     IF W-I-ONEACC-TOT > ZEROES
SGB012        MOVE W-I-ONEACC-TOT         TO W-I-ONEACC-ANA
SGB012     END-IF
SGB012     IF W-I-ONECER-TOT > ZEROES
SGB012        MOVE W-I-ONECER-TOT         TO W-I-ONECER-ANA
SGB012     END-IF
SGB012     IF W-I-COMINT-TOT > ZEROES
SGB012        MOVE W-I-COMINT-TOT         TO W-I-COMINT-ANA
SGB012     END-IF
SGB012     IF W-I-INTVAR-TOT-VAL > ZEROES
SGB012        MOVE W-I-INTVAR-TOT-VAL     TO W-I-INTVAR-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-SPERAT-TOT-VAL > ZEROES
SGB012        MOVE W-I-SPERAT-TOT-VAL     TO W-I-SPERAT-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-SPEIST-TOT-VAL > ZEROES
SGB012        MOVE W-I-SPEIST-TOT-VAL     TO W-I-SPEIST-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-IMPSOS-TOT-VAL > ZEROES
SGB012        MOVE W-I-IMPSOS-TOT-VAL     TO W-I-IMPSOS-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-PENEST-TOT-VAL > ZEROES
SGB012        MOVE W-I-PENEST-TOT-VAL     TO W-I-PENEST-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONESAL-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONESAL-TOT-VAL     TO W-I-ONESAL-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONEACC-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONEACC-TOT-VAL     TO W-I-ONEACC-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONECER-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONECER-TOT-VAL     TO W-I-ONECER-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-COMINT-TOT-VAL > ZEROES
SGB012        MOVE W-I-COMINT-TOT-VAL     TO W-I-COMINT-ANA-VAL
SGB012     END-IF
SGB012     .

SKK132 CHIAMA-ANWR253.
SKK132     MOVE 'CHIAMA-ANWR253'          TO IDBGU-X-LABEL-TRAC
SKK132     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKK132     PERFORM R-TRACE-LABEL.
SKK132
SKK132     INITIALIZE IAN9I-G-GROUP-AREA
SKK132     SET IAN9I-INDPOS-CONTO             TO TRUE
SKK132     MOVE FAN9Q-C-GRUPPO-ABI-O          TO IAN9I-C-GRUPPO-ABI-I
SKK132     MOVE FAN9Q-C-CODICE-ABI-O          TO IAN9I-C-CODICE-ABI-I
SKK132     MOVE FAN9Q-C-COOPAG-CAB-O          TO IAN9I-C-FILIAL-COD-I
SKK132     MOVE '1  '                         TO IAN9I-C-SERVIZ-COD-I
SKK132     MOVE FAN9Q-C-COOPAG-NUM-O          TO IAN9I-C-COOGEN-NUM-I
SKK132     MOVE FAN9Q-C-DIVISA-OPE-O          TO IAN9I-C-DIVISA-COD-I
SKK132
SKK132     PERFORM CL-EKIAN9IB
SKK132
SKK132     IF NOT IAN9I-OK
SKK132        MOVE IAN9I-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
SKK132        SET EKERR-ERR-GENERICO          TO TRUE
SKK132        PERFORM R-ERRORE-GESTIBILE
SKK132     END-IF.
SKK132
SKK132
       VALORIZZA-DICPINTE.
           MOVE 'VALORIZZA-DICPINTE'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

      *-- ANNO ---------------------------------------------------------
           MOVE IFRB1-D-RIFERI-OPE        TO W-APPO-DATA-X
           MOVE W-APPX-SSAA               TO  ANNO
      *-----------------------------------------------------------------
      *--PROCEDURA------------------------------------------------------
           MOVE FCEI1-C-PROCED-TIP        TO  PROCEDURA
      *-----------------------------------------------------------------
           MOVE FCEI1-C-SERVIZ-COD        TO  TIPO-SERVIZIO
           MOVE 'I'                       TO  FLAG-OPERAZ
      *****MOVE FCEI1-C-NDGNDG-COD        TO  NDG
           MOVE FCEI1-C-NDGNDG-COD        TO  APPO-NDG-9-12
           MOVE APPO-NDG-9-12             TO  NDG
           MOVE FCEI1-C-FINFIL-GES        TO  FILIALE
           MOVE FCEI1-C-CATANA-COD        TO  CATEGORIA
           MOVE FCEI1-N-FINANZ-NUM        TO  RAPPORTO
      *WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
           MOVE '01'                      TO     VOCE0-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE0-DIV
KKKKKK* QUA 3
           COMPUTE    VOCE0-VAL  =    APPO-I-VOCE0 * 100
           MOVE '02'                      TO   VOCE1-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE1-DIV
           COMPUTE    VOCE1-VAL  =    APPO-I-VOCE1 * 100
           MOVE '03'                      TO     VOCE2-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE2-DIV
           COMPUTE    VOCE2-VAL  =    APPO-I-VOCE2 * 100
           MOVE '04'                      TO   VOCE3-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE3-DIV
           COMPUTE    VOCE3-VAL  =    APPO-I-VOCE3 * 100
           MOVE '05'                      TO     VOCE4-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE4-DIV
           COMPUTE    VOCE4-VAL  =    APPO-I-VOCE4 * 100
           MOVE '06'                      TO   VOCE5-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE5-DIV
           COMPUTE    VOCE5-VAL  =    APPO-I-VOCE5 * 100
           MOVE '07'                      TO     VOCE6-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE6-DIV
           COMPUTE    VOCE6-VAL  =    APPO-I-VOCE6 * 100
           MOVE '08'                      TO   VOCE7-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE7-DIV
           COMPUTE    VOCE7-VAL  =    APPO-I-VOCE7 * 100
           MOVE '09'                      TO     VOCE8-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE8-DIV
           COMPUTE    VOCE8-VAL  =    APPO-I-VOCE8 * 100
           MOVE '10'                      TO   VOCE9-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE9-DIV
           COMPUTE    VOCE9-VAL  =    APPO-I-VOCE9 * 100
      *MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
      *--FLAG-ERR-1-----------------------------------------------------
           IF FCEI1-C-ACCOLL-FLG = 'SI'
             MOVE 'W'                       TO  FLAG-ERR-1
           END-IF
      *-----------------------------------------------------------------
           MOVE ZEROES                    TO  RAPPORTO-ES
           MOVE ZEROES                    TO  TIPO-RAPP
           MOVE 'N'                       TO  FLAG-STMP-AUT
           .

       VALORIZZA-PAPYRRRC.
           MOVE 'VALORIZZA-PAPYRRRC'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

090309*    MOVE FCEI1-C-CARTOL-COD        TO SO-CODICE-CARTOL
090309*    MOVE '1'                       TO SO-TIPO-REC
      *--- SO-IDENTIF-MUTUO ------------------------------------------*
090309*    MOVE FCEI1-N-FINANZ-NUM        TO APPO-IDENTIF-MUTUO
090309*    MOVE APPO-IDENTIF-MUTUO        TO  SO-IDENTIF-MUTUO
      *---------------------------------------------------------------*
090309*    MOVE ZEROES                    TO SO-PROGR-COINTEST
090309*    MOVE '2'                       TO SO-TIPO-PREST-MUTUO
      *-- SO-AGEVOLATO -----------------------------------------------*
090309*    IF FCEI1-F-AGEVOL-FIN = 'N'
090309*      MOVE 0                         TO SO-AGEVOLATO
090309*    END-IF
090309*    IF FCEI1-F-AGEVOL-FIN = 'S'
090309*      MOVE 1                         TO SO-AGEVOLATO
090309*    END-IF
      *---------------------------------------------------------------*
      *--SO-DATA-EROGAZIONE ------------------------------------------*
090309*    MOVE FCEI1-D-EROGAZ-CON        TO W-APPO-DATA-X
090309*      MOVE W-APPX-GG             TO W-APP9-GG
090309*      MOVE W-APPX-MM             TO W-APP9-MM
090309*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
090309*
090309*      MOVE W-APP9-GG         TO SO-DATA-EROGAZIONE(1:2)
090309*      MOVE W-APP9-MM         TO SO-DATA-EROGAZIONE(3:2)
090309*      MOVE W-APP9-SSAA       TO SO-DATA-EROGAZIONE(5:)
      *---------------------------------------------------------------*
      *-- SO-IMPORIG-PREST -------------------------------------------*
090309*    COMPUTE SO-IMPORIG-PREST       = FCEI1-I-EROGAZ-FIN * 100
      *---------------------------------------------------------------*
090309*-- SO-IMPCORR-ANNO --------------------------------------------*
090309*    COMPUTE SO-IMPCORR-ANNO        = (APPO-I-VOCE0 +
090309*                                      APPO-I-VOCE7 +
090309*                                      APPO-I-VOCE8 ) * 100
090309*---------------------------------------------------------------*
090309*    MOVE ZEROES                    TO SO-NUMERO-INTESTAT
090309*    MOVE SPACES                    TO SO-CODFISC-INTESTAT
090309*    MOVE SPACES                    TO SO-ANAGRAFICI-INTESTATARIO
090309*    MOVE SPACES                    TO SO-COGNOME
090309*    MOVE SPACES                    TO SO-NOME
090309*    MOVE SPACES                    TO SO-SESSO
090309*    MOVE ZEROES                    TO SO-DATA-NASCITA
090309*    MOVE SPACES                    TO SO-LUOGO-NASCITA
090309*    MOVE SPACES                    TO SO-PROV-NASCITA
090309*    MOVE '1'                       TO SO-PROGR-RECORD
090309*---------------------------------------------------------------*
090309*    IF FCEI1-C-DIVISA-COD = 'ITL'
090309*      MOVE 'L'                       TO SO-TIPO-DIVISA
090309*    ELSE
090309*      MOVE 'E'                       TO SO-TIPO-DIVISA
090309*    END-IF
090309*       MOVE '0034'                 TO EKERR-C-COD-ERRORE(1)
090309*       MOVE '1455'                 TO EKERR-C-RIF-ERRORE(1)
TODOX *       MOVE 'CODICE DIVSA NON GESTITO '
TODOX *                                   TO EKERR-X-DES-ERRORE(1) (6:2)
TODOX *       PERFORM ERRORE-GRAVE
TODOX *    END-IF
      *---------------------------------------------------------------*
090309*    MOVE '50'                      TO SO-SETTORE
090309*    MOVE FCEI1-C-FINFIL-GES(2:)    TO SO-DIPENDENZA
090309*    MOVE FCEI1-N-FINANZ-NUM        TO SO-COE
090309*    MOVE FCEI1-C-NDGNDG-COD(4:)    TO SO-CODICE-RUBRICA
           .
      *

       VALORIZZA-SONCORRC.
           MOVE 'VALORIZZA-SONCORRC'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

S1C251*    MOVE FCEI1-C-CARTOL-COD        TO SO-CODICE-CARTOL
S1C251*    MOVE '1'                       TO SO-TIPO-REC
      *--- SO-IDENTIF-MUTUO ------------------------------------------*
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO APPO-IDENTIF-MUTUO
S1C251*    MOVE APPO-IDENTIF-MUTUO        TO  SO-IDENTIF-MUTUO
      *---------------------------------------------------------------*
S1C251*    MOVE ZEROES                    TO SO-PROGR-COINTEST
S1C251*    MOVE '2'                       TO SO-TIPO-PREST-MUTUO
      *-- SO-AGEVOLATO -----------------------------------------------*
S1C251*    IF FCEI1-F-AGEVOL-FIN = 'N'
S1C251*      MOVE 0                         TO SO-AGEVOLATO
S1C251*    END-IF
S1C251*    IF FCEI1-F-AGEVOL-FIN = 'S'
S1C251*      MOVE 1                         TO SO-AGEVOLATO
S1C251*    END-IF
      *---------------------------------------------------------------*
      *--SO-DATA-EROGAZIONE ------------------------------------------*
S1C251*    MOVE FCEI1-D-EROGAZ-CON        TO W-APPO-DATA-X
S1C251*      MOVE W-APPX-GG             TO W-APP9-GG
S1C251*      MOVE W-APPX-MM             TO W-APP9-MM
S1C251*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*
S1C251*      MOVE W-APP9-GG         TO SO-DATA-EROGAZIONE(1:2)
S1C251*      MOVE W-APP9-MM         TO SO-DATA-EROGAZIONE(3:2)
S1C251*      MOVE W-APP9-SSAA       TO SO-DATA-EROGAZIONE(5:)
      *---------------------------------------------------------------*
      *-- SO-IMPORIG-PREST -------------------------------------------*
S1C251*    COMPUTE SO-IMPORIG-PREST       = FCEI1-I-EROGAZ-FIN * 100
      *---------------------------------------------------------------*
      *-- SO-IMPCORR-ANNO --------------------------------------------*
S1C251*    COMPUTE SO-IMPCORR-ANNO        = (APPO-I-VOCE0 +
S1C251*                                      APPO-I-VOCE7 +
S1C251*                                      APPO-I-VOCE8 ) * 100
      *---------------------------------------------------------------*
S1C251*    MOVE ZEROES                    TO SO-NUMERO-INTESTAT
S1C251*    MOVE SPACES                    TO SO-CODFISC-INTESTAT
S1C251*    MOVE SPACES                    TO SO-ANAGRAFICI-INTESTATARIO
S1C251*    MOVE SPACES                    TO SO-COGNOME
S1C251*    MOVE SPACES                    TO SO-NOME
S1C251*    MOVE SPACES                    TO SO-SESSO
S1C251*    MOVE ZEROES                    TO SO-DATA-NASCITA
S1C251*    MOVE SPACES                    TO SO-LUOGO-NASCITA
S1C251*    MOVE SPACES                    TO SO-PROV-NASCITA
S1C251*    MOVE '1'                       TO SO-PROGR-RECORD
      *---------------------------------------------------------------*
S1C251*    IF FCEI1-C-DIVISA-COD = 'ITL'
S1C251*      MOVE 'L'                       TO SO-TIPO-DIVISA
S1C251*    ELSE
S1C251*      MOVE 'E'                       TO SO-TIPO-DIVISA
S1C251*    END-IF
S1C251*       MOVE '0034'                 TO EKERR-C-COD-ERRORE(1)
S1C251*       MOVE '1455'                 TO EKERR-C-RIF-ERRORE(1)
S1C251*       MOVE 'CODICE DIVSA NON GESTITO '
S1C251*                                   TO EKERR-X-DES-ERRORE(1) (6:2)
S1C251*       PERFORM ERRORE-GRAVE
S1C251*    END-IF
      *---------------------------------------------------------------*
S1C251*    MOVE '50'                      TO SO-SETTORE
S1C251*    MOVE FCEI1-C-FINFIL-GES(2:)    TO SO-DIPENDENZA
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO SO-COE
S1C251*    MOVE FCEI1-C-NDGNDG-COD(4:)    TO SO-CODICE-RUBRICA
           .
      *


       ELABORA-DICPINTE-TOT.
           MOVE 'ELABORA-DICPINTE-TOT'    TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

      *-- ANNO ---------------------------------------------------------
           MOVE IFRB1-D-RIFERI-OPE        TO W-APPO-DATA-X
           MOVE W-APPX-SSAA               TO  ANNO
      *-----------------------------------------------------------------
      *--PROCEDURA------------------------------------------------------
           MOVE APPO-OLD-PROCED           TO  PROCEDURA
      *-----------------------------------------------------------------
           MOVE APPO-OLD-SERVIZ           TO  TIPO-SERVIZIO
           MOVE 'T'                       TO  FLAG-OPERAZ
           MOVE ALL '9'                   TO  NDG
           MOVE ALL '9'                   TO  FILIALE
           MOVE ALL '9'                   TO  CATEGORIA
           MOVE ALL '9'                   TO  RAPPORTO
      *WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
           MOVE '01'                      TO     VOCE0-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE0-DIV
KKKKKK* QUA 4
           COMPUTE   VOCE0-VAL  =  APPO-I-VOCE0-TOT * 100
           MOVE '02'                      TO   VOCE1-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE1-DIV
           COMPUTE   VOCE1-VAL  =  APPO-I-VOCE1-TOT * 100
           MOVE '03'                      TO     VOCE2-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE2-DIV
           COMPUTE   VOCE2-VAL  =  APPO-I-VOCE2-TOT * 100
           MOVE '04'                      TO   VOCE3-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE3-DIV
           COMPUTE   VOCE3-VAL  =  APPO-I-VOCE3-TOT * 100
           MOVE '05'                      TO     VOCE4-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE4-DIV
           COMPUTE   VOCE4-VAL  =  APPO-I-VOCE4-TOT * 100
           MOVE '06'                      TO   VOCE5-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE5-DIV
           COMPUTE   VOCE5-VAL  =  APPO-I-VOCE5-TOT * 100
           MOVE '07'                      TO     VOCE6-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE6-DIV
           COMPUTE   VOCE6-VAL  =  APPO-I-VOCE6-TOT * 100
           MOVE '08'                      TO   VOCE7-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE7-DIV
           COMPUTE   VOCE7-VAL  =  APPO-I-VOCE7-TOT * 100
           MOVE '09'                      TO     VOCE8-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE8-DIV
           COMPUTE   VOCE8-VAL  =  APPO-I-VOCE8-TOT * 100
           MOVE '10'                      TO   VOCE9-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE9-DIV
           COMPUTE   VOCE9-VAL  =  APPO-I-VOCE9-TOT * 100
      *MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
           MOVE SPACES                    TO  FLAG-ERR-1
           MOVE ZEROES                    TO  RAPPORTO-ES
           MOVE ZEROES                    TO  TIPO-RAPP
           MOVE SPACES                    TO  FLAG-STMP-AUT

           PERFORM SCRITTURA-DICPI

           INITIALIZE                     IMPORTI-VOCI-TOT
           .
SOB061 VERIFICA-RINEGOZIATO-FIGLIO.
SOB061     MOVE 'VERIFICA-RINEGOZIATO-FIGLIO'   TO IDBGU-X-LABEL-TRAC
SOB061     MOVE 3                               TO IDBGU-C-LIVELL-TRA
SOB061     PERFORM R-TRACE-LABEL
SOB061
SOB061     INITIALIZE                            FLF9Q-G-GROUP-AREA
SOB061                                           W-C-FINANZ-PRE-RIN
SOB061                                           W-N-FINANZ-NUM-RIN
SOB061     MOVE FCEI1-C-CODICE-ABI            TO FLF9Q-C-GRUPPO-ABI-I
SOB061     MOVE FCEI1-C-GRUPPO-ABI            TO FLF9Q-C-CODICE-ABI-I
SOB061     MOVE FCEI1-C-FINANZ-PRE            TO FLF9Q-C-FINANZ-PR2-I
SOB061     MOVE FCEI1-N-FINANZ-NUM            TO FLF9Q-N-FINANZ-NU2-I
SOJ311*SOB061   MOVE EKSYS-D-SYSTEM-OPE       TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
SOB061     MOVE '00002'                       TO FLF9Q-C-MULTIL-COD-I
SOB061     SET FLF9Q-SELECT-004               TO TRUE
SOB061     PERFORM CL-EKFLF9QB
SOB061     .
      *
       F-PGM-CHIUDI-FILE.
           MOVE 'F-PGM-CHIUDI-FILE'       TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           CLOSE EKCERIO.
           CLOSE EKDICPI.
           CLOSE PAPYRUS.
090309     CLOSE EKSONCO.
SKA292     CLOSE EKSONC2.
090309     CLOSE EKFANT1.
090309*
      *
       F-PGM-FINE.
           MOVE 'F-PGM-FINE'              TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           MOVE '0450'                      TO EKERR-C-COD-ERRORE(1)
           MOVE '0003'                      TO EKERR-C-RIF-ERRORE(1)
           MOVE W-N-READ                    TO W-N-DISPLAY
           MOVE W-N-DISPLAY                 TO EKERR-X-DES-ERRORE(1)
           PERFORM MESSAGGIO-WARNING
           MOVE '0451'                      TO EKERR-C-COD-ERRORE(1)
           MOVE '0004'                      TO EKERR-C-RIF-ERRORE(1)
           MOVE W-N-UPDATE                  TO W-N-DISPLAY
           MOVE W-N-DISPLAY                 TO EKERR-X-DES-ERRORE(1)
           PERFORM MESSAGGIO-WARNING
           DISPLAY '*************************************'
           MOVE W-N-READ                    TO W-N-DISPLAY
           DISPLAY 'REC. LETTI   IN CERIO :' W-N-DISPLAY
           MOVE W-N-UPDATE                  TO W-N-DISPLAY
           MOVE W-N-CONTA-DICPI             TO W-N-DISPLAY-1
           MOVE W-N-CONTA-PAPYR             TO W-N-DISPLAY-2
SGB012     MOVE W-N-CONTA-PAPYR-STP         TO W-N-DISPLAY-3
SJB071     MOVE W-N-CONTA-SONCO             TO W-N-DISPLAY-4
SKA292     MOVE W-N-CONTA-SONC2             TO W-N-DISPLAY-5
           DISPLAY 'SCRITTI IN DICPI      :' W-N-DISPLAY-1
           DISPLAY 'SCRITTI IN PAPYR      :' W-N-DISPLAY-2
SGB012     DISPLAY 'SCRITTI IN PAPYR SPESE:' W-N-DISPLAY-3
SJB071     DISPLAY 'SCRITTI IN SONCO      :' W-N-DISPLAY-4
SKA292     DISPLAY 'SCRITTI IN SONC2      :' W-N-DISPLAY-5
           DISPLAY '*************************************'
S1C251     IF TROVATO-COINT-PG
S1C251        MOVE '1277'                  TO EKERR-C-COD-ERRORE(1)
S1C251        SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251        MOVE 'NDG COINTESTATARIO PERSONA GIURIDICA'
S1C251                                     TO EKERR-X-DES-ERRORE(1)
S1C251        MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
S1C251        PERFORM R-ERRORE-NON-GESTIBILE
S1C251     END-IF
S1C251     DISPLAY '*************************************'
           .
      *
      ******************************************************************
      *          F I N E     P A R T E    C O M U N E                  *
      ******************************************************************
      *
       C-LETTURA-FILE-INPUT.
           MOVE 'C-LETTURA-FILE-INPUT'          TO IDBGU-X-LABEL-TRAC
           MOVE 3                               TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL

           READ EKCERIO
              AT END      SET IFRB1-F-ELABOR-STA-OFF  TO TRUE
              NOT AT END  ADD  1                      TO W-N-READ
                          MOVE FCEI1-C-GRUPPO-ABI TO IFRB1-C-GRUPPO-ABI
                          MOVE FCEI1-C-CODICE-ABI TO IFRB1-C-CODICE-ABI
           END-READ
           IF NOT CERIO-STATUS-OK AND NOT CERIO-STATUS-EOF
              DISPLAY 'ERRORE READ  TRFE1: ' CERIO-STATUS
              MOVE '0257'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0005'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'CERIO'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE CERIO-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           END-IF

           IF CERIO-STATUS-OK
             MOVE FCEI1-C-GRUPPO-ABI            TO WD-C-GRUPPO-ABI
             MOVE FCEI1-C-CODICE-ABI            TO WD-C-CODICE-ABI
             MOVE FCEI1-C-FINANZ-PRE            TO WD-C-FINANZ-PRE
             MOVE FCEI1-N-FINANZ-NUM            TO WD-N-FINANZ-NUM
090325*      display  'Letta posizione  : '
090325*               FCEI1-C-FINANZ-PRE '/' FCEI1-N-FINANZ-NUM
           END-IF
           IF CERIO-STATUS-EOF
             MOVE SPACES                        TO WD-C-GRUPPO-ABI
             MOVE SPACES                        TO WD-C-CODICE-ABI
             MOVE SPACES                        TO WD-C-FINANZ-PRE
             MOVE ZEROES                        TO WD-N-FINANZ-NUM
           END-IF.

           IF W-N-READ = ZERO
              MOVE '0447'                   TO EKERR-C-COD-ERRORE(1)
              MOVE '0006'                   TO EKERR-C-RIF-ERRORE(1)
              MOVE 'NESSUN RECORD DA ELABORARE'
                                            TO EKERR-X-DES-ERRORE(1)
              PERFORM MESSAGGIO-WARNING
           END-IF
           .

       RIDEFINISCI-DATA.
           MOVE 'RIDEFINISCI-DATA'        TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           MOVE W-APPX-SSAA               TO W-APP9-SSAA
           MOVE W-APPX-MM                 TO W-APP9-MM
           MOVE W-APPX-GG                 TO W-APP9-GG
           .

       AGGIUNGI-1-GG.
           MOVE 'AGGIUNGI-1-GG'           TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           MOVE W-APPO-D-DATA-CTRL            TO IDATU-D-INPUT-SAMG
           MOVE 1                             TO IDATU-N-GG-INP-OUT
           SET IDATU-SOMMA-GIORNI             TO TRUE

           PERFORM CL-EKIDATUB

           IF NOT IDATU-OK
              MOVE IDATU-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
              SET EKERR-ERR-DATI-INPUT        TO TRUE
              PERFORM ERRORE-GRAVE
           END-IF.

SJD121 CALCOLO-GIORNI-EFFETTIVI.
SJD121     MOVE 'CALCOLO-GIORNI-EFFETTIVI' TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                          TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL
SJD121
SJD121* CALCOLO I GIORNI DA DATA SCADENZA A DATA RIFERIMENTO
SJD121     INITIALIZE                         IDATU-G-GROUP-AREA
SJD121
SJD121     IF  W-D-INIRIS-CAL > EKIFB-D-RIFERI-OLD
SJD121         MOVE W-D-INIRIS-CAL         TO IDATU-D-INPUT-SAMG
SJD121     ELSE
SJD121         MOVE EKIFB-D-RIFERI-OPE(1:4)TO IDATU-D-INPUT-SAMG(1:4)
SJD121         MOVE '-01-01'               TO IDATU-D-INPUT-SAMG(5:6)
SJD121     END-IF
SJD121
SJD121     IF  W-D-FINRIS-CAL < EKIFB-D-RIFERI-OPE
SJD121         MOVE W-D-FINRIS-CAL         TO IDATU-D-INOUT-SAMG
SJD121     ELSE
SJD121         MOVE EKIFB-D-RIFERI-OPE     TO IDATU-D-INOUT-SAMG
SJD121     END-IF
SJD121
SJD121     SET IDATU-DELTA-DAT-GG          TO TRUE
SJD121     SET IDATU-SOLARE                TO TRUE
SJD121
SJD121     PERFORM CL-EKIDATUB
SJD121
SJD121     IF NOT IDATU-OK
SJD121        MOVE IDATU-G-ESITO-AREA      TO EKERR-G-ESITO-AREA
SJD121        SET EKERR-ERR-DATI-INPUT     TO TRUE
SJD121        PERFORM R-ERRORE-NON-GESTIBILE
SJD121     END-IF
SJD121
SJD121     MOVE IDATU-N-GG-INP-OUT         TO W-N-GG-RIST
SJD121
SJD121     MOVE 365                        TO W-N-GG-ANNO
SJD121     IF  IDATU-F-BISESTILE-SI
SJD121         MOVE 366                    TO W-N-GG-ANNO
SJD121     END-IF
SJD121     .
SGB012
SGB012 ARROTONDA-IMPORTO.
SGB012     MOVE 'ARROTONDA-IMPORTO'       TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
SGB012*
SGB012     INITIALIZE                        IARRU-G-GROUP-AREA
SGB012     SET IARRU-ARROTONDA-IMPORTO    TO TRUE
SGB012     MOVE 'C'                       TO IARRU-C-CODICE-ARR-I
SGB012     MOVE 1,00                      TO IARRU-N-NUMERO-ARR-I
SGB012     MOVE W-I-IMPORT-ARR            TO IARRU-I-IMPORT-ARR-I
DEB>>>*    MOVE W-I-IMPORT-ARR            TO W-I-IMPORT-APP
DEB>>>*    DISPLAY 'W-I-IMPORT-ARR: ' W-I-IMPORT-APP
SGB012
SGB012     PERFORM CL-EKIARRUB
SGB012
SGB012     IF NOT IARRU-OK
SGB012        MOVE IARRU-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SGB012        SET EKERR-ERR-DATI-INPUT    TO TRUE
SGB012        PERFORM ERRORE-GRAVE
SGB012     END-IF
DEB>>>*    MOVE IARRU-I-IMPORT-ARR-O      TO W-I-IMPORT-APP
DEB>>>*    DISPLAY 'IARRU-I-IMPORT-ARR-O: ' W-I-IMPORT-APP
SGB012
SGB012     MOVE ZEROES                    TO W-I-IMPORT-ARR
SGB012     .

