       CBL NUMPROC(PFD)
       IDENTIFICATION DIVISION.
       PROGRAM-ID.  EKFCEIEB.

      ***************************************************************
      *                     _____  ___    ___  _____  _____         *
      *   EXTENDED LOANS   /  __/ /  /   /  / /  __/ /  __/         *
      *     INTEGRATED    /  _/  /  /   /  / _)  )  /  _/           *
      *       SYSTEM     /____/ /____/ /__/ /____/ /____/  ENGINE   *
      *                                                     KERNEL  *
      ***************************************************************
      *                                                             *
      *  AUTORE:    PRO VALUE S.R.L.                                *
      *  PROGETTO:  ELISE                                           *
      *  PROGRAMMA: EKFCEIEB                                        *
      *  DATA:      2007.08.20                                      *
      *  FUNZIONE: BATCH DELLA CERTIFICAZIONE INTERESSI             *
SIB161*                                                             *
SIB161*            +++ VERSIONE TRACCIATO 2017 +++                  *
SIB161*                                                             *
SJD121*            - Modifiche versione "ANAGRAFE TRIBUTARIA" (FGT) *
SKA****                                                             *
SKB****                                                             *
SKC182*            - Modifiche per gestione "liquidit{"             *
SMK281*            - Modifiche (predisposizione) 2022 per           *
SMK281*              Operazioni Straordinarie                       *
SMK281*                                                             *
      ***************************************************************
      * TODO: C'h DA RIVEDERE LA GESTIONE AGEVOLATI                 *
      *                       CERCA "TODOX"                         *
      ***************************************************************

       ENVIRONMENT DIVISION.
       CONFIGURATION SECTION.
       SOURCE-COMPUTER. IBM-370.
       OBJECT-COMPUTER. IBM-370.
       SPECIAL-NAMES.
           DECIMAL-POINT IS COMMA.
       INPUT-OUTPUT SECTION.
       FILE-CONTROL.
           SELECT EKIMSG1 ASSIGN TO EKIMSG1
           FILE STATUS IS IMSG1-STATUS.

SJD121*- File input da EKFCEIBB:
           SELECT EKCERIO ASSIGN TO EKCERIO
           FILE STATUS IS CERIO-STATUS.

SJD121*- Flusso interessi (NON UTILIZZATO):
           SELECT EKDICPI ASSIGN TO EKDICPI
           FILE STATUS IS DICPI-STATUS.

SJD121*- Flusso stampa LETTERA e MOVIMENTI Papyrus:
           SELECT PAPYRUS ASSIGN TO PAPYRUS
           FILE STATUS IS PAPYR-STATUS.
090309
SJD121*- Flusso FANT1 (NON UTILIZZATO):
090309     SELECT EKFANT1 ASSIGN TO EKFANT1
090309     FILE STATUS IS FANT1-STATUS.
090309
SJD121*- Flusso SONCO per "Anagrafe Tributaria":
090309     SELECT EKSONCO ASSIGN TO EKSONCO
090309     FILE STATUS IS SONCO-STATUS.
090309
SKA292*- Flusso SONC2 per "Anagrafe Tributaria" - posizioni STIPULATE
SKA292*  dal 01/01/2019 SENZA ANAGRAFE TRIBUTARIA:
SKA292     SELECT EKSONC2 ASSIGN TO EKSONC2
SKA292     FILE STATUS IS SONC2-STATUS.
SKA292

       DATA DIVISION.
       FILE SECTION.
       FD  EKIMSG1
           LABEL RECORD STANDARD
           BLOCK CONTAINS 0 CHARACTERS.
       01  IMSG1-G-AREA-RECORD.
           COPY EKIMSG1W.

       FD  EKCERIO
           LABEL RECORD STANDARD
           BLOCK CONTAINS 0 CHARACTERS.
       01  CERIO-G-AREA-RECORD.
           COPY EKFCEI1W.

090309 FD  EKDICPI
090309     LABEL RECORD STANDARD
090309     BLOCK CONTAINS 0 CHARACTERS.
090309     COPY DICPINTE.
090309*COPY MTSGANTR

       FD  PAPYRUS
           LABEL RECORD STANDARD
           BLOCK CONTAINS 0 CHARACTERS.
       01  REC-PAPYRUS            PIC  X(808).

090309
090309 FD  EKFANT1
090309     RECORDING MODE V
090309     LABEL RECORD STANDARD
090309     RECORD VARYING FROM 1 TO 32000 DEPENDING ON W-N-FANT1-LEN.
090309 01  FANT1-G-AREA-RECORD PIC X(32000).
090309

090309 FD  EKSONCO
090309     LABEL RECORD STANDARD
090309     BLOCK CONTAINS 0 CHARACTERS.
090309 01  SONCORR2.
090309
S1C251*    05  SO-TIPO-REC              PIC 9.
S1C251*        88 RECORD-DI-TESTA   VALUE 0.
S1C251*        88 RECORD-DETTAGLIO  VALUE 1.
S1C251*        88 RECORD-DI-CODA    VALUE 9.
S1C251
SMK281*- Lunghezza record: 1800 byte
SMK281
SHA041* TIPOLOGIA TRACCIATO :
SHA041* - 0: TESTA;
SHA041* - 1: DETTAGLIO UNICO INTESTATARIO;
SHA041* - 2: DETTAGLIO COINTESTATARIO;
SHA041* - 9: CODA.
S1C251     05  SO-TIPO-REC              PIC 9.
S1C251         88 RECORD-TESTA             VALUE 0.
S1C251         88 RECORD-DETTAGLIO-INT     VALUE 1.
S1C251         88 RECORD-DETTAGLIO-COINT   VALUE 2.
S1C251         88 RECORD-CODA              VALUE 9.
S1C251
SHA041*************************************************
SHA041* - 0: TESTA:
SHA041*************************************************
S1C251* TRACCIATO RECORD DI TESTA
S1C251     05  SO-RECORD-TESTA.
S1C251* CODICE IDENTIFICATIVO DELLA FORNITURA
S1C251         10 SO-CODIDENT-FOR-T     PIC X(5).
S1C251* CODICE NUMERICO DELLA FORNITURA
S1C251         10 SO-CODNUM-FOR-T       PIC X(2).
S1C251* TIPOLOGIA DI INVIO
S1C251         10 SO-TIPO-INVIO-T       PIC 9(1).
S1C251            88 ORDINARIO-T                VALUE 0.
S1C251            88 SOSTITUTIVO-T              VALUE 1.
S1C251            88 ANNULLAMENTO-T             VALUE 2.
S1C251            88 COM-NEGATIVA-T             VALUE 3.
S1C251* PROTOCOLLO TELEMATICO DA SOSTITUIRE O ANNULLARE
S1C251         10 SO-PROTOCOLLO-TEL-T   PIC ZZZZZZZZZZZZZZZZ9.
S1C251* CODICE FISCALE SOGGETTO OBBLIGATO
S1C251         10 SO-CODICE-FISCALE-T   PIC 9(16).
S1C251* SOGGETTO OBBLIGATO PERSONA GIURIDICA
S1C251         10 SO-SOGG-PERSONA-GIURIDICA.
S1C251* DENOMINAZIONE DEL SOGGETTO
S1C251            15 SO-DEN-PER-T       PIC X(60).
S1C251* COMUNE DEL DOMICILIO FISCALE
S1C251            15 SO-COMUNE-T        PIC X(40).
S1C251* PROVINCIA DEL DOMICIO FISCALE
S1C251            15 SO-PROVINCIA-T     PIC X(2).
S1C251* SOGGETTO OBBLIGATO PERSONA FISICA
S1C251         10 SO-SOGG-PERSONA-FISICA.
S1C251* COGNOME PERSONA
S1C251            15 SO-COGNOME-T       PIC X(24).
S1C251* NOME PERSONA
S1C251            15 SO-NOME-T          PIC X(20).
S1C251* SESSO
S1C251            15 SO-SESSO-T         PIC X(1).
S1C251               88 MASCHILE-T              VALUE 'M'.
S1C251               88 FEMMINILE-T             VALUE 'F'.
S1C251* DATA DI NASCITA
S1C251            15 SO-DATA-NASCITA-T  PIC 9(8).
S1C251            15 FILLER REDEFINES SO-DATA-NASCITA-T.
S1C251              20 SO-GG-NA-T    PIC 99.
S1C251              20 SO-MM-NA-T    PIC 99.
S1C251              20 SO-SE-NA-T    PIC 99.
S1C251              20 SO-AA-NA-T    PIC 99.
S1C251* COMUNE O STATO ESTERO DI NASCITA
S1C251            15 SO-COMSTA-NAS-T    PIC X(40).
S1C251* PROVINCIA DI NASCITA
S1C251            15 SO-PROVINCIA-NAS-T PIC X(2).
S1C251* ESTREMI DELLA FORNITURA
S1C251* ANNO DI RIFERIMENTO
S1C251         10 SO-ANNO-RIF-T         PIC 9(4).
S1C251* DATI RISERVATI AL SOGGETTO CHE ASSUME L'IMPEGNO ALLA
S1C251* PRESENTAZIONE TELEMATICA
S1C251* CODICE FISCALE DELL'INTERMEDIARIO CHE EFFETTUA LA TRASMISSIONE
S1C251         10 SO-CODICE-INTER-T     PIC X(16).
S1C251* NUMERO DI ISCRIZIONE ALL'ALBO C.A.F
S1C251         10 SO-NUM-ALBO-CAF-T     PIC 9(5).
S1C251* IMPEGNO A TRASMETTERE IN VIA TELEMATICA LA COMUNICAZIONE
S1C251         10 SO-COM-TELEMATICA-T   PIC 9(1).
S1C251               88 COM-CONTRIBUENTE-T    VALUE 1.
S1C251               88 COM-SOG-INVIO-T       VALUE 2.
S1C251* DATA DELL'IMPEGNO
S1C251         10 SO-DATA-IMPEGNO-T     PIC 9(8).
S1C251         10 FILLER REDEFINES SO-DATA-IMPEGNO-T.
S1C251            15 SO-GG-NA-IMP-T  PIC 99.
S1C251            15 SO-MM-NA-IMP-T  PIC 99.
S1C251            15 SO-SE-NA-IMP-T  PIC 99.
S1C251            15 SO-AA-NA-IMP-T  PIC 99.
SHA041* E-MAIL VALIDO PER CONTATTI
SHA041         10 SO-EMAIL-T            PIC X(100).
S1C251* CARATTERI DI CONTROLLO
SHA041*S1C251  10 FILLER-T              PIC X(1524).
SHA041         10 FILLER-T              PIC X(1424).
S1C251         10 SO-CAR-CONTROLLO-T    PIC X(1).
S1C251         10 SO-CAR-FINE-RIGA-T    PIC X(2).
S1C251*                                                                    CL**2
SHA041*
SHA041*************************************************
SHA041* - 1: DETTAGLIO UNICO INTESTATARIO:
SHA041*************************************************
S1C251* TRACCIATO RECORD DI DETTAGLIO CON UN SOLO INTESTATARIO
S1C251     05  SO-RECORD-DETTAGLIO-INT REDEFINES SO-RECORD-TESTA.
S1C251* DATI IDENTIFICATIVI DELL'INTESTATARIO
S1C251         10 SO-ANAGRAFICA-INTESTATARIO.
S1C251* CODICE FISCALE
S1C251            15 SO-CODICE-FIS-INT  PIC X(16).
S1C251* COGNOME
S1C251            15 SO-COGNOME-INT     PIC X(24).
S1C251* NOME
S1C251            15 SO-NOME-INT        PIC X(20).
S1C251* SESSO
S1C251            15 SO-SESSO-INT       PIC X(1).
S1C251               88 MASCHILE-INT            VALUE 'M'.
S1C251               88 FEMMINILE-INT           VALUE 'F'.
S1C251* DATA DI NASCITA
S1C251            15 SO-DATA-NASCITA-INT PIC 9(8).
S1C251            15 FILLER REDEFINES SO-DATA-NASCITA-INT.
S1C251              20 SO-GG-NA-NAS-INT  PIC 99.
S1C251              20 SO-MM-NA-NAS-INT  PIC 99.
S1C251              20 SO-SA-NA-NAS-INT  PIC 9999.
S1C251* COMUNE O STATO ESTERO DI NASCITA
S1C251            15 SO-COMSTA-NAS-INT  PIC X(40).
S1C251* PROVINCIA DI NASCITA
S1C251            15 SO-PROVINCIA-INT   PIC X(02).
S1C251* DATI IDENTIFICATIVI DEL MUTUO
S1C251* IDENTIFICATIVO DEL MUTUO
S1C251         10 SO-ID-MUTUO-INT.
SHL121*S1C251     15 SO-FINANZ-PRE-INT     PIC X(03).
SHL121*S1C251     15 SO-FINANZ-NUM-INT     PIC 9(08).
SHL121*S1C251     15 SO-KEY-INT            PIC X(04).
SHL121*SHA041     15 FILLER                PIC X(35) VALUE SPACE.
SHA041*           15 SO-ID-RAPP-FIN        PIC X(50).
SIB201*SHL121     15 SO-ID-RAPP-FIN        PIC X(50).
SJB071            15 SO-ID-RAPP-FIN        PIC X(50).
SJB071*SIB201            15 SO-FINANZ-PRE-INT     PIC X(03).
SJB071*SIB201            15 SO-FINANZ-NUM-INT     PIC 9(08).
SJB071*SIB201            15 SO-KEY-INT            PIC X(04).
SJB071*SIB201            15 FILLER                PIC X(35) VALUE SPACE.
S1C251* TIPOLOGIA DEL MUTUO
S1C251         10 SO-TIPO-MUTUO-INT  PIC 9(1).
S1C251            88 AGRARIO-INT                VALUE 1.
S1C251            88 ABIT-PRIN-INT              VALUE 2.
S1C251            88 ALTRI-IMM-INT              VALUE 3.
S1C251            88 COST-RIST-INT              VALUE 4.
SKC182            88 ALTFIN-INT                 VALUE 5.
SIB161*SHL121* FLAG MUTUO MISTO
SIB161*SHL121         10 SO-FLAG-MISTO-INT      PIC 9(1).
SIB161*SHL121            88 MUTUO-UNICA-FIN-INT        VALUE 0.
SIB161*SHL121            88 MUTUO-MISTO-INT            VALUE 1.
SJB071* FLAG MUTUO MISTO
SJB071         10 SO-FLAG-MISTO-INT      PIC 9(1).
SJB071            88 MUTUO-UNICA-FIN-INT        VALUE 0.
SJB071            88 MUTUO-MISTO-INT            VALUE 1.
S1C251* DATA DI STIPULA DEL CONTRATTO DI MUTUO
S1C251         10 SO-DATA-STIPULA-INT PIC 9(8).
S1C251         10 FILLER REDEFINES SO-DATA-STIPULA-INT.
S1C251            15 SO-GG-NA-STI-INT  PIC 99.
S1C251            15 SO-MM-NA-STI-INT  PIC 99.
S1C251            15 SO-SA-NA-STI-INT  PIC 9999.
S1C251* AMMONTARE ORIGINARIO DEL MUTUO
S1C251         10 SO-IMP-INIZ-INT     PIC ZZZZZZZZ9.
S1C251* AMMONTARE DELLE RATE PAGATE
S1C251         10 SO-IMP-RATE-PAG-INT PIC ZZZZZZZZ9.
S1C251* AMMONTARE DEGLI INTERESSI E DEGLI ONERI ACCESSORI VERSATI
S1C251         10 SO-IMP-INT-ONE-INT  PIC ZZZZZZZZ9.
SIB161*SHL121* AMMONTARE DELLE PENALI E COSTI NON DETRAIBILI VERSATI
SIB161*SHL121         10 SO-IMP-PEN-NON-DET  PIC ZZZZZZZZ9.
SJB071* AMMONTARE DELLE PENALI E COSTI NON DETRAIBILI VERSATI
SJB071         10 SO-IMP-PEN-NON-DET  PIC ZZZZZZZZ9.
SHA041* FLAG ESTINZIONE
SHA041         10 SO-FLAG-ESTINZ-INT    PIC X(1).
SMK281* FLAG OPERAZIONI SOCIETARIE
SMK281         10 SO-FLAG-OPESOC-INT    PIC X(1).
SMK281* IDENTIFICATIVO MUTUO ASSEGNATO DA BANCA CEDENTE
SMK281         10 SO-ID-MUTUO-CED-INT   PIC X(50).
S1C251* CARATTERI DI CONTROLLO
SHA041*S1C251  10 FILLER-INT            PIC X(1634).
SHL121*SHA041  10 FILLER-INT            PIC X(1598).
SIB161*SHL121  10 FILLER-INT            PIC X(1588).
SJB071*SIB161         10 FILLER-INT            PIC X(1598).
SMK281*SJB071         10 FILLER-INT            PIC X(1588).
SMK281         10 FILLER-INT            PIC X(1537).
S1C251         10 SO-CAR-CONTROLLO-INT  PIC X(1).
S1C251         10 SO-CAR-FINE-RIGA-INT  PIC X(2).
S1C251*                                                                    CL**2
SHA041*
SHA041*************************************************
SHA041* - 2: DETTAGLIO COINTESTATARIO:
SHA041*************************************************
S1C251* TRACCIATO RECORD DI DETTAGLIO CON COINTESTATARIO
S1C251     05  SO-RECORD-DETTAGLIO-COINT REDEFINES SO-RECORD-TESTA.
S1C251* DATI IDENTIFICATIVI DELL'INTESTATARIO
S1C251         10 SO-ANAGRAFICA-COINTESTATARIO.
S1C251* CODICE FISCALE
S1C251            15 SO-CODICE-FIS-COINT   PIC X(16).
S1C251* COGNOME
S1C251            15 SO-COGNOME-COINT      PIC X(24).
S1C251* NOME
S1C251            15 SO-NOME-COINT         PIC X(20).
S1C251* SESSO
S1C251            15 SO-SESSO-COINT        PIC X(1).
S1C251               88 MASCHILE-COINT          VALUE 'M'.
S1C251               88 FEMMINILE-INT           VALUE 'F'.
S1C251* DATA DI NASCITA
S1C251            15 SO-DATA-NASCITA-COINT PIC 9(8).
S1C251            15 FILLER REDEFINES SO-DATA-NASCITA-COINT.
S1C251              20 SO-GG-NA-NAS-COINT  PIC 99.
S1C251              20 SO-MM-NA-NAS-COINT  PIC 99.
S1C251              20 SO-SA-NA-NAS-COINT  PIC 9999.
S1C251* COMUNE O STATO ESTERO DI NASCITA
S1C251            15 SO-COMSTA-NAS-COINT   PIC X(40).
S1C251* PROVINCIA DI NASCITA
S1C251            15 SO-PROVINCIA-COINT    PIC X(02).
S1C251* DATI IDENTIFICATIVI DEL MUTUO
S1C251* IDENTIFICATIVO DEL MUTUO
S1C251         10 SO-ID-MUTUO-COINT.
SHL121*S1C251     15 SO-FINANZ-PRE-COINT   PIC X(03).
SHL121*S1C251     15 SO-FINANZ-NUM-COINT   PIC 9(08).
SHL121*S1C251     15 SO-KEY-COINT          PIC X(04).
SHL121*SG0217     15 SO-KEY-SPACE          PIC X(35).
SHA041*           15 FILLER                PIC X(35).
SHA041*           15 SO-ID-RAPP-COINT      PIC X(50).
SIB201*SHL121     15 SO-ID-RAPP-COINT      PIC X(50).
SJB071            15 SO-ID-RAPP-COINT      PIC X(50).
SJB071*SIB201            15 SO-FINANZ-PRE-COINT   PIC X(03).
SJB071*SIB201            15 SO-FINANZ-NUM-COINT   PIC 9(08).
SJB071*SIB201            15 SO-KEY-COINT          PIC X(04).
SJB071*SIB201            15 SO-KEY-SPACE          PIC X(35).
S1C251* TIPOLOGIA DEL MUTUO
S1C251         10 SO-TIPO-MUTUO-COINT    PIC 9(1).
S1C251            88 AGRARIO-COINT              VALUE 1.
S1C251            88 ABIT-PRIN-COINT            VALUE 2.
S1C251            88 ALTRI-IMM-COINT            VALUE 3.
S1C251            88 COST-RIST-COINT            VALUE 4.
SKC182            88 ALTFIN-COINT               VALUE 5.
SIB161*SHL121* FLAG MUTUO MISTO
SIB161*SHL121         10 SO-FLAG-MISTO-COINT    PIC 9(1).
SIB161*SHL121            88 MUTUO-UNICA-FIN-COINT      VALUE 0.
SIB161*SHL121            88 MUTUO-MISTO-COINT          VALUE 1.
SJB071*FLAG MUTUO MISTO
SJB071         10 SO-FLAG-MISTO-COINT    PIC 9(1).
SJB071            88 MUTUO-UNICA-FIN-COINT      VALUE 0.
SJB071            88 MUTUO-MISTO-COINT          VALUE 1.
S1C251* DATA DI STIPULA DEL CONTRATTO DI MUTUO
S1C251         10 SO-DATA-STIPULA-COINT  PIC 9(8).
S1C251         10 FILLER REDEFINES SO-DATA-STIPULA-COINT.
S1C251            15 SO-GG-NA-STI-COINT PIC 99.
S1C251            15 SO-MM-NA-STI-COINT PIC 99.
S1C251            15 SO-SA-NA-STI-COINT PIC 9999.
S1C251* AMMONTARE ORIGINARIO DEL MUTUO
S1C251         10 SO-IMP-INIZ-COINT      PIC ZZZZZZZZ9.
S1C251* AMMONTARE DELLE RATE PAGATE COMPLESSIVAMENTE DA COINTESTATARI
S1C251         10 SO-IMP-RATE-PAG-COINT  PIC ZZZZZZZZ9.
S1C251* AMMONTARE DEGLI INTERESSI E DEGLI ONERI ACCESSORI VERSATI COMPL.
S1C251         10 SO-IMP-INT-ONE-COINT   PIC ZZZZZZZZ9.
SIB161*SHL121* AMMONTARE PENALI E COSTI CON DETR. VERSATI COMPL. DA COI
SIB161*SHL121         10 SO-IMP-PEN-COS-COINT   PIC ZZZZZZZZ9.
SJB071* AMMONTARE PENALI E COSTI NON DETR. VERSATI COMPL. DA COI
SJB071         10 SO-IMP-PEN-COS-COINT   PIC ZZZZZZZZ9.
SHA041* FLAG ESTINZIONE
SHA041         10 SO-FLAG-ESTINZ-COINT  PIC X(1).
SHA041* DATI DELLA COINTESTAZIONE
S1C251* PERCENTUALE DI COINTESTAZIONE
S1C251         10 SO-PERCENTUALE-COINT   PIC X(005).
S1C251* AMMONTARE DELLE RATE PAGATE DA PARTE DEL COINTESTATARIO
S1C251         10 SO-RATE-EFF-PAG-COINT  PIC ZZZZZZZZ9.
S1C251* AMMONTARE DEGLI INTERESSI E DEGLI ONERI ACCESSORI VERSATI DAL
S1C251* COINTESTATARIO
S1C251         10 SO-INT-ONE-PAG-COINT   PIC ZZZZZZZZ9.
SIB161*SHL121* AMMONTARE PENALI E COSTI CON DETR. VERSATI DA COI
SIB161*SHL121         10 SO-PEN-NON-DET-COINT   PIC ZZZZZZZZ9.
SJB071* AMMONTARE PENALI E COSTI NON DETR. VERSATI DA COI
SJB071         10 SO-PEN-NON-DET-COINT   PIC ZZZZZZZZ9.
SHA041* PROPRIETA' DELL'IMMOBILE
SHA041         10 SO-PROPR-IMM-COINT     PIC X(1).
S1C251* PROGRESSIVO COINTESTATARIO
SHA041*S1C251  10 SO-ID-COINT-COINT      PIC Z9.
SHA041         10 SO-ID-COINT-COINT      PIC 9(2).
S1C251* TOTALE COINTESTATARI
SHA041*S1C251  10 SO-TOTALE-COINT        PIC Z9.
SHA041         10 SO-TOTALE-COINT        PIC 9(2).
SMK281* FLAG OPERAZIONI SOCIETARIE
SMK281         10 SO-FLAG-OPESOC-COINT   PIC X(1).
SMK281* IDENTIFICATIVO MUTUO ASSEGNATO DA BANCA CEDENTE
SMK281         10 SO-ID-MUTUO-CED-COINT  PIC X(50).
S1C251* CARATTERI DI CONTROLLO
SHA041*S1C251  10 FILLER-COINT           PIC X(1607).
SHL121*SHA041  10 FILLER-COINT           PIC X(1570).
SIB161*SHL121  10 FILLER-COINT           PIC X(1551).
SJB071*SIB161  10 FILLER-COINT           PIC X(1570).
SMK281*SJB071         10 FILLER-COINT           PIC X(1551).
SMK281         10 FILLER-COINT           PIC X(1500).
S1C251         10 SO-CAR-CONTROLLO-COINT PIC X(1).
S1C251         10 SO-CAR-FINE-RIGA-COINT PIC X(2).
S1C251*                                                                    CL**2
S1C251*                                                                    CL**2
SHA041*************************************************
SHA041* - 9: CODA:
SHA041*************************************************
S1C251* TRACCIATO RECORD DI CODA
S1C251     05  SO-RECORD-CODA REDEFINES SO-RECORD-TESTA.                   CL**2
S1C251* CODICE IDENTIFICATIVO DELLA FORNITURA
S1C251         10 SO-CODIDENT-FOR-C     PIC X(5).
S1C251* CODICE NUMERICO DELLA FORNITURA
S1C251         10 SO-CODNUM-FOR-C       PIC X(2).
S1C251* TIPOLOGIA DI INVIO
S1C251         10 SO-TIPO-INVIO-C       PIC 9(1).
S1C251            88 ORDINARIO-C                VALUE 0.
S1C251            88 SOSTITUTIVO-C              VALUE 1.
S1C251            88 ANNULLAMENTO-C             VALUE 2.
S1C251            88 COM-NEGATIVA-C             VALUE 3.
S1C251* PROTOCOLLO TELEMATICO DA SOSTITUIRE O ANNULLARE
S1C251         10 SO-PROTOCOLLO-TEL-C   PIC ZZZZZZZZZZZZZZZZ9.
S1C251* CODICE FISCALE SOGGETTO OBBLIGATO
S1C251         10 SO-CODICE-FISCALE-C   PIC 9(16).
S1C251* SOGGETTO OBBLIGATO PERSONA GIURIDICA
S1C251         10 SO-SOGG-PERSONA-GIURIDICA.
S1C251* DENOMINAZIONE DEL SOGGETTO
S1C251            15 SO-DEN-PER-C       PIC X(60).
S1C251* COMUNE DEL DOMICILIO FISCALE
S1C251            15 SO-COMUNE-C        PIC X(40).
S1C251* PROVINCIA DEL DOMICIO FISCALE
S1C251            15 SO-PROVINCIA-C     PIC X(2).
S1C251* SOGGETTO OBBLIGATO PERSONA FISICA
S1C251         10 SO-SOGG-PERSONA-FISICA.
S1C251* COGNOME PERSONA
S1C251            15 SO-COGNOME-C       PIC X(24).
S1C251* NOME PERSONA
S1C251            15 SO-NOME-C          PIC X(20).
S1C251* SESSO
S1C251            15 SO-SESSO-C         PIC X(1).
S1C251               88 MASCHILE-C              VALUE 'M'.
S1C251               88 FEMMINILE-C             VALUE 'F'.
S1C251* DATA DI NASCITA
S1C251            15 SO-DATA-NASCITA-C  PIC 9(8).
S1C251            15 FILLER REDEFINES SO-DATA-NASCITA-C.
S1C251              20 SO-GG-NA-C    PIC 99.
S1C251              20 SO-MM-NA-C    PIC 99.
S1C251              20 SO-SA-NA-C    PIC 9999.
S1C251* COMUNE O STATO ESTERO DI NASCITA
S1C251            15 SO-COMSTA-NAS-C    PIC X(40).
S1C251* PROVINCIA DI NASCITA
S1C251            15 SO-PROVINCIA-NAS-C PIC X(2).
S1C251* ESTREMI DELLA FORNITURA
S1C251* ANNO DI RIFERIMENTO
S1C251         10 SO-ANNO-RIF-C         PIC 9(4).
S1C251* DATI RISERVATI AL SOGGETTO CHE ASSUME L'IMPEGNO ALLA
S1C251* PRESENTAZIONE TELEMATICA
S1C251* CODICE FISCALE DELL'INTERMEDIARIO CHE EFFETTUA LA TRASMISSIONE
S1C251         10 SO-CODICE-INTER-C     PIC X(16).
S1C251* NUMERO DI ISCRIZIONE ALL'ALBO C.A.F
S1C251         10 SO-NUM-ALBO-CAF-C     PIC 9(5).
S1C251* IMPEGNO A TRASMETTERE IN VIA TELEMATICA LA COMUNICAZIONE
S1C251         10 SO-COM-TELEMATICA-C   PIC 9(1).
S1C251               88 COM-CONTRIBUENTE-C    VALUE 1.
S1C251               88 COM-SOG-INVIO-C       VALUE 2.
S1C251* DATA DELL'IMPEGNO
S1C251         10 SO-DATA-IMPEGNO-C     PIC 9(8).
S1C251         10 FILLER REDEFINES SO-DATA-IMPEGNO-C.
S1C251            15 SO-GG-NA-IMP-C  PIC 99.
S1C251            15 SO-MM-NA-IMP-C  PIC 99.
S1C251            15 SO-SE-NA-IMP-C  PIC 99.
S1C251            15 SO-AA-NA-IMP-C  PIC 99.
SHA041* E-MAIL VALIDO PER CONTATTI
SHA041         10 SO-EMAIL-C            PIC X(100).
S1C251* CARATTERI DI CONTROLLO
SHA041*S1C251  10 FILLER-C              PIC X(1524).
SHA041         10 FILLER-C              PIC X(1424).
S1C251         10 SO-CAR-CONTROLLO-C    PIC X(1).
S1C251         10 SO-CAR-FINE-RIGA-C    PIC X(2).
S1C251
S1C251*    05  SO-RECORD-TESTA.
S1C251*        10 SO-CODFISC-EROGANTE-T PIC 9(11).
S1C251*        10 SO-ANAGR-EROGANTE-T   PIC X(60).
S1C251*        10 SO-ANNO-RIFERIMENTO   PIC 9(4).
S1C251*        10 SO-CODICE-FLUSSO      PIC X(2).
S1C251*           88 TIPO-FLUSSO         VALUE 'MU'.
S1C251*        10 SO-PROGR-VOLUME-T.
S1C251*           15 SO-PROGR-ANNO      PIC 9(4).
S1C251*           15 SO-PROGR-NUMERO    PIC 9(3).
S1C251*        10 SO-DATA-INVIO         PIC 9(8).
S1C251*        10 SO-TIPO-FORNITURA     PIC X(1).
S1C251*           88 ORDINARIA           VALUE 'O'.
S1C251*           88 CORREZIONE          VALUE 'R'.
S1C251*        10 FILLER-1              PIC X(106).
S1C251*
S1C251*    05  SO-RECORD-DETTAGLIO REDEFINES SO-RECORD-TESTA.
S1C251*        10 SO-IDENTIF-MUTUO.
S1C251*           15 SO-FINANZ-PRE         PIC X(03).
S1C251*           15 SO-FINANZ-NUM         PIC 9(08).
S1C251*           15 SO-PROG-KEY           PIC 9(04).
S1C251*        10 SO-PROGR-COINTEST     PIC 9(4).
S1C251*        10 SO-TIPO-PREST-MUTUO   PIC 9.
S1C251*           88 AGRARIO                VALUE 1.
S1C251*           88 GARANTITO-DA-IPOTECA   VALUE 2.
S1C251*        10 SO-AGEVOLATO          PIC 9.
S1C251*           88 NON-AGEVOLATO          VALUE 0.
S1C251*           88 AGEVOLATO              VALUE 1.
S1C251*        10 SO-DATA-EROGAZIONE    PIC 9(8).
S1C251*        10 FILLER REDEFINES SO-DATA-EROGAZIONE.
S1C251*           15 SO-GG-ER      PIC 99.
S1C251*           15 SO-MM-ER      PIC 99.
S1C251*           15 SO-SE-ER      PIC 99.
S1C251*           15 SO-AA-ER      PIC 99.
S1C251*        10 SO-IMPORIG-PREST      PIC 9(13).
S1C251*        10 SO-IMPCORR-ANNO       PIC 9(13).
S1C251*        10 SO-NUMERO-INTESTAT    PIC 9(4).
S1C251*        10 SO-CODFISC-INTESTAT   PIC X(16).
S1C251*        10 SO-ANAGRAFICI-INTESTATARIO.
S1C251*           15 SO-COGNOME         PIC X(24).
S1C251*           15 SO-NOME            PIC X(20).
S1C251*           15 SO-SESSO           PIC X.
S1C251*              88 SESSO-FEMMINILE        VALUE 'F'.
S1C251*              88 SESSO-MASCHILE         VALUE 'M'.
S1C251*           15 SO-DATA-NASCITA    PIC 9(8).
S1C251*           15 FILLER REDEFINES SO-DATA-NASCITA.
S1C251*             20 SO-GG-NA      PIC 99.
S1C251*             20 SO-MM-NA      PIC 99.
S1C251*             20 SO-SE-NA      PIC 99.
S1C251*             20 SO-AA-NA      PIC 99.
S1C251*           15 SO-LUOGO-NASCITA   PIC X(25).
S1C251*           15 SO-PROV-NASCITA    PIC XX.
S1C251*        10 SO-PROGR-RECORD       PIC 9(6).
S1C251*        10 SO-TIPO-DIVISA        PIC X.
S1C251*           88 IN-LIRE                    VALUE 'L'.
S1C251*           88 IN-EURO                    VALUE 'E'.
S1C251*        10 SO-SETTORE            PIC 99.
S1C251*           88 PORTAFOGLIO-FINANZIARIO    VALUE 02.
S1C251*           88 MUTUI                      VALUE 50.
S1C251*        10 SO-DIPENDENZA         PIC 9(4).
S1C251*        10 SO-NUMERO-POSIZ       PIC 9(6).
S1C251*        10 SO-CODICE-COE REDEFINES SO-NUMERO-POSIZ.
S1C251*           15 FILLER                PIC X.
S1C251*           15 SO-COE                PIC 9(9) COMP-3.
S1C251*        10 SO-CODICE-RUBRICA     PIC 9(9).
S1C251*        10 FILLER-2              PIC X(11).
S1C251*        10 SO-CODICE-CARTOL      PIC X(05).
S1C251*                                                                    CL**2
S1C251*    05  SO-RECORD-CODA REDEFINES SO-RECORD-TESTA.                   CL**2
S1C251*        10 SO-CODFISC-EROGANTE-C PIC 9(11).                         CL**2
S1C251*        10 SO-ANAGR-EROGANTE-C   PIC X(60).                         CL**2
S1C251*        10 SO-ANNO-RIFERIM-C     PIC 9(4).
S1C251*        10 SO-CODICE-FLUSSO-C    PIC X(2).
S1C251*        10 SO-PROGR-VOLUME-C.                                       CL**2
S1C251*           15 SO-PROGR-ANNO-C    PIC 9(4).
S1C251*           15 SO-PROGR-NUMERO-C  PIC 9(3).
S1C251*        10 SO-DATA-INVIO-C       PIC 9(8).
S1C251*        10 SO-TIPO-FORNITURA-C   PIC X(1).
S1C251*        10 SO-NUMREC-DETTAGLIO   PIC 9(9).                          CL**2
S1C251*        10 SO-TOT-SOMME-LIRE     PIC 9(15).                         CL**2
S1C251*        10 SO-TOT-SOMME-EURO     PIC 9(15).                         CL**2
S1C251*        10 FILLER-3              PIC X(67).                         CL**2
S1C251**********************************************************

SKA292
SKA292 FD  EKSONC2
SKA292     LABEL RECORD STANDARD
SKA292     BLOCK CONTAINS 0 CHARACTERS.
SKA292 01  SONCOR22                     PIC X(1800).

       WORKING-STORAGE SECTION.

      ******************************************************************
      * AREA PER WORKING DEL FRAME
      ******************************************************************
           COPY EKIFRB1W.

      ******************************************************************
      * AREA PER DICHIARAZIONE COPY SQL DI COMODO
      ******************************************************************
       01 DATI-SQL.
         03 W-FAC-SQL                 PIC S9(4) COMP.
            88 FAC-OK          VALUE ZERO.
            88 FAC-NOTFND      VALUE +100 +1403.

         03 W-RPG-SQL               PIC S9(4) COMP.
            88 RPG-OK          VALUE ZERO.
            88 RPG-NOTFND      VALUE +100 +1403.

      ******************************************************************
      * AREA PER DICHIARAZIONE DATI DI COMODO
      ******************************************************************
       01  W-C-NOME-PROGR                   PIC X(008) VALUE 'EKFCEIEB'.

090325*                                                                 00590002
090325     COPY AGC0033.
090325     COPY AGC0080.
090325
090309 01  FANT1-G-APPO-RECORD.
090309     COPY EKFANT1W.

090325 01 W-G-AREA-FINANZ.
090325    COPY EKFAN00W REPLACING 'XXXXX' BY FAN00.
090325
       77 IMSG1-STATUS                      PIC X(002).
           88 IMSG1-STATUS-OK               VALUE '00'.

       77 CERIO-STATUS                      PIC X(002).
           88 CERIO-STATUS-OK               VALUE '00'.
           88 CERIO-STATUS-EOF              VALUE '10'.

       77 DICPI-STATUS                      PIC X(002).
           88 DICPI-STATUS-OK               VALUE '00'.

       77 PAPYR-STATUS                      PIC X(002).
           88 PAPYR-STATUS-OK               VALUE '00'.

090309 77 ELABORA-MOVIMENTO      PIC  X(002)  VALUE SPACE.
090309     88 NO-ELAB                          VALUE 'NO'.
090309     88 SI-ELAB                          VALUE 'SI'.
090309
090309 77  CERTIFCY-RD            PIC  9(008)  VALUE ZERO.
090309 77  CCOMAIL-RD             PIC  9(008)  VALUE ZERO.
090309 77  CCOMAIL-NF             PIC  9(008)  VALUE ZERO.
SID191 77  ANWR0302-RD             PIC  9(008)  VALUE ZERO.

090309 77 SONCO-STATUS                      PIC X(002).
090309     88 SONCO-STATUS-OK               VALUE '00'.
090309
SKA292 77 SONC2-STATUS                      PIC X(002).
SKA292     88 SONC2-STATUS-OK               VALUE '00'.
SKA292
       01 W-NO-EOF-CERIO                    PIC X(001).
          88 W-EOF-CERIO                    VALUE  '1'.

       01 W-APPO.
         03 W-APPO-DATA-X.
           05 W-APPX-SSAA                   PIC X(04).
           05 FILLER                        PIC X(01).
           05 W-APPX-MM                     PIC X(02).
           05 FILLER                        PIC X(01).
           05 W-APPX-GG                     PIC X(02).
         03 W-APPO-DATA-9.
           05 W-APP9-SSAA                   PIC 9(04).
           05 W-APP9-MM                     PIC 9(02).
           05 W-APP9-GG                     PIC 9(02).
         03 W-APPO-D-DATA-CTRL              PIC X(10).
      *
       01  WD-CHIAVE-MSG.
         03  WD-C-GRUPPO-ABI                PIC X(5).
         03  WD-C-CODICE-ABI                PIC X(5).
         03  WD-C-FINANZ-PRE                PIC X(5).
         03  WD-N-FINANZ-NUM                PIC 9(8).

       01 W-ELABORARE                       PIC X(001).
           88 ELABORARE-SI                  VALUE 'S'.
           88 ELABORARE-NO                  VALUE 'N'.

       01 W-INIZIO-CICLO                    PIC X(001).
           88 INIZIO-CICLO-SI               VALUE 'S'.
           88 INIZIO-CICLO-NO               VALUE 'N'.

       01 W-TROVATO                         PIC X(001).
           88 TROVATO-SI                    VALUE 'S'.
           88 TROVATO-NO                    VALUE 'N'.

S1C251 01 W-TROVATO-TIPO-FIN                PIC X(001).
S1C251     88 TROVATO-TIPO-FIN              VALUE 'S'.
S1C251     88 NO-TROVATO-TIPO-FIN           VALUE 'N'.

S1C251 01 W-TROVATO-MINORE                  PIC X(001).
S1C251     88 TROVATO-MINORE                VALUE 'S'.
S1C251     88 NO-TROVATO-MINORE             VALUE 'N'.

S1C251 01 W-TROVATO-COINT-PG                PIC X(001).
S1C251     88 TROVATO-COINT-PG              VALUE 'S'.
S1C251     88 NO-TROVATO-COINT-PG           VALUE 'N'.

S1G201 01 W-TROVATO-FIN-VALUTA              PIC X(001).
S1G201     88 TROVATO-FIN-VALUTA            VALUE 'S'.
S1G201     88 NO-TROVATO-FIN-VALUTA         VALUE 'N'.

080325 01 W-PROVENIENZA-DATI-ANA         PIC X(001).
080325     88 DATI-DA-CCORMAIL             VALUE 'C'.
080325     88 DATI-DA-ANAGRAFE             VALUE 'A'.
SID191     88 DATI-DA-ANWC0302             VALUE 'X'.
SKK132     88 DATI-DA-IAN9I                VALUE 'I'.


       01 W-COMODI.
SLE052    05 W-C-DIVISA-ORIG             PIC X(003).
SJD121    05 W-N-GG-RIST                 PIC 9(003).
SJD121    05 W-N-GG-ANNO                 PIC 9(003).
SJD121    05 W-P-PERC-RIST               PIC 9(005)V99999.
SJD121    05 W-F-EKFGT                   PIC X(001).
SJD121       88 W-F-EKFGT-SI             VALUE 'S'.
SJD121       88 W-F-EKFGT-NO             VALUE 'N'.
SKB261    05 W-F-ALTFIN-SOLO             PIC X(001).
SKB261       88 W-F-ALTFIN-SOLO-SI       VALUE 'S'.
SKB261       88 W-F-ALTFIN-SOLO-NO       VALUE 'N'.
SKB261    05 W-F-ALTFIN-COI              PIC X(001).
SKB261       88 W-F-ALTFIN-COI-SI       VALUE 'S'.
SKB261       88 W-F-ALTFIN-COI-NO       VALUE 'N'.
SLC113    05 W-PF-MISTO-SI               PIC X(001).
SLC113       88 PF-MISTO-NO              VALUE 'N'.
SLC113       88 PF-MISTO-SI              VALUE 'S'.
SLC121    05 W-RATE-A-ZERO               PIC X(001).
SLC121       88 RATE-A-ZERO-NO           VALUE 'N'.
SLC121       88 RATE-A-ZERO-SI           VALUE 'S'.
SJD121    05 W-P-DETRAZ-PER              PIC 9(010)V9(007).
SKC182    05 W-P-LIQUIDITA               PIC 9(010)V9(007).
          05 W-I                         PIC 9(003).
          05 W-J                         PIC 9(003).
S1C251    05 W-IAN                       PIC 9(003).
SKB261    05 W-COI                       PIC 9(003).
SLH051*   Numero di finalit{ certificabili e non
SKC182    05 W-FINALI                    PIC 9(003).
SLH051*   Numero di finalit{ uguali
SKC182    05 W-FINALI-N                  PIC 9(003).
SLH051*   Numero di finalit{ certificabili
SLC102    05 W-FINALI-TOT                PIC 9(003).
S1C251    05 W-N-CONT-ACC                PIC 9(004).
S2B161    05 W-N-CONTO-12                PIC 9(012).
SND171    05 W-C-FINANZ-PRE-RIN          PIC X(005).
SND171    05 W-N-FINANZ-NUM-RIN          PIC 9(008).
S1C251    05 W-C-FINANZ-PRE              PIC X(005).
S1C251    05 W-N-FINANZ-NUM              PIC 9(008).
SHA041    05 W-C-FINANZ-NUM REDEFINES W-N-FINANZ-NUM
SHA041                                   PIC X(008).
SHA041    05 W-N-FINANZ-NUM-Z            PIC ZZZZZZZ9.
          05 APPO-NDG-9-12               PIC 9(012).
090309    05 W-N-FANT1-LEN               PIC 9(9) COMP.
          05 W-N-READ                    PIC S9(09) COMP.
          05 W-N-UPDATE                  PIC S9(09) COMP.
          05 W-N-DISPLAY                 PIC ZZZZZZZ9.
          05 W-N-CONTA-DICPI             PIC S9(09) COMP.
090309    05 W-N-CONTA-SONCO             PIC S9(09) COMP.
090309    05 W-N-CONTA-FANT1             PIC S9(09) COMP.
090309    05 W-N-CONTA-SONC              PIC 9(09) VALUE ZEROES.
          05 W-N-CONTA-PAPYR             PIC S9(09) COMP.
SGB012    05 W-N-CONTA-PAPYR-STP         PIC S9(09) COMP.
          05 W-N-DISPLAY-1               PIC ZZZZZZZ9.
          05 W-N-DISPLAY-2               PIC ZZZZZZZ9.
SGB012    05 W-N-DISPLAY-3               PIC ZZZZZZZ9.
SJB071    05 W-N-DISPLAY-4               PIC ZZZZZZZ9.
          05 W-PROGRAMMA-ERRORE          PIC X(08).
090309    05 W-IMPCORR-ANNO-LIT          PIC 9(13) VALUE ZEROES.
090309    05 W-IMPCORR-ANNO-EUR          PIC 9(13) VALUE ZEROES.
          05 W-RIFERIMENTO-ERR           PIC X(04).
          05 W-PROGR-CHIAMATO            PIC X(08).
090309    05 W-N-LUNGH-IAN               PIC 9(003).
S1C251    05 W-N-CONTA-IAN               PIC 9(003).
S1C251    05 W-P-PERC-APPO               PIC 9(002)V9(002).
S1C251    05 W-P-PERC-SOMMA              PIC 9(002)V9(005).
S1C251    05 W-I-DELTA-MORA              PIC 9(009).
S1G201    05 W-APPO-MORA                 PIC 9(009).
S1G201    05 W-I-APPO-TOT-RATA           PIC 9(009).
S1C251    05 IMP-INIZ-INT-APPO           PIC 9(009).
SHL121    05 IMP-PEN-COS-NONDET          PIC 9(009).
S1C251    05 IMP-RATE-PAG-INT-APPO       PIC 9(009).
S1C251    05 IMP-INT-ONE-INT-APPO        PIC 9(009).
S1C251    05 IMP-INIZ-COINT-APPO         PIC 9(009).
SHL121    05 IMP-PEN-COS-COINT           PIC 9(009).
S1C251    05 IMP-RATE-PAG-COINT-APPO     PIC 9(009).
S1C251    05 IMP-INT-ONE-COINT-APPO      PIC 9(009).
S1C251    05 APPO-INT-ONE-COINT          PIC 9(009).
SHL121    05 APPO-PEN-COS-COINT          PIC 9(009).
S1C251    05 W-SOMMA-IMP-RATE            PIC 9(009).
S1C251    05 W-SOMMA-IMP-INT             PIC 9(009).
S1G201    05 W-APPO-IMP-INT              PIC S9(13)V99.
SLH051    05 W-APPO-IMP-PAG              PIC S9(13)V99.
SLH051    05 W-APPO-IMP-PAG-DIFF         PIC S9(13)V99.
SGB012*   05 W-APPO-IMP-INT-DIV          PIC S9(13)V99.
SGB012*   05 W-APPO-IMP-INT-VAL          PIC S9(13)V99.
S1C251    05 RATE-EFF-PAG-COINT-APPO     PIC 9(009).
S1C251    05 INT-ONE-PAG-COINT-APPO      PIC 9(009).
SHL121    05 PEN-NON-DET-COINT-APPO      PIC 9(009).
S1C251    05 ID-COINT-COINT-APPO         PIC 9(002).
S1C251    05 TOTALE-COINT-APPO           PIC 9(002).
S1C251    05 W-V-DATINT-VAL              PIC X(005).
S1C251    05 W-V-PERCENT REDEFINES
S1C251       W-V-DATINT-VAL              PIC 99,99.
S1C251    05 W-C-FINE-RIGA.
S1C251       08 FILLER-RIGA-CR           PIC 99 COMP VALUE 13.
S1C251       08 FILLER-RIGA-LF           PIC 99 COMP VALUE 10.
      *
S1G201*   05 APPO-AREA-MOMENT            PIC X(700).
S1G201*   05 APPO-AREA-PADRE             PIC X(700).
SGB012*S1G201    05 APPO-AREA-MOMENT     PIC X(1300).
SGB012*S1G201    05 APPO-AREA-PADRE      PIC X(1300).
SLC043*SGB012    05 APPO-AREA-MOMENT     PIC X(3500).
SLC043*SGB012    05 APPO-AREA-PADRE      PIC X(3500).
SNC091*SLC043    05 APPO-AREA-MOMENT            PIC X(3508).
SNC091*SLC043    05 APPO-AREA-PADRE             PIC X(3508).
SNC091    05 APPO-AREA-MOMENT            PIC X(5218).
SNC091    05 APPO-AREA-PADRE             PIC X(5218).
          05 APPO-C-CONTRA-PRE           PIC X(005).
          05 APPO-N-CONTRA-NUM           PIC X(008).
          05 APPO-IDENTIF-MUTUO          PIC 9(015).
          05 APPO-NEW-PROCED             PIC 9(002).
          05 APPO-NEW-SERVIZ             PIC 9(003).
          05 APPO-NEW-DIVISA             PIC 9(003).
          05 APPO-OLD-PROCED             PIC 9(002).
          05 APPO-OLD-SERVIZ             PIC 9(003).
          05 APPO-OLD-DIVISA             PIC 9(003).
SGB012    05 W-IAN1I-G-AREA-APPO         PIC X(806).
SHL121    05 W-C-GARANZ-ABT              PIC X(002).
SIB091    05 W-D-STIPUL-ADE              PIC X(010).
SJD291    05 W-C-DOMINI-DAT              PIC X(012).
SJD291    05 W-V-DOMINI-DAT              PIC X(016).
SJD121    05 W-D-INIRIS-CAL              PIC X(010).
SJD121    05 W-D-FINRIS-CAL              PIC X(010).
SJD121    05 W-D-INIRIS-PRE              PIC X(010).
SJD121    05 W-D-FINRIS-PRE              PIC X(010).
      *
          05 IMPORTI-VOCI.
            10 APPO-I-VOCE0                PIC S9(13)V99.
            10 APPO-I-VOCE1                PIC S9(13)V99.
            10 APPO-I-VOCE2                PIC S9(13)V99.
            10 APPO-I-VOCE3                PIC S9(13)V99.
            10 APPO-I-VOCE4                PIC S9(13)V99.
            10 APPO-I-VOCE5                PIC S9(13)V99.
            10 APPO-I-VOCE6                PIC S9(13)V99.
            10 APPO-I-VOCE7                PIC S9(13)V99.
            10 APPO-I-VOCE8                PIC S9(13)V99.
            10 APPO-I-VOCE9                PIC S9(13)V99.

SGB012    05 IMPORTI-VOCI-CER.
SGB012*- 1) IMPORTI DIVISA ORIGINARIA FINANZIAMENTO:
SGB012*-   interessi vari + oneri interessi
SGB012      10 W-I-INTVAR-TOT              PIC S9(13)V99.
SGB012*-   spese rata
SGB012      10 W-I-SPERAT-TOT              PIC S9(13)V99.
SGB012*-   spese istruttoria + oneri spese istruttoria
SGB012      10 W-I-SPEIST-TOT              PIC S9(13)V99.
SGB012*-   imposta sostitutiva + oneri imposta sostitutiva
SGB012      10 W-I-IMPSOS-TOT              PIC S9(13)V99.
SGB012*-   penali estinzione + oneri estinzione
SGB012      10 W-I-PENEST-TOT              PIC S9(13)V99.
SGB012*-   oneri SAL (SPSAL):
SGB012      10 W-I-ONESAL-TOT              PIC S9(13)V99.
SGB012*-   oneri accollo (SPACC):
SGB012      10 W-I-ONEACC-TOT              PIC S9(13)V99.
SGB012*-   altri oneri certificabili:
SGB012      10 W-I-ONECER-TOT              PIC S9(13)V99.
SGB012*-   commissioni di intervento:
SGB012      10 W-I-COMINT-TOT              PIC S9(13)V99.
SGB012*- 2) IMPORTI IN VALUTA (SE FINANZIAMENTO VALUTA ESTERA, IN EURO):
SGB012*-   interessi vari + oneri interessi VALUTA:
SGB012      10 W-I-INTVAR-TOT-VAL          PIC S9(13)V99.
SGB012*-   spese rata VALUTA:
SGB012      10 W-I-SPERAT-TOT-VAL          PIC S9(13)V99.
SGB012*-   spese istruttoria + oneri spese istruttoria VALUTA:
SGB012      10 W-I-SPEIST-TOT-VAL          PIC S9(13)V99.
SGB012*-   imposta sostitutiva + oneri imposta sostitutiva VALUTA:
SGB012      10 W-I-IMPSOS-TOT-VAL          PIC S9(13)V99.
SGB012*-   penali estinzione + oneri estinzione VALUTA
SGB012      10 W-I-PENEST-TOT-VAL          PIC S9(13)V99.
SGB012*-   oneri SAL (SPSAL) VALUTA:
SGB012      10 W-I-ONESAL-TOT-VAL          PIC S9(13)V99.
SGB012*-   oneri SAL (SPACC) VALUTA:
SGB012      10 W-I-ONEACC-TOT-VAL          PIC S9(13)V99.
SGB012*-   altri oneri certificabili VALUTA:
SGB012      10 W-I-ONECER-TOT-VAL          PIC S9(13)V99.
SGB012*-   commissioni di intervento VALUTA:
SGB012      10 W-I-COMINT-TOT-VAL          PIC S9(13)V99.
SMB153*- 3) IMPORTI DI APPOGGIO PER SOMME SU COINTESTATARI
SMB153      10 W-I-PENALE                  PIC S9(13)V99.
SNE092*CAMPI DI APPOGGIO PER IMPORTI NON TRACCIABILI
SNC091      10 W-I-NONTRAC-IMP             PIC S9(13)V99.
SNC091      10 W-I-NONTRAC-IMP-VAL         PIC S9(13)V99.
SNE092      10 W-I-INTVAR-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-INTVAR-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-SPEIST-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-SPEIST-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-ONESAL-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-ONESAL-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-PENEST-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-PENEST-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-ONEACC-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-ONEACC-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-ONECER-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-ONECER-TOT-C-VAL        PIC S9(13)V99.
SNE092      10 W-I-IMPSOS-TOT-C            PIC S9(13)V99.
SNE092      10 W-I-IMPSOS-TOT-C-VAL        PIC S9(13)V99.

SGB012*- Importi (solo positivi) per Anagrafe Tributaria:
SGB012    05 IMPORTI-VOCI-ANA.
SGB012      10 W-I-INTVAR-ANA              PIC S9(13)V99.
SGB012      10 W-I-SPERAT-ANA              PIC S9(13)V99.
SGB012      10 W-I-SPEIST-ANA              PIC S9(13)V99.
SGB012      10 W-I-IMPSOS-ANA              PIC S9(13)V99.
SGB012      10 W-I-PENEST-ANA              PIC S9(13)V99.
SGB012      10 W-I-ONESAL-ANA              PIC S9(13)V99.
SGB012      10 W-I-ONEACC-ANA              PIC S9(13)V99.
SGB012      10 W-I-ONECER-ANA              PIC S9(13)V99.
SGB012      10 W-I-COMINT-ANA              PIC S9(13)V99.
SGB012      10 W-I-INTVAR-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-SPERAT-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-SPEIST-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-IMPSOS-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-PENEST-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-ONESAL-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-ONEACC-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-ONECER-ANA-VAL          PIC S9(13)V99.
SGB012      10 W-I-COMINT-ANA-VAL          PIC S9(13)V99.

SGB012*-Interessi
SGB012    05  IMP-INT-STP                PIC S9(011)V9(002).
SGB012    05  IMP-INT-STP-VAL            PIC S9(011)V9(002).
SGB012*-Spese incasso rata
SGB012    05  IMP-SPE-INC                PIC S9(011)V9(002).
SGB012    05  IMP-SPE-INC-VAL            PIC S9(011)V9(002).
SGB012*-Spese di istruttoria
SGB012    05  IMP-SPE-IST                PIC S9(011)V9(002).
SGB012    05  IMP-SPE-IST-VAL            PIC S9(011)V9(002).
SGB012*-Spese erogazione mutuo a Stato Avanzamento Lavori
SGB012    05  IMP-ONE-SAL                PIC S9(011)V9(002).
SGB012    05  IMP-ONE-SAL-VAL            PIC S9(011)V9(002).
SGB012*-Compenso sostenuto per estinzione/riduzione anticipata del mutuo
SGB012    05  IMP-PEN-EST                PIC S9(011)V9(002).
SGB012    05  IMP-PEN-EST-VAL            PIC S9(011)V9(002).
SGB012*-Spese accollo mutuo
SGB012    05  IMP-ONE-ACC                PIC S9(011)V9(002).
SGB012    05  IMP-ONE-ACC-VAL            PIC S9(011)V9(002).
SGB012*-Spese e oneri connessi al mutuo
SGB012    05  IMP-ONE-VAR                PIC S9(011)V9(002).
SGB012    05  IMP-ONE-VAR-VAL            PIC S9(011)V9(002).
SGB012*-Imposta sostitutiva
SGB012    05  IMP-IMP-SOS                PIC S9(011)V9(002).
SGB012    05  IMP-IMP-SOS-VAL            PIC S9(011)V9(002).
SGB012*-Commissioni di intervento
SGB012    05  COM-INT                    PIC S9(011)V9(002).
SGB012    05  COM-INT-VAL                PIC S9(011)V9(002).

SGB012    05 IMP-INT-ONE-INT-APPO-NEW      PIC 9(009).
SGB012    05 IMP-INT-ONE-COINT-APPO-NEW    PIC 9(009).

SGB012    05 IMP-INT-ONE-INT-ARRO-NEW      PIC S9(13)V9(03).
SGB012    05 IMP-INT-ONE-COINT-ARRO-NEW    PIC S9(13)V9(03).
SGB012    05 IMP-RATE-PAG-INT-ARRO         PIC S9(13)V9(03).
SGB012    05 IMP-RATE-PAG-COINT-ARRO       PIC S9(13)V9(03).
SGB012    05 INT-ONE-PAG-COINT-ARRO        PIC S9(13)V9(03).
SHL121    05 PEN-NON-DET-COINT-ARRO        PIC 9(009).
SGB012    05 RATE-EFF-PAG-COINT-ARRO       PIC S9(13)V9(03).
SGB012    05 W-I-IMPORT-ARR                PIC S9(13)V9(03).
SJD121    05 W-I-RISPRI-CAL                PIC S9(13)V9(02).
SJD121    05 W-I-RISPRI-RAT                PIC S9(13)V9(02).
SJD121    05 W-I-AMMPAM-CAL                PIC S9(13)V9(02).
SJD121    05 W-I-AMMPAM-RAT                PIC S9(13)V9(02).
      *
          05 IMPORTI-VOCI-TOT.
            10 APPO-I-VOCE0-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE1-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE2-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE3-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE4-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE5-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE6-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE7-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE8-TOT            PIC S9(13)V99.
            10 APPO-I-VOCE9-TOT            PIC S9(13)V99.

S1C251*    S1-RECORD-DETTAGLIO.
S1C251*        10 S1-IDENTIF-MUTUO.
S1C251*           15 S1-FINANZ-PRE         PIC X(03).
S1C251*           15 S1-FINANZ-NUM         PIC 9(08).
S1C251*           15 S1-PROG-KEY           PIC 9(04).
S1C251*        10 S1-PROGR-COINTEST     PIC 9(4).
S1C251*        10 S1-TIPO-PREST-MUTUO   PIC 9.
S1C251*        10 S1-AGEVOLATO          PIC 9.
S1C251*        10 S1-DATA-EROGAZIONE    PIC 9(8).
S1C251*        10 FILLER REDEFINES S1-DATA-EROGAZIONE.
S1C251*           15 S1-GG-ER      PIC 99.
S1C251*           15 S1-MM-ER      PIC 99.
S1C251*           15 S1-SE-ER      PIC 99.
S1C251*           15 S1-AA-ER      PIC 99.
S1C251*        10 S1-IMPORIG-PREST      PIC 9(13).
S1C251*        10 S1-IMPCORR-ANNO       PIC 9(13).
S1C251*        10 S1-NUMERO-INTESTAT    PIC 9(4).
S1C251*        10 S1-CODFISC-INTESTAT   PIC X(16).
S1C251*        10 S1-ANAGRAFICI-INTESTATARIO.
S1C251*           15 S1-COGNOME         PIC X(24).
S1C251*           15 S1-NOME            PIC X(20).
S1C251*           15 S1-SESSO           PIC X.
S1C251*           15 S1-DATA-NASCITA    PIC 9(8).
S1C251*           15 FILLER REDEFINES S1-DATA-NASCITA.
S1C251*             20 S1-GG-NA      PIC 99.
S1C251*             20 S1-MM-NA      PIC 99.
S1C251*             20 S1-SE-NA      PIC 99.
S1C251*             20 S1-AA-NA      PIC 99.
S1C251*           15 S1-LUOGO-NASCITA   PIC X(25).
S1C251*           15 S1-PROV-NASCITA    PIC XX.
S1C251*        10 S1-PROGR-RECORD       PIC 9(6).
S1C251*        10 S1-TIPO-DIVISA        PIC X.
S1C251*        10 S1-SETTORE            PIC 99.
S1C251*        10 S1-DIPENDENZA         PIC 9(4).
S1C251*        10 S1-NUMERO-POSIZ       PIC 9(6).
S1C251*        10 S1-CODICE-COE.
S1C251*           15 FILLER                PIC X.
S1C251*           15 S1-COE                PIC 9(9) COMP-3.
S1C251*        10 S1-CODICE-RUBRICA     PIC 9(9).
S1C251*        10 FILLER                PIC X(11).
S1C251*        10 S1-CODICE-CARTOL      PIC X(05).
S1C251*                                                                    CL**2
S5B091*- Dati per Cofinanziamenti:
S5B091    05 W-L                         PIC 9(003).
S5B091    05 W-F-LEGAMI-PROD             PIC X(001).
S5B091       88 NO-LEGAMI-FIN            VALUE 'N'.
S5B091       88 SI-LEGAMI-FIN            VALUE 'S'.
S5B091    05 W-N-LUNGH-TAB-LEG           PIC 9(003).
S5B091    05 WAPPO-G-TABLE-LEG-I.
S5B091     10 WAPPO-G-ELEMEN-LEG-I OCCURS 30.
S5B091       15 WAPPO-C-MULTIL-COD   PIC  X(005).
S5B091       15 WAPPO-C-FINANZ-PRE   PIC  X(005).
S5B091       15 WAPPO-N-FINANZ-NUM   PIC  9(008).
S5B091    05 W-C-FINANZ-PR2          PIC  X(003).
S5B091    05 W-N-FINANZ-NU2          PIC  9(008).

SGB012    05 W-F-TROVATO-PF              PIC X(001).
SGB012       88 TROVATO-PF-NO            VALUE 'N'.
SGB012       88 TROVATO-PF-SI            VALUE 'S'.
SGB012    05 W-F-TRM                     PIC X(001).
SGB012       88 TRM-NO                   VALUE 'N'.
SGB012       88 TRM-SI                   VALUE 'S'.
SIB091    05 W-F-COI                     PIC X(001).
SIB091       88 COI-NO                   VALUE 'N'.
SIB091       88 COI-SI                   VALUE 'S'.
DEB>>>*   05 W-F-ANA                     PIC X(001).
DEB>>>*      88 ANA-NO                   VALUE 'N'.
DEB>>>*      88 ANA-SI                   VALUE 'S'.

SJD121    05 W-U                         PIC 9(003).
SJD121    05 W-E                         PIC 9(003).
SJD121    05 W-STORE                     PIC 9(003).                    00671004
SJD121    05 W-SCAMBIO                   PIC X(001).                    00671004
SJD121       88 SCAMBIO-SI               VALUE 'S'.
SJD121       88 SCAMBIO-NO               VALUE 'N'.
SJD121    05 W-ELEMENTO-SCA.
SJD121     10 WAPPO-I-TIPOLO-SCA         PIC 9(011).
SJD121     10 WAPPO-C-TIPOLO-SCA         PIC X(080).
SGB012    05 W-K                         PIC 9(003).
SHL121    05 W-W                         PIC 9(003).
SHL121    05 W-Z                         PIC 9(003).
SHL121    05 W-X                         PIC 9(003).
SHL121    05 W-C-NATURA-DIR              PIC X(003).
SHL121    05 W-C-PROPRI-IMM              PIC X(001).
SHA041
SHA041    05 W-ID-RAPP-FIN.
SJB071     10 W-CAR-FISSO            PIC X(01).
SJB071     10 W-MUTUO-TIP            PIC X(03).
SJB071     10 W-FISCAL-COD           PIC X(16).
SHA041     10 W-FINANZ-PRE           PIC X(03).
SHA041     10 W-FILIA                PIC X(05).
SHA041     10 W-APPO-FIN             PIC X(04) VALUE ZEROES.
SHA041     10 W-FINANZ-NUM           PIC X(08) VALUE ZEROES.
SJB071*SHA041     10 FILLER                 PIC X(30).
SHA041     10 FILLER                 PIC X(10).
SHK271    05 WS-TIPO-PRO             PIC  X(003).
SHK271*- Proprietario/Nudo proprietario:
SHK271       88 PROP-SI              VALUE '1', '1S', '1T',
SJB071*SHK271                                     '2', '2S', '6'.
SJB071                                     '2', '2S', '4'.
SHK271*- No proprietario/Nudo proprietario:
SHK271       88 PROP-NO              VALUE '0', '10', '3',
SJB071*SHK271                                     '3S', '4', '5',
SJB071                                     '3S', '5', '6',
SHK271                                     '7', '7S', '8'.

SHL121    05 W-I-IMPFIN-IMM          PIC S9(13)V9(03).
SJB211    05 W-I-IMPSTI-IMM          PIC S9(13)V9(03).
SHL121
SHL121    05 W-G-TABLE-COINT.
SHL121       10 W-G-ELEMENT-COINT OCCURS 20.
SHL121          15 W-C-NDGNDG-COD-COI   PIC  X(012).
SHL121          15 W-C-PROPRI-IMM-COI   PIC  X(001).
SIB201          15 W-C-TIPO-MUTUO-COI   PIC  X(001).
SHL121    05 W-F-PRO                     PIC X(001).
SHL121       88 PRO-NO                   VALUE 'N'.
SHL121       88 PRO-SI                   VALUE 'S'.
SIB201    05 W-F-SPA                     PIC X(001).
SIB201       88 SPA-NO                   VALUE 'N'.
SIB201       88 SPA-SI                   VALUE 'S'.
SIB201    05 W-F-TEST                    PIC X(001).
SIB201       88 TEST-NO                  VALUE 'N'.
SIB201       88 TEST-SI                  VALUE 'S'.
SIB201    05 W-F-PROP-CAL                PIC X(001).
SIB201       88 PROP-CAL-NO              VALUE 'N'.
SIB201       88 PROP-CAL-SI              VALUE 'S'.
SJD121*SJB071    05 W-F-EKFDI                   PIC X(001).
SJD121*SJB071       88 W-F-EKFDI-SI             VALUE 'S'.
SJD121*SJB071       88 W-F-EKFDI-NO             VALUE 'N'.
SJD121    05 W-I-IMPORT-APP                PIC --.---.---.--9,99.
SJD121    05 W-P-PERCEN-APP                PIC -.---.---.--9,999.
SJD121
SJD121    05 WAPPO-G-TABLE-TIP-I.
SJD121     10 WAPPO-G-ELEMEN-TIP-I OCCURS 5.
SJD121       15 WAPPO-C-TIPOLO-TIP PIC  X(12).
SJD121       15 WAPPO-I-TIPOLO-MUT PIC S9(13)V9(02).
SJD121    05 W-G-ELE-TAB-TMP       PIC X(27).
SKA292**********************************************************
S5B091    05 W-F-PROPRI-IMM              PIC X(001).
SKA292    05 W-Y                         PIC 9(003).
SKA292    05 W-V                         PIC 9(003).
SKB181    05 W-G                         PIC 9(003).
SKB251    05 W-M                         PIC 9(003).
SKB261    05 W-F                         PIC 9(003).
SKA292    05 W-P-DETRAZ-NEW              PIC 9(005)V99999.
SKA292    05 W-C-NDGNDG-COD              PIC X(012).
SKA292    05 W-N-CONTA-SONC2             PIC S9(09) COMP.
SKA292    05 W-N-DISPLAY-5               PIC ZZZZZZZ9.
SKA292    05 W-I-DETRAZ-IMP              PIC S9(13)V9(02).
SKA292    05 W-I-DETRAZ-APP              PIC S9(13)V9(02).
SKA292    05 W-I-NONDET-IMP              PIC S9(13)V9(02).
SKA292    05 W-F-IFICOINT                PIC X(001).
SKA292       88 IFICOINT-NO              VALUE 'N'.
SKA292       88 IFICOINT-SI              VALUE 'S'.
SKB181    05 W-F-MUTUO-MISTO             PIC X(001).
SKB181       88 MUTUO-MISTO-NO           VALUE 'N'.
SKB181       88 MUTUO-MISTO-SI           VALUE 'S'.
SKB251    05 W-F-MUTUO-MISTO-2           PIC X(001).
SKB251       88 MUTUO-MISTO-2-NO         VALUE 'N'.
SKB251       88 MUTUO-MISTO-2-SI         VALUE 'S'.
SKB261    05 W-F-MUTUO-MISTO-3           PIC X(001).
SKB261       88 MUTUO-MISTO-3-NO         VALUE 'N'.
SKB261       88 MUTUO-MISTO-3-SI         VALUE 'S'.
SKC182    05 W-F-FINAL-MISTO             PIC X(001).
SKC182       88 FINAL-MISTO-UGU          VALUE 'N'.
SKC182       88 FINAL-MISTO-DIV          VALUE 'S'.
SLC102    05 W-F-FORZO-NON-MISTO         PIC X(001).
SLC102       88 FORZO-NON-MISTO-NO       VALUE 'N'.
SLC102       88 FORZO-NON-MISTO-SI       VALUE 'S'.
SKC182    05 W-F-ACCOL-NOPROP            PIC X(001).
SKC182       88 ACCOL-NOPROP-NO          VALUE 'N'.
SKC182       88 ACCOL-NOPROP-SI          VALUE 'S'.
SKA292
SKB261    05 W-F-AGRARIO-COINT           PIC X(001).
SKB261       88 AGRARIO-COINT-NO         VALUE 'N'.
SKB261       88 AGRARIO-COINT-SI         VALUE 'S'.
SKB261    05 W-F-ABIT-PRIN-COINT         PIC X(001).
SKB261       88 ABIT-PRIN-COINT-NO       VALUE 'N'.
SKB261       88 ABIT-PRIN-COINT-SI       VALUE 'S'.
SKB261    05 W-F-ALTRI-IMM-COINT         PIC X(001).
SKB261       88 ALTRI-IMM-COINT-NO       VALUE 'N'.
SKB261       88 ALTRI-IMM-COINT-SI       VALUE 'S'.
SKB261    05 W-F-COST-RIST-COINT         PIC X(001).
SKB261       88 COST-RIST-COINT-NO       VALUE 'N'.
SKB261       88 COST-RIST-COINT-SI       VALUE 'S'.
SKC182    05 W-F-ALTFIN-COINT            PIC X(001).
SKC182       88 ALTFIN-COINT-NO          VALUE 'N'.
SKC182       88 ALTFIN-COINT-SI          VALUE 'S'.
SKC182    05 W-F-AGRARIO-FINAL           PIC X(001).
SKC182       88 AGRARIO-FINAL-NO         VALUE 'N'.
SKC182       88 AGRARIO-FINAL-SI         VALUE 'S'.
SKC182    05 W-F-ABIT-PRIN-FINAL         PIC X(001).
SKC182       88 ABIT-PRIN-FINAL-NO       VALUE 'N'.
SKC182       88 ABIT-PRIN-FINAL-SI       VALUE 'S'.
SKC182    05 W-F-ALTRI-IMM-FINAL         PIC X(001).
SKC182       88 ALTRI-IMM-FINAL-NO       VALUE 'N'.
SKC182       88 ALTRI-IMM-FINAL-SI       VALUE 'S'.
SKC182    05 W-F-COST-RIST-FINAL         PIC X(001).
SKC182       88 COST-RIST-FINAL-NO       VALUE 'N'.
SKC182       88 COST-RIST-FINAL-SI       VALUE 'S'.
SKC182    05 W-F-ALTFIN-FINAL            PIC X(001).
SKC182       88 ALTFIN-FINAL-NO          VALUE 'N'.
SKC182       88 ALTFIN-FINAL-SI          VALUE 'S'.
SKB261
SKA292    05 W-N-LUNGH-TAB-SONCO         PIC 9(003).
SKB251    05 W-N-LUNGH-TAB-MIS           PIC 9(003).
SKC182
SKC182*- Record di "appoggio" per verifiche pre-scrittura:
SKA292    05 W-SO-RECORD.
SKA292     10 W-SO-RECORD-G-ELEMEN-I        OCCURS 20.
SKA292       15 W-SO-C-NDGNDG-COD           PIC X(12).
SKA292       15 W-SO-P-DETRAZ-COI           PIC 9(005)V99999.
SKA292       15 W-SO-RECORD-DETTAGLIO-COINT PIC X(1800).
SKA292       15 W-SO-INT-ONE-PAG-COINT      PIC 9(09).
SKA292       15 W-SO-PEN-NON-DET-COINT      PIC 9(09).
SKB181       15 W-SO-INT-ONE-PAG-COINT-PRE  PIC 9(09).
SKB181       15 W-SO-PEN-NON-DET-COINT-PRE  PIC 9(09).
SKB251       15 W-SO-INT-ONE-PAG-COINT-PRE-TOT  PIC 9(09).
SKB251       15 W-SO-PEN-NON-DET-COINT-PRE-TOT  PIC 9(09).
SKB261       15 W-SO-IMP-RPAG-COINT-PRE-TOT  PIC 9(09).
SKB251       15 W-SO-TIPO-MUTUO-COINT       PIC X(01).
SKB181       15 W-SO-FLAG-MISTO-COINT       PIC X(01).
SKB181       15 W-I-ACQPRI-IPO-COINT        PIC S9(13)V9(02).
SKB181       15 W-I-ACQALT-IPO-COINT        PIC S9(13)V9(02).
SKB181       15 W-I-RISPRI-IPO-COINT        PIC S9(13)V9(02).
SKB181       15 W-I-ALTFIN-IPO-COINT        PIC S9(13)V9(02).
SKB181       15 W-I-AGRARI-IPO-COINT        PIC S9(13)V9(02).
SKB181       15 W-I-TOTFIN-IPO-COINT        PIC S9(13)V9(02).
SKC182       15 W-C-PROPRI-IMM-COINT        PIC X(01).
SKC182       15 W-F-ABITAZ-PRI-COINT        PIC X(01).
SKC182*
SKB251    05 W-SO-RECORD-MIS.
SKB251     10 W-SO-RECORD-G-ELEMEN-MIS      OCCURS 20.
SKB251       15 W-SO-TIPO-MUTUO-COINT-MIS   PIC 9(1).
SKB251       15 W-SO-RECORD-DETTAGLIO-MIS   PIC X(1800).
SKB181    05 W-SONCO-APPO                   PIC X(1800).
SKC182    05 W-F-ABITAZ-PRI-APPO            PIC X(01).
SKC182    05 W-C-PROPRI-IMM-APPO            PIC X(01).
SKB181    05 W-I-ACQPRI-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-ACQALT-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-RISPRI-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-ALTFIN-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-AGRARI-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-TOTFIN-IPO-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-INTONE-PRE-APPO            PIC S9(13)V9(02).
SKB181    05 W-I-PENNON-PRE-APPO            PIC S9(13)V9(02).
SKB281    05 W-I-TOTRAT-PAG-APPO            PIC S9(13)V9(02).
SKB181    05 W-P-AGRARIO                    PIC 9(003)V9(005).
SKB181    05 W-P-ABIT-PRIN                  PIC 9(003)V9(005).
SKB181    05 W-P-ALTRI-IMM                  PIC 9(003)V9(005).
SKB181    05 W-P-COST-RIST                  PIC 9(003)V9(005).
SKB181    05 W-P-PERC-MISTO                 PIC 9(003)V9(005).
SKB181    05 W-P-PERC-RESTO                 PIC 9(003)V9(005).
SKC182    05 W-I-NONDET-TOT                 PIC S9(13)V9(02).
SKA292
SKA292    05 W-SO-INT-ONE-PAG-APPO          PIC 9(09).
SKB251    05 W-SO-INT-ONE-PAG-APPO-SUM      PIC 9(09).
SKB251    05 W-SO-INT-ONE-PAG-APPRO         PIC 9(09).
SKB251    05 W-SO-IMP-INT-ONE-APPRO         PIC 9(09).
SKB251    05 W-RESTO                        PIC 9(09).
SKB251    05 W-RESTO-APPR                   PIC 9(09).
SKA292    05 W-SO-PEN-NON-DET-APPO          PIC 9(09).
SKB181    05 W-SO-INT-ONE-PAG-CALC          PIC S9(13)V9(03).
SKB181    05 W-SO-PEN-NON-DET-CALC          PIC S9(13)V9(03).
SKC182    05 W-SO-LIQUIDITA                 PIC S9(13)V9(03).
SKB261    05 W-SO-PEN-NON-DET-9             PIC 9(09).
SKB181    05 W-SO-INT-ONE-PAG-ARR           PIC 9(09).
SKB181    05 W-SO-PEN-NON-DET-ARR           PIC 9(09).
SKA292    05 W-SO-INT-ONE-PAG-COINT-9       PIC 9(09).
SKA292    05 W-SO-IMP-INT-ONE-COINT-9       PIC 9(09).
SKA292    05 W-SO-PEN-NON-DET-COINT-9       PIC 9(09).
SKB181    05 W-INT-ONE-PAG-COINT-ARRO      PIC 9(009).
SKB181    05 W-PEN-NON-DET-COINT-ARRO      PIC 9(009).
SKB261    05 W-SO-IMP-RATE-PAG-COINT       PIC 9(009).
SKB251    05 W-INT-ONE-PAG-COINT-ARRO-TOT  PIC 9(009).
SKB251    05 W-PEN-NON-DET-COINT-ARRO-TOT  PIC 9(009).
SKB251    05 W-SO-IMP-INT-ONE-COINT        PIC ZZZZZZZZ9.
SKB251    05 W-SO-IMP-PEN-COS-COINT        PIC ZZZZZZZZ9.
SKB181    05 W-F-PAPY-2019               PIC X(001).
SKB181       88 PAPY-2019-NO             VALUE 'N'.
SKB181       88 PAPY-2019-SI             VALUE 'S'.
SKB181    05 W-F-ALTRI-IMM               PIC X(001).
SKB181       88 ALTRI-IMM-NO             VALUE 'N'.
SKB181       88 ALTRI-IMM-SI             VALUE 'S'.
SKC051    05 W-F-ACCOLLATO               PIC X(001).
SKC051       88 ACCOLLATO-NO             VALUE 'N'.
SKC051       88 ACCOLLATO-SI             VALUE 'S'.
SKA292    05 W-SO-IMP-PEN-NON-DET        PIC S9(13)V99.
SKA292    05 W-I-ACQPRI-IPO              PIC S9(13)V99.
SKA292    05 W-I-ACQALT-IPO              PIC S9(13)V99.
SKA292    05 W-I-RISPRI-IPO              PIC S9(13)V99.
SKA292    05 W-I-ALTFIN-IPO              PIC S9(13)V99.
SKA292    05 W-I-AGRARI-IPO              PIC S9(13)V99.
SKA292    05 W-I-TOTFIN-IPO              PIC S9(13)V99.
SLC113    05 W-I-TOTFIN-IPO-NOLIQ        PIC S9(13)V99.
SKB181    05 W-I-ALTIMM-TOT              PIC S9(13)V99.
SKB251    05 W-SO-ID-COINT-COINT         PIC 9(2).
SKB251    05 W-ELEMENTO-SCA-MIS.
SKB251     10 WAPPO-TIPO-MUTUO-COINT-MIS  PIC 9(1).
SKB251     10 WAPPO-RECORD-DETTAGLIO-MIS  PIC X(1800).
SKB261    05 WAPPO-G-IMPORT-MIS-I.
SKB261     10 WAPPO-G-IMPORT-ELE-I OCCURS 5.
SKB261       15 W-SO-TIPO-MUTUO-COINT-TOT      PIC 9(1).
SKB261       15 W-SO-IMP-RATE-PAG-COINT-TOT    PIC 9(09).
SKB261       15 W-SO-IMP-INT-ONE-COINT-TOT     PIC 9(09).
SKB261       15 W-SO-IMP-PEN-COS-COINT-TOT     PIC 9(09).
SKC182       15 W-SO-IMP-LIQUIDITA-TOT         PIC 9(09).
SKC182    05 W-SO-IMP-LIQUIDITA             PIC 9(09).
SKB261    05 W-SO-IMP-RATE-PAG-COINT-APPO   PIC 9(09).
SKB261    05 W-SO-IMP-INT-ONE-COINT-APPO    PIC 9(09).
SKB261    05 W-SO-IMP-PEN-COS-COINT-APPO    PIC 9(09).
SKC182    05 W-ABITAZ-PRI                PIC X(001).                    00671004
SKC182       88 ABITAZ-PRI-SI            VALUE 'S'.
SKC182       88 ABITAZ-PRI-NO            VALUE 'N'.

090309 77 FANT1-STATUS                      PIC X(002).
090309     88 FANT1-STATUS-OK               VALUE '00'.
090339     88 FANT1-STATUS-EOF              VALUE '10'.

SID191 01  WS-DAVAR1        PIC 9(013).
SID191 01  FILLER REDEFINES WS-DAVAR1.
SID191     05  WS-FILIALE-5.
SID191      07  WS-FILIALE   PIC 9(003).
SID191      07  WS-FILIALE-X PIC X(002).
SID191     05  WS-RAPPORTO  PIC 9(008).
SID191 01  WS-RAPPORTO-12   PIC 9(012).

      ******************************************************************
      * AREA DICHIARAZIONE COPY UTILI
      ******************************************************************

           COPY EKPAGRAW.

090309*                                === Gestione Corrispondenza ===
090309*COPY CCOC003.
090309 COPY EKECCERT.
090309*                                === Routine Corrispondenza  ===
SKK132*090309 COPY CCOCMAIL.
SID191*                                === Routine Corrispondenza  ===
SID191 COPY ANWC0302.
      ******************************************************************
      * AREA PER CHIAVE DI RIPARTENZA
      ******************************************************************
       01  W-X-SCHEDA-KEY                   PIC X(100).
       01 FILLER REDEFINES     W-X-SCHEDA-KEY.
            10 FILLER                    PIC X(100).
      *
SGB012*- Record lettera STAMPA PAPYRUS:
090309 01  PAPYRUS-REC-LET.
090309     03 PAPY-TIPO-REC       PIC  X(001) VALUE 'L'.
090309     03 FILLER-11           PIC  X(001).
090309     03 PAPY-CCOC003        PIC  X(400).
090309
090309     03 PAPY-DT-LETTERA     PIC  X(008).
090309     03 FILLER-12           PIC  X(001).
090309
090309     03 PAPY-LET-UFFAL      PIC  9(003).
090309     03 FILLER-13           PIC  X(001).
090309     03 PAPY-NOTE-LETT      PIC  X(001)  VALUE SPACE.
090309        88 PAPY-ALLEGA           VALUE 'A'.
090309        88 PAPY-IN-FIL           VALUE 'F'.
090309     03 PAPY-COPIA          PIC  X(001)  VALUE SPACE.
090309        88 PAPY-COPIA-NO         VALUE '1'.
090309        88 PAPY-COPIA-SI         VALUE '2'.
090309     03 FILLER-14           PIC  X(074).
090309     03 FILLER              PIC  X(009).
090309     03 NEW-NUMFIN-L        PIC  9(008).
S4K181*    03 PAPY-INDICA-SAB-L   PIC  X(002).
090309
SGB012*- Record movimenti STAMPA PAPYRUS:
090309 01  PAPYRUS-REC-MCC.
090309     03 PAPY-TIPO-REC       PIC  X(001) VALUE 'M'.
090309     03 FILLER-21           PIC  X(001).
090309     03 PAPY-FILIALE        PIC  9(005).
090309     03 PAPY-CONTO          PIC  9(012).
090309     03 PAPY-CERTIFCY.
090309        05  DATA-CERT-MM               PIC X(010).
090309        05  DATA-CERT-AA               PIC X(004).
090309        05  TIPO-FIN                   PIC X(002).
090309        05  ANNO-CERT                  PIC X(004).
090309        05  NUM-DOM-OUT                PIC X(006).
SID191*090309       05  INTEST-1                   PIC X(032).
SID191        05  INTEST-1                   PIC X(040).
SID191*090309        05  INTEST-2                   PIC X(032).
SID191        05  INTEST-2                   PIC X(040).
090309        05  INDIRIZZO                  PIC X(032).
090309        05  CAP                        PIC X(005).
090309*       05  LOCAL                      PIC X(027).
090309        05  FILLER                     PIC X(027).
090309        05  UIC-POSTA                  PIC X(003).
090309        05  DT-EROG                    PIC X(008).
090309        05  IMP-EROG                   PIC 9(011)V9(002).
090309        05  IMP-INT                    PIC 9(011)V9(002).
090309        05  COD-FIL                    PIC X(003).
090309        05  COD-CAT-OUT                PIC X(002).
090309**** IL CONTROVALORE LIRE SERVE SOLO PER LA CERTIFICAZIONE
090309**** RELATIVA ALL'ANNO 2001
090309        05  SETTORE                    PIC X(003).
090309        05  DIVISA                     PIC X(004).
090309        05  CAMBIO                     PIC 9(004)V9(6).
090309        05  IMP-INT-EURO               PIC 9(011)V9(002).
090309        05  FIL-CC                     PIC 9(005).
090309        05  CONTO-CC                   PIC X(012).
090309        05  NDG-MUT                    PIC X(012).
090309        05  NAZ                        PIC X(004).
090309        05  NATURA-GIURIDICA           PIC X(005).
090309        05  SESSO                      PIC X(001).
SGB012*       05  PRODOT-CLA                 PIC X(005).
SGB012        05  IMP-DEB-RES                PIC 9(011)V9(002).
SGB012*090309 05  FILLER                     PIC X(135).
SIC023*SGB012 05  FILLER                     PIC X(122).
SIC023        05  F-PASOFF                   PIC X(1).
SKC051        05  F-ACCOLL                   PIC X(1).
SID191*SIC023        05  FILLER              PIC X(121).
SKC051*SID191        05  FILLER              PIC X(105).
SKC051*       05  FILLER                     PIC X(104).
SKC051        05  LOCAL                      PIC X(040).
SKC051        05  FILLER                     PIC X(064).
090309     03 FILLER              PIC  X(081).
090309     03 NEW-NUMFIN-M        PIC  9(008).
090309     03 FILLER              PIC  X(219).
090309*    03 FILLER              PIC  X(300).
SID191     03 PAPY-INDICA-SAB-M   PIC  X(002).
SJD291     03 PAPY-TIPNTE-PRI     PIC  X(020).
SJD291     03 PAPY-IDENTE-PRI     PIC  X(025).
SKA292     03 PAPY-STIPUL-2019    PIC  X(001).
SID191*090309     03 FILLER-22    PIC  X(072).
SJD291*SID191 03 FILLER-22        PIC  X(071).
SKA292*SJD291     03 FILLER-22    PIC  X(026).
SLE052     03 PAPY-DIVISA-ORIG    PIC  X(004).
SLE052*SKA292     03 FILLER-22           PIC  X(025).
SLE052     03 FILLER-22           PIC  X(021).
S4K181*090309     03 FILLER              PIC  X(009).
SID191*S4K181     03 FILLER              PIC  X(007).

SGB012*- Nuovo record dettaglio Interessi e Spese STAMPA PAPYRUS:
SGB012 01  PAPYRUS-REC-STP.
SGB012     03 PAPY-TIPO-REC       PIC X(001) VALUE 'S'.
SGB012     03 FILLER-31           PIC X(001).
SGB012     03 PAPY-FILIALE-S      PIC 9(005).
SGB012     03 PAPY-CONTO-S        PIC 9(012).
SGB012     03 PAPY-IMPORTI.
SGB012        05  ORD-STP         PIC X(002).
SGB012        05  DES-STP         PIC X(100).
SGB012        05  IMP-STP         PIC S9(011)V9(002).
SGB012        05  STR-STP         PIC X(012).
SGB012        05  IMP-STP-EURO    PIC S9(011)V9(002).
SGB012        05  FILLER          PIC X(341).
SGB012     03 NEW-NUMFIN-S        PIC 9(008).
      *

      ******************************************************************
      * AREA DI COMMAERA STANDARD MODULI RICHIAMATI
      ******************************************************************
       01 EKCOM-G-GROUP-AREA.
           COPY EKEKCOMW.

      ******************************************************************
      * AREA PER LA GESTIONE ERRORI DEL BATCH
      ******************************************************************
       01 EKERR-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY EKERR.

      ******************************************************************
      * AREA PER DICHIARAZIONE AREE MODULI RICHIAMATI
      ******************************************************************
       01 IDBGU-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY IDBGU.
           COPY EKIDBGUW.

       01 ILOGU-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY ILOGU.
           COPY EKILOGUW.

       01 IDM9Q-G-GROUP-AREA.                                           00570001
           COPY EKIERR1W REPLACING 'XXXXX' BY IDM9Q.                    00580001
           COPY EKIDM9QW.                                               00590001

       01 IER9Q-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY IER9Q.
           COPY EKIER9QW.

       01 ITB9Q-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY ITB9Q.
           COPY EKITB9QW.

       01 IDB9Q-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY IDB9Q.
           COPY EKIDB9QW.

       01 IDATU-G-GROUP-AREA.
           COPY EKIERR1W REPLACING 'XXXXX' BY IDATU.
           COPY EKIDATUW.
090309
090309 01 FAN9Q-G-GROUP-AREA.
090309     COPY EKIERR1W REPLACING 'XXXXX' BY FAN9Q.
090309     COPY EKFAN9QW.
090309
090309 01 IAN1I-G-GROUP-AREA.
090309     COPY EKIERR1W REPLACING 'XXXXX' BY IAN1I.
090309     COPY EKFAN00W REPLACING 'XXXXX' BY IAN1I.
090309     COPY EKIAN1IW.

S2B161 01 INUMU-G-GROUP-AREA.                                           00570001
S2B161     COPY EKIERR1W REPLACING 'XXXXX' BY INUMU.                    00580001
S2B161     COPY EKINUMUW.                                               00590001

090309 01 IAN3I-G-GROUP-AREA.
090309     COPY EKIERR1W REPLACING 'XXXXX' BY IAN3I.
090309     COPY EKIAN3IW.
090309 01 IFILI-G-GROUP-AREA.
090309     COPY EKIERR1W REPLACING 'XXXXX' BY IFILI.
090309     COPY EKIFILIW.
090309
S9K101 01 FCONU-G-GROUP-AREA.
S9K101     COPY EKIERR1W REPLACING 'XXXXX' BY FCONU.
S9K101     COPY EKFCONUW.
S9K101
S1G201 01 FER9Q-G-GROUP-AREA.
S1G201     COPY EKIERR1W REPLACING 'XXXXX' BY FER9Q.
S1G201     COPY EKFER9QW.

S5B091 01 FLF9Q-G-GROUP-AREA.
S5B091     COPY EKIERR1W REPLACING 'XXXXX' BY FLF9Q.
S5B091     COPY EKFLF9QW.
S5B091
S5B091 01 WAFAN-AREA.
S5B091      COPY EKFAN00W REPLACING 'XXXXX' BY WAFAN.
S5B091 01 WAFVA-AREA.
S5B091      COPY EKFVA00W REPLACING 'XXXXX' BY WAFVA.
S5B091 01 WAFAN-AREA-FAN9.
S5B091      COPY EKFAN00W REPLACING 'XXXXX' BY W9FAN.
S5B091 01 WAFVA-AREA-F053.
S5B091      COPY EKFVA00W REPLACING 'XXXXX' BY W9FVA.
S5B091
S5B091 01 WAFAN-AREA-COF.
S5B091      COPY EKFAN00W REPLACING 'XXXXX' BY WCFAN.
S5B091 01 WAFVA-AREA-COF.
S5B091      COPY EKFVA00W REPLACING 'XXXXX' BY WCFVA.
S5B091 01 WAFAN-AREA-FAN9-COF.
S5B091      COPY EKFAN00W REPLACING 'XXXXX' BY WCFA9.
S5B091 01 WAFVA-AREA-F053-COF.
S5B091      COPY EKFVA00W REPLACING 'XXXXX' BY WCFV9.
SGB012 01 WAFAN-AREA-TRM.
SGB012      COPY EKFAN00W REPLACING 'XXXXX' BY WTFAN.
SGB012 01 WAFAN-AREA-FAN9-TRM.
SGB012      COPY EKFAN00W REPLACING 'XXXXX' BY WTFA9.
S5B091
SGB012 01 IARRU-G-GROUP-AREA.
SGB012     COPY EKIERR1W REPLACING 'XXXXX' BY IARRU.
SGB012     COPY EKIARRUW.

SHL121 01 IFD4I-G-GROUP-AREA.
SHL121     COPY EKIERR1W REPLACING 'XXXXX' BY IFD4I.
SHL121     COPY EKIFD4IW.
SHL121
SHL121 01 IIM1I-G-GROUP-AREA.
SHL121     COPY EKIERR1W REPLACING 'XXXXX' BY IIM1I.
SHL121     COPY EKIIM1IW.
SHL121
SHL121 01 FIM9Q-G-GROUP-AREA.
SHL121     COPY EKIERR1W REPLACING 'XXXXX' BY FIM9Q.
SHL121     COPY EKFIM9QW.
SHL121
SJD291 01 FDT9Q-G-GROUP-AREA.
SJD291     COPY EKIERR1W REPLACING 'XXXXX' BY FDT9Q.
SJD291     COPY EKFDT9QW.

SJB071*01 FDI9Q-G-GROUP-AREA.
SJB071*    COPY EKIERR1W REPLACING 'XXXXX' BY FDI9Q.
SJB071*    COPY EKFDI9QW.
SJD121 01 FGT9Q-G-GROUP-AREA.
SJD121     COPY EKIERR1W REPLACING 'XXXXX' BY FGT9Q.
SJD121     COPY EKFGT9QW.
SKA292
SKA292 01 FLG9Q-G-GROUP-AREA.
SKA292     COPY EKIERR1W REPLACING 'XXXXX' BY FLG9Q.
SKA292     COPY EKFLG9QW.
SKA292
SKC051 01 FAC9Q-G-GROUP-AREA.
SKC051     COPY EKIERR1W REPLACING 'XXXXX' BY FAC9Q.
SKC051     COPY EKFAC9QW.
SKC051                                                                  00810002
SKK132 01 IAN9I-G-GROUP-AREA.
SKK132     COPY EKIERR1W REPLACING 'XXXXX' BY IAN9I.
SKK132     COPY EKIAN9IW.
SKK132
SID191 01  WS-ANWR0302           PIC X(08) VALUE 'ANWR0302'.
      ******************************************************************
      * AREA PER DICHIARAZIONE SCHEDE PARAMETRO PGM.
      ******************************************************************
       01  W-G-SCHEDA-PGM.
         03 W-X-SCHEDA-PGM               PIC X(100).

      ******************************************************************
      * AREA COMUNE PER DICHIARAZIONE OGGETTI DB2
      ******************************************************************
           EXEC SQL   INCLUDE SQLCA      END-EXEC.

           COPY EKI00W.
           COPY EKI01W.
           COPY EKI03W.
S5B091     COPY EKP10W.

      *  - TABELLE GENERICHE
           EXEC SQL INCLUDE EKITBD END-EXEC.

      *  - TABELLA FASI BATCH
           EXEC SQL INCLUDE EKIFBD END-EXEC.

      *  - TABELLA SCHEDE PARAMETRO
           EXEC SQL INCLUDE EKISKD END-EXEC.

      *  - TABELLA PER GESTIONE COMMIT
           EXEC SQL INCLUDE EKICOD END-EXEC.

      ******************************************************************
      * AREA PGM PER DICHIARAZIONE OGGETTI DB2
      ******************************************************************

      ******************************************************************
      * AREA PER DICHIARAZIONE CURSORI DB2
      ******************************************************************

      ******************************************************************
       PROCEDURE DIVISION.
      *****************************************************************
      *                                                               *
      *    CORPO PRINCIPALE DEL PROGRAMMA                             *
      *         CON GESTIONE DEI PRINCIPALI CICLI ELABORATIVI         *
      *                                                               *
      * SE IL BATCH DEVE FARE COMMIT INTERMEDIE SI DEVE:
      * -  CARICARE L'AREA DI RICICLO W-X-SCHEDA-KEY
      * -  RICHIAMARE LA LABEL Z-COMMIT-INTERMEDIE
      *****************************************************************

      *-FRAME
           COPY EKIFRB1P.
           COPY EKIERR3P.

       USCITA-PGM.
           MOVE 'USCITA-PGM'              TO IDBGU-X-LABEL-TRAC
           MOVE 1                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           STOP RUN.

      *
       B-PGM-APRI-FILE.
           MOVE 'B-PGM-APRI-FILE'         TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
      * APERTURA FILE PGM
      *
090309     OPEN OUTPUT EKSONCO.
090309     IF NOT SONCO-STATUS-OK
090309        DISPLAY 'ERRORE OPEN SONCO: ' SONCO-STATUS
090309        MOVE '0128'                 TO EKERR-C-COD-ERRORE(1)
090309        MOVE '0002'                 TO EKERR-C-RIF-ERRORE(1)
090309        MOVE 'SONCO'                TO EKERR-X-DES-ERRORE(1) (1:5)
090309        MOVE SONCO-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
090309        PERFORM ERRORE-GRAVE
090309     END-IF.

SKA292     OPEN OUTPUT EKSONC2.
SKA292     IF NOT SONC2-STATUS-OK
SKA292        DISPLAY 'ERRORE OPEN SONC2: ' SONC2-STATUS
SKA292        MOVE '0128'                 TO EKERR-C-COD-ERRORE(1)
SKA292        MOVE '0008'                 TO EKERR-C-RIF-ERRORE(1)
SKA292        MOVE 'SONC2'                TO EKERR-X-DES-ERRORE(1) (1:5)
SKA292        MOVE SONC2-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
SKA292        PERFORM ERRORE-GRAVE
SKA292     END-IF.
      *
           OPEN INPUT EKCERIO.
           IF NOT CERIO-STATUS-OK
              DISPLAY 'ERRORE OPEN CERIO: ' CERIO-STATUS
              MOVE '0128'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0001'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'CERIO'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE CERIO-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           END-IF.
      *
           OPEN OUTPUT EKDICPI.
           IF NOT DICPI-STATUS-OK
              DISPLAY 'ERRORE OPEN DICPI: ' DICPI-STATUS
              MOVE '0128'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0002'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'DICPI'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE DICPI-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           END-IF.
      *
           OPEN OUTPUT PAPYRUS.
           IF NOT PAPYR-STATUS-OK
              DISPLAY 'ERRORE OPEN PAPYR: ' PAPYR-STATUS
              MOVE '0128'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0002'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'PAPYR'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE PAPYR-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           END-IF.
090309*
090309     OPEN OUTPUT EKFANT1.
090309     IF NOT FANT1-STATUS-OK
090309        DISPLAY 'ERRORE OPEN FANT1: ' FANT1-STATUS
090309        MOVE '0128'                  TO EKERR-C-COD-ERRORE(1)
090309        MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
090309        MOVE 'FANT1'                 TO EKERR-X-DES-ERRORE(1)(1:5)
090309        MOVE FANT1-STATUS            TO EKERR-X-DES-ERRORE(1)(6:2)
090309        PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF.
      *
      *
       B-PGM-INIZIO.
           MOVE 'B-PGM-INIZIO'            TO IDBGU-X-LABEL-TRAC
           MOVE 1                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           INITIALIZE W-COMODI.
           SET IFRB1-F-STATO-FASE-ON TO TRUE
           SET IFRB1-F-CTRL-PARAM-NO TO TRUE
DEB>>>*    SET ANA-SI                TO TRUE
090309
090309     COMPUTE W-N-LUNGH-IAN = LENGTH OF IAN3I-G-TAB-OUT
090309                           / LENGTH OF IAN3I-G-ELEMEN-OUT.
090309
S5B091     COMPUTE W-N-LUNGH-TAB-LEG = LENGTH OF WAPPO-G-TABLE-LEG-I/
S5B091                                 LENGTH OF WAPPO-G-ELEMEN-LEG-I.
S5B091
SKA292     COMPUTE W-N-LUNGH-TAB-SONCO =
SKA292                           LENGTH OF W-SO-RECORD /
SKA292                           LENGTH OF W-SO-RECORD-G-ELEMEN-I.
SKB251     COMPUTE W-N-LUNGH-TAB-MIS   =
SKB251                           LENGTH OF W-SO-RECORD-MIS /
SKB251                           LENGTH OF W-SO-RECORD-G-ELEMEN-MIS.
SKA292
S1C251     SET NO-TROVATO-COINT-PG       TO TRUE
           .
      *
       D-PGM-PRE-ELABORA-BANCA.
           MOVE 'D-PGM-PRE-ELABORA-BANCA' TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

S1C251     MOVE 13                          TO FILLER-RIGA-CR
S1C251     MOVE 10                          TO FILLER-RIGA-LF

           SET INIZIO-CICLO-SI              TO TRUE
S1C251*    MOVE '0'                         TO SO-TIPO-REC
S1C251*    MOVE '00053810149'               TO SO-CODFISC-EROGANTE-T
S1C251*    MOVE 'BANCA POPOLARE DI SONDRIO' TO SO-ANAGR-EROGANTE-T
S1C251*    MOVE EKIFB-D-RIFERI-OPE(1:4)     TO SO-ANNO-RIFERIMENTO
S1C251*    MOVE 'MU'                        TO SO-CODICE-FLUSSO
S1C251*    MOVE EKIFB-D-ELABOR-OPE(1:4)     TO SO-PROGR-ANNO
S1C251*    MOVE 1                           TO SO-PROGR-NUMERO
S1C251*    MOVE 1                           TO SO-DATA-INVIO
S1C251*    MOVE EKIFB-D-ELABOR-OPE    TO W-APPO-DATA-X
S1C251*    MOVE W-APPX-GG             TO W-APP9-GG
S1C251*    MOVE W-APPX-MM             TO W-APP9-MM
S1C251*    MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*    MOVE W-APP9-GG         TO SO-DATA-INVIO(1:2)
S1C251*    MOVE W-APP9-MM         TO SO-DATA-INVIO(3:2)
S1C251*    MOVE W-APP9-SSAA       TO SO-DATA-INVIO(5:4)
S1C251*    MOVE 'O'                         TO SO-TIPO-FORNITURA
S1C251*    MOVE SPACES                      TO FILLER-1
S1C251     MOVE SPACES                      TO SO-RECORD-TESTA
S1C251     MOVE ZEROES                      TO SO-TIPO-REC
SHB241*S1C251     MOVE 'ART78'              TO SO-CODIDENT-FOR-T
SHL121*SHB241     MOVE 'IPS00'              TO SO-CODIDENT-FOR-T
SIB161*SHL121     MOVE 'MIP00'                     TO SO-CODIDENT-FOR-T
SJB071*SIB161     MOVE 'IPS00'                     TO SO-CODIDENT-FOR-T
SJB071     MOVE 'MIP00'                     TO SO-CODIDENT-FOR-T
S1C251     MOVE '06'                        TO SO-CODNUM-FOR-T
S1C251     MOVE ZEROES                      TO SO-TIPO-INVIO-T
S1C251     MOVE '00053810149'               TO SO-CODICE-FISCALE-T(1:11)
S1C251     MOVE SPACES                      TO SO-CODICE-FISCALE-T(12:5)
S1C251     MOVE 'BANCA POPOLARE DI SONDRIO' TO SO-DEN-PER-T
S1C251     MOVE 'SONDRIO'                   TO SO-COMUNE-T
S1C251     MOVE 'SO'                        TO SO-PROVINCIA-T
S1C251     MOVE ZEROES                      TO SO-DATA-NASCITA-T
S1C251     MOVE ZEROES                      TO SO-DATA-IMPEGNO-T
SHA041     MOVE 'ELISE.SOSI@POPSO.IT'       TO SO-EMAIL-T
S1C251     MOVE EKIFB-D-RIFERI-OPE(1:4)     TO SO-ANNO-RIF-T
SHL121
SHL121*- Verifica per elaborazione in anno di riferimento:
SHL121*    IF SO-ANNO-RIF-T < EKSYS-D-SYSTEM-OPE(1:4)
SHL121*       MOVE '0231'                   TO EKERR-C-COD-ERRORE(1)
SHL121*       SET EKERR-ERR-DATI-INPUT      TO TRUE
SHL121*       MOVE 'ANNO DI RIFERIMENTO NON VALIDO'
SHL121*                                     TO EKERR-X-DES-ERRORE(1)
SHL121*       MOVE 'SO-ANNO-RIF-T'          TO EKERR-X-DAT-ERRATO(1)
SHL121*       MOVE 'P021'                   TO EKERR-C-RIF-ERRORE(1)
SHL121*       PERFORM ERRORE-GRAVE
SHL121*    END-IF
SHL121
SJB071     IF SO-ANNO-RIF-T < EKSYS-D-SYSTEM-OPE(1:4)
SJB071        MOVE '0231'                   TO EKERR-C-COD-ERRORE(1)
SJB071        SET EKERR-ERR-DATI-INPUT      TO TRUE
SJB071        MOVE 'ANNO DI RIFERIMENTO NON VALIDO'
SJB071                                      TO EKERR-X-DES-ERRORE(1)
SJB071        MOVE 'SO-ANNO-RIF-T'          TO EKERR-X-DAT-ERRATO(1)
SJB071        MOVE 'P021'                   TO EKERR-C-RIF-ERRORE(1)
SJB071        PERFORM ERRORE-GRAVE
SJB071     END-IF
SJB071
S1C251     MOVE 'A'                         TO SO-CAR-CONTROLLO-T
S1C251     MOVE W-C-FINE-RIGA(2:1)          TO SO-CAR-FINE-RIGA-T(1:1)
S1C251     MOVE W-C-FINE-RIGA(4:1)          TO SO-CAR-FINE-RIGA-T(2:1)
SHL121*PROVA      PERFORM SCRITTURA-SONCO
SKA292     MOVE SONCORR2                    TO SONCOR22
DEB>>>     DISPLAY 'SCRITTURA-SONCO 1'
SHL121     PERFORM SCRITTURA-SONCO
SKA292     PERFORM SCRITTURA-SONC2
           .
      *
       C-PGM-CTRL-SCHEDA.
           MOVE 'C-PGM-CTRL-SCHEDA'       TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
       E-PGM-ELABORA-BANCA.
           MOVE 'E-PGM-ELABORA-BANCA'     TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           IF FCEI1-C-ATTIVA-PRG = ZEROES
           OR FCEI1-C-ATTIVA-PRG = 999

             MOVE CERIO-G-AREA-RECORD      TO APPO-AREA-MOMENT
             MOVE FCEI1-C-PROCED-TIP       TO APPO-NEW-PROCED
             MOVE FCEI1-C-SERVIZ-COD       TO APPO-NEW-SERVIZ
             MOVE FCEI1-C-DIVISA-COD       TO APPO-NEW-DIVISA

             IF INIZIO-CICLO-NO
               PERFORM ELABORAZIONE-SCRITTURE
090309         IF APPO-NEW-PROCED NOT = APPO-OLD-PROCED
090309         OR APPO-NEW-SERVIZ NOT = APPO-OLD-SERVIZ
090309         OR APPO-NEW-DIVISA NOT = APPO-OLD-DIVISA
090309           PERFORM ELABORA-DICPINTE-TOT
090309         END-IF
             END-IF

             MOVE APPO-AREA-MOMENT         TO CERIO-G-AREA-RECORD

      *                ------------------------
             PERFORM ZONA-SOMME
             MOVE FCEI1-C-CONTRA-PRE      TO APPO-C-CONTRA-PRE
             MOVE FCEI1-N-CONTRA-NUM      TO APPO-N-CONTRA-NUM
             MOVE CERIO-G-AREA-RECORD     TO APPO-AREA-PADRE
             SET INIZIO-CICLO-NO          TO TRUE
      *                ------------------------
           END-IF

           IF  FCEI1-C-ATTIVA-PRG = 1
           AND FCEI1-C-CONTRA-PRE = APPO-C-CONTRA-PRE
           AND FCEI1-N-CONTRA-NUM = APPO-N-CONTRA-NUM
             PERFORM ZONA-SOMME
           END-IF
      *
           MOVE APPO-NEW-PROCED           TO APPO-OLD-PROCED
           MOVE APPO-NEW-SERVIZ           TO APPO-OLD-SERVIZ
           MOVE APPO-NEW-DIVISA           TO APPO-OLD-DIVISA
      *
           .

       ZONA-SOMME.
           MOVE 'ZONA-SOMME              ' TO IDBGU-X-LABEL-TRAC
           MOVE 3                          TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
DEB>>>
DEB>>>     DISPLAY 'DENTRO ZONA-SOMME: ' FCEI1-C-FINANZ-PRE '-'
DEB>>>                                   FCEI1-N-FINANZ-NUM ' / '
DEB>>>                                   FCEI1-C-NDGNDG-COD
SOB281     INITIALIZE                            W-C-FINANZ-PRE-RIN
SOB281                                           W-N-FINANZ-NUM-RIN
SJD121*
SJD121*- Ricerca della percentuale DETRAIBILE per FINANZIAMENTO:
SJD121*    PERFORM RICERCA-PERC-DETRAIBILE
SJD121*
SJD121*- Gestione interessi da RISTRUTTURAZIONE:
SJD121*    IF  W-F-EKFGT-SI
SJD121* 1) Calcolo periodo "a ristrutturazione":
SJD121*        IF  W-D-INIRIS-PRE > '0001-01-01'
SJD121*        AND W-D-FINRIS-PRE > '0001-01-01'
SJD121*            PERFORM CALCOLA-SCADENZA-RISTR
SJD121*            MOVE IDATU-D-INOUT-SAMG   TO W-D-FINRIS-CAL
SJD121*            MOVE W-D-INIRIS-PRE       TO W-D-INIRIS-CAL
SJD121*
SJD121* 2) Lavoro SOLO giorni all'interno del periodo di dichiarazione:
SJD121*            IF W-D-FINRIS-CAL >= EKIFB-D-RIFERI-OLD
SJD121*            OR W-D-INIRIS-CAL <= EKIFB-D-RIFERI-OPE
SJD121*            OR ( W-D-INIRIS-CAL >= EKIFB-D-RIFERI-OLD
SJD121*            AND  W-D-FINRIS-CAL <= EKIFB-D-RIFERI-OPE )
SJD121*              PERFORM CALCOLO-GIORNI-EFFETTIVI
SJD121*
SJD121*              IF W-N-GG-RIST > ZEROES
SJD121* 3) Calcolo la percentuale di interessi di ristrutturazione sul
SJD121*    totale (su singolo COI, il risultato } lo stesso):
SJD121*               COMPUTE W-P-PERC-RIST = ( W-I-RISPRI-IPO /
SJD121*                                         W-I-TOTFIN-IPO )
SJD121*
SJD121*               IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SJD121* 4.1) Calcolo gli interessi di ristrutturazione:
SJD121*                COMPUTE W-I-RISPRI-CAL = FCEI1-I-ANNUAL-INT-VAL-1
SJD121*                                       * W-P-PERC-RIST
SJD121*
SJD121* 4.2) Sottraggo gli interessi di ristrutturazione al totale:
SJD121*                COMPUTE FCEI1-I-ANNUAL-INT-VAL-1 =
SJD121*                                         FCEI1-I-ANNUAL-INT-VAL-1
SJD121*                                       - W-I-RISPRI-CAL
SJD121*                COMPUTE FCEI1-I-AMMPAM-INT-VAL   =
SJD121*                                         FCEI1-I-AMMPAM-INT-VAL
SJD121*                                       - W-I-RISPRI-CAL
SJD121*
SJD121* 4.3) Calcolo il rateo degli interessi di ristrutturazione
SJD121*                COMPUTE W-I-RISPRI-RAT = ( W-I-RISPRI-CAL /
SJD121*                                           W-N-GG-ANNO ) *
SJD121*                                           W-N-GG-RIST
SJD121* 4.4) Ri-sommo il rateo degli interessi di ristrutturazione ad
SJD121*    interesse totale:
SJD121*                COMPUTE FCEI1-I-ANNUAL-INT-VAL-1 =
SJD121*                        FCEI1-I-ANNUAL-INT-VAL-1 +
SJD121*                        W-I-RISPRI-RAT
SJD121*                COMPUTE FCEI1-I-AMMPAM-INT-VAL   =
SJD121*                        FCEI1-I-AMMPAM-INT-VAL   +
SJD121*                        W-I-RISPRI-RAT
SJD121*               ELSE
SJD121* 5.1) Calcolo gli interessi di ristrutturazione:
SJD121*                COMPUTE W-I-RISPRI-CAL = FCEI1-I-ANNUAL-INT-1
SJD121*                                       * W-P-PERC-RIST
SJD121*
SJD121* 5.2) Sottraggo gli interessi di ristrutturazione al totale:
SJD121*                COMPUTE FCEI1-I-ANNUAL-INT-1 =
SJD121*                                         FCEI1-I-ANNUAL-INT-1
SJD121*                                       - W-I-RISPRI-CAL
SJD121*                COMPUTE FCEI1-I-AMMPAM-INT   =
SJD121*                                         FCEI1-I-AMMPAM-INT
SJD121*                                       - W-I-RISPRI-CAL
SJD121*
SJD121* 5.3) Calcolo il rateo degli interessi di ristrutturazione
SJD121*                COMPUTE W-I-RISPRI-RAT = ( W-I-RISPRI-CAL /
SJD121*                                           W-N-GG-ANNO ) *
SJD121*                                           W-N-GG-RIST
SJD121* 5.4) Ri-sommo il rateo degli interessi di ristrutturazione ad
SJD121*    interesse totale:
SJD121*                COMPUTE FCEI1-I-ANNUAL-INT-1 =
SJD121*                        FCEI1-I-ANNUAL-INT-1 +
SJD121*                        W-I-RISPRI-RAT
SJD121*                COMPUTE FCEI1-I-AMMPAM-INT   =
SJD121*                        FCEI1-I-AMMPAM-INT   +
SJD121*                        W-I-RISPRI-RAT
SJD121*               END-IF
SJD121*              END-IF
SJD121*            END-IF
SJD121*        END-IF
SJD121*    END-IF

      *                ------------------------
      * SUDDIVISIONE TRA MUTUI IN VALUTA E MUTUI IN DIVISA
      *                ------------------------
SGB012     MOVE ZEROES                     TO W-I-COMINT-TOT
SGB012     MOVE ZEROES                     TO W-I-COMINT-TOT-VAL
SNC091     MOVE ZEROES                     TO W-I-NONTRAC-IMP
SNC091     MOVE ZEROES                     TO W-I-NONTRAC-IMP-VAL
SGB012
S1G201     IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>*       DISPLAY 'SOMME PER VALUTA'
S1G201        COMPUTE APPO-I-VOCE0 = APPO-I-VOCE0
S1G201                                   + FCEI1-I-ANNUAL-INT-VAL-1
S1G201*  si tolgono dal totale i contributi riscossi
S1G201                                   - FCEI1-I-CONTRI-TOT-VAL-1
S1G201*                           XXX
S1G201*       COMPUTE APPO-I-VOCE1 = APPO-I-VOCE1
S1G201*                                  + FCEI1-I-MORA-PAGAT-VAL-3
S1G201*                           XXX
S1G201        COMPUTE W-APPO-IMP-INT = W-APPO-IMP-INT
S1G201                                   + FCEI1-I-ANNUAL-INT-1
S1G201                                   - FCEI1-I-CONTRI-TOT-1
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE2 = APPO-I-VOCE2
S1G201                                   + FCEI1-I-IMPSOS-CLI-VAL-2
S1G201                                   + FCEI1-I-IMPSOS-IMP-VAL-3
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE3 = APPO-I-VOCE3
S1G201                                   + FCEI1-I-SPESA-RATA-VAL-2
S1G201                                   + FCEI1-I-SPESE-RATA-VAL-3
S1G201                                   + FCEI1-I-SPESE-ESTI-VAL-4
S1G201                                   + FCEI1-I-PENALE-EST-VAL-4
S1G201                                   + FCEI1-I-SPESA-ISTR-VAL-2
S1G201                                   + FCEI1-I-COMMIS-COO-VAL-2
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE5 = APPO-I-VOCE5
S1G201                                   + FCEI1-I-CONTRI-TOT-VAL-1
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE6 = APPO-I-VOCE6
S1G201                                   + FCEI1-I-COMMIS-FIG-VAL-2
S1G201*                           XXX
DEB>>>*       DISPLAY 'FX1802 APPO-I-VOCE6: ' APPO-I-VOCE6
DEB>>>*       DISPLAY 'FX1802 FCEI1-C-ATTIVA-PRG: '
DEB>>>*                       FCEI1-C-ATTIVA-PRG
DEB>>>*       DISPLAY 'FX1802 FCEI1-C-PRODOT-CLA: '
DEB>>>*                       FCEI1-C-PRODOT-CLA
DEB>>>*       DISPLAY 'FX1802 FCEI1-C-FINANZ-PRE: '
DEB>>>*                       FCEI1-C-FINANZ-PRE
DEB>>>*       DISPLAY 'FX1802 FCEI1-I-CONTRI-TOT-VAL-1: '
S1G201        IF FCEI1-C-ATTIVA-PRG = 999
S1G201        AND FCEI1-C-PRODOT-CLA NOT EQUAL 'TRM'
S1G201        AND FCEI1-C-FINANZ-PRE NOT EQUAL '41'
S1G201        AND FCEI1-C-FINANZ-PRE NOT EQUAL '42'
doppi         AND FCEI1-I-CONTRI-TOT-VAL-1 NOT = ZEROES
DEB>>>*       DISPLAY 'FX1802 DENTRO'
S1G201          COMPUTE APPO-I-VOCE7 = APPO-I-VOCE7
S1G201                                     + FCEI1-I-ANNUAL-INT-VAL-1
S1G201*  si tolgono dal totale i contributi riscossi
S1G201                                     - FCEI1-I-CONTRI-TOT-VAL-1
DISPLA*       DISPLAY ' CONTRIBUTI  '  FCEI1-I-CONTRI-TOT-VAL-1
S1G201        END-IF
DEB>>>*       DISPLAY 'FX1802 POST'
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE8 = APPO-I-VOCE8
S1G201                                   + FCEI1-I-CONGIN-RAT-VAL-3
S1G201                                   + FCEI1-I-CONGIN-RAP-VAL-3
S1G201*                           XXX
S1G201        COMPUTE APPO-I-VOCE9 = APPO-I-VOCE9
S1G201                                   + FCEI1-I-ASSICU-TOT-VAL-1
S1G201*                ------------------------
SGB012
SGB012        COMPUTE W-I-INTVAR-TOT-VAL = W-I-INTVAR-TOT-VAL
SGB012                                 + FCEI1-I-AMMPAM-INT-VAL
SGB012                                 + FCEI1-I-AMMPAM-ONE-VAL
SNF272*  si tolgono dal totale i contributi riscossi
SNF272                                 - FCEI1-I-CONTRI-TOT-VAL-1
SNE092        COMPUTE W-I-INTVAR-TOT-C-VAL = W-I-INTVAR-TOT-C-VAL
SNE092                                 + FCEI1-I-AMMPAM-INT-C-VAL
SNE092                                 + FCEI1-I-AMMPAM-ONE-VAL
SNF272*SGB012*  si tolgono dal totale i contributi riscossi
SNF272*SGB012                                 - FCEI1-I-CONTRI-TOT-VAL-1
SGB012
SGB012*       COMPUTE W-APPO-IMP-INT-VAL = W-APPO-IMP-INT-VAL
SGB012*                                + FCEI1-I-AMMPAM-INT
SGB012*                                + FCEI1-I-AMMPAM-ONE
SGB012
SGB012        COMPUTE W-I-SPERAT-TOT-VAL = W-I-SPERAT-TOT-VAL
SGB012                                 + FCEI1-I-SPERAT-IMP-VAL
SGB012
SGB012        COMPUTE W-I-SPEIST-TOT-VAL = W-I-SPEIST-TOT-VAL
SGB012                                 + FCEI1-I-SPEIST-IMP-VAL
SGB012                                 + FCEI1-I-SPEIST-ONE-VAL
SGB012
SNE092        COMPUTE W-I-SPEIST-TOT-C-VAL = FCEI1-I-SPEIST-ONE-C-VAL
SGB012        COMPUTE W-I-IMPSOS-TOT-VAL = W-I-IMPSOS-TOT-VAL
SGB012                                 + FCEI1-I-IMPSOS-IMP-VAL
SGB012                                 + FCEI1-I-IMPSOS-ONE-VAL
SGB012
SNE092        COMPUTE W-I-IMPSOS-TOT-C-VAL = W-I-IMPSOS-TOT-C-VAL
SNE092                                 + FCEI1-I-IMPSOS-IMP-C-VAL
SNE092                                 + FCEI1-I-IMPSOS-ONE-C-VAL
SNE092
SGB012        COMPUTE W-I-PENEST-TOT-VAL = W-I-PENEST-TOT-VAL
SGB012                                 + FCEI1-I-ESTPEN-IMP-VAL
SGB012                                 + FCEI1-I-ESTPEN-ONE-VAL
SNE092        COMPUTE W-I-PENEST-TOT-C-VAL = W-I-PENEST-TOT-C-VAL
SNE092                                 + FCEI1-I-ESTPEN-IMP-C-VAL
SNE092                                 + FCEI1-I-ESTPEN-ONE-C-VAL
SGB012
SGB012        MOVE FCEI1-I-COMMIS-COO-VAL-2 TO W-I-COMINT-TOT-VAL
SGB012
SNC091        COMPUTE W-I-NONTRAC-IMP-VAL = W-I-NONTRAC-IMP-VAL
SNC091                                    + FCEI1-I-AMMPAM-INT-C-VAL
SNC091                                    + FCEI1-I-AMMPAM-ONE-C-VAL
SNC091                                    + FCEI1-I-SPEIST-ONE-C-VAL
SNC091                                    + FCEI1-I-IMPSOS-IMP-C-VAL
SNC091                                    + FCEI1-I-IMPSOS-ONE-C-VAL
SNC091                                    + FCEI1-I-ESTPEN-IMP-C-VAL
SNC091                                    + FCEI1-I-ESTPEN-ONE-C-VAL
S1G201     ELSE
DEB>>>*       DISPLAY 'SOMME PER DIVISA'
              COMPUTE APPO-I-VOCE0 = APPO-I-VOCE0
                                         + FCEI1-I-ANNUAL-INT-1
100305*  si tolgono dal totale i contributi riscossi
100305                                   - FCEI1-I-CONTRI-TOT-1
      *                           XXX
              COMPUTE APPO-I-VOCE1 = APPO-I-VOCE1
                                         + FCEI1-I-MORA-PAGAT-3
      *                           XXX
              COMPUTE APPO-I-VOCE2 = APPO-I-VOCE2
                                         + FCEI1-I-IMPSOS-CLI-2
                                         + FCEI1-I-IMPSOS-IMP-3
      *                           XXX
              COMPUTE APPO-I-VOCE3 = APPO-I-VOCE3
                                         + FCEI1-I-SPESA-RATA-2
BPSPER                                   + FCEI1-I-SPESE-RATA-3
BPSPER                                   + FCEI1-I-SPESE-ESTI-4
BPSPER                                   + FCEI1-I-PENALE-EST-4
BPSPER                                   + FCEI1-I-SPESA-ISTR-2
S1C251                                   + FCEI1-I-COMMIS-COO-2
BPSPER*                                  + FCEI1-I-SPESA-ISTR-2
BPSPER*                                  + FCEI1-I-SPESA-BOLL-2
V8129 *                                  + FCEI1-I-IMPSOS-CLI-2
BPSPER*                                  + FCEI1-I-COMMIS-COO-2
BPSPER*                                  + FCEI1-I-COMMIS-FIG-2
BPSPER*                                  + FCEI1-I-COMMIS-FGC-2
BPSPER*                                  + FCEI1-I-RECUOE-VAR-2
BPSPER*                                  + FCEI1-I-SPESE-RATA-3
BPSPER*                                  + FCEI1-I-SPESE-ISTR-3
BPSPER*                                  + FCEI1-I-RECUPE-VAR-3
BPSPER*                                  + FCEI1-I-SPESE-RATA-4
      *                           XXX
      *       COMPUTE APPO-I-VOCE4 = APPO-I-VOCE4
      *                                  + FCEI1-I-CONTRI-TOT-1
      *                           XXX
              COMPUTE APPO-I-VOCE5 = APPO-I-VOCE5
                                         + FCEI1-I-CONTRI-TOT-1
      *                           XXX
              COMPUTE APPO-I-VOCE6 = APPO-I-VOCE6
                                         + FCEI1-I-COMMIS-FIG-2
      *                           XXX
      *       display 'APPO-I-VOCE7 : 'APPO-I-VOCE7
      *       display 'FCEI1-C-ATTIVA-PRG   :' FCEI1-C-ATTIVA-PRG
              IF FCEI1-C-ATTIVA-PRG = 999
S1C251        AND FCEI1-C-PRODOT-CLA NOT EQUAL 'TRM'
S1C251        AND FCEI1-C-FINANZ-PRE NOT EQUAL '41'
S1C251        AND FCEI1-C-FINANZ-PRE NOT EQUAL '42'
DOPPI         AND FCEI1-I-CONTRI-TOT-1 NOT = ZEROES
                COMPUTE APPO-I-VOCE7 = APPO-I-VOCE7
                                           + FCEI1-I-ANNUAL-INT-1
100305*  si tolgono dal totale i contributi riscossi
100305                                   - FCEI1-I-CONTRI-TOT-1
DISPLA*       DISPLAY 'CONTRIBUTI 1 ' FCEI1-I-CONTRI-TOT-1
              END-IF
      *                           XXX
      *       display 'APPO-I-VOCE8 : 'APPO-I-VOCE8
      *       display 'FCEI1-I-CONGIN-RAT-3 :' FCEI1-I-CONGIN-RAT-3
      *       display 'FCEI1-I-CONGIN-RAP-3 :' FCEI1-I-CONGIN-RAP-3
              COMPUTE APPO-I-VOCE8 = APPO-I-VOCE8
V8129 *                                  + FCEI1-I-STIPUL-INT-3
                                         + FCEI1-I-CONGIN-RAT-3
                                         + FCEI1-I-CONGIN-RAP-3
      *                           XXX
              COMPUTE APPO-I-VOCE9 = APPO-I-VOCE9
                                         + FCEI1-I-ASSICU-TOT-1
      *                ------------------------
SGB012     END-IF
SGB012
SGB012*- Calcolo sempre importi in EURO, anche per valuta:
DEB>>>*    DISPLAY 'SOMME PER TUTTI'
SGB012
SGB012     COMPUTE W-I-INTVAR-TOT =  W-I-INTVAR-TOT
SGB012                             + FCEI1-I-AMMPAM-INT
SGB012                             + FCEI1-I-AMMPAM-ONE
SGB012*  si tolgono dal totale i contributi riscossi
SGB012                             - FCEI1-I-CONTRI-TOT-1
SNE092     COMPUTE W-I-INTVAR-TOT-C = W-I-INTVAR-TOT-C
SNE092                              + FCEI1-I-AMMPAM-INT-C
SNE092                              + FCEI1-I-AMMPAM-ONE-C
DEB>>>*    DISPLAY 'W-I-INTVAR-TOT    : 'W-I-INTVAR-TOT
DEB>>>*    DISPLAY 'FCEI1-I-AMMPAM-INT: 'FCEI1-I-AMMPAM-INT
DEB>>>*    DISPLAY 'FCEI1-I-AMMPAM-ONE: 'FCEI1-I-AMMPAM-ONE
DEB>>>*    DISPLAY 'FCEI1-I-CONTRI-TOT-1: 'FCEI1-I-CONTRI-TOT-1
SGB012
SGB012*    COMPUTE W-APPO-IMP-INT-DIV = W-APPO-IMP-INT-DIV
SGB012*                            + FCEI1-I-AMMPAM-INT-VAL
SGB012*                            + FCEI1-I-AMMPAM-ONE-VAL
SGB012
SGB012     COMPUTE W-I-SPERAT-TOT = W-I-SPERAT-TOT
SGB012                             + FCEI1-I-SPERAT-IMP
SGB012
SGB012     COMPUTE W-I-SPEIST-TOT = W-I-SPEIST-TOT
SGB012                             + FCEI1-I-SPEIST-IMP
SGB012                             + FCEI1-I-SPEIST-ONE
SGB012
SNE092     COMPUTE W-I-SPEIST-TOT-C = FCEI1-I-SPEIST-ONE-C
SNF272*SNE092                              + FCEI1-I-SPEIST-ONE-C
SGB012     COMPUTE W-I-IMPSOS-TOT = W-I-IMPSOS-TOT
SGB012                             + FCEI1-I-IMPSOS-IMP
SGB012                             + FCEI1-I-IMPSOS-ONE
SGB012
SNE092     COMPUTE W-I-IMPSOS-TOT-C = W-I-IMPSOS-TOT-C
SNE092                              + FCEI1-I-IMPSOS-IMP-C
SNE092                              + FCEI1-I-IMPSOS-ONE-C
SNE092
SGB012     COMPUTE W-I-PENEST-TOT = W-I-PENEST-TOT
SGB012                             + FCEI1-I-ESTPEN-IMP
SGB012                             + FCEI1-I-ESTPEN-ONE
SGB012
SNE092     COMPUTE W-I-PENEST-TOT-C = W-I-PENEST-TOT-C
SNE092                              + FCEI1-I-ESTPEN-IMP-C
SNE092                              + FCEI1-I-ESTPEN-ONE-C
SNE092
SGB012     PERFORM ONERI-ACCESSORI
SGB012
SGB012     MOVE FCEI1-I-COMMIS-COO-2      TO W-I-COMINT-TOT
SGB012
SNC091     COMPUTE W-I-NONTRAC-IMP = W-I-NONTRAC-IMP
SNC091                             + FCEI1-I-AMMPAM-INT-C
SNC091                             + FCEI1-I-AMMPAM-ONE-C
SNC091                             + FCEI1-I-SPEIST-ONE-C
SNC091                             + FCEI1-I-IMPSOS-IMP-C
SNC091                             + FCEI1-I-IMPSOS-ONE-C
SNC091                             + FCEI1-I-ESTPEN-IMP-C
SNC091                             + FCEI1-I-ESTPEN-ONE-C
DEB>>>     DISPLAY 'IMPORTI PRE: '
DEB>>>     DISPLAY 'W-P-DETRAZ-PER: ' W-P-PERCEN-APP
DEB>>>     DISPLAY 'APPO-I-VOCE0: ' APPO-I-VOCE0
DEB>>>     DISPLAY 'APPO-I-VOCE1: ' APPO-I-VOCE1
DEB>>>     DISPLAY 'APPO-I-VOCE2: ' APPO-I-VOCE2
DEB>>>     DISPLAY 'APPO-I-VOCE3: ' APPO-I-VOCE3
DEB>>>     DISPLAY 'APPO-I-VOCE4: ' APPO-I-VOCE4
DEB>>>     DISPLAY 'APPO-I-VOCE5: ' APPO-I-VOCE5
DEB>>>     DISPLAY 'APPO-I-VOCE6: ' APPO-I-VOCE6
DEB>>>     DISPLAY 'APPO-I-VOCE7: ' APPO-I-VOCE7
DEB>>>     DISPLAY 'APPO-I-VOCE8: ' APPO-I-VOCE8
DEB>>>     DISPLAY 'APPO-I-VOCE9: ' APPO-I-VOCE9
DEB>>>     DISPLAY 'W-I-INTVAR-TOT: ' W-I-INTVAR-TOT
DEB>>>     DISPLAY 'W-I-SPERAT-TOT: ' W-I-SPERAT-TOT
DEB>>>     DISPLAY 'W-I-SPEIST-TOT: ' W-I-SPEIST-TOT
DEB>>>     DISPLAY 'W-I-IMPSOS-TOT: ' W-I-IMPSOS-TOT
DEB>>>     DISPLAY 'W-I-PENEST-TOT: ' W-I-PENEST-TOT
DEB>>>     DISPLAY 'W-I-COMINT-TOT: ' W-I-COMINT-TOT
SJD121*
SJD121*- Applico la % di detraibilit{ su tutte le voci:
SJD121*    IF W-P-DETRAZ-PER > ZEROES
SJD121*       COMPUTE APPO-I-VOCE0   = APPO-I-VOCE0 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE1   = APPO-I-VOCE1 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE2   = APPO-I-VOCE2 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE3   = APPO-I-VOCE3 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE4   = APPO-I-VOCE4 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE5   = APPO-I-VOCE5 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE6   = APPO-I-VOCE6 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE7   = APPO-I-VOCE7 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE8   = APPO-I-VOCE8 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE APPO-I-VOCE9   = APPO-I-VOCE9 *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-INTVAR-TOT = W-I-INTVAR-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-SPERAT-TOT = W-I-SPERAT-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-SPEIST-TOT = W-I-SPEIST-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-IMPSOS-TOT = W-I-IMPSOS-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-PENEST-TOT = W-I-PENEST-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*       COMPUTE W-I-COMINT-TOT = W-I-COMINT-TOT *
SJD121*                              ( W-P-DETRAZ-PER / 100 )
SJD121*    END-IF
DEB>>>*    DISPLAY 'IMPORTI POS: '
DEB>>>*    DISPLAY 'W-P-DETRAZ-PER: ' W-P-PERCEN-APP
DEB>>>*    DISPLAY 'APPO-I-VOCE0  : ' APPO-I-VOCE0
DEB>>>*    DISPLAY 'APPO-I-VOCE1  : ' APPO-I-VOCE1
DEB>>>*    DISPLAY 'APPO-I-VOCE2  : ' APPO-I-VOCE2
DEB>>>*    DISPLAY 'APPO-I-VOCE3  : ' APPO-I-VOCE3
DEB>>>*    DISPLAY 'APPO-I-VOCE4  : ' APPO-I-VOCE4
DEB>>>*    DISPLAY 'APPO-I-VOCE5  : ' APPO-I-VOCE5
DEB>>>*    DISPLAY 'APPO-I-VOCE6  : ' APPO-I-VOCE6
DEB>>>*    DISPLAY 'APPO-I-VOCE7  : ' APPO-I-VOCE7
DEB>>>*    DISPLAY 'APPO-I-VOCE8  : ' APPO-I-VOCE8
DEB>>>*    DISPLAY 'APPO-I-VOCE9  : ' APPO-I-VOCE9
DEB>>>*    DISPLAY 'W-I-INTVAR-TOT: ' W-I-INTVAR-TOT
DEB>>>*    DISPLAY 'W-I-SPERAT-TOT: ' W-I-SPERAT-TOT
DEB>>>*    DISPLAY 'W-I-SPEIST-TOT: ' W-I-SPEIST-TOT
DEB>>>*    DISPLAY 'W-I-IMPSOS-TOT: ' W-I-IMPSOS-TOT
DEB>>>*    DISPLAY 'W-I-PENEST-TOT: ' W-I-PENEST-TOT
DEB>>>*    DISPLAY 'W-I-COMINT-TOT: ' W-I-COMINT-TOT
           .

SGB012 ONERI-ACCESSORI.
SGB012     MOVE 'ONERI-ACCESSORI'         TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'ONERI-ACCESSORI'
SGB012
SGB012     PERFORM VARYING W-K FROM 1 BY 1
SGB012      UNTIL W-K > 50
SGB012      OR FCEI1-C-CODICE-ONE(W-K) = SPACES OR LOW-VALUES
SGB012         EVALUATE FCEI1-C-CODICE-ONE(W-K)
SGB012         WHEN 'SPSAL'
DEB>>>*          DISPLAY 'ACCESSORI 1 SPSAL'
SGB012           COMPUTE W-I-ONESAL-TOT     = W-I-ONESAL-TOT
SGB012                                     + FCEI1-I-IMPORT-ONE(W-K)
SNE092           COMPUTE W-I-ONESAL-TOT-C   = W-I-ONESAL-TOT-C
SNE092                                     + FCEI1-I-IMPORT-ONE-C(W-K)
SGB012           COMPUTE W-I-ONESAL-TOT-VAL = W-I-ONESAL-TOT-VAL
SGB012                                     + FCEI1-I-IMPORT-ONE-VAL(W-K)
SNE092           COMPUTE W-I-ONESAL-TOT-C-VAL = W-I-ONESAL-TOT-C-VAL
SNE092                                   + FCEI1-I-IMPORT-ONE-C-VAL(W-K)
SGB012         WHEN 'SPACC'
DEB>>>*          DISPLAY 'ACCESSORI 2 SPACC'
SGB012           COMPUTE W-I-ONEACC-TOT     = W-I-ONEACC-TOT
SGB012                                     + FCEI1-I-IMPORT-ONE(W-K)
SNE092           COMPUTE W-I-ONEACC-TOT-C   = W-I-ONEACC-TOT-C
SNE092                                     + FCEI1-I-IMPORT-ONE-C(W-K)
SGB012           COMPUTE W-I-ONEACC-TOT-VAL = W-I-ONEACC-TOT-VAL
SGB012                                     + FCEI1-I-IMPORT-ONE-VAL(W-K)
SNE092           COMPUTE W-I-ONEACC-TOT-C-VAL = W-I-ONEACC-TOT-C-VAL
SNE092                                   + FCEI1-I-IMPORT-ONE-C-VAL(W-K)
SGB012         WHEN OTHER
DEB>>>*          DISPLAY 'ACCESSORI 3 ALTRI'
SGB012           IF FCEI1-C-NATURA-ONE(W-K) = 'S'
SGB012              COMPUTE W-I-ONECER-TOT     = W-I-ONECER-TOT
SGB012                                     + FCEI1-I-IMPORT-ONE(W-K)
SNE092              COMPUTE W-I-ONECER-TOT-C   = W-I-ONECER-TOT-C
SNE092                                     + FCEI1-I-IMPORT-ONE-C(W-K)
SGB012              COMPUTE W-I-ONECER-TOT-VAL = W-I-ONECER-TOT-VAL
SGB012                                     + FCEI1-I-IMPORT-ONE-VAL(W-K)
SNE092              COMPUTE W-I-ONECER-TOT-C-VAL = W-I-ONECER-TOT-C-VAL
SNE092                                   + FCEI1-I-IMPORT-ONE-C-VAL(W-K)
SGB012           END-IF
SGB012         END-EVALUATE
SGB012     END-PERFORM
SGB012     .

       D-PGM-POST-ELABORA-BANCA.
           MOVE 'D-PGM-POST-ELABORA-BANCA' TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           IF INIZIO-CICLO-NO
             PERFORM ELABORAZIONE-SCRITTURE
             PERFORM ELABORA-DICPINTE-TOT
S1C251*      MOVE '9'                         TO SO-TIPO-REC
S1C251*      MOVE '00053810149'               TO SO-CODFISC-EROGANTE-C
S1C251*      MOVE 'BANCA POPOLARE DI SONDRIO' TO SO-ANAGR-EROGANTE-C
S1C251*      MOVE EKIFB-D-RIFERI-OPE(1:4)     TO SO-ANNO-RIFERIM-C
S1C251*      MOVE 'MU'                        TO SO-CODICE-FLUSSO-C
S1C251*      MOVE EKIFB-D-ELABOR-OPE(1:4)     TO SO-PROGR-ANNO-C
S1C251*      MOVE 1                           TO SO-PROGR-NUMERO-C
S1C251*      MOVE 1                           TO SO-DATA-INVIO-C
S1C251*      MOVE EKIFB-D-ELABOR-OPE    TO W-APPO-DATA-X
S1C251*      MOVE W-APPX-GG             TO W-APP9-GG
S1C251*      MOVE W-APPX-MM             TO W-APP9-MM
S1C251*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*      MOVE W-APP9-GG         TO SO-DATA-INVIO-C(1:2)
S1C251*      MOVE W-APP9-MM         TO SO-DATA-INVIO-C(3:2)
S1C251*      MOVE W-APP9-SSAA       TO SO-DATA-INVIO-C(5:4)
S1C251*      MOVE 'O'                         TO SO-TIPO-FORNITURA-C
S1C251*      MOVE W-N-CONTA-SONC              TO SO-NUMREC-DETTAGLIO
S1C251*      MOVE W-IMPCORR-ANNO-LIT          TO SO-TOT-SOMME-LIRE
S1C251*      MOVE W-IMPCORR-ANNO-EUR          TO SO-TOT-SOMME-EURO
S1C251*      MOVE SPACES                      TO FILLER-3
S1C251       MOVE SPACES                      TO SO-RECORD-CODA
S1C251       MOVE '9'                         TO SO-TIPO-REC
SHB241*S1C251       MOVE 'ART78'              TO SO-CODIDENT-FOR-C
SHL121*SHB241     MOVE 'IPS00'                TO SO-CODIDENT-FOR-C
SIB161*SHL121     MOVE 'MIP00'                TO SO-CODIDENT-FOR-C
SJB071*SIB161      MOVE 'IPS00'                     TO SO-CODIDENT-FOR-C
SJB071       MOVE 'MIP00'                TO SO-CODIDENT-FOR-C
S1C251       MOVE '06'                        TO SO-CODNUM-FOR-C
S1C251       MOVE ZEROES                      TO SO-TIPO-INVIO-C
S1C251       MOVE '00053810149'             TO SO-CODICE-FISCALE-C(1:11)
S1C251       MOVE SPACES                    TO SO-CODICE-FISCALE-C(12:5)
S1C251       MOVE 'BANCA POPOLARE DI SONDRIO' TO SO-DEN-PER-C
S1C251       MOVE 'SONDRIO'                   TO SO-COMUNE-C
S1C251       MOVE 'SO'                        TO SO-PROVINCIA-C
S1C251       MOVE ZEROES                      TO SO-DATA-NASCITA-C
S1C251       MOVE ZEROES                      TO SO-DATA-IMPEGNO-C
SHA041       MOVE 'ELISE.SOSI@POPSO.IT'       TO SO-EMAIL-C
S1C251       MOVE EKIFB-D-RIFERI-OPE(1:4)     TO SO-ANNO-RIF-C
SHL121
SHL121*- Verifica per elaborazione in anno di riferimento:
SHL121*      IF SO-ANNO-RIF-C < EKSYS-D-SYSTEM-OPE(1:4)
SHL121*         MOVE '0231'                   TO EKERR-C-COD-ERRORE(1)
SHL121*         SET EKERR-ERR-DATI-INPUT      TO TRUE
SHL121*         MOVE 'ANNO DI RIFERIMENTO NON VALIDO'
SHL121*                                       TO EKERR-X-DES-ERRORE(1)
SHL121*         MOVE 'SO-ANNO-RIF-C'          TO EKERR-X-DAT-ERRATO(1)
SHL121*         MOVE 'P022'                   TO EKERR-C-RIF-ERRORE(1)
SHL121*         PERFORM ERRORE-GRAVE
SHL121*      END-IF
SHL121
SJB071*- Verifica per elaborazione in anno di riferimento:
SJB071       IF SO-ANNO-RIF-C < EKSYS-D-SYSTEM-OPE(1:4)
SJB071          MOVE '0231'                   TO EKERR-C-COD-ERRORE(1)
SJB071          SET EKERR-ERR-DATI-INPUT      TO TRUE
SJB071          MOVE 'ANNO DI RIFERIMENTO NON VALIDO'
SJB071                                        TO EKERR-X-DES-ERRORE(1)
SJB071          MOVE 'SO-ANNO-RIF-C'          TO EKERR-X-DAT-ERRATO(1)
SJB071          MOVE 'P022'                   TO EKERR-C-RIF-ERRORE(1)
SJB071          PERFORM ERRORE-GRAVE
SJB071       END-IF
SJB071
S1C251       MOVE 'A'                         TO SO-CAR-CONTROLLO-C
S1C251       MOVE W-C-FINE-RIGA(2:1)          TO SO-CAR-FINE-RIGA-C(1:1)
S1C251       MOVE W-C-FINE-RIGA(4:1)          TO SO-CAR-FINE-RIGA-C(2:1)
SHL121*PROVA PERFORM SCRITTURA-SONCO
SKA292       MOVE SONCORR2                    TO SONCOR22
DEB>>>       DISPLAY 'SCRITTURA-SONCO 2'
SHL121       PERFORM SCRITTURA-SONCO
SKA292       PERFORM SCRITTURA-SONC2
           END-IF
           .
      *
       ELABORAZIONE-SCRITTURE.
           MOVE 'ELABORAZIONE-SCRITTURE'  TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
DEB>>>     DISPLAY 'DENTRO ELABORAZIONE-SCRITTURE'

           MOVE APPO-AREA-PADRE           TO CERIO-G-AREA-RECORD
DEB>>>     DISPLAY 'ELABORO POSIZIONE: ' FCEI1-C-FINANZ-PRE'/'
DEB>>>                                   FCEI1-N-FINANZ-NUM' - '
DEB>>>                                   FCEI1-C-TIPO-FINAN' - '
DEB>>>                                   FCEI1-C-ATTIVA-PRG' - '
DEB>>>                                   FCEI1-C-IDENTI-RAP' - '
DEB>>>                                   FCEI1-I-NONDET-IMP' - '
DEB>>>                                   FCEI1-I-NONDET-IMP-VAL

           INITIALIZE DICPINTE
090309                SONCORR2
SKA292                SONCOR22
090309                REC-PAPYRUS
SKB181                W-SONCO-APPO
S5B091     SET NO-LEGAMI-FIN TO TRUE
SGB012     SET TRM-NO TO TRUE
SLC121     SET RATE-A-ZERO-NO TO TRUE

SKA292*- Verifico a livello di finanziamento se esiste FGT:
SKA292     PERFORM VERIFICA-IFICOINT
SKA292
SLC121*- Verifico a livello di finanziamento se sono state pagate rate
SLC121*  (solo rate, no altri oneri o spese) nel periodo di elaboraz.):
SLC121     IF  FCEI1-I-TOTANN-RAT-3 = ZEROES
SLC121     AND FCEI1-I-TOTANN-RAT-VAL-3 = ZEROES
SLC121         SET RATE-A-ZERO-SI TO TRUE
SLC121     END-IF
SLC121
SGB012*- ELABORAZIONE DICPINTE:
           PERFORM VALORIZZA-DICPINTE

           IF    APPO-I-VOCE0 = 0   AND   APPO-I-VOCE1 = 0
           AND   APPO-I-VOCE3 = 0   AND   APPO-I-VOCE2 = 0
           AND   APPO-I-VOCE5 = 0   AND   APPO-I-VOCE4 = 0
           AND   APPO-I-VOCE7 = 0   AND   APPO-I-VOCE6 = 0
           AND   APPO-I-VOCE9 = 0   AND   APPO-I-VOCE8 = 0
SGB012     AND   W-I-INTVAR-TOT = 0 AND   W-I-INTVAR-TOT-VAL = 0
SGB012     AND   W-I-SPERAT-TOT = 0 AND   W-I-SPERAT-TOT-VAL = 0
SGB012     AND   W-I-SPEIST-TOT = 0 AND   W-I-SPEIST-TOT-VAL = 0
SGB012     AND   W-I-IMPSOS-TOT = 0 AND   W-I-IMPSOS-TOT-VAL = 0
SGB012     AND   W-I-PENEST-TOT = 0 AND   W-I-PENEST-TOT-VAL = 0
SGB012     AND   W-I-ONESAL-TOT = 0 AND   W-I-ONESAL-TOT-VAL = 0
SGB012     AND   W-I-ONEACC-TOT = 0 AND   W-I-ONEACC-TOT-VAL = 0
SGB012     AND   W-I-ONECER-TOT = 0 AND   W-I-ONECER-TOT-VAL = 0
SGB012     AND   W-I-COMINT-TOT = 0 AND   W-I-COMINT-TOT-VAL = 0
              CONTINUE
DEB>>>        DISPLAY 'NON HO IMPORTI DA SEGNALARE: NON ELABORO'
           ELSE
DEB>>>        DISPLAY 'ELABORO IMPORTI DA SEGNALARE'
090309        PERFORM RICAVA-DATI-FAN
SGB012        IF FCEI1-C-FINANZ-PRE = '41'
SGB012        OR FCEI1-C-FINANZ-PRE = '42'
SGB012           SET TRM-SI TO TRUE
SGB012        END-IF
S5B091        PERFORM REPERIMENTO-LEGAMI-FIN
S5B091        IF SI-LEGAMI-FIN
S5B091           MOVE FAN00-G-AREA-FAN     TO WAFAN-AREA
S5B091           MOVE FAN9Q-G-AREA-O       TO WAFAN-AREA-FAN9
S5B091           MOVE FCEI1-C-FINANZ-PRE   TO W-C-FINANZ-PR2
S5B091           MOVE FCEI1-N-FINANZ-NUM   TO W-N-FINANZ-NU2
S5B091           PERFORM VARYING W-L FROM 1 BY 1
S5B091             UNTIL W-L > W-N-LUNGH-TAB-LEG
S5B091             OR WAPPO-C-MULTIL-COD(W-L) = SPACES OR LOW-VALUES
S5B091              MOVE WAPPO-C-FINANZ-PRE(W-L) TO FCEI1-C-FINANZ-PRE
S5B091              MOVE WAPPO-N-FINANZ-NUM(W-L) TO FCEI1-N-FINANZ-NUM
S5B091              PERFORM RICAVA-DATI-FAN
S5B091           END-PERFORM
S5B091           MOVE FAN00-G-AREA-FAN     TO WAFAN-AREA-COF
S5B091           MOVE FAN9Q-G-AREA-O       TO WAFAN-AREA-FAN9-COF
S5B091           MOVE W-C-FINANZ-PR2       TO FCEI1-C-FINANZ-PRE
S5B091           MOVE W-N-FINANZ-NU2       TO FCEI1-N-FINANZ-NUM
S5B091           ADD W9FAN-I-EROGAZ-FIN    TO FAN9Q-I-EROGAZ-FIN-O
S5B091           ADD W9FAN-I-STIPUL-FIN    TO FAN9Q-I-STIPUL-FIN-O
S5B091           MOVE WAFAN-AREA           TO FAN00-G-AREA-FAN
S5B091           MOVE WAFAN-AREA-FAN9      TO FAN9Q-G-AREA-O
S5B091        END-IF
S9K101        IF FAN9Q-C-ATTIVA-COD-O = 'RINEG'
S9K101           PERFORM REPERIMENTO-DATI-PADRE
S9K101        END-IF
DEB>>>*       IF ANA-SI
090309        PERFORM RICAVA-DATI-IAN
DEB>>>*       END-IF
SGB012*
SGB012*- ELABORAZIONE LETTERA PAPYRUS:
DEB>>>*       DISPLAY '1) ELABORAZIONE LETTERA PAPYRUS'
090309        INITIALIZE   PAPYRUS-REC-LET
090309        MOVE 'L'     TO PAPY-TIPO-REC OF PAPYRUS-REC-LET
090309*       MOVE DATA-EL          TO PAPY-DT-LETTERA
090309        MOVE EKSYS-D-SYSTEM-OPE(1:4) TO PAPY-DT-LETTERA(1:4)
090309        MOVE EKSYS-D-SYSTEM-OPE(6:2) TO PAPY-DT-LETTERA(5:2)
090309        MOVE EKSYS-D-SYSTEM-OPE(9:2) TO PAPY-DT-LETTERA(7:2)
090420*       MOVE 'S'              TO FILLER-11
DEB>>>*       IF ANA-SI
090309        PERFORM CARICA-DATI-CORRISPONDENZA
DEB>>>*       END-IF
090309        MOVE PAPYRUS-REC-LET  TO REC-PAPYRUS
090309        IF  APPO-I-VOCE0 = 0   AND APPO-I-VOCE7 = 0
SGB012        AND W-I-INTVAR-TOT = 0 AND W-I-INTVAR-TOT-VAL = 0
SNC201*SGB012        AND W-I-SPERAT-TOT = 0 AND W-I-SPERAT-TOT-VAL = 0
SGB012        AND W-I-SPEIST-TOT = 0 AND W-I-SPEIST-TOT-VAL = 0
SGB012        AND W-I-IMPSOS-TOT = 0 AND W-I-IMPSOS-TOT-VAL = 0
SGB012        AND W-I-PENEST-TOT = 0 AND W-I-PENEST-TOT-VAL = 0
SGB012        AND W-I-COMINT-TOT = 0 AND W-I-COMINT-TOT-VAL = 0
SNE092        AND W-I-INTVAR-TOT-C = 0 AND W-I-INTVAR-TOT-C-VAL = 0
SNE092        AND W-I-SPEIST-TOT-C = 0 AND W-I-SPEIST-TOT-C-VAL = 0
SNE092        AND W-I-PENEST-TOT-C = 0 AND W-I-PENEST-TOT-C-VAL = 0
SNE092        AND W-I-IMPSOS-TOT-C = 0 AND W-I-IMPSOS-TOT-C-VAL = 0
090309         CONTINUE
090309        ELSE
SOE142*090309             PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
090309        END-IF
090309*
SGB012*- ELABORAZIONE MOVIMENTO PAPYRUS:
DEB>>>*       DISPLAY '2) ELABORAZIONE MOVIMENTO PAPYRUS'
090309        INITIALIZE   PAPYRUS-REC-MCC
SGB012        INITIALIZE   PAPYRUS-REC-STP
SGB012*
090309        PERFORM GESTIONE-MOVIMENTO
SGB012*
090309        MOVE PAPYRUS-REC-MCC TO REC-PAPYRUS
090309        IF  APPO-I-VOCE0 = 0   AND APPO-I-VOCE7 = 0
SGB012        AND W-I-INTVAR-TOT = 0 AND W-I-INTVAR-TOT-VAL = 0
SNC201*SGB012        AND W-I-SPERAT-TOT = 0 AND W-I-SPERAT-TOT-VAL = 0
SGB012        AND W-I-SPEIST-TOT = 0 AND W-I-SPEIST-TOT-VAL = 0
SGB012        AND W-I-IMPSOS-TOT = 0 AND W-I-IMPSOS-TOT-VAL = 0
SGB012        AND W-I-PENEST-TOT = 0 AND W-I-PENEST-TOT-VAL = 0
SGB012        AND W-I-COMINT-TOT = 0 AND W-I-COMINT-TOT-VAL = 0
SNE092        AND W-I-INTVAR-TOT-C = 0 AND W-I-INTVAR-TOT-C-VAL = 0
SNE092        AND W-I-SPEIST-TOT-C = 0 AND W-I-SPEIST-TOT-C-VAL = 0
SNE092        AND W-I-PENEST-TOT-C = 0 AND W-I-PENEST-TOT-C-VAL = 0
SNE092        AND W-I-IMPSOS-TOT-C = 0 AND W-I-IMPSOS-TOT-C-VAL = 0
090309         CONTINUE
090309        ELSE
SOE142*090309         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
090309        END-IF
SGB012
SGB012*- ELABORAZIONE LETTERA DETTAGLIO PAPYRUS:
DEB>>>*       DISPLAY '3) ELABORAZIONE MOVIMENTO DETTAGLIO PAPYRUS'
SGB012        IF  W-I-INTVAR-TOT = 0 AND W-I-INTVAR-TOT-VAL = 0
SGB012        AND W-I-SPERAT-TOT = 0 AND W-I-SPERAT-TOT-VAL = 0
SGB012        AND W-I-SPEIST-TOT = 0 AND W-I-SPEIST-TOT-VAL = 0
SGB012        AND W-I-IMPSOS-TOT = 0 AND W-I-IMPSOS-TOT-VAL = 0
SGB012        AND W-I-PENEST-TOT = 0 AND W-I-PENEST-TOT-VAL = 0
SGB012        AND W-I-COMINT-TOT = 0 AND W-I-COMINT-TOT-VAL = 0
SNE092        AND W-I-INTVAR-TOT-C = 0 AND W-I-INTVAR-TOT-C-VAL = 0
SNE092        AND W-I-SPEIST-TOT-C = 0 AND W-I-SPEIST-TOT-C-VAL = 0
SNE092        AND W-I-PENEST-TOT-C = 0 AND W-I-PENEST-TOT-C-VAL = 0
SNE092        AND W-I-IMPSOS-TOT-C = 0 AND W-I-IMPSOS-TOT-C-VAL = 0
SGB012         CONTINUE
SGB012        ELSE
SGB012         PERFORM GESTIONE-DETTAGLIO
SGB012        END-IF

SGB012*- SCRITTURA FLUSSI FANT1 E SONCO:
BPSPER        IF  APPO-I-VOCE0 = 0   AND APPO-I-VOCE7 = 0
BPSPER        AND APPO-I-VOCE2 = 0   AND APPO-I-VOCE3 = 0
SGB012        AND W-I-INTVAR-TOT = 0 AND W-I-INTVAR-TOT-VAL = 0
SGB012        AND W-I-SPERAT-TOT = 0 AND W-I-SPERAT-TOT-VAL = 0
SGB012        AND W-I-SPEIST-TOT = 0 AND W-I-SPEIST-TOT-VAL = 0
SGB012        AND W-I-IMPSOS-TOT = 0 AND W-I-IMPSOS-TOT-VAL = 0
SGB012        AND W-I-PENEST-TOT = 0 AND W-I-PENEST-TOT-VAL = 0
SGB012        AND W-I-COMINT-TOT = 0 AND W-I-COMINT-TOT-VAL = 0
SNE092        AND W-I-INTVAR-TOT-C = 0 AND W-I-INTVAR-TOT-C-VAL = 0
SNE092        AND W-I-SPEIST-TOT-C = 0 AND W-I-SPEIST-TOT-C-VAL = 0
SNE092        AND W-I-PENEST-TOT-C = 0 AND W-I-PENEST-TOT-C-VAL = 0
SNE092        AND W-I-IMPSOS-TOT-C = 0 AND W-I-IMPSOS-TOT-C-VAL = 0
BPSPER            CONTINUE
BPSPER        ELSE
SGB012*- Gi{ filtrati a livello di input EKCERIO per classi/tipo fin.:
SGB012*   APLUS-AGR
SGB012*   CHAGR-AGR
SGB012*   MTAGE-MAT
SGB012*   MTAGE-MUT
SGB012*   MTAGR-MAG
SGB012*   MTCAS-MUT
SGB012*   MTCOP-MUT
SGB012*   MTORD-MUT
SGB012*   MTVAL-VUT
SGB012*   PVORD-PIV
SGB012*   TRM  -TRM
SGB012*
SGB012*BPSPER   IF FAN00-C-TIPO-FINAN  EQUAL 'MUT' OR 'VUT' OR 'AGR'
SGB012*SG0215                           OR 'MAT' OR 'MAG'
SGB012*S5D272                           OR 'PIV'
                  PERFORM VALORIZZA-FANT1
SGB012*BPSPER   ELSE
SGB012*BPSPER     CONTINUE
SGB012*BPSPER   END-IF
BPSPER        END-IF

              PERFORM SCRITTURA-DICPI

              PERFORM CALCOLA-VOCI-TOTALI
           END-IF

           INITIALIZE                        IMPORTI-VOCI
SGB012     INITIALIZE                        IMPORTI-VOCI-CER
S1G201     MOVE ZEROES                       TO W-APPO-IMP-INT
SLH051     MOVE ZEROES                       TO W-APPO-IMP-PAG
           .
      *
       CALCOLA-VOCI-TOTALI.
           MOVE 'CALCOLA-VOCI-TOTALI'     TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COMPUTE APPO-I-VOCE0-TOT   = APPO-I-VOCE0-TOT
                                      + APPO-I-VOCE0
           COMPUTE APPO-I-VOCE1-TOT   = APPO-I-VOCE1-TOT
                                      + APPO-I-VOCE1
           COMPUTE APPO-I-VOCE2-TOT   = APPO-I-VOCE2-TOT
                                      + APPO-I-VOCE2
           COMPUTE APPO-I-VOCE3-TOT   = APPO-I-VOCE3-TOT
                                      + APPO-I-VOCE3
           COMPUTE APPO-I-VOCE4-TOT   = APPO-I-VOCE4-TOT
                                      + APPO-I-VOCE4
           COMPUTE APPO-I-VOCE5-TOT   = APPO-I-VOCE5-TOT
                                      + APPO-I-VOCE5
           COMPUTE APPO-I-VOCE6-TOT   = APPO-I-VOCE6-TOT
                                      + APPO-I-VOCE6
           COMPUTE APPO-I-VOCE7-TOT   = APPO-I-VOCE7-TOT
                                      + APPO-I-VOCE7
           COMPUTE APPO-I-VOCE8-TOT   = APPO-I-VOCE8-TOT
                                      + APPO-I-VOCE8
           COMPUTE APPO-I-VOCE9-TOT   = APPO-I-VOCE9-TOT
                                      + APPO-I-VOCE9
           .
090309******************************************************************
090309 GESTIONE-MOVIMENTO.
090309*---------------------------
090309     MOVE 'GESTIONE-MOVIMENTO'           TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                              TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'GESTIONE-MOVIM                     '
SGB012*- Gestione dati finanziamenti originari per Tremonti:
SGB012     IF TRM-SI
SGB012        MOVE FAN00-G-AREA-FAN        TO WAFAN-AREA-TRM
SGB012        MOVE FAN9Q-G-AREA-O          TO WAFAN-AREA-FAN9-TRM
SGB012        MOVE FCEI1-C-FINANZ-PRE      TO W-C-FINANZ-PR2
SGB012        IF FCEI1-C-FINANZ-PRE = '41'
SGB012           MOVE '09'                 TO FCEI1-C-FINANZ-PRE
SGB012        ELSE
SGB012           MOVE '10'                 TO FCEI1-C-FINANZ-PRE
SGB012        END-IF
SGB012        PERFORM RICAVA-DATI-FAN
SGB012     END-IF
090309
090309     MOVE 'M'          TO PAPY-TIPO-REC OF PAPYRUS-REC-MCC
090309*    MOVE FIL-CC       TO PAPY-FILIALE
090325     MOVE CCOC003-FILIALE      TO PAPY-FILIALE
SGB012                                  PAPY-FILIALE-S
090325     MOVE CCOC003-CONTO        TO PAPY-CONTO
SGB012                                  PAPY-CONTO-S
090325*    MOVE FCEI1-C-FINFIL-GES   TO PAPY-FILIALE
090325*    MOVE FAN9Q-C-COOPAG-NUM-O TO PAPY-CONTO
090309     MOVE 'marzo'                   TO DATA-CERT-MM
090309     MOVE EKSYS-T-SYSTEM-OPE(1:4)   TO DATA-CERT-AA
090309*    MOVE 'MU'                      TO TIPO-FIN
090309     EVALUATE FAN9Q-C-TIPO-FINAN-O
090309     WHEN 'AGR'
S1C251*      MOVE 'FR'                      TO TIPO-FIN
S1C251       MOVE 'FG'                      TO TIPO-FIN
090309     WHEN 'ATC'
090309       MOVE 'FG'                      TO TIPO-FIN
090309     WHEN 'CHI'
090309       MOVE 'FI'                      TO TIPO-FIN
090309     WHEN 'MAG'
090309*      MOVE 'MU'                      TO TIPO-FIN
090309       MOVE 'MA'                      TO TIPO-FIN
090309     WHEN 'MAT'
090309       MOVE 'MU'                      TO TIPO-FIN
090309     WHEN 'MUT'
090309       MOVE 'MU'                      TO TIPO-FIN
S5D272     WHEN 'PIV'
S5D272       MOVE 'PV'                      TO TIPO-FIN
090309     WHEN 'PRP'
090309       MOVE 'FI'                      TO TIPO-FIN
090309     WHEN 'TRM'
090309       MOVE 'MU'                      TO TIPO-FIN
S1G201*    WHEN 'VUT'
S1G201*      MOVE 'MU'                      TO TIPO-FIN
S1G201     WHEN 'VUT'
S1G201       MOVE 'M1'                      TO TIPO-FIN
S1G201     WHEN 'VCH'
S1G201       MOVE 'M1'                      TO TIPO-FIN
S1G201     WHEN 'VPR'
S1G201       MOVE 'F1'                      TO TIPO-FIN
090309     END-EVALUATE
090309     MOVE EKIFB-D-RIFERI-OPE(1:4)   TO ANNO-CERT
090309     MOVE FCEI1-N-FINANZ-NUM        TO NUM-DOM-OUT
090309     MOVE FCEI1-N-FINANZ-NUM        TO NEW-NUMFIN-M
090325*    MOVE FAN9Q-X-NDGNDG-DES-O(01:32)  TO INTEST-1
090325*    MOVE FAN9Q-X-NDGNDG-DES-O(33:18)  TO INTEST-2
090325     MOVE CCOC003-ANAGRAFICA-1         TO INTEST-1
090325     MOVE CCOC003-ANAGRAFICA-2         TO INTEST-2
090325*    MOVE CCOCMAIL-INDIRIZZO           TO INDIRIZZO
090325*    MOVE CCOCMAIL-CAP                 TO CAP
090325*    MOVE CCOCMAIL-LOCALITA            TO LOCAL
090325*    MOVE CCOCMAIL-CODICE-UIC-POSTA    TO UIC-POSTA
090325     MOVE CCOC003-INDIRIZZO            TO INDIRIZZO
090325     MOVE CCOC003-CAP                  TO CAP
090325     MOVE CCOC003-LOCALITA             TO LOCAL
090325     MOVE CCOC003-CODICE-UIC-POSTA     TO UIC-POSTA
SIC023* per tutti data e importo di stipula
SIC023*090309     IF   FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
SIC023*CORRAD     OR   FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
090309       MOVE FAN9Q-D-STIPUL-OPE-O(1:4)      TO DT-EROG(1:4)
090309       MOVE FAN9Q-D-STIPUL-OPE-O(6:2)      TO DT-EROG(5:2)
090309       MOVE FAN9Q-D-STIPUL-OPE-O(9:2)      TO DT-EROG(7:2)
090309       MOVE FAN9Q-I-STIPUL-FIN-O      TO IMP-EROG
SIC023*090309     ELSE
SIC023*090309       MOVE FAN9Q-D-EROGAZ-OPE-O(1:4)      TO DT-EROG(1:4)
SIC023*090309       MOVE FAN9Q-D-EROGAZ-OPE-O(6:2)      TO DT-EROG(5:2)
SIC023*090309       MOVE FAN9Q-D-EROGAZ-OPE-O(9:2)      TO DT-EROG(7:2)
SIC023*090309       MOVE FAN9Q-I-EROGAZ-FIN-O      TO IMP-EROG
SIC023*090309     END-IF
090309     MOVE FAN9Q-C-FILIAL-GES-O(3:3) TO COD-FIL
090309     MOVE '  '                      TO COD-CAT-OUT
090309     MOVE IAN1I-C-SETTOR-COD-O      TO SETTORE
090309     MOVE FAN9Q-C-DIVISA-OPE-O      TO DIVISA

SLE052     IF FAN9Q-C-ATTIVA-COD-O = 'RINEG'
SLE052        MOVE W-C-DIVISA-ORIG        TO PAPY-DIVISA-ORIG
SLE052     ELSE
SLE052        MOVE FAN9Q-C-DIVISA-OPE-O   TO PAPY-DIVISA-ORIG
SLE052     END-IF

DEB>>>*    DISPLAY 'APPO-I-VOCE0      : ' APPO-I-VOCE0
DEB>>>*    DISPLAY 'W-I-INTVAR-TOT    : ' W-I-INTVAR-TOT
DEB>>>*    DISPLAY 'W-I-INTVAR-TOT-VAL: ' W-I-INTVAR-TOT-VAL
DEB>>>*    DISPLAY 'W-I-COMINT-TOT    : ' W-I-COMINT-TOT
DEB>>>*    DISPLAY 'W-I-COMINT-TOT-VAL: ' W-I-COMINT-TOT-VAL
SGB012*- Finanziamento in Valuta:
S1G201     IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
S1G201*       COMPUTE IMP-INT-EURO ROUNDED = FCEI1-I-EROGAZ-FIN-VAL
S1G201        COMPUTE IMP-INT-EURO = APPO-I-VOCE0
090309        MOVE FCEI1-P-CAMBIO-TAS        TO CAMBIO
S1G201        MOVE ZEROES                    TO FIL-CC
S1G201        MOVE ZEROES                    TO CONTO-CC
S1G201        COMPUTE IMP-INT = W-APPO-IMP-INT
SGB012*- Dati nuovi - Se lavoro in VALUTA ESTERA, i dati valorizzati
SGB012*- nei campi d'appoggio in VALUTA saranno in EURO:
SGB012        MOVE W-I-INTVAR-TOT            TO IMP-INT
SNE092        ADD  W-I-INTVAR-TOT-C          TO IMP-INT
SGB012        MOVE W-I-INTVAR-TOT-VAL        TO IMP-INT-EURO
SNE092        ADD  W-I-INTVAR-TOT-C-VAL      TO IMP-INT-EURO
SGB012*       MOVE W-I-COMINT-TOT            TO COM-INT-VAL
SGB012*       MOVE W-I-COMINT-TOT-VAL        TO COM-INT
S1G201     ELSE
SGB012*- Finanziamento in Divisa:
090309        MOVE ZEROES                    TO CAMBIO
090309        MOVE ZEROES                    TO IMP-INT-EURO
S1G201        MOVE FAN9Q-C-COOPAG-CAB-O      TO FIL-CC
S1G201        MOVE FAN9Q-C-COOPAG-NUM-O      TO CONTO-CC
S1G201        COMPUTE IMP-INT = APPO-I-VOCE0
SGB012*- Dati nuovi:
SGB012        MOVE W-I-INTVAR-TOT            TO IMP-INT
SNE092        ADD  W-I-INTVAR-TOT-C          TO IMP-INT
SGB012        MOVE ZEROES                    TO IMP-INT-EURO
SGB012*       MOVE ZEROES                    TO COM-INT-VAL
SGB012*       MOVE ZEROES                    TO COM-INT
S1G201     END-IF
SGB012
S1B251*090309     COMPUTE IMP-INT                = (APPO-I-VOCE0 +
S1B251*090309                                       APPO-I-VOCE7 )
S1B251*-- VOCE0 = VOCE7, VOCE 7 E' CALCOLATO SOLO SE
S1B251*--                C-ATTIVA-PRG = 999, QUINDI PER I "FIGLI"
S1B251*--                RISULTA DOPPIO
S1G201*    COMPUTE IMP-INT = APPO-I-VOCE0
090309*                                      APPO-I-VOCE8 )
S1G201*    MOVE FAN9Q-C-COOPAG-CAB-O      TO FIL-CC
S1G201*    MOVE FAN9Q-C-COOPAG-NUM-O      TO CONTO-CC
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO NDG-MUT
090309     MOVE IAN1I-C-RESIDE-NAZ-O      TO NAZ
090309     MOVE IAN1I-C-NGIURI-COD-O      TO NATURA-GIURIDICA
090309     MOVE IAN1I-C-PERSON-SEX-O      TO SESSO.
SGB012*    MOVE FCEI1-C-PRODOT-CLA        TO PRODOT-CLA
SGB012     MOVE FCEI1-I-DEBRES-EFF        TO IMP-DEB-RES
SIC023* FLAG FINANZIAMENTO PASSATO A SOFFERENZA
SIC023     IF FAN9Q-C-ESTINZ-COD-O = 'PASOF'
SIC023        MOVE 'S'                    TO F-PASOFF
SIC023     END-IF
SKC051     MOVE SPACES                    TO F-ACCOLL
SKC051     SET ACCOLLATO-NO               TO TRUE
SKC051     IF FCEI1-C-ACCOLL-FLG = 'SI'
SKC051        PERFORM ESTRAZIONE-ACCOLLO
SKC051        IF ACCOLLATO-SI
SKC051           MOVE 'S'                 TO F-ACCOLL
SKC051        END-IF
SKC051     END-IF
SJD291*--- Recupero ID Ente esterno principale
SJD291     PERFORM RECUPERA-ID-ENTE.
SGB012*
SGB012*- DATI ELABORATI IN LABEL GESTIONE-DETTAGLIO:
SGB012*- Se lavoro in VALUTA ESTERA, i dati valorizzati
SGB012*- nei campi d'appoggio in VALUTA saranno in EURO:
SGB012     IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        MOVE W-I-SPERAT-TOT-VAL        TO IMP-SPE-INC
SGB012        MOVE W-I-SPEIST-TOT-VAL        TO IMP-SPE-IST
SNE092        ADD  W-I-SPEIST-TOT-C-VAL      TO IMP-SPE-IST
SGB012        MOVE W-I-IMPSOS-TOT-VAL        TO IMP-IMP-SOS
SNE092        ADD  W-I-IMPSOS-TOT-C-VAL      TO IMP-IMP-SOS
SGB012        MOVE W-I-PENEST-TOT-VAL        TO IMP-PEN-EST
SNE092        ADD  W-I-PENEST-TOT-C-VAL      TO IMP-PEN-EST
SGB012        MOVE W-I-ONESAL-TOT-VAL        TO IMP-ONE-SAL
SNE092        ADD  W-I-ONESAL-TOT-C-VAL      TO IMP-ONE-SAL
SGB012        MOVE W-I-ONEACC-TOT-VAL        TO IMP-ONE-ACC
SNE092        MOVE W-I-ONEACC-TOT-C-VAL      TO IMP-ONE-ACC
SGB012        MOVE W-I-ONECER-TOT-VAL        TO IMP-ONE-VAR
SNE092        ADD  W-I-ONECER-TOT-C-VAL      TO IMP-ONE-VAR
SGB012        MOVE W-I-COMINT-TOT-VAL        TO COM-INT
SGB012        MOVE W-I-SPERAT-TOT            TO IMP-SPE-INC-VAL
SGB012        MOVE W-I-SPEIST-TOT            TO IMP-SPE-IST-VAL
SNE092        ADD  W-I-SPEIST-TOT-C          TO IMP-SPE-IST-VAL
SGB012        MOVE W-I-IMPSOS-TOT            TO IMP-IMP-SOS-VAL
SNE092        ADD  W-I-IMPSOS-TOT-C          TO IMP-IMP-SOS-VAL
SGB012        MOVE W-I-PENEST-TOT            TO IMP-PEN-EST-VAL
SNE092        ADD  W-I-PENEST-TOT-C          TO IMP-PEN-EST-VAL
SGB012        MOVE W-I-ONESAL-TOT            TO IMP-ONE-SAL-VAL
SNE092        ADD  W-I-ONESAL-TOT-C          TO IMP-ONE-SAL-VAL
SGB012        MOVE W-I-ONEACC-TOT            TO IMP-ONE-ACC-VAL
SNE092        ADD  W-I-ONEACC-TOT-C          TO IMP-ONE-ACC-VAL
SGB012        MOVE W-I-ONECER-TOT            TO IMP-ONE-VAR-VAL
SNE092        ADD  W-I-ONECER-TOT-C          TO IMP-ONE-VAR-VAL
SGB012        MOVE W-I-COMINT-TOT            TO COM-INT-VAL
SGB012     ELSE
SGB012        MOVE W-I-SPERAT-TOT            TO IMP-SPE-INC
SGB012        MOVE W-I-SPEIST-TOT            TO IMP-SPE-IST
SNE092        ADD  W-I-SPEIST-TOT-C          TO IMP-SPE-IST
SGB012        MOVE W-I-IMPSOS-TOT            TO IMP-IMP-SOS
SNE092        ADD  W-I-IMPSOS-TOT-C          TO IMP-IMP-SOS
SGB012        MOVE W-I-PENEST-TOT            TO IMP-PEN-EST
SNE092        ADD  W-I-PENEST-TOT-C          TO IMP-PEN-EST
SGB012        MOVE W-I-ONESAL-TOT            TO IMP-ONE-SAL
SNE092        ADD  W-I-ONESAL-TOT-C          TO IMP-ONE-SAL
SGB012        MOVE W-I-ONEACC-TOT            TO IMP-ONE-ACC
SNE092        ADD  W-I-ONEACC-TOT-C          TO IMP-ONE-ACC
SGB012        MOVE W-I-ONECER-TOT            TO IMP-ONE-VAR
SNE092        ADD  W-I-ONECER-TOT-C          TO IMP-ONE-VAR
SGB012        MOVE W-I-COMINT-TOT            TO COM-INT
SGB012        MOVE W-I-SPERAT-TOT-VAL        TO IMP-SPE-INC-VAL
SGB012        MOVE W-I-SPEIST-TOT-VAL        TO IMP-SPE-IST-VAL
SNE092        ADD  W-I-SPEIST-TOT-C-VAL      TO IMP-SPE-IST-VAL
SGB012        MOVE W-I-IMPSOS-TOT-VAL        TO IMP-IMP-SOS-VAL
SNE092        ADD  W-I-IMPSOS-TOT-C-VAL      TO IMP-IMP-SOS-VAL
SGB012        MOVE W-I-PENEST-TOT-VAL        TO IMP-PEN-EST-VAL
SNE092        ADD  W-I-PENEST-TOT-C-VAL      TO IMP-PEN-EST-VAL
SGB012        MOVE W-I-ONESAL-TOT-VAL        TO IMP-ONE-SAL-VAL
SNE092        ADD  W-I-ONESAL-TOT-C-VAL      TO IMP-ONE-SAL-VAL
SGB012        MOVE W-I-ONEACC-TOT-VAL        TO IMP-ONE-ACC-VAL
SNE092        ADD  W-I-ONEACC-TOT-C-VAL      TO IMP-ONE-ACC-VAL
SGB012        MOVE W-I-ONECER-TOT-VAL        TO IMP-ONE-VAR-VAL
SNE092        ADD  W-I-ONECER-TOT-C-VAL      TO IMP-ONE-VAR-VAL
SGB012        MOVE W-I-COMINT-TOT-VAL        TO COM-INT-VAL
SGB012     END-IF
SGB012*
DEB>>>*    DISPLAY 'DATI NEW X PAPYRUS: '
DEB>>>*    IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>*       DISPLAY 'FINANZIAMENTO IN VALUTA ESTERA: '
DEB>>>*                FCEI1-C-DIVISA-COD
DEB>>>*    ELSE
DEB>>>*       DISPLAY 'FINANZIAMENTO IN EURO: '
DEB>>>*                FCEI1-C-DIVISA-COD
DEB>>>*    END-IF
DEB>>>*    DISPLAY 'IMP-INT      : ' IMP-INT
DEB>>>*    DISPLAY 'IMP-INT-EURO : ' IMP-INT-EURO
DEB>>>*    DISPLAY 'COM-INT      : ' COM-INT
DEB>>>*    DISPLAY 'COM-INT-VAL  : ' COM-INT-VAL
DEB>>>*    DISPLAY '***'
DEB>>>*    DISPLAY 'IMPORTI IN EURO: '
DEB>>>*    DISPLAY 'IMP-SPE-INC  : ' IMP-SPE-INC
DEB>>>*    DISPLAY 'IMP-SPE-IST  : ' IMP-SPE-IST
DEB>>>*    DISPLAY 'IMP-IMP-SOS  : ' IMP-IMP-SOS
DEB>>>*    DISPLAY 'IMP-PEN-EST  : ' IMP-PEN-EST
DEB>>>*    DISPLAY 'IMP-ONE-ACC  : ' IMP-ONE-ACC
DEB>>>*    DISPLAY 'IMP-ONE-SAL  : ' IMP-ONE-SAL
DEB>>>*    DISPLAY 'IMP-ONE-VAR  : ' IMP-ONE-VAR
DEB>>>*    DISPLAY '***'
DEB>>>*    IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>*       DISPLAY 'IMPORTI IN VALUTA ' FCEI1-C-DIVISA-COD ': '
DEB>>>*    ELSE
DEB>>>*       DISPLAY 'IMPORTI IN VALUTA: '
DEB>>>*    END-IF
DEB>>>*    DISPLAY 'IMP-SPE-INC-VAL: ' IMP-SPE-INC-VAL
DEB>>>*    DISPLAY 'IMP-SPE-IST-VAL: ' IMP-SPE-IST-VAL
DEB>>>*    DISPLAY 'IMP-IMP-SOS-VAL: ' IMP-IMP-SOS-VAL
DEB>>>*    DISPLAY 'IMP-PEN-EST-VAL: ' IMP-PEN-EST-VAL
DEB>>>*    DISPLAY 'IMP-ONE-ACC-VAL: ' IMP-ONE-ACC-VAL
DEB>>>*    DISPLAY 'IMP-ONE-SAL-VAL: ' IMP-ONE-SAL-VAL
DEB>>>*    DISPLAY 'IMP-ONE-VAR-VAL: ' IMP-ONE-VAR-VAL
DEB>>>*    DISPLAY '***'
DEB>>>*    DISPLAY 'PRODOT-CLA     : ' PRODOT-CLA
DEB>>>*    DISPLAY 'IMP-DEB-RES    : ' IMP-DEB-RES
DEB>>>*    DISPLAY '***'
S4K181     MOVE FCEI1-C-INDICA-SAB        TO PAPY-INDICA-SAB-M.
SKA292
SKA292     MOVE SPACES                    TO PAPY-STIPUL-2019
SKA292     IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SKB181
SKB181*- Scrittura indicazione Anagrafe Tributaria solo su PF/PF di COI:
SKB181        SET TROVATO-PF-NO           TO TRUE
SKB181        SET PAPY-2019-NO            TO TRUE
SKB181        MOVE ZEROES                 TO W-I
SMC241*SKB181 IF CCOC003-NATURA-GIURIDICA = 'PF'
SMC241        IF IAN1I-C-NGIURI-COD-O = 'PF'
SKB181        OR FAN00-C-TIPO-FINAN = 'AGR'
SKB181        OR FAN00-C-TIPO-FINAN = 'MAG'
SKB181           SET PAPY-2019-SI TO TRUE
SKB181        ELSE
SKB181           IF IAN1I-C-NGIURI-COD-O = 'COI'
SKB181              SET TROVATO-PF-NO          TO TRUE
SKB181
SKB181              PERFORM ESTRAI-NDG-COLLEGATI
SKB181
SKB181              MOVE ZEROES                TO W-I
SKB181              PERFORM VARYING W-I FROM 1 BY 1
SKB181              UNTIL W-I > W-N-LUNGH-IAN
SKB181              OR IAN3I-C-NDGNDG-COD-O(W-I) NOT > SPACES
SKB181              OR TROVATO-PF-SI
SKB181                 PERFORM REPER-INTEST-COI
SKB181                 IF IAN1I-C-NGIURI-COD-O = 'PF'
SKB181                    SET TROVATO-PF-SI    TO TRUE
SKB181                 END-IF
SKB181              END-PERFORM
SKB181              MOVE ZEROES                TO W-I
SKB181
SKB181              IF TROVATO-PF-SI
SKB181                 SET PAPY-2019-SI        TO TRUE
SKB181              END-IF
SKB181
SKB181           END-IF
SKB181        END-IF
SKB181
SKA292        IF IFICOINT-SI
SKB181        AND PAPY-2019-SI
SKA292           MOVE 'S'                 TO PAPY-STIPUL-2019
SKA292        ELSE
SKA292           MOVE 'N'                 TO PAPY-STIPUL-2019
SKA292        END-IF
SKA292     END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012     IF TRM-SI
SGB012        MOVE W-C-FINANZ-PR2         TO FCEI1-C-FINANZ-PRE
SGB012        MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012        MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012     END-IF
SGB012     .
090309*
090309 RICAVA-DATI-FAN.
090309*
090309     MOVE 'RICAVA-DATI-FAN'         TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL
090309*
090309     INITIALIZE  FAN9Q-G-GROUP-AREA.
090309     SET  FAN9Q-SELECT-001              TO TRUE
090309     MOVE FCEI1-C-GRUPPO-ABI        TO FAN9Q-C-GRUPPO-ABI-I
090309     MOVE FCEI1-C-CODICE-ABI        TO FAN9Q-C-CODICE-ABI-I
090309     MOVE FCEI1-C-FINANZ-PRE        TO FAN9Q-C-FINANZ-PRE-I
090309     MOVE FCEI1-N-FINANZ-NUM        TO FAN9Q-N-FINANZ-NUM-I
090325     IF FCEI1-C-ACCOLL-FLG = 'SI'
090325       MOVE FCEI1-D-ACCOLL-DAT        TO FAN9Q-D-RIFERI-OPE-I
090325     ELSE
090309       MOVE EKIFB-D-RIFERI-OPE        TO FAN9Q-D-RIFERI-OPE-I
090325     END-IF
090309     PERFORM CL-EKFAN9QB
090325
090325     INITIALIZE FAN00-G-AREA-FAN
090325     MOVE FAN9Q-G-AREA-O            TO FAN00-G-AREA-FAN
090309
090309     IF NOT FAN9Q-OK
090309        MOVE FAN9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        MOVE 'P013'                 TO EKERR-C-RIF-ERRORE(1)
090309        PERFORM ERRORE-GRAVE
090309     END-IF.
090309
090309 RICAVA-DATI-IAN.
090309     MOVE 'RICAVA-DATI-IAN'             TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                             TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     INITIALIZE IAN1I-G-GROUP-AREA
090309     SET IAN1I-CTRL-NDGNDG          TO TRUE
090309     MOVE FCEI1-C-GRUPPO-ABI        TO IAN1I-C-GRUPPO-ABI-I
090309     MOVE FCEI1-C-CODICE-ABI        TO IAN1I-C-CODICE-ABI-I
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO IAN1I-C-NDGNDG-COD-I
090309     MOVE FAN9Q-G-AREA-O            TO IAN1I-G-AREA-FAN
090309
090309     PERFORM CL-EKIAN1IB.
090309     IF NOT IAN1I-OK
SLC043        MOVE FAN9Q-C-FINANZ-PRE-O       TO WD-C-FINANZ-PRE
SLC043        MOVE FAN9Q-N-FINANZ-NUM-O       TO WD-N-FINANZ-NUM
090309        MOVE IAN1I-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT        TO TRUE
090309        PERFORM ERRORE-GRAVE
090309     END-IF.

090309******************************************************************
S9K101 REPERIMENTO-DATI-PADRE.
S9K101*
S9K101     MOVE 'REPERIMENTO-DATI-PADRE'  TO IDBGU-X-LABEL-TRAC
S9K101     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S9K101     PERFORM R-TRACE-LABEL
S9K101*
S9K101     INITIALIZE FCONU-G-GROUP-AREA.
S9K101     SET  FCONU-REPERI-001              TO TRUE
S9K101     MOVE FAN9Q-C-GRUPPO-ABI-O       TO FCONU-C-GRUPPO-ABI-I
S9K101     MOVE FAN9Q-C-CODICE-ABI-O       TO FCONU-C-CODICE-ABI-I
S9K101     MOVE FAN9Q-C-FINANZ-PRE-O       TO FCONU-C-FINANZ-PR2-I
S9K101     MOVE FAN9Q-N-FINANZ-NUM-O       TO FCONU-N-FINANZ-NU2-I
S9K101     MOVE FAN9Q-C-CONTRA-PRE-O       TO FCONU-C-CONTRA-PRE-I
S9K101     MOVE FAN9Q-N-CONTRA-NUM-O       TO FCONU-N-CONTRA-NUM-I
S9K101     MOVE EKIFB-D-RIFERI-OPE         TO FCONU-D-RIFERI-OPE-I
S9K101
S9K101     PERFORM CL-EKFCONUB
S9K101
S9K101     IF NOT FCONU-OK
S9K101     AND FCONU-ERR-NON-TROVATO
S9K101        MOVE FCONU-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
S9K101        MOVE FCONU-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
S9K101        PERFORM ERRORE-GRAVE
S9K101     END-IF
S9K101
S9K101     IF FCONU-OK
S9K101        MOVE FCONU-C-DESFIN-APP-O   TO FAN9Q-C-DESFIN-APP-O
S9K101        MOVE FCONU-D-STIPUL-OPE-O   TO FAN9Q-D-STIPUL-OPE-O
S9K101        MOVE FCONU-D-STIPUL-CON-O   TO FAN9Q-D-STIPUL-CON-O
S9K101        MOVE FCONU-I-STIPUL-FIN-O   TO FAN9Q-I-STIPUL-FIN-O
S9K101        MOVE FCONU-D-EROGAZ-OPE-O   TO FAN9Q-D-EROGAZ-OPE-O
S9K101        MOVE FCONU-D-EROGAZ-CON-O   TO FAN9Q-D-EROGAZ-CON-O
S9K101        MOVE FCONU-I-EROGAZ-FIN-O   TO FAN9Q-I-EROGAZ-FIN-O
S9K101        MOVE FCONU-C-DESFIN-APP-O   TO FAN00-C-DESFIN-APP
S9K101        MOVE FCONU-D-STIPUL-OPE-O   TO FAN00-D-STIPUL-OPE
S9K101        MOVE FCONU-D-STIPUL-CON-O   TO FAN00-D-STIPUL-CON
S9K101        MOVE FCONU-I-STIPUL-FIN-O   TO FAN00-I-STIPUL-FIN
S9K101        MOVE FCONU-D-EROGAZ-OPE-O   TO FAN00-D-EROGAZ-OPE
S9K101        MOVE FCONU-D-EROGAZ-CON-O   TO FAN00-D-EROGAZ-CON
S9K101        MOVE FCONU-I-EROGAZ-FIN-O   TO FAN00-I-EROGAZ-FIN
SLE052        MOVE FCONU-C-DIVISA-OPE-O   TO W-C-DIVISA-ORIG
S9K101     END-IF
S9K101     .
      *
      *
090309 CARICA-DATI-CORRISPONDENZA.
090309*---------------------------
090309     MOVE 'CARICA-DATI-CORRISPONDENZA'   TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                              TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
SKK132*090309     INITIALIZE CCOCMAIL-INPUT
090325     INITIALIZE PAPY-CCOC003
090325     INITIALIZE CCOC003
090325     PERFORM REPERIMENTO-DATI-ANA
090309     MOVE FCEI1-N-FINANZ-NUM        TO NEW-NUMFIN-L
090325     PERFORM CARICA-CCOC003.
090309*
090309* se non sono valorizzati fil e conto significa che il cliente
090309* non ha conto corrente e quindi va utilizzato indirizzo
090309* estratto dalla procedura mutui e che sara' presente sul
090309* RECORD M - N IN FILLER-11 FA CAPIRE CHE NON VA STAMPATO
090309* L'INDIRIZZO DEL RECORD L MA DEL RECORD M
090309*
090309*    IF  FIL-CC = ZEROES AND
090309*        CONTO-CC = ZEROES
090309*       DISPLAY 'FAN9Q-C-COOPAG-CAB-O :' FAN9Q-C-COOPAG-CAB-O
090309*       DISPLAY 'FAN9Q-C-COOPAG-NUM-O :' FAN9Q-C-COOPAG-NUM-O
090309**   IF  (FAN9Q-C-COOPAG-CAB-O  NOT NUMERIC)   OR
090309**       (FAN9Q-C-COOPAG-NUM-O  NOT NUMERIC)
090309**       MOVE 'N' TO FILLER-11
090309**       MOVE SPACES  TO PAPY-CCOC003
090309**       MOVE SPACES  TO CCOC003
090309**       MOVE FAN9Q-C-NDGNDG-COD-O    TO CCOC003-CODICE-NDG
090309**       MOVE ZERO             TO CCOC003-FILIALE
090309**       MOVE ZERO             TO CCOC003-CONTO
090309**       MOVE CCOC003 TO PAPY-CCOC003
090309**   ELSE
090309**
090309**      MOVE FAN9Q-C-COOPAG-CAB-O   TO CCOCMAIL-I-FILIALE
090309**      MOVE FAN9Q-C-COOPAG-NUM-O   TO CCOCMAIL-I-CONTO
090309**      DISPLAY 'CCOCMAIL-I-FILIALE :'  CCOCMAIL-I-FILIALE
090309**      DISPLAY 'CCOCMAIL-I-CONTO :'CCOCMAIL-I-CONTO
090309**
090309**      CALL CCOCMAIL-ROUTINE-BT USING CCOCMAIL
090309**      IF CCOCMAIL-O-RC-OK
090309**         SET SI-ELAB            TO TRUE
090309**         ADD 1                  TO CCOMAIL-RD
090309**         PERFORM CARICA-CCOC003
090309**      ELSE
090309**         IF CCOCMAIL-O-RC-KO-NFD
090309**            DISPLAY 'CONTO NON TROVATO SU CCORMAIL '
090309**                     FIL-CC '-' CONTO-CC
090309**            ADD 1                  TO CCOMAIL-NF
090309**            SET SI-ELAB            TO TRUE
090309**            MOVE 'N' TO FILLER-11
090309**            MOVE SPACES  TO PAPY-CCOC003
090309**            MOVE SPACES  TO CCOC003
090309**            MOVE FAN9Q-C-NDGNDG-COD-O TO CCOC003-CODICE-NDG
090309**            MOVE ZERO                 TO CCOC003-FILIALE
090309**            MOVE ZERO                 TO CCOC003-CONTO
090309**            MOVE CCOC003 TO PAPY-CCOC003
090309**         ELSE
090309**            DISPLAY 'ERRORE CALL ROUTINE CCORMAIL'
090309**            DISPLAY CCOCMAIL-O-RC-DESC-1
090309**            DISPLAY CCOCMAIL-O-RC-DESC-2
090309**            MOVE '0011'          TO EKERR-C-COD-ERRORE(1)
090309**            MOVE '0097'          TO EKERR-C-RIF-ERRORE(1)
090309**            MOVE CCOCMAIL-O-RC-DESC-1
090309**                                 TO EKERR-X-DES-ERRORE(1)
090309**            PERFORM ERRORE-GRAVE
090309**         END-IF
090309**      END-IF
090309**   END-IF.
090309**

090325 REPERIMENTO-DATI-ANA.
090325     MOVE 'REPERIMENTO-DATI-ANA'    TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325*    INITIALIZE FAN00-G-AREA-FAN
090325*    MOVE FAN9Q-G-AREA-O            TO FAN00-G-AREA-FAN
090325     MOVE SPACE                     TO W-PROVENIENZA-DATI-ANA
090325
090417     MOVE 'N'              TO FILLER-11
      *
      *    display 'FAN00-N-FINANZ-NUM :'FAN00-N-FINANZ-NUM
      *    display 'FAN00-C-PAGRAT-MOD :'FAN00-C-PAGRAT-MOD
090325     EVALUATE FAN00-C-PAGRAT-MOD
090325      WHEN 'A'
090325         PERFORM CTRL-FIL-NUM-CC
SID191* CHIAMATA ALLA ROUTINE ANWC0302
SJC152*SID191         PERFORM CHIAMA-ROUTINE-ANWC0302
SJC152*SID191 IF (ANWC0302-S-CDRETCOD-OK OR ANWC0302-S-CDRETCOD-WRN)
anto ?***      AND CCOCMAIL-CODICE-NDG = FAN00-C-NDGNDG-COD
SID191*        DISPLAY 'ANWC0302 - CHIAMATA OK'
SJC152*SID191            SET DATI-DA-ANWC0302      TO TRUE
SJC152*SID191            MOVE 'S'              TO FILLER-11
SID191*090325* CHIAMATA ALLA ROUTINE CORRISPONDENZA CCORMAIL:
SID191*090325         PERFORM CALL-ROUTINE-CORRISPONDENZA
SID191*090325         IF  CCOCMAIL-O-RC-OK
SID191*090325         AND CCOCMAIL-CODICE-NDG = FAN00-C-NDGNDG-COD
SID191*                  DISPLAY 'NO CCORMAIL'
SID191*090325            SET DATI-DA-CCORMAIL      TO TRUE
SID191*090417            MOVE 'S'              TO FILLER-11
SJC152*        CHIAMATA ALLA ROUTINE CORRISPONDENZA CCORMAIL:
SKK132*SJC152         PERFORM CALL-ROUTINE-CORRISPONDENZA
SKK132*SJC152         IF  CCOCMAIL-O-RC-OK
SKK132*SJC152         AND CCOCMAIL-CODICE-NDG = FAN00-C-NDGNDG-COD
SJC152*            DISPLAY 'NO CCORMAIL'
SKK132*SJC152             SET DATI-DA-CCORMAIL      TO TRUE
SKK132         PERFORM CHIAMA-ANWR253
SKK132         IF IAN9I-OK
               AND IAN9I-C-NDGNDG-COD-O = FAN00-C-NDGNDG-COD
SKK132            SET DATI-DA-IAN9I     TO TRUE
SJC152             MOVE 'S'              TO FILLER-11
090325         ELSE
DEB>>>*         IF ANA-SI
090325           PERFORM RECUPERA-ANAG-TITOLARE-FINANZ
090325           SET DATI-DA-ANAGRAFE   TO TRUE
DEB>>>*          END-IF
090325         END-IF
090325
090325*     WHEN 'O'
090325      WHEN OTHER
090325* (CASSA E RID)
DEB>>>*       IF ANA-SI
090325         PERFORM RECUPERA-ANAG-TITOLARE-FINANZ
090325         SET DATI-DA-ANAGRAFE         TO TRUE
DEB>>>*       END-IF
090325     END-EVALUATE
090325
      *    DISPLAY 'FILLER-11 :' FILLER-11

090325     IF DATI-DA-ANAGRAFE
090325        IF AGR33-O-IC-UIC NOT EQUAL '086'
090325           DISPLAY 'ATTENZIONE| NDG: ' FAN00-C-NDGNDG-COD
090325                   ' --> AGR33-O-IC-UIC : ' AGR33-O-IC-UIC
090325        END-IF
090325     END-IF
090325     .
090325
090325 CTRL-FIL-NUM-CC.
090325     MOVE 'CTRL-FIL-NUM-CC'         TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325     IF (FAN00-C-COOPAG-CAB = SPACES OR LOW-VALUE)
090325*       MOVE '0499'               TO EKERR-C-COD-ERRORE(1)
090325        MOVE '0803'                 TO EKERR-C-COD-ERRORE(1)
090325        SET EKERR-ERR-GENERICO      TO TRUE
090325        MOVE 'FAN00-C-COOPAG-CAB'   TO EKERR-X-DES-ERRORE(1)
090325        MOVE 'FAN00-C-COOPAG-CAB'   TO EKERR-X-DAT-ERRATO(1)
090325        MOVE '0001'                 TO EKERR-C-RIF-ERRORE(1)
090325        PERFORM ERRORE-GRAVE
090325     END-IF
090325     IF (FAN00-C-COOPAG-NUM = SPACES OR LOW-VALUE)
090325        MOVE '0803'                 TO EKERR-C-COD-ERRORE(1)
090325        SET EKERR-ERR-GENERICO      TO TRUE
090325        MOVE 'FAN00-C-COOPAG-NUM'   TO EKERR-X-DES-ERRORE(1)
090325        MOVE 'FAN00-C-COOPAG-NUM'   TO EKERR-X-DAT-ERRATO(1)
090325        MOVE '0002'                 TO EKERR-C-RIF-ERRORE(1)
090325        PERFORM ERRORE-GRAVE
090325     END-IF
090325     .
090325
SKK132*090325 CALL-ROUTINE-CORRISPONDENZA.
SKK132*090325   MOVE 'CALL-ROUTINE-CORRISPONDENZA' TO IDBGU-X-LABEL-TRAC
SKK132*090325     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKK132*090325     PERFORM R-TRACE-LABEL.
SKK132*090325
SKK132*090325     INITIALIZE                     CCOCMAIL-INPUT
SKK132*090325     MOVE FAN00-C-COOPAG-CAB     TO CCOCMAIL-I-FILIALE
SKK132*
SKK132*S2B161     IF   FAN00-C-COOPAG-NUM(12:1) = SPACE
SKK132*S2B161          INITIALIZE INUMU-G-GROUP-AREA
SKK132*S2B161          SET INUMU-CTRL-NUMERO         TO TRUE
SKK132*S2B161       MOVE 0                        TO INUMU-N-DECIMA-TOT
SKK132*S2B161       MOVE FAN00-C-COOPAG-NUM       TO INUMU-V-NUMERO-ALF
SKK132*S2B161          PERFORM CL-EKINUMUB
SKK132*S2B161          IF NOT INUMU-OK
SKK132*S2B161          MOVE INUMU-G-ESITO-AREA    TO EKERR-G-ESITO-AREA
SKK132*S2B161             SET EKERR-ERR-DATI-INPUT   TO TRUE
SKK132*S2B161             PERFORM ERRORE-GRAVE
SKK132*S2B161          ELSE
SKK132*S2B161             MOVE INUMU-N-NUMERO-D00    TO W-N-CONTO-12
SKK132*S2B161             MOVE W-N-CONTO-12          TO CCOCMAIL-I-CONTO
SKK132*S2B161          END-IF
SKK132*S2B161     ELSE
SKK132*090325        MOVE FAN00-C-COOPAG-NUM         TO CCOCMAIL-I-CONTO
SKK132*S2B161     END-IF
SKK132*
SKK132*090325     CALL CCOCMAIL-ROUTINE-BT USING CCOCMAIL
SKK132*090325
SKK132*090325     IF NOT  CCOCMAIL-O-RC-OK
SKK132*090325     AND NOT CCOCMAIL-O-RC-KO-NFD
SKK132*090325        DISPLAY 'ERRORE CALL ROUTINE CCORMAIL'
SKK132*090325        DISPLAY 'CHIAVE: ' WD-CHIAVE-MSG
SKK132*090325        DISPLAY 'ESITO : ' CCOCMAIL-O-RC
SKK132*090325        DISPLAY 'DESC-1: ' CCOCMAIL-O-RC-DESC-1
SKK132*090325        DISPLAY 'DESC-2: ' CCOCMAIL-O-RC-DESC-2
SKK132*090325        MOVE '0910'                TO EKERR-C-COD-ERRORE(1)
SKK132*090325        MOVE '0001'                TO EKERR-C-RIF-ERRORE(1)
SKK132*090325   MOVE CCOCMAIL-O-RC         TO EKERR-X-DES-ERRORE(1)(1:2)
SKK132*090325  MOVE CCOCMAIL-O-RC-DESC-1  TO EKERR-X-DES-ERRORE(1)(3:20)
SKK132*090325 MOVE CCOCMAIL-O-RC-DESC-2  TO EKERR-X-DES-ERRORE(1)(23:20)
SKK132*090325        PERFORM ERRORE-GRAVE
SKK132*090325     END-IF
SKK132*090325     .
090325*
090325 RECUPERA-ANAG-TITOLARE-FINANZ.
090325     MOVE 'RECUPERA-ANAG-TITOLARE-FINANZ' TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                           TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325* CHIAMATA AD ANAGRAFE PER AVERE I DATI DELL'NDG DEL MUTUO
090325* NB: CHIAMO DIRETTAMENTE I MODLULI DI ANAGRAFE AGR033 E AGR080
090325* PERCHE' MI SERVONO DEI DATI CHE I MODULI INTERFACCIA ELISE DI
090325* CHIAMATA ALL'ANAGRAFE (EKIAN...) NON RESTITUISCONO.
090325
090325**** CHIAMATA A AGR0033
090325     INITIALIZE                          AGR33-AREA
090325     MOVE FAN00-C-NDGNDG-COD          TO AGR33-I-NDG
090325     PERFORM CL-AGR0033
090325
090325     EVALUATE AGR33-S-FLAG
090325      WHEN '0'
090325         PERFORM CHIAMATA-AGR80
090325      WHEN '1'
090325        MOVE '0414'                   TO EKERR-C-COD-ERRORE(1)
090325        SET EKERR-ERR-GENERICO        TO TRUE
090325*  NDG NON PRESENTE IN ANAGRAFE
090325        MOVE AGR33-I-NDG              TO EKERR-X-DES-ERRORE(1)
090325        MOVE 'AGR33-I-NDG'            TO EKERR-X-DAT-ERRATO(1)
090325        MOVE '0001'                   TO EKERR-C-RIF-ERRORE(1)
090325        PERFORM ERRORE-GRAVE
090325      WHEN OTHER
090325         MOVE '0410'                  TO EKERR-C-COD-ERRORE(1)
090325         SET EKERR-ERR-GENERICO       TO TRUE
090325         STRING AGR33-S-FLAG
090325                ': ERRORE DI MODULO'
090325                DELIMITED BY SIZE
090325                                    INTO EKERR-X-DES-ERRORE(1)
090325         MOVE 'AGR33-I-NDG'           TO EKERR-X-DAT-ERRATO(1)
090325         MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
090325         PERFORM ERRORE-GRAVE
090325     END-EVALUATE
090325     .
090325
090325 CHIAMATA-AGR80.
090325     MOVE 'CHIAMATA-AGR80'            TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                           TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325**** CHIAMATA A AGR0080
090325     INITIALIZE                      AGR80-AREA
090325     IF AGR33-O-NGIURI = 'PF   '
090325        MOVE AGR33-O-COGNO    TO     AGR80-I-COGNO
090325        MOVE AGR33-O-NOME     TO     AGR80-I-NOME
090325     ELSE
090325        IF AGR33-O-NGIURI = 'COI'
090325           MOVE AGR33-O-DESCO TO     AGR80-I-DESCO
090325        ELSE
090325           MOVE AGR33-O-RAGIO TO     AGR80-I-RAGIO
090325        END-IF
090325     END-IF
090325     MOVE FAN00-C-NDGNDG-COD  TO AGR80-I-NDG
090325     MOVE AGR33-O-NGIURI      TO AGR80-I-NGIURI
090325     MOVE AGR33-O-IC-DOM      TO AGR80-I-DOM
090325     MOVE AGR33-O-IC-STR      TO AGR80-I-STR
090325     MOVE AGR33-O-IC-DES      TO AGR80-I-DES
090325     MOVE AGR33-O-IC-NUM      TO AGR80-I-NUM
090325     MOVE AGR33-O-IC-INT      TO AGR80-I-INT
090325     MOVE AGR33-O-IC-SCA      TO AGR80-I-SCA
090325     MOVE AGR33-O-IC-CF       TO AGR80-I-CF
090325     MOVE AGR33-O-IC-FRA      TO AGR80-I-FRA
090325     MOVE AGR33-O-IC-QUA      TO AGR80-I-QUA
090325     MOVE AGR33-O-IC-CAP      TO AGR80-I-CAP
090325     MOVE AGR33-O-IC-LOC      TO AGR80-I-LOC
090325     MOVE AGR33-O-IC-PRO      TO AGR80-I-PRO
090325     MOVE AGR33-O-IC-NAZ      TO AGR80-I-NAZ
090325     MOVE 'NO'                TO AGR80-I-NO-DENCO
090325     MOVE 'SI'                TO AGR80-I-SI-PRO
090325
090325     PERFORM CL-AGR0080
090325
090325     EVALUATE AGR80-S-FLAG
090325       WHEN '0'
090325         CONTINUE
090325       WHEN '1'
090325         MOVE '0414'                   TO EKERR-C-COD-ERRORE(1)
090325         SET EKERR-ERR-GENERICO        TO TRUE
090325*  NDG NON PRESENTE IN ANAGRAFE
090325         MOVE AGR80-I-NDG              TO EKERR-X-DES-ERRORE(1)
090325         MOVE 'AGR80-I-NDG'            TO EKERR-X-DAT-ERRATO(1)
090325         MOVE '0002'                   TO EKERR-C-RIF-ERRORE(1)
090325         PERFORM ERRORE-GRAVE
090325       WHEN OTHER
090325         MOVE '0410'                  TO EKERR-C-COD-ERRORE(1)
090325         SET EKERR-ERR-GENERICO       TO TRUE
090325         STRING AGR80-S-FLAG
090325                ': ERRORE DI MODULO'
090325                DELIMITED BY SIZE
090325                                    INTO EKERR-X-DES-ERRORE(1)
090325         MOVE 'AGR80-I-NDG'           TO EKERR-X-DAT-ERRATO(1)
090325         MOVE '0002'                  TO EKERR-C-RIF-ERRORE(1)
090325         PERFORM ERRORE-GRAVE
090325     END-EVALUATE.
090325     .
090325
090325*
090309******************************************************************
090309 CARICA-CCOC003.
090309*---------------

SID191     IF DATI-DA-ANWC0302
SID191        MOVE FAN00-C-COOPAG-CAB      TO CCOC003-FILIALE
SID191        MOVE FAN00-C-COOPAG-NUM      TO CCOC003-CONTO
SID191        MOVE ANWC0302-O-CCLNDGXX     TO CCOC003-CODICE-NDG
SID191        MOVE ANWC0302-O-DENOM1       TO CCOC003-ANAGRAFICA-1
SID191        MOVE ANWC0302-O-DENOM2       TO CCOC003-ANAGRAFICA-2
SID191        IF ANWC0302-O-INFO-AGG NOT EQUAL SPACE
SID191           MOVE ANWC0302-O-INFO-AGG  TO CCOC003-SOTTOINTESTAZIONE
SID191        END-IF
SID191        IF ANWC0302-O-CASELLA-POSTAMANO NOT EQUAL SPACE
SID191        MOVE ANWC0302-O-CASELLA-POSTAMANO
SID191                                     TO CCOC003-SOTTOINTESTAZIONE
SID191        END-IF
SID191        IF ANWC0302-O-PRESSO NOT EQUAL SPACE
SID191           MOVE ANWC0302-O-PRESSO    TO CCOC003-SOTTOINTESTAZIONE
SID191        END-IF
SID191        MOVE ANWC0302-O-STRADA       TO CCOC003-INDIRIZZO
SID191        MOVE ANWC0302-O-CAP          TO CCOC003-CAP
SID191        MOVE ANWC0302-O-LOCALITA     TO CCOC003-LOCALITA
SID191        MOVE ANWC0302-O-PROVINCIA    TO CCOC003-PROVINCIA
SID191        MOVE ANWC0302-O-TIPO-SPEDIZIONE TO CCOC003-TIPO-SPEDIZIONE
SID191        MOVE SPACE                   TO CCOC003-CODICE-BLOCCO
SID191        MOVE SPACE                   TO CCOC003-CATEGORIA-BPS
SID191        MOVE SPACE                   TO CCOC003-COD-CATEGORIA
SID191        MOVE SPACE                   TO CCOC003-CONVENZIONE
SID191        MOVE SPACE                   TO CCOC003-CODICE-PARAMETRO
SID191        MOVE ANWC0302-O-CSESOTGR     TO CCOC003-CODICE-SETTORE
SID191        MOVE ANWC0302-O-CGRGRUPP     TO CCOC003-CODICE-RAMO
SID191        MOVE ANWC0302-O-CCLGIURI     TO CCOC003-NATURA-GIURIDICA
SID191        MOVE ANWC0302-O-CCLSESSO     TO CCOC003-SESSO
SID191        MOVE ANWC0302-O-UIC          TO CCOC003-CODICE-UIC-POSTA
SID191        MOVE ANWC0302-O-CCLLINGU     TO CCOC003-LINGUA
SID191        MOVE ANWC0302-O-ALLEGATO-PUBBL TO CCOC003-ALLEGATO-PUBBL
SID191        MOVE SPACE                   TO CCOC003-CODICE-IBAN
SID191        MOVE CCOC003 TO PAPY-CCOC003
SID191     ELSE
SKK132*080325     IF DATI-DA-CCORMAIL
SKK132*090309      MOVE CCOCMAIL-I-FILIALE         TO CCOC003-FILIALE
SKK132*090309      MOVE CCOCMAIL-I-CONTO           TO CCOC003-CONTO
SKK132*090309      MOVE CCOCMAIL-CODICE-NDG        TO CCOC003-CODICE-NDG
SKK132*090309    MOVE CCOCMAIL-ANAGRAFICA-1      TO CCOC003-ANAGRAFICA-1
SKK132*090309    MOVE CCOCMAIL-ANAGRAFICA-2      TO CCOC003-ANAGRAFICA-2
SKK132*090309MOVE CCOCMAIL-SOTTOINTESTAZIONE TOCCOC003-SOTTOINTESTAZIONE
SKK132*090309      MOVE CCOCMAIL-INDIRIZZO         TO CCOC003-INDIRIZZO
SKK132*090309      MOVE CCOCMAIL-CAP               TO CCOC003-CAP
SKK132*090309      MOVE CCOCMAIL-LOCALITA          TO CCOC003-LOCALITA
SKK132*090309      MOVE CCOCMAIL-PROVINCIA         TO CCOC003-PROVINCIA
SKK132*090309 MOVE CCOCMAIL-TIPO-SPEDIZIONE   TO CCOC003-TIPO-SPEDIZIONE
SKK132*090309   MOVE CCOCMAIL-CODICE-BLOCCO     TO CCOC003-CODICE-BLOCCO
SKK132*090309   MOVE CCOCMAIL-CATEGORIA-BPS     TO CCOC003-CATEGORIA-BPS
SKK132*090309   MOVE CCOCMAIL-COD-CATEGORIA     TO CCOC003-COD-CATEGORIA
SKK132*090309     MOVE CCOCMAIL-CONVENZIONE       TO CCOC003-CONVENZIONE
SKK132*090309MOVE CCOCMAIL-CODICE-PARAMETRO  TO CCOC003-CODICE-PARAMETRO
SKK132*090309  MOVE CCOCMAIL-CODICE-SETTORE    TO CCOC003-CODICE-SETTORE
SKK132*090309     MOVE CCOCMAIL-CODICE-RAMO       TO CCOC003-CODICE-RAMO
SKK132*090309MOVE CCOCMAIL-NATURA-GIURIDICA  TO CCOC003-NATURA-GIURIDICA
SKK132*090309      MOVE CCOCMAIL-SESSO             TO CCOC003-SESSO
SKK132*090309MOVE CCOCMAIL-CODICE-UIC-POSTA  TO CCOC003-CODICE-UIC-POSTA
SKK132*090309      MOVE CCOCMAIL-LINGUA            TO CCOC003-LINGUA
SKK132*090309  MOVE CCOCMAIL-ALLEGATO-PUBBL    TO CCOC003-ALLEGATO-PUBBL
SKK132*090309     MOVE CCOCMAIL-CODICE-IBAN       TO CCOC003-CODICE-IBAN
SKK132*090309      MOVE CCOC003 TO PAPY-CCOC003
SKK132     IF DATI-DA-IAN9I
            DISPLAY 'Recupero dati da IAN9I'
SKK132      MOVE IAN9I-C-FILIAL-COD-I       TO CCOC003-FILIALE
SKK132      MOVE IAN9I-C-COOGEN-NUM-I       TO CCOC003-CONTO
SKK132      MOVE IAN9I-C-NDGNDG-COD-O       TO CCOC003-CODICE-NDG
SKK132      MOVE IAN9I-X-INDIRI-ET1-O       TO CCOC003-ANAGRAFICA-1
SKK132      MOVE IAN9I-X-INDIRI-ET2-O       TO CCOC003-ANAGRAFICA-2
SKK132      MOVE IAN9I-C-CASPOS-COD-O       TO CCOC003-SOTTOINTESTAZIONE
SKK132      MOVE IAN9I-X-INDIRI-ET3-O       TO CCOC003-INDIRIZZO
SKK132      MOVE IAN9I-C-CORNDG-CAP-O       TO CCOC003-CAP
SKK132      MOVE IAN9I-X-INDIRI-ET4-O       TO CCOC003-LOCALITA
SKK132      MOVE IAN9I-C-RESIDE-PRO-O       TO CCOC003-PROVINCIA
SKK132      MOVE IAN9I-C-TIPSPE-COD-O       TO CCOC003-TIPO-SPEDIZIONE
SKK132      MOVE SPACES                     TO CCOC003-CODICE-BLOCCO
SKK132      MOVE SPACES                     TO CCOC003-CATEGORIA-BPS
SKK132      MOVE SPACES                     TO CCOC003-COD-CATEGORIA
SKK132      MOVE SPACES                     TO CCOC003-CONVENZIONE
SKK132      MOVE SPACES                     TO CCOC003-CODICE-PARAMETRO
SKK132      MOVE SPACES                     TO CCOC003-CODICE-SETTORE
SKK132      MOVE SPACES                     TO CCOC003-CODICE-RAMO
SKK132      MOVE IAN9I-C-NGIURI-COD-O       TO CCOC003-NATURA-GIURIDICA
SKK132      MOVE IAN9I-C-SESSO-FLAG-O       TO CCOC003-SESSO
SKK132      MOVE IAN9I-C-CODICE-UIC-O       TO CCOC003-CODICE-UIC-POSTA
SKK132      MOVE IAN9I-C-LINGUA-COD-O       TO CCOC003-LINGUA
SKK132      MOVE SPACES                     TO CCOC003-ALLEGATO-PUBBL
SKK132      MOVE SPACES                     TO CCOC003-CODICE-IBAN
            MOVE IAN9I-X-INDIRI-ET5-O       TO CCOC003-NAZIONE
            MOVE IAN9I-C-INFAGG-DES-O       TO CCOC003-INFO
SKK132      MOVE CCOC003                    TO PAPY-CCOC003
090309     ELSE
090309      MOVE ZEROES                     TO CCOC003-FILIALE
090309      MOVE ZEROES                     TO CCOC003-CONTO
090309      MOVE FAN00-C-NDGNDG-COD         TO CCOC003-CODICE-NDG
090309      MOVE AGR80-O-INT-R1             TO CCOC003-ANAGRAFICA-1
090309      MOVE AGR80-O-INT-R2             TO CCOC003-ANAGRAFICA-2
090309      MOVE SPACES                     TO CCOC003-SOTTOINTESTAZIONE
090309      MOVE AGR80-O-IND-R              TO CCOC003-INDIRIZZO
090309      MOVE AGR80-O-LOC-E(1:5)         TO CCOC003-CAP
S1G201*     MOVE AGR80-O-LOC-E(6:30)        TO CCOC003-LOCALITA
S1G201*     MOVE AGR80-O-LOC-E(7:30)        TO CCOC003-LOCALITA
SJC152*SG0518      MOVE AGR80-O-LOC-E              TO CCOC003-LOCALITA
SJC152*     MOVE AGR80-O-LOC-E(7:30)        TO CCOC003-LOCALITA
SJC152      MOVE AGR80-O-LOC-E              TO CCOC003-LOCALITA
090309      MOVE AGR33-O-IC-PRO             TO CCOC003-PROVINCIA
100318*- AGGIUNTA FORZATURA A 'P' IN CORRISPONDENZA DELLE MODIFICHE
100318*- PER CERTIFICAZIONE INTERESSI REALIZZATE CON DATA VALUTA
100318*- PIUTTOSTO CHE CON DATA CONTABILE RELATIVAMENTE AL 2009
100318      MOVE 'P'                        TO CCOC003-TIPO-SPEDIZIONE
090309      MOVE SPACES                     TO CCOC003-CODICE-BLOCCO
090309      MOVE SPACES                     TO CCOC003-CATEGORIA-BPS
090309      MOVE SPACES                     TO CCOC003-COD-CATEGORIA
090309      MOVE SPACES                     TO CCOC003-CONVENZIONE
090309      MOVE SPACES                     TO CCOC003-CODICE-PARAMETRO
090309      MOVE AGR33-O-SETT1              TO CCOC003-CODICE-SETTORE
090309      MOVE AGR33-O-RAMO1              TO CCOC003-CODICE-RAMO
090309      MOVE AGR33-O-NGIURI             TO CCOC003-NATURA-GIURIDICA
090309      MOVE AGR33-O-SESSO              TO CCOC003-SESSO
090309      MOVE AGR33-O-IC-UIC             TO CCOC003-CODICE-UIC-POSTA
090309      MOVE AGR33-O-LINGU              TO CCOC003-LINGUA
090309      MOVE SPACES                     TO CCOC003-ALLEGATO-PUBBL
090309      MOVE SPACES                     TO CCOC003-CODICE-IBAN
            MOVE SPACES                     TO CCOC003-NAZIONE
            MOVE SPACES                     TO CCOC003-INFO
090309      MOVE CCOC003                    TO PAPY-CCOC003
090309     END-IF.
090309*
SGB012*- Produzione lettera per 'PF' e AGRARI:
SGB012     IF CCOC003-NATURA-GIURIDICA = 'PF'
SGB012     OR FAN00-C-TIPO-FINAN = 'AGR'
SGC072     OR FAN00-C-TIPO-FINAN = 'MAG'
SGB012        CONTINUE
SGB012     ELSE
SGB012        IF IAN1I-C-NGIURI-COD-O = 'COI'
SGB012           SET TROVATO-PF-NO          TO TRUE
SGB012
SGB012           PERFORM ESTRAI-NDG-COLLEGATI
SGB012
SGB012           PERFORM VARYING W-I FROM 1 BY 1
SGB012           UNTIL W-I > W-N-LUNGH-IAN
SGB012           OR IAN3I-C-NDGNDG-COD-O(W-I) NOT > SPACES
SGB012           OR TROVATO-PF-SI
SGB012              INITIALIZE                 W-IAN1I-G-AREA-APPO
SGB012              MOVE IAN1I-G-AREA       TO W-IAN1I-G-AREA-APPO
DEB>>>*             IF ANA-SI
SGB012              PERFORM REPER-INTEST-COI
DEB>>>*             END-IF
SGB012              IF IAN1I-C-NGIURI-COD-O = 'PF'
SGB012                 SET TROVATO-PF-SI    TO TRUE
SGB012              END-IF
SGB012           END-PERFORM
SGB012
SGB012           IF NOT TROVATO-PF-SI
SGC072*SGB012       MOVE '4'                TO CCOC003-TIPO-SPEDIZIONE
SGC072              MOVE 'E'                TO CCOC003-TIPO-SPEDIZIONE
SGB012           END-IF
SGB012
SGB012           MOVE W-IAN1I-G-AREA-APPO   TO IAN1I-G-AREA
SGB012        ELSE
SGC072*SGB012       MOVE '4'                TO CCOC003-TIPO-SPEDIZIONE
SGC072              MOVE 'E'                TO CCOC003-TIPO-SPEDIZIONE
SGB012        END-IF
SGB012     END-IF
SGB012     MOVE CCOC003                     TO PAPY-CCOC003
SGB012     .

090309
090309 VALORIZZA-FANT1.
090309     MOVE 'VALORIZZA-FANT1'         TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
SGB012*- Scrittura flussi: - FANT1
SGB012*-                   - SONCO x ANAGRAFE TRIBUTARIA
SGB012*-                     (solo se C-NGIURI-COD-O = 'COI' o 'PF')
DEB>>>*    DISPLAY 'VALORIZZA-FANT1 E SONCO: ' FCEI1-C-FINANZ-PRE'/'
DEB>>>*                                        FCEI1-N-FINANZ-NUM

AGGTRI     INITIALIZE SONCORR2
SKA292     INITIALIZE SONCOR22
S1C251*    INITIALIZE S1-RECORD-DETTAGLIO
S1C251*    MOVE SPACES                    TO SO-CODICE-CARTOL
S1C251*    MOVE SPACES                    TO FILLER-2
S1C251*    MOVE '1'                       TO SO-TIPO-REC
S1C251*    MOVE FCEI1-C-FINANZ-PRE(1:3)   TO SO-FINANZ-PRE
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM


S1C251*    IF FCEI1-F-AGEVOL-FIN = 'S'
S1C251*      MOVE 1                         TO SO-AGEVOLATO
S1C251*      MOVE 1                         TO SO-TIPO-PREST-MUTUO
S1C251*    ELSE
S1C251*      MOVE 0                         TO SO-AGEVOLATO
S1C251*      MOVE 2                         TO SO-TIPO-PREST-MUTUO
S1C251*    END-IF

S1C251*    IF   FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
S1C251*         MOVE FAN9Q-D-STIPUL-OPE-O      TO W-APPO-DATA-X
S1C251*         MOVE FAN9Q-I-STIPUL-FIN-O      TO SO-IMPORIG-PREST
S1C251*         COMPUTE SO-IMPORIG-PREST ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251*         COMPUTE SO-IMPORIG-PREST = SO-IMPORIG-PREST * 100
S1C251*    ELSE
S1C251*         MOVE FAN9Q-D-EROGAZ-OPE-O      TO W-APPO-DATA-X
S1C251*         MOVE FAN9Q-I-EROGAZ-FIN-O      TO SO-IMPORIG-PREST
S1C251*         COMPUTE SO-IMPORIG-PREST ROUNDED = FAN9Q-I-EROGAZ-FIN-O
S1C251*         COMPUTE SO-IMPORIG-PREST = FAN9Q-I-EROGAZ-FIN-O * 100
S1C251*    END-IF

S1C251*    MOVE W-APPX-GG             TO W-APP9-GG
S1C251*    MOVE W-APPX-MM             TO W-APP9-MM
S1C251*    MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*    MOVE W-APP9-GG         TO SO-DATA-EROGAZIONE(1:2)
S1C251*    MOVE W-APP9-MM         TO SO-DATA-EROGAZIONE(3:2)
S1C251*    MOVE W-APP9-SSAA       TO SO-DATA-EROGAZIONE(5:4)

S1C251*    COMPUTE SO-IMPCORR-ANNO ROUNDED = APPO-I-VOCE0 +
S1C251*                                      APPO-I-VOCE7 +
S1C251*                                      APPO-I-VOCE2 +
S1C251*                                      APPO-I-VOCE3
S1C251*                                                   ) * 100
S1C251*                                      APPO-I-VOCE8 ) * 100
S1C251*    MOVE ZEROES                    TO SO-PROGR-COINTEST
S1C251*    MOVE ZEROES                    TO SO-PROG-KEY
S1C251*    MOVE ZEROES                    TO SO-NUMERO-INTESTAT
S1C251*    MOVE SPACES                    TO SO-CODFISC-INTESTAT
S1C251*    MOVE SPACES                    TO SO-COGNOME
S1C251*    MOVE SPACES                    TO SO-NOME
S1C251*    MOVE SPACES                    TO SO-SESSO
S1C251*    MOVE ZEROES                    TO SO-DATA-NASCITA
S1C251*    MOVE SPACES                    TO SO-LUOGO-NASCITA
S1C251*    MOVE SPACES                    TO SO-PROV-NASCITA
S1C251*    MOVE SO-RECORD-DETTAGLIO       TO S1-RECORD-DETTAGLIO
S1C251*    ADD 1                          TO SO-PROGR-RECORD
S1C251*---------------------------------------------------------------*
S1C251*    MOVE '50'                      TO SO-SETTORE
S1C251*    MOVE FCEI1-C-FINFIL-GES(2:)    TO SO-DIPENDENZA
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO SO-COE
S1C251*    MOVE FCEI1-C-NDGNDG-COD(4:)    TO SO-CODICE-RUBRICA
090309
090309     INITIALIZE FANT1-G-APPO-RECORD
090309
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO FANT1-C-CODICE-ABI
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO FANT1-C-GRUPPO-ABI
090309     MOVE FAN9Q-C-FINANZ-PRE-O      TO FANT1-C-FINANZ-PRE
090309     MOVE FAN9Q-N-FINANZ-NUM-O      TO FANT1-N-FINANZ-NUM
090309     MOVE FAN9Q-C-FILIAL-GES-O      TO FANT1-C-FILIAL-GES
090309
090309     INITIALIZE                        IFILI-G-GROUP-AREA
090309     SET IFILI-CTRL-FILIALE         TO TRUE
090309     MOVE FAN9Q-C-FILIAL-GES-O      TO IFILI-C-FILIAL-COD
090309
090309     PERFORM CL-EKIFILIB
090309     IF NOT IFILI-OK
090309        MOVE IFILI-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT    TO TRUE
090309        PERFORM ERRORE-GRAVE
090309     END-IF
090309     MOVE IFILI-C-FILIAL-DEN       TO FANT1-X-FILIAL-GES
090309
090309     MOVE EKSYS-D-SYSTEM-OPE        TO FANT1-D-RIFERI-OPE
090309     MOVE EKIFB-D-RIFERI-OPE(1:4)   TO FANT1-C-ANNOEL-RIF
090309     IF   FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
CORRAD     OR   FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
090309          MOVE FAN9Q-D-STIPUL-OPE-O      TO FANT1-D-EROGAZ-OPE
090309          MOVE FAN9Q-I-STIPUL-FIN-O      TO FANT1-I-MOVIME-ERO
090309     ELSE
090309          MOVE FAN9Q-D-EROGAZ-OPE-O      TO FANT1-D-EROGAZ-OPE
090309          MOVE FAN9Q-I-EROGAZ-FIN-O      TO FANT1-I-MOVIME-ERO
090309     END-IF
090309     MOVE EKSYS-D-SYSTEM-OPE        TO FANT1-D-RIFERI-MOV
090309     MOVE 'NESSUNA       '          TO FANT1-C-TIPAGE-COD
090309     COMPUTE FANT1-I-MOVIME-ONE     = (APPO-I-VOCE0 +
090423                                       APPO-I-VOCE7 +
BPSPER                                       APPO-I-VOCE2 +
BPSPER                                       APPO-I-VOCE3 )
090423*                                      APPO-I-VOCE7 +
090309*                                      APPO-I-VOCE8 )
090309*
090309     MOVE FAN9Q-C-DIVISA-OPE-O      TO  FANT1-C-DIVISA-OPE
090309*
S1C251*    PERFORM REPER-INTEST
S1C251*    IF IAN1I-C-NGIURI-COD-O = 'COI'  OR 'PF'
S1C251*    IF IAN1I-C-NGIURI-COD-O = 'COI'
S1C251*      PERFORM ESTRAI-NDG-COLLEGATI
S1C251*      MOVE IAN3I-N-NDGNDG-LEG-O   TO FANT1-N-COINTE-NUM
S1C251*      MOVE IAN3I-N-NDGNDG-LEG-O   TO SO-NUMERO-INTESTAT
S1C251*      MOVE IAN3I-N-NDGNDG-LEG-O   TO S1-NUMERO-INTESTAT
S1C251*      PERFORM VARYING W-I FROM 1 BY 1
S1C251*      UNTIL W-I > W-N-LUNGH-IAN
S1C251*      OR IAN3I-C-NDGNDG-COD-O(W-I) NOT > SPACES
S1C251*        PERFORM REPER-INTEST-COI
S1C251*        IF IAN1I-C-NGIURI-COD-O = 'PF'
S1C251*        MOVE IAN1I-X-NASCIT-LOC-O TO SO-LUOGO-NASCITA
S1C251*        MOVE IAN1I-X-NASCIT-LOC-O TO S1-LUOGO-NASCITA
S1C251*        MOVE SPACES               TO SO-PROV-NASCITA
S1C251*        PERFORM RECUPERA-PROV-NAS
S1C251*        MOVE W-I                       TO  FANT1-N-COINTE-PRG
S1C251*        MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251*        MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251*        MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251*        MOVE IAN1I-X-NASCIT-LOC-O    TO  FANT1-X-LOCNAS-NDG(6:55)
S1C251*        MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251*        PERFORM SCRITTURA-FANT1
      *******************************************************
S1C251*        IF IAN1I-C-NGIURI-COD-O = 'PF'
S1C251*        MOVE S1-RECORD-DETTAGLIO  TO SO-RECORD-DETTAGLIO
S1C251*        MOVE '1'                       TO SO-TIPO-REC
S1C251*        DISPLAY 'SO-RECORD-DETTAGLIO :' SO-RECORD-DETTAGLIO
S1C251*        MOVE W-I                  TO SO-PROGR-COINTEST
S1C251*        MOVE W-I                  TO SO-PROG-KEY
S1C251*        MOVE IAN1I-C-FISCAL-COD-O TO SO-CODFISC-INTESTAT
S1C251*        MOVE IAN1I-X-COGNOM-DES-O TO SO-COGNOME
S1C251*        MOVE IAN1I-X-NOME-DES-O   TO SO-NOME
S1C251*        MOVE IAN1I-C-PERSON-SEX-O TO SO-SESSO
S1C251*        MOVE IAN1I-D-NASCIT-DAT-O TO W-APPO-DATA-X
S1C251*        MOVE W-APPX-GG             TO W-APP9-GG
S1C251*        MOVE W-APPX-MM             TO W-APP9-MM
S1C251*        MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*        MOVE W-APP9-GG         TO SO-DATA-NASCITA(1:2)
S1C251*        MOVE W-APP9-MM         TO SO-DATA-NASCITA(3:2)
S1C251*        MOVE W-APP9-SSAA       TO SO-DATA-NASCITA(5:4)
S1C251*        ADD 1                     TO W-N-CONTA-SONC
S1C251*        MOVE W-N-CONTA-SONC       TO SO-PROGR-RECORD
S1C251*        IF SO-PROG-KEY > 1
S1C251*             MOVE  0                        TO SO-IMPCORR-ANNO
S1C251*             MOVE 'E'                       TO SO-TIPO-DIVISA
S1C251*           ELSE
S1C251*           IF FCEI1-C-DIVISA-COD = 'ITL'
S1C251*               MOVE 'L'                       TO SO-TIPO-DIVISA
S1C251*               ADD SO-IMPCORR-ANNO          TO W-IMPCORR-ANNO-LIT
S1C251*           ELSE
S1C251*               MOVE 'E'                       TO SO-TIPO-DIVISA
S1C251*               ADD SO-IMPCORR-ANNO          TO W-IMPCORR-ANNO-EUR
S1C251*           END-IF
S1C251*
S1C251*        END-IF
S1C251*        PERFORM SCRITTURA-SONCO
S1C251*        END-IF
S1C251*       END-PERFORM
S1C251*    ELSE
S1C251*      MOVE IAN1I-X-NASCIT-LOC-O TO SO-LUOGO-NASCITA
S1C251*      MOVE SPACES               TO SO-PROV-NASCITA
S1C251*      PERFORM RECUPERA-PROV-NAS
S1C251*      MOVE 1                         TO  FANT1-N-COINTE-NUM
S1C251*      MOVE 1                         TO  FANT1-N-COINTE-PRG
S1C251*      MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251*      MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251*      MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251*      MOVE IAN1I-X-NASCIT-LOC-O      TO FANT1-X-LOCNAS-NDG(6:55)
S1C251*      MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251*      PERFORM SCRITTURA-FANT1
      *******************************************************
S1C251*      MOVE SO-RECORD-DETTAGLIO  TO SONCORR2
S1C251*      DISPLAY 'SO-RECORD-DETTAGLIO :' SO-RECORD-DETTAGLIO
S1C251*      MOVE 0                    TO SO-PROGR-COINTEST
S1C251*      MOVE 0                    TO SO-PROG-KEY
S1C251*      MOVE 1                    TO SO-NUMERO-INTESTAT
S1C251*      MOVE IAN1I-C-FISCAL-COD-O TO SO-CODFISC-INTESTAT
S1C251*      MOVE IAN1I-X-COGNOM-DES-O TO SO-COGNOME
S1C251*      MOVE IAN1I-X-NOME-DES-O   TO SO-NOME
S1C251*      MOVE IAN1I-C-PERSON-SEX-O TO SO-SESSO
S1C251*      MOVE IAN1I-D-NASCIT-DAT-O  TO W-APPO-DATA-X
S1C251*      MOVE W-APPX-GG             TO W-APP9-GG
S1C251*      MOVE W-APPX-MM             TO W-APP9-MM
S1C251*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*      MOVE W-APP9-GG             TO SO-DATA-NASCITA(1:2)
S1C251*      MOVE W-APP9-MM             TO SO-DATA-NASCITA(3:2)
S1C251*      MOVE W-APP9-SSAA           TO SO-DATA-NASCITA(5:4)
S1C251*      ADD 1                     TO W-N-CONTA-SONC
S1C251*      MOVE W-N-CONTA-SONC       TO SO-PROGR-RECORD
S1C251*           IF FCEI1-C-DIVISA-COD = 'ITL'
S1C251*               MOVE 'L'                       TO SO-TIPO-DIVISA
S1C251*               ADD SO-IMPCORR-ANNO          TO W-IMPCORR-ANNO-LIT
S1C251*           ELSE
S1C251*               MOVE 'E'                       TO SO-TIPO-DIVISA
S1C251*               ADD SO-IMPCORR-ANNO          TO W-IMPCORR-ANNO-EUR
S1C251*           END-IF
S1C251*      PERFORM SCRITTURA-SONCO
S1C251*    END-IF
S1C251*    END-IF
S1C251* I RECORD DI DETTAGLIO SONO 2 E MUTUAMENTE ESCLUSIVI :
S1C251*    ESTATARIO O COINTESTATARIO
S1C251     MOVE ZEROES                    TO SO-IMP-INIZ-COINT
SIB161*SHL121     MOVE ZEROES             TO SO-IMP-PEN-COS-COINT
SJB071     MOVE ZEROES                    TO SO-IMP-PEN-COS-COINT
SKB251     MOVE ZEROES                    TO W-SO-IMP-INT-ONE-COINT
SKB251     MOVE ZEROES                    TO W-SO-IMP-PEN-COS-COINT
S1C251     MOVE ZEROES                    TO SO-IMP-RATE-PAG-COINT
S1C251     MOVE ZEROES                    TO SO-IMP-INT-ONE-COINT
S1C251     MOVE ZEROES                    TO SO-PERCENTUALE-COINT
S1C251     MOVE ZEROES                    TO SO-RATE-EFF-PAG-COINT
S1C251     MOVE ZEROES                    TO SO-INT-ONE-PAG-COINT
SIB161*SHL121     MOVE ZEROES             TO SO-PEN-NON-DET-COINT
SJB071     MOVE ZEROES                    TO SO-PEN-NON-DET-COINT
S1C251     MOVE ZEROES                    TO SO-ID-COINT-COINT
S1C251     MOVE ZEROES                    TO SO-TOTALE-COINT
S1C251     MOVE ZEROES                    TO SO-IMP-INIZ-INT
S1C251     MOVE ZEROES                    TO SO-IMP-RATE-PAG-INT
S1C251     MOVE ZEROES                    TO SO-IMP-INT-ONE-INT
SIB161*SHL121     MOVE ZEROES             TO SO-IMP-PEN-NON-DET
SJB071     MOVE ZEROES                    TO SO-IMP-PEN-NON-DET
S1C251     MOVE ZEROES                    TO W-P-PERC-APPO
S1C251     MOVE ZEROES                    TO W-P-PERC-SOMMA
S1C251     MOVE ZEROES                    TO W-I-DELTA-MORA
S1G201     MOVE ZEROES                    TO W-APPO-MORA
S1C251     MOVE ZEROES                    TO IMP-INIZ-INT-APPO
S1C251     MOVE ZEROES                    TO IMP-RATE-PAG-INT-APPO
SGB012     MOVE ZEROES                    TO IMP-RATE-PAG-INT-ARRO
SGB012     MOVE ZEROES                    TO IMP-RATE-PAG-COINT-ARRO
S1C251     MOVE ZEROES                    TO IMP-INT-ONE-INT-APPO
SGB012     MOVE ZEROES                    TO IMP-INT-ONE-INT-APPO-NEW
SGB012     MOVE ZEROES                    TO IMP-INT-ONE-INT-ARRO-NEW
S1C251     MOVE ZEROES                    TO IMP-INIZ-COINT-APPO
S1C251     MOVE ZEROES                    TO IMP-RATE-PAG-COINT-APPO
S1C251     MOVE ZEROES                    TO IMP-INT-ONE-COINT-APPO
SGB012     MOVE ZEROES                    TO IMP-INT-ONE-COINT-APPO-NEW
SGB012     MOVE ZEROES                    TO IMP-INT-ONE-COINT-ARRO-NEW
S1C251     MOVE ZEROES                    TO APPO-INT-ONE-COINT
S1C251     MOVE ZEROES                    TO APPO-PEN-COS-COINT
S1C251     MOVE ZEROES                    TO W-SOMMA-IMP-RATE
S1C251     MOVE ZEROES                    TO W-SOMMA-IMP-INT
S1C251     MOVE ZEROES                    TO RATE-EFF-PAG-COINT-APPO
SGB012     MOVE ZEROES                    TO RATE-EFF-PAG-COINT-ARRO
S1C251     MOVE ZEROES                    TO INT-ONE-PAG-COINT-APPO
SHL121     MOVE ZEROES                    TO PEN-NON-DET-COINT-APPO
SGB012     MOVE ZEROES                    TO INT-ONE-PAG-COINT-ARRO
SGB012     MOVE ZEROES                    TO PEN-NON-DET-COINT-ARRO
S1C251     MOVE ZEROES                    TO ID-COINT-COINT-APPO
S1C251     MOVE ZEROES                    TO TOTALE-COINT-APPO
SKB181     MOVE ZEROES                    TO IMP-PEN-COS-NONDET
SKB181     MOVE ZEROES                    TO W-I-ACQPRI-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-ACQALT-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-RISPRI-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-ALTFIN-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-AGRARI-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-TOTFIN-IPO-APPO
SKB181     MOVE ZEROES                    TO W-I-INTONE-PRE-APPO
SKB181     MOVE ZEROES                    TO W-I-PENNON-PRE-APPO
SKB181     MOVE ZEROES                    TO W-P-AGRARIO
SKB181     MOVE ZEROES                    TO W-P-ABIT-PRIN
SKB181     MOVE ZEROES                    TO W-P-ALTRI-IMM
SKB181     MOVE ZEROES                    TO W-P-COST-RIST
SKB181     MOVE ZEROES                    TO W-P-PERC-MISTO
SKC182     MOVE ZEROES                    TO W-SO-IMP-LIQUIDITA
SKB181     MOVE ZEROES                    TO W-P-PERC-RESTO
SKB181     MOVE ZEROES                    TO W-SO-INT-ONE-PAG-CALC
SKB181     MOVE ZEROES                    TO W-SO-PEN-NON-DET-CALC
SLC043     MOVE ZEROES                    TO W-P-LIQUIDITA
SLC043     MOVE ZEROES                    TO W-SO-LIQUIDITA
SKB181     MOVE ZEROES                    TO W-SO-INT-ONE-PAG-ARR
SKB181     MOVE ZEROES                    TO W-SO-PEN-NON-DET-ARR
SKB181     INITIALIZE                        W-SO-RECORD
SLC043     INITIALIZE                        W-F-PROPRI-IMM
SKB261     SET AGRARIO-COINT-NO           TO TRUE
SKB261     SET ABIT-PRIN-COINT-NO         TO TRUE
SKB261     SET ALTRI-IMM-COINT-NO         TO TRUE
SKB261     SET COST-RIST-COINT-NO         TO TRUE
SKC182     SET ALTFIN-COINT-NO            TO TRUE
SKB251
SKB251     PERFORM INIZIALIZZA-RICICLI
S1C251
S1G201     SET NO-TROVATO-FIN-VALUTA      TO TRUE
S1G201
S1G201     IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
S1G201        SET TROVATO-FIN-VALUTA      TO TRUE
S1G201     END-IF
S1G201
S1C251     IF  FCEI1-C-FINANZ-PRE = W-C-FINANZ-PRE
S1C251     AND FCEI1-N-FINANZ-NUM = W-N-FINANZ-NUM
S1C251        ADD 1                      TO W-N-CONT-ACC
S1C251     ELSE
S1C251        MOVE ZEROES                TO W-N-CONT-ACC
S1C251     END-IF
S1C251
S1C251     MOVE FCEI1-C-FINANZ-PRE          TO W-C-FINANZ-PRE
S1C251     MOVE FCEI1-N-FINANZ-NUM          TO W-N-FINANZ-NUM
SHL121*
DEB>>>*    IF EKIST-F-ANAGRA-CTR = 'S'
SIB091     SET COI-NO                     TO TRUE
SKC182     SET ACCOL-NOPROP-NO            TO TRUE
S1C251     PERFORM REPER-INTEST
DEB>>>*    END-IF
DEB>>>*    DISPLAY 'IAN1I-C-NGIURI-COD-O: ' IAN1I-C-NGIURI-COD-O
SGB012*- Per Anagrafe Tributaria elaboro solo 'COI' e 'PF':
S1C251     IF IAN1I-C-NGIURI-COD-O = 'COI'  OR 'PF'
SHL121*
SHL121*  1) Gestione COIntestati:
S1C251      IF IAN1I-C-NGIURI-COD-O = 'COI'
SIB091       SET COI-SI                   TO TRUE
DEB>>>       DISPLAY '1) ELABORO COI: ' W-N-FINANZ-NUM
SHL121       MOVE ZEROES                       TO W-X
S1C251       PERFORM ESTRAI-NDG-COLLEGATI
SHL121*-    Conta i Cointestatari:
S1C251       PERFORM VARYING W-IAN FROM 1 BY 1
S1C251       UNTIL W-IAN > W-N-LUNGH-IAN
S1C251       OR IAN3I-C-NDGNDG-COD-O(W-IAN) NOT > SPACES
S1C251          MOVE W-IAN                  TO W-N-CONTA-IAN
S1C251       END-PERFORM
SKB261
SKC182       SET ACCOL-NOPROP-NO             TO TRUE
SLC102*- Valorizzazioni valide per entrambi i COI:
SKB261       SET AGRARIO-COINT-NO            TO TRUE
SKB261       SET ABIT-PRIN-COINT-NO          TO TRUE
SKB261       SET ALTRI-IMM-COINT-NO          TO TRUE
SKB261       SET COST-RIST-COINT-NO          TO TRUE
SKC182       SET ALTFIN-COINT-NO             TO TRUE
SLC102*
SKC182       SET AGRARIO-FINAL-NO            TO TRUE
SKC182       SET ABIT-PRIN-FINAL-NO          TO TRUE
SKC182       SET ALTRI-IMM-FINAL-NO          TO TRUE
SKC182       SET COST-RIST-FINAL-NO          TO TRUE
SKC182       SET ALTFIN-FINAL-NO             TO TRUE
SKC182       SET FINAL-MISTO-UGU             TO TRUE
SKC182       MOVE ZEROES                     TO W-FINALI
SKC182       MOVE ZEROES                     TO W-FINALI-N
SLC102       MOVE ZEROES                     TO W-FINALI-TOT
SLC102       SET FORZO-NON-MISTO-NO          TO TRUE
SKB261       PERFORM VARYING W-COI FROM 1 BY 1
SKB261       UNTIL W-COI > W-N-LUNGH-IAN
SKB261       OR IAN3I-C-NDGNDG-COD-O(W-COI) NOT > SPACES
SKB261        IF IFICOINT-SI
SKB261           MOVE IAN3I-C-NDGNDG-COD-O(W-COI) TO W-C-NDGNDG-COD
SKB261           PERFORM VERIFICA-EKFGT-TOT
SKB261        END-IF
SKB261       END-PERFORM
SKB261       MOVE ZEROES                     TO W-C-NDGNDG-COD
SLC102*- Se ho 2 finalit{, ed una } "Altra finalit{/Liquidit{", che
SLC102*  non } segnalabile, passerei un solo record e considerato
SLC102*  erroneamente "MISTO", quindi in questo caso mi setto il livello
SLC102*  88 prima, e alla scrittura FORZO a NON MISTO:
SLH051*
SLH051*  In caso di cointestato non } previsto il mutuo non misto
SLH051*SLC102 IF  W-FINALI-TOT = 2
SLH051*SLC102 AND ALTFIN-COINT-SI
SLH051*DEB>>>     DISPLAY 'FORZO-NON-MISTO-SI|||||||||'
SLH051*SLC102     SET FORZO-NON-MISTO-SI      TO TRUE
SLH051*SLC102 END-IF
SHL121*
SHL121*-    Ciclo sui Cointestatari:
S1C251       PERFORM VARYING W-I FROM 1 BY 1
S1C251       UNTIL W-I > W-N-LUNGH-IAN
S1C251       OR IAN3I-C-NDGNDG-COD-O(W-I) NOT > SPACES
DEB>>>        DISPLAY 'COI CON ' W-N-CONTA-IAN ' INTESTATARI '
DEB>>>        DISPLAY 'COI - ELABORO: ' IAN3I-C-NDGNDG-COD-O(W-I)
DEB>>>        IF IFICOINT-SI
DEB>>>           DISPLAY 'GIRO CON FGT'
DEB>>>        ELSE
DEB>>>           DISPLAY 'GIRO A VECCHIO'
DEB>>>        END-IF
DEB>>>*       IF EKIST-F-ANAGRA-CTR = 'S'
S1C251        PERFORM REPER-INTEST-COI
SJD121*- Accedo a tabella ANAGRAFE TRIBUTARIA per COINTESTATO:
SJD121        SET W-F-EKFGT-NO               TO TRUE
SKB261        SET W-F-ALTFIN-SOLO-NO         TO TRUE
SKA292        IF IFICOINT-SI
SKA292           MOVE IAN3I-C-NDGNDG-COD-O(W-I) TO W-C-NDGNDG-COD
SJD121           PERFORM VERIFICA-EKFGT
SKA292        END-IF
SJD121
SIB091        MOVE W-I                       TO W-X
SIB091        MOVE IAN3I-C-NDGNDG-COD-O(W-I) TO W-C-NDGNDG-COD-COI(W-X)
DEB>>>*       END-IF
S1C251        IF IAN1I-C-NGIURI-COD-O = 'PF'
DEB>>>*        IF EKIST-F-ANAGRA-CTR = 'S'
S1C251          PERFORM RECUPERA-PROV-NAS
DEB>>>*        END-IF
S1C251          MOVE W-I                       TO  FANT1-N-COINTE-PRG
S1C251          MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251          MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251          MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251          MOVE IAN1I-X-NASCIT-LOC-O   TO  FANT1-X-LOCNAS-NDG(6:55)
S1C251          MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251          PERFORM SCRITTURA-FANT1
S1C251*******************************************************
SGB012*- Scrittura flusso SONCO x ANAGRAFE TRIBUTARIA - COINTESTATO:
DEB>>>         DISPLAY 'FLUSSO SONCO X ANAGRAFE TRIBUTARIA - COI'
SGB012*- Gestione dati finanziamenti originari per Tremonti:
SGB012          IF TRM-SI
SGB012             MOVE FAN00-G-AREA-FAN        TO WAFAN-AREA-TRM
SGB012             MOVE FAN9Q-G-AREA-O          TO WAFAN-AREA-FAN9-TRM
SGB012             MOVE FCEI1-C-FINANZ-PRE      TO W-C-FINANZ-PR2
SGB012             IF FCEI1-C-FINANZ-PRE = '41'
SGB012                MOVE '09'                 TO FCEI1-C-FINANZ-PRE
SGB012             ELSE
SGB012                MOVE '10'                 TO FCEI1-C-FINANZ-PRE
SGB012             END-IF
SGB012             PERFORM RICAVA-DATI-FAN
SGB012             MOVE W-C-FINANZ-PR2          TO FCEI1-C-FINANZ-PRE
SGB012          END-IF
S1C251         IF FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
CORRAD         OR FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
S1C251          MOVE FAN9Q-D-STIPUL-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-COINT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-COINT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-COINT(5:4)
S1C251          COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
S1G201                                              FAN9Q-I-STIPUL-FIN-O
S1C251         ELSE
S1C251          MOVE FAN9Q-D-EROGAZ-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-COINT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-COINT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-COINT(5:4)
S1C251          COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
SJB071*S1G201                                       FAN9Q-I-EROGAZ-FIN-O
SJB071                                              FAN9Q-I-STIPUL-FIN-O
S1C251         END-IF
S1G201         IF TROVATO-FIN-VALUTA
S1G201            COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
S1G201                                            FCEI1-I-EROGAZ-FIN-VAL
SGB012*S1G201     COMPUTE IMP-RATE-PAG-COINT-APPO ROUNDED =
SGB012            COMPUTE IMP-RATE-PAG-COINT-ARRO ROUNDED =
S1G201                                         FCEI1-I-TOTANN-RAT-VAL-3
S1G201            MOVE FCEI1-I-TOTANN-RAT-VAL-3   TO W-I-APPO-TOT-RATA
S5A281*S1G201     MOVE FCEI1-I-MORA-PAGAT-VAL-3   TO W-APPO-MORA
S5A281            COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-VAL-3
S1C251            MOVE IMP-INIZ-COINT-APPO        TO SO-IMP-INIZ-COINT
SIB161*SHL121     MOVE ZEROES                    TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                       APPO-PEN-COS-COINT
SIB161*SHL121   IF FCEI1-I-NONDET-IMP-VAL > ZEROES
SIB161*SHL121      COMPUTE IMP-PEN-COS-COINT   ROUNDED =
SIB161*SHL121                              FCEI1-I-NONDET-IMP-VAL
SIB161*SHL121      MOVE IMP-PEN-COS-COINT      TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                     APPO-PEN-COS-COINT
SIB161*SHL121   ELSE
SIB161*SHL121      MOVE ZEROES                 TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                     APPO-PEN-COS-COINT
SIB161*SHL121   END-IF
SJD121*         IF  W-F-EKFGT-SI
SJD121*             COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
SJD121*                                           W-I-TOTIMP-TOT
SJD121*             MOVE IMP-INIZ-COINT-APPO     TO SO-IMP-INIZ-COINT
SJD121*         END-IF
SJB071            MOVE ZEROES                    TO SO-IMP-PEN-COS-COINT
SJB071                                              APPO-PEN-COS-COINT
SJB071          IF FCEI1-I-NONDET-IMP-VAL > ZEROES
SJB071          OR W-APPO-MORA            > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE-VAL > ZEROES
SNC091          OR W-I-NONTRAC-IMP-VAL    > ZEROES
SJB071             COMPUTE IMP-PEN-COS-COINT   ROUNDED =
SJB071                                     FCEI1-I-NONDET-IMP-VAL +
SNC091                                     W-I-NONTRAC-IMP-VAL    +
SJB071                                     W-APPO-MORA            +
SJB071                                     FCEI1-I-ASSICU-ONE-VAL
SJB071             MOVE IMP-PEN-COS-COINT      TO SO-IMP-PEN-COS-COINT
SJB071                                            APPO-PEN-COS-COINT
SJB071          ELSE
SJB071             MOVE ZEROES                 TO SO-IMP-PEN-COS-COINT
SJB071                                            APPO-PEN-COS-COINT
SJB071          END-IF
S1G201         ELSE
SGB012*S1C251     COMPUTE IMP-RATE-PAG-COINT-APPO ROUNDED =
SGB012            COMPUTE IMP-RATE-PAG-COINT-ARRO ROUNDED =
S1C251                                         FCEI1-I-TOTANN-RAT-3
S1G201            MOVE FCEI1-I-TOTANN-RAT-3       TO W-I-APPO-TOT-RATA
S5A281*S1G201     MOVE FCEI1-I-MORA-PAGAT-3       TO W-APPO-MORA
S5A281            COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-3
S1C251            MOVE IMP-INIZ-COINT-APPO        TO SO-IMP-INIZ-COINT
SIB161*SHL121     MOVE ZEROES                   TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                      APPO-PEN-COS-COINT
SIB161*SHL121     IF FCEI1-I-NONDET-IMP > ZEROES
SIB161*SHL121        COMPUTE IMP-PEN-COS-COINT   ROUNDED =
SIB161*SHL121                                      FCEI1-I-NONDET-IMP
SIB161*SHL121        MOVE IMP-PEN-COS-COINT     TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                      APPO-PEN-COS-COINT
SIB161*SHL121     ELSE
SIB161*SHL121        MOVE ZEROES                TO SO-IMP-PEN-COS-COINT
SIB161*SHL121                                      APPO-PEN-COS-COINT
SIB161*SHL121     END-IF
SJB071            MOVE ZEROES                   TO SO-IMP-PEN-COS-COINT
SJB071                                             APPO-PEN-COS-COINT
SJB071            IF FCEI1-I-NONDET-IMP > ZEROES
SJB071            OR W-APPO-MORA        > ZEROES
SJB071            OR FCEI1-I-ASSICU-ONE > ZEROES
SNC091            OR W-I-NONTRAC-IMP    > ZEROES
SJB071               COMPUTE IMP-PEN-COS-COINT   ROUNDED =
SJB071                                             FCEI1-I-NONDET-IMP +
SJB071                                             W-I-NONTRAC-IMP    +
SJB071                                             W-APPO-MORA        +
SJB071                                             FCEI1-I-ASSICU-ONE
SJB071               MOVE IMP-PEN-COS-COINT     TO SO-IMP-PEN-COS-COINT
SJB071                                             APPO-PEN-COS-COINT
SJB071            ELSE
SJB071               MOVE ZEROES                TO SO-IMP-PEN-COS-COINT
SJB071                                             APPO-PEN-COS-COINT
SJB071            END-IF
S1G201         END-IF
SGB012         MOVE IMP-RATE-PAG-COINT-ARRO       TO W-I-IMPORT-ARR
SGB012         PERFORM ARROTONDA-IMPORTO
SGB012         MOVE IARRU-I-IMPORT-ARR-O     TO IMP-RATE-PAG-COINT-APPO
S1C251*        COMPUTE IMP-RATE-PAG-COINT-APPO ROUNDED =
S1C251*                                             FCEI1-I-TOTANN-RAT-3
S1C251         COMPUTE W-I-DELTA-MORA ROUNDED = IMP-RATE-PAG-COINT-APPO
S1C251                                        - W-APPO-MORA
S1C251         MOVE IMP-RATE-PAG-COINT-APPO   TO SO-IMP-RATE-PAG-COINT
SLH051         IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051            MOVE SO-IMP-INIZ-COINT     TO SO-IMP-RATE-PAG-COINT
SLH051         END-IF
SLH051*
DEB>>>*        DISPLAY 'SO-IMP-RATE-PAG-COINT 1: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
S1C251         IF W-I-DELTA-MORA > IMP-INIZ-COINT-APPO
SJC111         AND FAN9Q-D-ESTINZ-DAT-O = '0001-01-01'
S1C251          MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251          SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251          MOVE 'IMPORTO RATE PAGATE > https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  MUTUO'
S1C251                                        TO EKERR-X-DES-ERRORE(1)
S1C251          MOVE 'P017'                   TO EKERR-C-RIF-ERRORE(1)
S1C251          PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S1C251*        COMPUTE IMP-INT-ONE-COINT-APPO ROUNDED =
S1C251*                                             FCEI1-I-ANNUAL-INT-1
SGB012
KKKKKK* QUA 1
S1C251         COMPUTE IMP-INT-ONE-COINT-APPO ROUNDED = APPO-I-VOCE0  +
S1C251                                                  APPO-I-VOCE2  +
S1C251                                                  APPO-I-VOCE3  +
S1C251                                                  APPO-I-VOCE7
DEB>>>*        DISPLAY 'IMP-INT-ONE-COINT-APPO: '
DEB>>>*                        IMP-INT-ONE-COINT-APPO
SGB012
SGB012         PERFORM IMPORTI-ANAGRAFE
SGB012         IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012            COMPUTE IMP-INT-ONE-COINT-ARRO-NEW ROUNDED =
SGB012                                              W-I-INTVAR-ANA-VAL +
SNB211*SGB012                                       W-I-SPERAT-ANA-VAL +
SGB012                                              W-I-SPEIST-ANA-VAL +
SGB012                                              W-I-IMPSOS-ANA-VAL +
SGB012                                              W-I-PENEST-ANA-VAL +
SGB012                                              W-I-COMINT-ANA-VAL +
SGB012                                              W-I-ONEACC-ANA-VAL +
SGB012                                              W-I-ONESAL-ANA-VAL +
SGB012                                              W-I-ONECER-ANA-VAL
SGB012         ELSE
SGB012            COMPUTE IMP-INT-ONE-COINT-ARRO-NEW ROUNDED =
SGB012                                              W-I-INTVAR-ANA +
SNB211*SGB012                                           W-I-SPERAT-ANA +
SGB012                                              W-I-SPEIST-ANA +
SGB012                                              W-I-IMPSOS-ANA +
SGB012                                              W-I-PENEST-ANA +
SGB012                                              W-I-COMINT-ANA +
SGB012                                              W-I-ONEACC-ANA +
SGB012                                              W-I-ONESAL-ANA +
SGB012                                              W-I-ONECER-ANA
DEB>>>*        DISPLAY 'IMP-INT-ONE-COINT-ARRO-NEW: '
DEB>>>*                 IMP-INT-ONE-COINT-ARRO-NEW
DEB>>>         DISPLAY 'W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>         DISPLAY 'W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>         DISPLAY 'W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>         DISPLAY 'W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>         DISPLAY 'W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>         DISPLAY 'W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>         DISPLAY 'W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>         DISPLAY 'W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>         DISPLAY 'W-I-ONECER-ANA: ' W-I-ONECER-ANA
SGB012         END-IF
SGB012         MOVE IMP-INT-ONE-COINT-ARRO-NEW TO W-I-IMPORT-ARR
SGB012         PERFORM ARROTONDA-IMPORTO
SGB012         MOVE IARRU-I-IMPORT-ARR-O   TO IMP-INT-ONE-COINT-APPO-NEW
SGB012
DEB>>>         DISPLAY '****'
DEB>>>         DISPLAY 'DATI NUOVI SONCO: '
DEB>>>         DISPLAY 'IMP-INT-ONE-COINT-APPO  : '
DEB>>>                  IMP-INT-ONE-COINT-APPO
DEB>>>         DISPLAY ' -->   APPO-I-VOCE0  : ' APPO-I-VOCE0
DEB>>>         DISPLAY ' --> + APPO-I-VOCE2  : ' APPO-I-VOCE2
DEB>>>         DISPLAY ' --> + APPO-I-VOCE3  : ' APPO-I-VOCE3
DEB>>>         DISPLAY ' --> + APPO-I-VOCE7  : ' APPO-I-VOCE7
DEB>>>         DISPLAY '****'
DEB>>>         DISPLAY 'IMP-INT-ONE-COINT-ARRO-NEW: '
DEB>>>                  IMP-INT-ONE-COINT-ARRO-NEW
DEB>>>         DISPLAY 'IMP-INT-ONE-COINT-APPO-NEW: '
DEB>>>                  IMP-INT-ONE-COINT-APPO-NEW
DEB>>>         DISPLAY '****'
DEB>>>         IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>         DISPLAY ' -->   W-I-INTVAR-ANA-VAL: ' W-I-INTVAR-ANA-VAL
DEB>>>         DISPLAY ' -->   W-I-INTVAR-TOT-VAL: ' W-I-INTVAR-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-SPERAT-ANA-VAL: ' W-I-SPERAT-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-SPERAT-TOT-VAL: ' W-I-SPERAT-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-SPEIST-ANA-VAL: ' W-I-SPEIST-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-SPEIST-TOT-VAL: ' W-I-SPEIST-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-IMPSOS-ANA-VAL: ' W-I-IMPSOS-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-IMPSOS-TOT-VAL: ' W-I-IMPSOS-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-PENEST-ANA-VAL: ' W-I-PENEST-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-PENEST-TOT-VAL: ' W-I-PENEST-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-COMINT-ANA-VAL: ' W-I-COMINT-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-COMINT-TOT-VAL: ' W-I-COMINT-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-ONEACC-ANA-VAL: ' W-I-ONEACC-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-ONEACC-TOT-VAL: ' W-I-ONEACC-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-ONESAL-ANA-VAL: ' W-I-ONESAL-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-ONESAL-TOT-VAL: ' W-I-ONESAL-TOT-VAL
DEB>>>         DISPLAY ' --> + W-I-ONECER-ANA-VAL: ' W-I-ONECER-ANA-VAL
DEB>>>         DISPLAY ' --> + W-I-ONECER-TOT-VAL: ' W-I-ONECER-TOT-VAL
DEB>>>         ELSE
DEB>>>         DISPLAY ' -->   W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>         DISPLAY ' -->   W-I-INTVAR-TOT: ' W-I-INTVAR-TOT
DEB>>>         DISPLAY ' --> + W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>         DISPLAY ' --> + W-I-SPERAT-TOT: ' W-I-SPERAT-TOT
DEB>>>         DISPLAY ' --> + W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>         DISPLAY ' --> + W-I-SPEIST-TOT: ' W-I-SPEIST-TOT
DEB>>>         DISPLAY ' --> + W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>         DISPLAY ' --> + W-I-IMPSOS-TOT: ' W-I-IMPSOS-TOT
DEB>>>         DISPLAY ' --> + W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>         DISPLAY ' --> + W-I-PENEST-TOT: ' W-I-PENEST-TOT
DEB>>>         DISPLAY ' --> + W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>         DISPLAY ' --> + W-I-COMINT-TOT: ' W-I-COMINT-TOT
DEB>>>         DISPLAY ' --> + W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>         DISPLAY ' --> + W-I-ONEACC-TOT: ' W-I-ONEACC-TOT
DEB>>>         DISPLAY ' --> + W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>         DISPLAY ' --> + W-I-ONESAL-TOT: ' W-I-ONESAL-TOT
DEB>>>         DISPLAY ' --> + W-I-ONECER-ANA: ' W-I-ONECER-ANA
DEB>>>         DISPLAY ' --> + W-I-ONECER-TOT: ' W-I-ONECER-TOT
DEB>>>         END-IF
DEB>>>         DISPLAY '****'
DEB>>>         DISPLAY 'IMP-RATE-PAG-COINT-APPO: '
DEB>>>                  IMP-RATE-PAG-COINT-APPO
SGB012*S1C251  MOVE IMP-INT-ONE-COINT-APPO     TO APPO-INT-ONE-COINT
SGB012         MOVE IMP-INT-ONE-COINT-APPO-NEW TO APPO-INT-ONE-COINT
S1C251                                           SO-IMP-INT-ONE-COINT
S1C251         SET NO-TROVATO-MINORE          TO TRUE
SGB012*S1C251  IF IMP-INT-ONE-COINT-APPO > IMP-RATE-PAG-COINT-APPO
SGB012         IF IMP-INT-ONE-COINT-APPO-NEW > IMP-RATE-PAG-COINT-APPO
S1C251            MOVE SO-IMP-INT-ONE-COINT   TO SO-IMP-RATE-PAG-COINT
DEB>>>*           DISPLAY 'SO-IMP-RATE-PAG-COINT 2: '
DEB>>>*                           SO-IMP-RATE-PAG-COINT
SLH051            IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051               MOVE SO-IMP-INIZ-COINT     TO SO-IMP-RATE-PAG-COINT
SLH051            END-IF
SLH051*
S1C251            SET TROVATO-MINORE          TO TRUE
S1C251*        AND FAN9Q-D-ESTINZ-DAT-O ='0001-01-01'
S1C251*        AND FAN9Q-D-SCDPRI-DAT-O <= EKIFB-D-RIFERI-OPE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  INTERESSI E ONERI > IMPORTO RATE PAGATE'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P018'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
DEB>>>*        DISPLAY 'SO-IMP-INT-ONE-COINT : ' SO-IMP-INT-ONE-COINT
DEB>>>*        DISPLAY 'SO-IMP-RATE-PAG-COINT: ' SO-IMP-RATE-PAG-COINT
SLC151*- Forzatura per diagnostico: se l'importo delle rate pagate }
SLC151*  minore delle quote non detraibili, forzo quest'ultimo.
SLC151         IF SO-IMP-RATE-PAG-COINT < SO-IMP-PEN-COS-COINT
SLC151              MOVE SO-IMP-PEN-COS-COINT TO SO-IMP-RATE-PAG-COINT
SLC151          END-IF
SLH051         IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051            MOVE SO-IMP-INIZ-COINT     TO SO-IMP-RATE-PAG-COINT
SLH051         END-IF
SLH051*
SOE142*SHA041         MOVE FCEI1-F-ESTINZ-TIP        TO SO-FLAG-ESTINZ-COINT
SOE142         IF  FCEI1-F-ESTINZ-TIP = 'E'
SOE142             MOVE '3'                   TO SO-FLAG-ESTINZ-COINT
SOE142         ELSE
SOE142             MOVE FCEI1-F-ESTINZ-TIP    TO SO-FLAG-ESTINZ-COINT
SOE142         END-IF
DEB>>>*        DISPLAY 'SO-FLAG-ESTINZ-COINT: '
DEB>>>*                        SO-FLAG-ESTINZ-COINT
DEB>>>*        DISPLAY 'W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
SKC182*- Se il MUTUO } ACCOLLATO (SO-FLAG-ESTINZ-COINT a "4") ed il
SKC182*  flag PROPRIETA' non } valorizzato --> non lo comunico|
SKC182         SET ACCOL-NOPROP-NO            TO TRUE
SKC182         IF SO-FLAG-ESTINZ-COINT = '4'
SKC182         AND W-F-PROPRI-IMM = 'N'
SKC182            SET ACCOL-NOPROP-SI         TO TRUE
DEB>>>*           DISPLAY 'SETTO ACCOL-NOPROP-SI|||'
SKC182         END-IF
SHL121
SKB181         IF  W-F-EKFGT-NO
SKB181
S1C251         SET NO-TROVATO-TIPO-FIN        TO TRUE
S1C251         IF FAN9Q-C-TIPO-FINAN-O = 'AGR'
SG0215         OR FAN9Q-C-TIPO-FINAN-O = 'MAG'
S1C251          MOVE 1                      TO SO-TIPO-MUTUO-COINT
S1C251         ELSE
S1C251           IF (FAN9Q-C-TIPO-FINAN-O = 'MUT' OR 'VUT'
SIB201*SG0215    OR  'MAT')
SIB201           OR  'MAT' OR 'PIV' )
S1C251           AND FCEI1-C-GARANZ-TIP = 'I'
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '070'  OR '070A' OR
S1C251*                                         '070B' OR '071'  OR
S1C251*                                         '080A' OR '081'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '071A' OR '071'  OR
SG0215                                          '081'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 2                   TO  SO-TIPO-MUTUO-COINT
S1C251            END-IF
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '010' OR '010A' OR
S1C251*                                         '011' OR '130B' OR
S1C251*                                         '130C'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '011A' OR '011B' OR
SG0215                                          '011'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 4                   TO  SO-TIPO-MUTUO-COINT
S1C251            END-IF
S1C251            IF NO-TROVATO-TIPO-FIN
S1C251               MOVE 3                   TO  SO-TIPO-MUTUO-COINT
S1C251            END-IF
S1C251           END-IF
S1C251         END-IF
SKB181
SKB181         END-IF
SKB181
SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoli record.
SKB181         SET ALTRI-IMM-NO              TO TRUE
SJD121         IF  W-F-EKFGT-SI
DEB>>>*            DISPLAY 'W-F-EKFGT-SI'
DEB>>>*            DISPLAY 'FX1707 W-I-AGRARI-IPO: '
DEB>>>*                            W-I-AGRARI-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ACQPRI-IPO: '
DEB>>>*                            W-I-ACQPRI-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ACQALT-IPO: '
DEB>>>*                            W-I-ACQALT-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-ALTFIN-IPO: '
DEB>>>*                            W-I-ALTFIN-IPO
DEB>>>*            DISPLAY 'FX1707 W-I-RISPRI-IPO: '
DEB>>>*                            W-I-RISPRI-IPO
SJD121             MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121             MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121             MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121             MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121             MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121             MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121      MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121      MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121      MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121      MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182             MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182             MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182             MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182             MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
DEB>>>*            DISPLAY 'FX1707 PRE '
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(1):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(1):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(2):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(2):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(3):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(3):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(4):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(4):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(5):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(5)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(5):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121             PERFORM ORDINA-IMPORTI
SJD121
DEB>>>*            DISPLAY 'FX1707 POST'
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(1):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(1):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(1)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(2):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(2):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(2)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(3):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(3):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(3)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(4):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(4):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(4)
DEB>>>*            DISPLAY 'FX1707 WAPPO-I-TIPOLO-MUT(5):'
DEB>>>*                            WAPPO-I-TIPOLO-MUT(5)
DEB>>>*            DISPLAY 'FX1707 WAPPO-C-TIPOLO-TIP(5):'
DEB>>>*                            WAPPO-C-TIPOLO-TIP(5)
SJD121             EVALUATE TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182*SJD121                 SET AGRARIO-COINT      TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182*SJD121                 SET ABIT-PRIN-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182*SJD121                 SET ALTRI-IMM-COINT    TO TRUE
SKC182*SJD121             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182*SJD121                 SET COST-RIST-COINT    TO TRUE
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SKC182                 SET AGRARIO-COINT      TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET AGRARIO-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SKC182                 SET ABIT-PRIN-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ABIT-PRIN-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182                 SET ALTRI-IMM-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET ALTRI-IMM-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SKC182                 SET COST-RIST-COINT    TO TRUE
DEB>>>*                DISPLAY 'FX1707 SET COST-RIST-COINT'
SKC182             WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SOH203               IF W-FINALI-TOT = 1
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-AGRARI-IPO'
SOH203                    SET AGRARIO-COINT      TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQPRI-IPO'
SOH203                    SET ABIT-PRIN-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-ACQALT-IPO'
SOH203                    SET ALTRI-IMM-COINT    TO TRUE
SOH203                 END-IF
SOH203                 IF WAPPO-C-TIPOLO-TIP(4)  =  'I-RISPRI-IPO'
SOH203                    SET COST-RIST-COINT    TO TRUE
SOH203                 END-IF
SOH203               ELSE
SKC182                 SET ALTFIN-COINT       TO TRUE
SOH203               END-IF
DEB>>>                 DISPLAY 'FX1707 SET LIQUIDITA-COINT'
SJD121             END-EVALUATE
SKB181             IF ALTRI-IMM-INT
SKB181             AND W-I-AGRARI-IPO =  ZEROES
SKB181             AND W-I-ACQPRI-IPO =  ZEROES
SKB181             AND W-I-RISPRI-IPO =  ZEROES
SKB181                SET ALTRI-IMM-SI          TO TRUE
SKB181             END-IF
DEB>>>         ELSE
DEB>>>             DISPLAY 'TIPO MUTUO OLD'
SJD121         END-IF
DEB>>>         DISPLAY 'SO-TIPO-MUTUO-COINT: ' SO-TIPO-MUTUO-COINT
SHL121
SHA041         MOVE SPACES                    TO SO-PROPR-IMM-COINT
SHA041                                           W-C-PROPRI-IMM
SIB201*- Controllo eseguito SOLO PER STIPULATI/EROGATI POST 01/01/2017:
SIB201         SET PROP-CAL-NO                TO TRUE
SKC182         IF W-F-EKFGT-SI
SKC182            IF W-F-PROPRI-IMM = 'S'
SKC182               MOVE '1'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            ELSE
SKC182               MOVE '0'              TO W-C-PROPRI-IMM
SKC182                                        W-C-PROPRI-IMM-APPO
SKC182            END-IF
SKC182            PERFORM ABITAZIONE-PRINCIPALE
SKC182         ELSE
SJB071*SIB201     IF W-D-STIPUL-ADE >= '2017-01-01'
SJB211*           IF W-D-STIPUL-ADE >= '2017-01-01'
SJB071            IF W-D-STIPUL-ADE >= '2019-01-01'
SHL121               PERFORM GESTIONE-PROPRIETA
SIB201            END-IF
SKC182         END-IF
SHL121         MOVE W-C-PROPRI-IMM            TO SO-PROPR-IMM-COINT
SHL121
SIB161*SHL121  MOVE '0'                       TO SO-FLAG-MISTO-COINT
SJB071         MOVE '0'                       TO SO-FLAG-MISTO-COINT
SHL121
SKB181         MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121         IF  W-F-EKFGT-SI
SJD121             EVALUATE TRUE
SJD121             WHEN  W-I-AGRARI-IPO > 0
SJD121                 MOVE '0'               TO SO-FLAG-MISTO-COINT
SJD121             WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181                 COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                          W-I-ALTFIN-IPO
SJD121                 IF (W-I-ACQPRI-IPO   > 0
SJD121                 AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121          AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182                 OR (W-I-ACQALT-IPO   > 0
SKC182                 AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121                 OR (W-I-RISPRI-IPO   > 0
SJD121                 AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121          OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121          AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181                 OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181                 AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                     MOVE '1'           TO SO-FLAG-MISTO-COINT
SLH051*                    Se ho solo una finalita certificabile
SLH051*                    non pu essere misto
SLH051                     IF W-FINALI-TOT <= 1
SLH051                        MOVE '0'        TO SO-FLAG-MISTO-COINT
SLH051                     END-IF
DEB>>>*            DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>*            DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>*            DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>*            DISPLAY 'W-I-ALTIMM-TOT: ' W-I-ALTIMM-TOT
SJD121                 ELSE
SJD121                     MOVE '0'           TO SO-FLAG-MISTO-COINT
SJD121                 END-IF
SJD121              END-EVALUATE
SJD121         END-IF
S1C251         MOVE '2'                       TO SO-TIPO-REC
SHA041
SG0217         INITIALIZE SO-ID-MUTUO-COINT
SHL121*S1C251  MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SHL121*S1C251  MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SHL121*S1C251  MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SHL121*SG0217  MOVE SPACES                    TO SO-KEY-SPACE
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201      MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-COINT
SJB071*SIB201      MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-COINT
SJB071*SIB201         MOVE W-N-CONT-ACC              TO SO-KEY-COINT
SJB071*SIB201         MOVE SPACES                    TO SO-KEY-SPACE
SHA041*        MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*        IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*           MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*        ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*           MOVE SPACES                     TO W-FINANZ-PRE
SHA041*           IF FCEI1-C-FINANZ-PRE = '09'
SHA041*              MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*           ELSE
SHA041*              MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*           END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*           MOVE ZEROES                 TO W-C-FINANZ-NUM
SHA041*           MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SHA041*           MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SHA041*           MOVE ALL ZEROES             TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*           MOVE 'IST  '                TO W-FILIA
SHA041*        END-IF
SHA041*        MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
SJB071         MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071         IF FCEI1-C-IDENTI-RAP > SPACES
SJB071            MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071         ELSE
SJB071            MOVE '-'                    TO W-CAR-FISSO
SJB071            IF FAN00-F-CARTOL-FIN = 'S'
SJB071               MOVE 'CAR'               TO W-MUTUO-TIP
SJB071            ELSE
SJB071               MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071            END-IF
SJB071            MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211            MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071            MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211            IF FCEI1-C-FINANZ-PRE = '09'
SJB211               STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            ELSE
SJB211               STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211                DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211            END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071            MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071            MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071            MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211            MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211            MOVE 'IST00'                TO W-FILIA
SJB071         END-IF
SJB071         MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-COINT
SJB071
S1C251         MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-COINT
S1C251         MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-COINT
S1C251         MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-COINT
S1C251         MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-COINT
S1C251         MOVE W-I                       TO ID-COINT-COINT-APPO
S1C251         MOVE ID-COINT-COINT-APPO       TO SO-ID-COINT-COINT
S1C251         MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-COINT
S1C251         MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251         MOVE W-APPX-GG                 TO W-APP9-GG
S1C251         MOVE W-APPX-MM                 TO W-APP9-MM
S1C251         MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251         MOVE W-APP9-GG             TO SO-DATA-NASCITA-COINT(1:2)
S1C251         MOVE W-APP9-MM             TO SO-DATA-NASCITA-COINT(3:2)
S1C251         MOVE W-APP9-SSAA           TO SO-DATA-NASCITA-COINT(5:4)
S1C251         MOVE W-N-CONTA-IAN             TO TOTALE-COINT-APPO
S1C251         MOVE TOTALE-COINT-APPO         TO SO-TOTALE-COINT
S1C251
S1C251         IF TOTALE-COINT-APPO <= 1
DEB>>>            DISPLAY '|||||| ERRORE P019 NUM. COI: ' W-N-FINANZ-NUM
SKB261            CONTINUE
S1C251*           MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*           SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*           MOVE 'IL NUMERO DEI COINTESTATARI DEVE ESSERE > 1 '
S1C251*                                      TO EKERR-X-DES-ERRORE(1)
S1C251*           MOVE 'P019'                TO EKERR-C-RIF-ERRORE(1)
S1C251*           PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S1C251
SMK281         MOVE SPACES                    TO SO-FLAG-OPESOC-COINT
SMK281         MOVE SPACES                    TO SO-ID-MUTUO-CED-COINT
S1C251
SHB223*S1C251         IF IMP-INT-ONE-COINT-APPO  EQUAL ZEROES
SHB223*S1C251         AND IMP-RATE-PAG-COINT-APPO EQUAL ZEROES
SHB223         IF W-I-APPO-TOT-RATA = ZEROES
SHB223         AND APPO-INT-ONE-COINT = ZEROES
S1C251            MOVE ZEROES               TO SO-INT-ONE-PAG-COINT
SIB161*SHL121     MOVE ZEROES               TO SO-PEN-NON-DET-COINT
SJB071            MOVE ZEROES               TO SO-PEN-NON-DET-COINT
S1C251            MOVE ZEROES               TO SO-RATE-EFF-PAG-COINT
S1C251            IF W-I < W-N-CONTA-IAN
SJB071*             PERFORM VERIFICA-EKFDI
S1C251              COMPUTE W-P-PERC-SOMMA = (100 / W-N-CONTA-IAN
S1C251                                      + W-P-PERC-SOMMA)
SJB071*             IF W-F-EKFDI-SI
SJB071*                MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*             ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*             END-IF
S1C251            ELSE
S1C251              COMPUTE W-P-PERC-APPO ROUNDED = 100 - W-P-PERC-SOMMA
S1C251            END-IF
S1C251         ELSE
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251*            IF IMP-INT-ONE-COINT-APPO > ZEROES
S1C251*               COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
S1C251*                                  FCEI1-I-ANNUAL-INT-1 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (INT-ONE-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-INT-ONE-COINT-APPO
S1C251*            ELSE
S1C251*               COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
S1C251*                                 FCEI1-I-TOTANN-RAT-3 *
S1C251*                                 (100 / W-N-CONTA-IAN) / 100
S1C251*               COMPUTE W-P-PERC-APPO ROUNDED =
S1C251*                                 (RATE-EFF-PAG-COINT-APPO * 100)
S1C251*                                 / IMP-RATE-PAG-COINT-APPO
S1C251*            END-IF
SJB071*            PERFORM VERIFICA-EKFDI
SJB071*            IF W-F-EKFDI-SI
SJB071*               MOVE FDI9Q-P-POSSES-PER-O TO W-P-PERC-APPO
SJB071*            ELSE
S1C251               COMPUTE W-P-PERC-APPO ROUNDED = 100 / W-N-CONTA-IAN
SJB071*            END-IF
S1C251
S1C251             COMPUTE W-P-PERC-SOMMA ROUNDED = W-P-PERC-APPO
S1C251                                            + W-P-PERC-SOMMA
S1C251          ELSE
S1C251             COMPUTE W-P-PERC-APPO  ROUNDED = 100 - W-P-PERC-SOMMA
S1C251          END-IF
SLH051          MOVE SO-IMP-RATE-PAG-COINT      TO W-I-APPO-TOT-RATA
SGB012*S1C251   COMPUTE RATE-EFF-PAG-COINT-APPO ROUNDED =
SGB012          COMPUTE RATE-EFF-PAG-COINT-ARRO ROUNDED =
S1G201*                                    (FCEI1-I-TOTANN-RAT-3 *
S1G201                                     (W-I-APPO-TOT-RATA    *
S1C251                                      W-P-PERC-APPO)       / 100
SGB012          MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251   COMPUTE INT-ONE-PAG-COINT-APPO  ROUNDED =
KKKKKK* QUA QUA QUA
SGB012          COMPUTE INT-ONE-PAG-COINT-ARRO  ROUNDED =
S1C251*                                    (FCEI1-I-ANNUAL-INT-1 *
S1C251                                     (APPO-INT-ONE-COINT   *
S1C251                                      W-P-PERC-APPO)       / 100
SKA292          MOVE ZEROES                  TO W-I-NONDET-IMP
SKB251          MOVE APPO-INT-ONE-COINT  TO W-INT-ONE-PAG-COINT-ARRO-TOT
SKB181          MOVE INT-ONE-PAG-COINT-ARRO  TO W-INT-ONE-PAG-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE per COINTESTATI:
SKA292          IF W-F-EKFGT-SI
SKB181            IF ALTRI-IMM-SI
SKB251            OR SO-FLAG-MISTO-COINT = '1'
SKB181             CONTINUE
SKB181            ELSE
DEB>>>*            DISPLAY 'QUI APPLICO DETRAZIONE COI'
SKA292             MOVE INT-ONE-PAG-COINT-ARRO TO W-I-DETRAZ-IMP
SKA292                                            W-I-DETRAZ-APP
SKA292             PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292             MOVE W-I-DETRAZ-IMP TO INT-ONE-PAG-COINT-ARRO
SKA292             COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                      W-I-DETRAZ-IMP
SKB181            END-IF
SKA292          END-IF
SGB012          MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012          PERFORM ARROTONDA-IMPORTO
SGB012          MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COINT-APPO
SHL121
SHL121          MOVE ZEROES                   TO PEN-NON-DET-COINT-APPO
SHL121          IF APPO-PEN-COS-COINT > ZEROES
SHL121            COMPUTE PEN-NON-DET-COINT-ARRO  ROUNDED =
SHL121                                     (APPO-PEN-COS-COINT   *
SHL121                                      W-P-PERC-APPO)       / 100
SKB251            MOVE APPO-PEN-COS-COINT
SKB251                                 TO W-PEN-NON-DET-COINT-ARRO-TOT
SKB181            MOVE PEN-NON-DET-COINT-ARRO
SKB181                                     TO W-PEN-NON-DET-COINT-ARRO
SKA292            IF W-I-NONDET-IMP > ZEROES
SKA292              ADD W-I-NONDET-IMP        TO PEN-NON-DET-COINT-ARRO
SKA292            END-IF
SHL121            MOVE PEN-NON-DET-COINT-ARRO    TO W-I-IMPORT-ARR
SHL121            PERFORM ARROTONDA-IMPORTO
SHL121            MOVE IARRU-I-IMPORT-ARR-O   TO PEN-NON-DET-COINT-APPO
SHL121          ELSE
SHL121             MOVE ZEROES                TO PEN-NON-DET-COINT-APPO
SKB181                                         W-PEN-NON-DET-COINT-ARRO
SKB251                                     W-PEN-NON-DET-COINT-ARRO-TOT
SKA292             IF W-I-NONDET-IMP > ZEROES
SKA292              MOVE W-I-NONDET-IMP     TO W-I-IMPORT-ARR
SKA292              PERFORM ARROTONDA-IMPORTO
SKA292              MOVE IARRU-I-IMPORT-ARR-O TO PEN-NON-DET-COINT-APPO
SKA292             END-IF
SHL121          END-IF
S1C251
DEB>>>*         DISPLAY 'TOTALE-COINT-APPO: '
DEB>>>*                  TOTALE-COINT-APPO
DEB>>>*         DISPLAY 'ID-COINT-COINT-APPO: '
DEB>>>*                  ID-COINT-COINT-APPO
DEB>>>*         DISPLAY 'W-PEN-NON-DET-COINT-ARRO: '
DEB>>>*                  W-PEN-NON-DET-COINT-ARRO
S1C251          IF TOTALE-COINT-APPO NOT EQUAL ID-COINT-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-RATE = W-SOMMA-IMP-RATE
S1C251                                     + RATE-EFF-PAG-COINT-APPO
S1C251            COMPUTE W-SOMMA-IMP-INT  = W-SOMMA-IMP-INT
S1C251                                     + INT-ONE-PAG-COINT-APPO
S1C251          ELSE
SKA292*- Se ricalcolo la % detraibile pro-quota, non conosco il totale
SKA292*  a priori:
SKA292           IF W-F-EKFGT-SI
SKA292            CONTINUE
SKA292           ELSE
SLH051            MOVE SO-IMP-RATE-PAG-COINT
SLH051                         TO IMP-RATE-PAG-COINT-APPO
SGB012*S1C251     COMPUTE RATE-EFF-PAG-COINT-APPO =
SGB012            COMPUTE RATE-EFF-PAG-COINT-ARRO =
S1C251                                           IMP-RATE-PAG-COINT-APPO
S1C251                                           -
S1C251                                           W-SOMMA-IMP-RATE
SGB012            MOVE RATE-EFF-PAG-COINT-ARRO  TO W-I-IMPORT-ARR
SGB012            PERFORM ARROTONDA-IMPORTO
SGB012            MOVE IARRU-I-IMPORT-ARR-O   TO RATE-EFF-PAG-COINT-APPO
SGB012*S1C251     COMPUTE INT-ONE-PAG-COINT-APPO =
SGB012            COMPUTE INT-ONE-PAG-COINT-ARRO =
SGB012*S1C251                                     IMP-INT-ONE-COINT-APPO
SGB012                                            APPO-INT-ONE-COINT
S1C251                                           -
S1C251                                           W-SOMMA-IMP-INT
SGB012            MOVE INT-ONE-PAG-COINT-ARRO
SGB012                                         TO INT-ONE-PAG-COINT-APPO
SGB012*SGB012     MOVE INT-ONE-PAG-COINT-ARRO   TO W-I-IMPORT-ARR
SGB012*SGB012     PERFORM ARROTONDA-IMPORTO
SGB012*SGB012     MOVE IARRU-I-IMPORT-ARR-O     TO INT-ONE-PAG-COI      NT-APPO
DEB>>>*           DISPLAY 'W-SOMMA-IMP-INT: '
DEB>>>*                    W-SOMMA-IMP-INT
DEB>>>*           DISPLAY 'INT-ONE-PAG-COINT-APPO POST ARROT 2: '
DEB>>>*                    INT-ONE-PAG-COINT-APPO
SKA292           END-IF
S1C251          END-IF
S1C251
S1C251          IF TROVATO-MINORE
SLH051          AND INT-ONE-PAG-COINT-ARRO > RATE-EFF-PAG-COINT-APPO
S1C251            MOVE INT-ONE-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
S1C251          ELSE
S1C251            MOVE RATE-EFF-PAG-COINT-APPO  TO SO-RATE-EFF-PAG-COINT
S1C251          END-IF
S1C251
S1C251          MOVE INT-ONE-PAG-COINT-APPO    TO SO-INT-ONE-PAG-COINT
SIB161*SHL121   MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
SJB071          MOVE PEN-NON-DET-COINT-APPO    TO SO-PEN-NON-DET-COINT
S1C251
SMB153          PERFORM VERIFICA-PENALE
S1C251         END-IF
S1C251
SLH051*        Il calcolo tramite proporzione delle rate pagate dai
SLH051*        singoli cointestatari ha problemi di arrotondamento
SLH051         MOVE SO-RATE-EFF-PAG-COINT     TO RATE-EFF-PAG-COINT-APPO
SLH051         ADD RATE-EFF-PAG-COINT-APPO    TO W-APPO-IMP-PAG
SLH051         IF W-APPO-IMP-PAG < W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-I-APPO-TOT-RATA - W-APPO-IMP-PAG
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SMB153*SLH051     AND W-APPO-IMP-PAG-DIFF <
SMB153*SLH051                       RATE-EFF-PAG-COINT-APPO
SMB153            AND W-APPO-IMP-PAG-DIFF <
SMB153                                (RATE-EFF-PAG-COINT-APPO - 1 )
SLH051               ADD W-APPO-IMP-PAG-DIFF  TO RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         IF W-APPO-IMP-PAG > W-I-APPO-TOT-RATA
SLH051            COMPUTE W-APPO-IMP-PAG-DIFF =
SLH051                    W-APPO-IMP-PAG - W-I-APPO-TOT-RATA
SLH051            IF W-APPO-IMP-PAG-DIFF <= 5
SLH051            AND W-APPO-IMP-PAG-DIFF <
SLH051                              RATE-EFF-PAG-COINT-APPO
SLH051               SUBTRACT W-APPO-IMP-PAG-DIFF
SLH051                                      FROM RATE-EFF-PAG-COINT-APPO
SMB153                                           W-APPO-IMP-PAG
SLH051            END-IF
SLH051         END-IF
SLH051         MOVE RATE-EFF-PAG-COINT-APPO   TO SO-RATE-EFF-PAG-COINT
SKB261         MOVE SO-RATE-EFF-PAG-COINT     TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 3: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
FORZAA*        MOVE INT-ONE-PAG-COINT-APPO    TO W-SO-IMP-RATE-PAG-COINT
FORZAA*                                          SO-RATE-EFF-PAG-COINT
S1C251         MOVE W-P-PERC-APPO             TO W-V-PERCENT
S1C251         MOVE W-V-DATINT-VAL            TO SO-PERCENTUALE-COINT
S1C251         MOVE SPACES                    TO FILLER-COINT
S1C251         MOVE 'A'                       TO SO-CAR-CONTROLLO-COINT
S1C251         MOVE W-C-FINE-RIGA(2:1)    TO SO-CAR-FINE-RIGA-COINT(1:1)
S1C251         MOVE W-C-FINE-RIGA(4:1)    TO SO-CAR-FINE-RIGA-COINT(2:1)
SIB201
SKC182*- Se sto trattando l'ultimo NDG, elaboro PROPRIETA' (lo esegue
SKC182*  solo se non ho FGT):
SIB201         IF W-I = W-N-CONTA-IAN
SIB201         AND PROP-CAL-SI
SKC182         AND W-F-EKFGT-NO
SIB201            PERFORM PROPRIETA-COI
SIB201         END-IF
SKC182*SJD121         IF  W-F-EKFGT-SI
SKA292*SJD121           IF FGT9Q-F-PROPRI-IMM-O = 'S'
SKC182*SKA292           IF W-F-PROPRI-IMM = 'S'
SKC182*SJD121             MOVE '1'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           ELSE
SKC182*SJD121             MOVE '0'                 TO SO-PROPR-IMM-COINT
SKC182*SJD121           END-IF
SKC182*SJD121         END-IF
SIB201*
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo (CASO PARTICOLARE X COI):
DEB>>>*        DISPLAY 'FX07FAN9Q-D-STIPUL-OPE-O: ' FAN9Q-D-STIPUL-OPE-O
DEB>>>*        DISPLAY 'FX07FAN9Q-N-FINANZ-NUM-O: ' FAN9Q-N-FINANZ-NUM-O
SKA292         IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SLH051         OR W-F-EKFGT-SI
DEB>>>            DISPLAY 'SCRITTURA SONCO NUOVA'
SKA292*           PERFORM VERIFICA-IFICOINT
SKA292
SKA292            IF IFICOINT-SI
SKA292*- GESTIONE DEGLI IMPORTI TOTALI:
SKA292              IF W-I < W-N-CONTA-IAN
SKA292*- Scrivo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-C-PROPRI-IMM-COINT(W-Y)
SKC182                MOVE W-F-ABITAZ-PRI-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKA292              ELSE
SKA292*- Scrivo l'ultimo su tabellina di appoggio:
SKA292                MOVE W-I       TO W-Y
SKA292                MOVE IAN3I-C-NDGNDG-COD-O(W-I)
SKA292                                         TO W-SO-C-NDGNDG-COD(W-Y)
SKA292                                            W-C-NDGNDG-COD
SKA292                MOVE W-P-DETRAZ-PER
SKA292                                         TO W-SO-P-DETRAZ-COI(W-Y)
SKA292                MOVE SONCORR2
SKA292                               TO W-SO-RECORD-DETTAGLIO-COINT(W-Y)
SKB181*- Importi comprensivi di "detrazione":
SKA292                MOVE SO-INT-ONE-PAG-COINT
SKA292                               TO W-SO-INT-ONE-PAG-COINT(W-Y)
SKA292                                  W-SO-INT-ONE-PAG-COINT-9
SKA292                MOVE SO-PEN-NON-DET-COINT
SKA292                               TO W-SO-PEN-NON-DET-COINT(W-Y)
SKA292                                  W-SO-PEN-NON-DET-COINT-9
SKA292                ADD  W-SO-INT-ONE-PAG-COINT-9
SKA292                               TO W-SO-INT-ONE-PAG-APPO
SKA292                ADD  W-SO-PEN-NON-DET-COINT-9
SKA292                               TO W-SO-PEN-NON-DET-APPO
SKB251*- Appoggio per Tipo mutuo:
SKB251                MOVE SO-TIPO-MUTUO-COINT
SKB251                               TO W-SO-TIPO-MUTUO-COINT(W-Y)
SKB181*- Appoggio per flag "misto":
SKB181                MOVE SO-FLAG-MISTO-COINT
SKB181                               TO W-SO-FLAG-MISTO-COINT(W-Y)
SKB181*- Appoggio per importi totali per NDG originali:
SKB181                MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                               TO W-SO-INT-ONE-PAG-COINT-PRE(W-Y)
SKB251                MOVE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251                           TO W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-Y)
SKB181                MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                               TO W-SO-PEN-NON-DET-COINT-PRE(W-Y)
SKB251                MOVE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251                           TO W-SO-PEN-NON-DET-COINT-PRE-TOT(W-Y)
SKB261                MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                          TO W-SO-IMP-RPAG-COINT-PRE-TOT(W-Y)
SKB181
SKB181*- Reperimento importi da EKFGT:
SKB181                PERFORM REPERISCI-IMPORTI-FGT
SKB181                MOVE W-I-ACQPRI-IPO  TO W-I-ACQPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ACQALT-IPO  TO W-I-ACQALT-IPO-COINT(W-Y)
SKB181                MOVE W-I-RISPRI-IPO  TO W-I-RISPRI-IPO-COINT(W-Y)
SKB181                MOVE W-I-ALTFIN-IPO  TO W-I-ALTFIN-IPO-COINT(W-Y)
SKB181                MOVE W-I-AGRARI-IPO  TO W-I-AGRARI-IPO-COINT(W-Y)
SKB181                MOVE W-I-TOTFIN-IPO  TO W-I-TOTFIN-IPO-COINT(W-Y)
SKB261                IF W-F-ALTFIN-SOLO-SI
SKB261                   SET W-F-ALTFIN-COI-SI TO TRUE
SKB261                END-IF
SKC182*- Gestione COI con immobile non Abitazione principale per tutti:
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKC182                MOVE W-C-PROPRI-IMM-APPO
SKC182                                     TO W-F-ABITAZ-PRI-COINT(W-Y)
SKB261
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261                SET MUTUO-MISTO-2-NO     TO TRUE
SKB261                SET MUTUO-MISTO-3-NO     TO TRUE
SKB261                MOVE ZEROES              TO W-G
SKB261                PERFORM VARYING W-G FROM 1 BY 1
SKB261                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261                   IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(1) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(2) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(3) )
SKB261                   OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261                   AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261                         W-SO-TIPO-MUTUO-COINT(4) )
SKB261                      SET MUTUO-MISTO-2-SI TO TRUE
SKB261                   END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261                   IF W-F-ALTFIN-SOLO-SI
SKB261                   OR W-F-ALTFIN-COI-SI
SKB261                      SET MUTUO-MISTO-3-SI TO TRUE
SKB261                      SET MUTUO-MISTO-2-NO TO TRUE
SKB261                   END-IF
SKB261                END-PERFORM
SKC182                IF FINAL-MISTO-DIV
SLC102                OR FORZO-NON-MISTO-SI
DEB>>>*                  DISPLAY 'FX0709 SETTO NO|'
SKC182                   SET MUTUO-MISTO-3-SI TO TRUE
SKC182                   SET MUTUO-MISTO-2-NO TO TRUE
SKC182                END-IF
SKB261
SKB261                MOVE ZEROES              TO W-G
SKA292
SKB181*- Verifica "MUTUO MISTO":
SKB181                SET MUTUO-MISTO-NO       TO TRUE
SKB181                PERFORM VARYING W-G FROM 1 BY 1
SKB181                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB181                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB181                OR MUTUO-MISTO-SI
SKB181                   IF W-SO-FLAG-MISTO-COINT(W-G) = '1'
SKB261                   OR MUTUO-MISTO-2-SI
SKB181                      SET MUTUO-MISTO-SI TO TRUE
SKB181                   END-IF
SKB181                END-PERFORM
SKB251
SKB261*- Se almeno uno degli NDG } "misto", setto tutto il MUTUO a MISTO
SKB261*               SET MUTUO-MISTO-2-NO     TO TRUE
SKB261*               SET MUTUO-MISTO-3-NO     TO TRUE
SKB261*               MOVE ZEROES              TO W-G
SKB261*               PERFORM VARYING W-G FROM 1 BY 1
SKB261*               UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKB261*               OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKB261*                  IF  ( W-SO-TIPO-MUTUO-COINT(1) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(1) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(2) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(2) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(3) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(3) )
SKB261*                  OR  ( W-SO-TIPO-MUTUO-COINT(4) > SPACES
SKB261*                  AND   W-SO-TIPO-MUTUO-COINT(W-G) NOT =
SKB261*                        W-SO-TIPO-MUTUO-COINT(4) )
SKB261*                     SET MUTUO-MISTO-2-SI TO TRUE
SKB261*                  END-IF
SKB261*- Se "liquidit{" lo metto a NON MISTO|
SKB261*                  IF W-F-ALTFIN-SOLO-SI
SKB261*                  OR W-F-ALTFIN-COI-SI
SKB261*                     SET MUTUO-MISTO-3-SI TO TRUE
SKB261*                     SET MUTUO-MISTO-2-NO TO TRUE
SKB261*                  END-IF
SKB261*               END-PERFORM
SKB261*
SKB261*               MOVE ZEROES              TO W-G
SKC182
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale - tutti i COI devono essere
SKC182*  PROPRIETARI e solo ACQUISTO ABITAZIONE PRINCIPALE. Se supera
SKC182*  questo controllo, vado a testare l'abitazione principale:
SKC182                SET ABITAZ-PRI-NO        TO TRUE
SKC182                PERFORM VARYING W-G FROM 1 BY 1
SKC182                UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                  IF  W-I-ACQPRI-IPO-COINT(W-G) =
SKC182                                 W-I-TOTFIN-IPO-COINT(W-G)
SKC182                  AND W-C-PROPRI-IMM-COINT(W-G) = '1'
SKC182                     SET ABITAZ-PRI-SI   TO TRUE
SKC182                  ELSE
SKC182                     SET ABITAZ-PRI-NO   TO TRUE
SKC182                  END-IF
SKC182                END-PERFORM
SKC182                MOVE ZEROES              TO W-G
SKC182*- Verifica Abitazione Principale:
SKC182                IF ABITAZ-PRI-SI
SKC182                   PERFORM VARYING W-G FROM 1 BY 1
SKC182                   UNTIL W-G > W-N-LUNGH-TAB-SONCO
SKC182                   OR W-SO-C-NDGNDG-COD(W-G) NOT > SPACES
SKC182                      IF W-F-ABITAZ-PRI-COINT(W-G) = 'N'
SKC182                        MOVE '0'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      ELSE
SKC182                        MOVE '1'     TO W-C-PROPRI-IMM-COINT(W-G)
SKC182                      END-IF
SKC182                   END-PERFORM
SKC182                END-IF
SKB181
SMB153                MOVE ZEROES          TO W-I-PENALE
SKA292                PERFORM VARYING W-V FROM 1 BY 1
SKA292                UNTIL W-V > W-N-LUNGH-TAB-SONCO
SKA292                OR W-SO-C-NDGNDG-COD(W-V) NOT > SPACES
DEB>>>                  DISPLAY 'CICLO NUOVO PER NDG: '
DEB>>>                           W-SO-C-NDGNDG-COD(W-V)
SKA292*- Ciclo e scrivo SONCO effettivo:
SKA292                  MOVE W-SO-RECORD-DETTAGLIO-COINT(W-V)
SKA292                                         TO SONCORR2
SKA292                                            W-SONCO-APPO
SKA292*                 MOVE W-SO-INT-ONE-PAG-APPO
SKA292*                                        TO SO-IMP-INT-ONE-COINT
SKA292*                 MOVE W-SO-PEN-NON-DET-APPO
SKA292*                                        TO SO-IMP-PEN-COS-COINT
SKB251                  IF MUTUO-MISTO-2-SI
SKB251                     MOVE '1'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 1'
SKB251                  END-IF
SKB261                  IF MUTUO-MISTO-3-SI
SKB261                     MOVE '0'            TO SO-FLAG-MISTO-COINT
DEB>>>*                    DISPLAY 'FX0709 SO-FLAG-MISTO-COINT 0'
SKB261                  END-IF
SKC182                  IF ABITAZ-PRI-SI
SKC182                     MOVE W-C-PROPRI-IMM-COINT(W-V) TO
SKC182                                               SO-PROPR-IMM-COINT
SKC182                  END-IF
SKB181                  IF MUTUO-MISTO-SI
SKB251                     MOVE W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-INT-ONE-COINT
SKB261                                     W-SO-IMP-INT-ONE-COINT-APPO
SKB251                     MOVE W-SO-PEN-NON-DET-COINT-PRE-TOT(W-V)
SKB251                                  TO W-SO-IMP-PEN-COS-COINT
SKB261                                     W-SO-IMP-PEN-COS-COINT-APPO
SKB261                     MOVE W-SO-IMP-RPAG-COINT-PRE-TOT(W-V)
SKB261                                  TO W-SO-IMP-RATE-PAG-COINT-APPO
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-APPO: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-APPO
SKB181
SKB181                     MOVE W-I-ACQPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQPRI-IPO-APPO
SKB181                     MOVE W-I-ACQALT-IPO-COINT(W-V)
SKB181                                         TO W-I-ACQALT-IPO-APPO
SKB181                     MOVE W-I-RISPRI-IPO-COINT(W-V)
SKB181                                         TO W-I-RISPRI-IPO-APPO
SKB181                     MOVE W-I-ALTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-ALTFIN-IPO-APPO
SKB181                     MOVE W-I-AGRARI-IPO-COINT(W-V)
SKB181                                         TO W-I-AGRARI-IPO-APPO
SKB181                     MOVE W-I-TOTFIN-IPO-COINT(W-V)
SKB181                                         TO W-I-TOTFIN-IPO-APPO
SKB181                     MOVE W-SO-PEN-NON-DET-COINT-PRE(W-V)
SKB181                                         TO W-I-PENNON-PRE-APPO
SKB181                     MOVE W-SO-INT-ONE-PAG-COINT-PRE(W-V)
SKB181                                         TO W-I-INTONE-PRE-APPO
serena      display 'sm27 sono sotto data >2019 mutuo misto'
serena      display 'sm27 W-I-INTONE-PRE-APPO 1=' W-I-INTONE-PRE-APPO
SKB181                     PERFORM GESTIONE-MISTO-COI
SKC182                     IF FINAL-MISTO-DIV
SLC102                     OR FORZO-NON-MISTO-SI
DEB>>>*                       DISPLAY 'FX0709 SETTO NO| 22'
SKC182                        MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182                     END-IF
SKB181
SKB181                  ELSE
SKB181*- Li modifico solo se non sono "misto":
SKB181                     MOVE W-SO-INT-ONE-PAG-APPO
SKB181                                         TO SO-IMP-INT-ONE-COINT
SKB181                     MOVE W-SO-PEN-NON-DET-APPO
SKB181                                         TO SO-IMP-PEN-COS-COINT
SKB251*- Approssimazione degli importi:
SKB251                     PERFORM APPROSSIMA-DETRAZ
SKB251                     IF W-V = W-N-CONTA-IAN
SKB251                        PERFORM APPROSSIMA-DETRAZ-ULT
SKB251                     END-IF
SKB251                     IF W-SO-IMP-INT-ONE-COINT-9 > ZEROES
SKB251                        MOVE W-SO-IMP-INT-ONE-COINT-9
SKB251                                           TO SO-IMP-INT-ONE-COINT
SKB251                     END-IF
SKB181
SKC182                     IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182                     AND ACCOL-NOPROP-NO
DEB>>>                     DISPLAY 'SCRITTURA-SONCO 3'
SKA292                     PERFORM SCRITTURA-SONCO
SKC182                     END-IF
SKB181
SKB181                  END-IF
SKA292
SKA292                END-PERFORM
SKA292
SKA292                INITIALIZE               W-SO-RECORD
SKA292                                         W-SO-INT-ONE-PAG-APPO
SKA292                                         W-SO-PEN-NON-DET-APPO
SKB181                                         W-I-INTONE-PRE-APPO
SKB181                                         W-I-PENNON-PRE-APPO
SKA292
SKA292              END-IF
SKA292            ELSE
serena      display 'sm27 ificoint N'
SKB181              MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261              IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261              OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                 MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261              ELSE
SKB261                 IF FAN00-C-DESFIN-APP = '071A'
SKB261                 OR FAN00-C-DESFIN-APP = '071'
SKB261                 OR FAN00-C-DESFIN-APP = '081'
SKB261                    MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261                 IF FAN00-C-DESFIN-APP = '011A'
SKB261                 OR FAN00-C-DESFIN-APP = '011B'
SKB261                 OR FAN00-C-DESFIN-APP = '011'
SKB261                    MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                 END-IF
SKB261              END-IF
SKA292              MOVE SONCORR2               TO SONCOR22
serena              display 'sm27 scrivo sonco2'
SKA292              PERFORM SCRITTURA-SONC2
SKA292            END-IF
SKA292         ELSE
serena              display 'sm27 data < 2019'
DEB>>>            DISPLAY 'SCRITTURA SONCO STANDARD'
DEB>>>            DISPLAY 'SO-INT-ONE-PAG-COINT : '
DEB>>>                     SO-INT-ONE-PAG-COINT
DEB>>>            DISPLAY 'SO-TIPO-MUTUO-COINT  : '
DEB>>>                     SO-TIPO-MUTUO-COINT
DEB>>>            DISPLAY 'W-F-ACCOL-NOPROP     : '
DEB>>>                     W-F-ACCOL-NOPROP
SKC182            IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182            AND ACCOL-NOPROP-NO
DEB>>>            DISPLAY 'SCRITTURA-SONCO 4'
S1C251            PERFORM SCRITTURA-SONCO
SKC182            END-IF
SKA292         END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012         IF TRM-SI
SGB012            MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012            MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012         END-IF
S1C251        ELSE
S1C251           SET TROVATO-COINT-PG    TO TRUE
S1C251           DISPLAY '----ATTENZIONE---- '
S1C251                   'https://urldefense.com/v3/__http://FIN.TO__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ0qP69mN$  CON COINTESTATARIO PG -->  '
S1C251           FCEI1-C-FINANZ-PRE ' / ' FCEI1-N-FINANZ-NUM
S1C251        END-IF
S1C251       END-PERFORM
SKB251
SKB251*- Ordino e scrivo i mutui misti:
SKB251       MOVE ZEROES                    TO W-M
SKB251       IF MUTUO-MISTO-SI
DEB>>>          DISPLAY 'ELABORO MISTI|||'
SKB251          MOVE ZEROES          TO W-V
SKB251          PERFORM ORDINA-TIPO
SKB261
SKB261          MOVE ZEROES          TO W-V
SKB251          PERFORM VARYING W-V FROM 1 BY 1
SKB251          UNTIL W-V > W-N-LUNGH-TAB-MIS
SKB251          OR W-SO-TIPO-MUTUO-COINT-MIS(W-V) NOT > ZEROES
SKB251             MOVE W-SO-RECORD-DETTAGLIO-MIS(W-V) TO SONCORR2
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(1): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(1)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(2): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(2)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(3): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(3)
DEB>>>*            DISPLAY 'FX0405 W-SO-IMP-PEN-COS-COINT-TOT(4): '
DEB>>>*                            W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261
SKB261*- Sistemazione per importi TOTALI:
SKB261             IF SO-TIPO-MUTUO-COINT = '1'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(1) = '1'
DEB>>>*              DISPLAY 'FX0409 sistemazione 1'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(1)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 5: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(1)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 1: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(1) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(1)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '2'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(2) = '2'
DEB>>>*              DISPLAY 'FX0409 sistemazione 2'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(2)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 6: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(2)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 2: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(2) > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '3'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(3) = '3'
DEB>>>*              DISPLAY 'FX0409 sistemazione 3'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(3)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 7: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(3) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(3)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 3: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(3) > ZEROES
SNC141               OR W-I-ACQALT-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(3)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SKB261             IF SO-TIPO-MUTUO-COINT = '4'
SKB261             AND W-SO-TIPO-MUTUO-COINT-TOT(4) = '4'
DEB>>>*              DISPLAY 'FX0409 sistemazione 4'
SKB261               IF W-SO-IMP-RATE-PAG-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-RATE-PAG-COINT-TOT(4)
SKB261                       TO SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 SO-IMP-RATE-PAG-COINT 8: '
DEB>>>*                        SO-IMP-RATE-PAG-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-INT-ONE-COINT-TOT(4) > ZEROES
SKB261                  MOVE W-SO-IMP-INT-ONE-COINT-TOT(4)
SKB261                       TO SO-IMP-INT-ONE-COINT
DEB>>>*              DISPLAY 'FX0409 SO-IMP-INT-ONE-COINT 4: '
DEB>>>*                              SO-IMP-INT-ONE-COINT
SKB261               END-IF
SKB261               IF W-SO-IMP-PEN-COS-COINT-TOT(4) > ZEROES
SNC141               OR W-I-RISPRI-IPO-APPO > ZEROES
SKB261                  MOVE W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261                       TO SO-IMP-PEN-COS-COINT
SKB261               END-IF
SKB261             END-IF
SLH051*            Se ho solo una finalita certificabile vanno scritti
SLH051*            comunque tutti gli ndg (prima non scriveva i non
SLH051*            certificabili) ma deve essere segnato non misto.
SKC182             IF FINAL-MISTO-DIV
SLC102             OR FORZO-NON-MISTO-SI
SLH051             OR W-FINALI-TOT <= 1
DEB>>>*               DISPLAY 'FX0709 SETTO NO| 23'
SKC182                MOVE '0' TO SO-FLAG-MISTO-COINT
SKC182             END-IF
SKB261
SLH051             IF SO-IMP-RATE-PAG-COINT > SO-IMP-INIZ-COINT
SLH051                MOVE SO-IMP-INIZ-COINT    TO SO-IMP-RATE-PAG-COINT
SLH051             END-IF
SLH051*
SMB153*            IF SO-PEN-NON-DET-COINT = '        0'
SMB153*               MOVE ZEROES               TO SO-IMP-PEN-COS-COINT
SMB153*            END-IF
SMB153*
SKC182             IF SO-TIPO-MUTUO-COINT NOT = '5'
SKC182             AND ACCOL-NOPROP-NO
DEB>>>             DISPLAY 'SCRITTURA-SONCO 5 misti'
SKB251             PERFORM SCRITTURA-SONCO
SKC182             END-IF
SKB251          END-PERFORM
SKB251       END-IF
SKB251
SKB251       PERFORM INIZIALIZZA-RICICLI
SKB251
S1C251      ELSE
SHL121*
SHL121*  2) Gestione Persone Fisiche:
SHL121*
DEB>>>       DISPLAY 'NON COINTESTATO: ' W-N-FINANZ-NUM ' - '
DEB>>>                IAN1I-C-NGIURI-COD-O
DEB>>>       IF IFICOINT-SI
DEB>>>          DISPLAY 'GIRO CON FGT'
DEB>>>       ELSE
DEB>>>          DISPLAY 'GIRO A VECCHIO'
DEB>>>       END-IF
DEB>>>*      IF ANA-SI
S1C251       PERFORM RECUPERA-PROV-NAS
SJD121
SJD121*- Accedo a tabella ANAGRAFE TRIBUTARIA per MONOINTESTATO:
SJD121       SET W-F-EKFGT-NO               TO TRUE
SKB261       SET W-F-ALTFIN-SOLO-NO         TO TRUE
SKA292       IF IFICOINT-SI
SKA292          MOVE IAN1I-C-NDGNDG-COD-O      TO W-C-NDGNDG-COD
SJD121          PERFORM VERIFICA-EKFGT
SKA292       END-IF
SJD121
DEB>>>*      END-IF
S1C251       MOVE 1                         TO  FANT1-N-COINTE-NUM
S1C251       MOVE 1                         TO  FANT1-N-COINTE-PRG
S1C251       MOVE IAN1I-X-NDGNDG-DES-O      TO  FANT1-X-NDGNDG-DES
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO  FANT1-C-TIPSES-NDG
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO  FANT1-D-DATNAS-NDG
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO  FANT1-X-LOCNAS-NDG(6:55)
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO  FANT1-C-CODFIS-NDG
S1C251       PERFORM SCRITTURA-FANT1
S1C251*******************************************************
SGB012*
SGB012*- Scrittura flusso SONCO x ANAGRAFE TRIBUTARIA - NON COINTESTATO:
SGB012*
SGB012*- Gestione dati finanziamenti originari per Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE FAN00-G-AREA-FAN        TO WAFAN-AREA-TRM
SGB012          MOVE FAN9Q-G-AREA-O          TO WAFAN-AREA-FAN9-TRM
SGB012          MOVE FCEI1-C-FINANZ-PRE      TO W-C-FINANZ-PR2
SGB012          IF FCEI1-C-FINANZ-PRE = '41'
SGB012             MOVE '09'                 TO FCEI1-C-FINANZ-PRE
SGB012          ELSE
SGB012             MOVE '10'                 TO FCEI1-C-FINANZ-PRE
SGB012          END-IF
SGB012          PERFORM RICAVA-DATI-FAN
SGB012          MOVE W-C-FINANZ-PR2          TO FCEI1-C-FINANZ-PRE
SGB012       END-IF
S1C251       MOVE '1'                       TO SO-TIPO-REC
SHA041
SG0217       INITIALIZE SO-ID-MUTUO-INT
SHL121*S1C251       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SHL121*S1C251       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SHL121*S1C251       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SIB201*- Siamo tornati al vecchio ID-Mutuo in quanto diagnostico ADE
SIB201*  2018 non gestisce ancora nuovo ID Univoco:
SJB071*SIB201       MOVE FCEI1-C-FINANZ-PRE        TO SO-FINANZ-PRE-INT
SJB071*SIB201       MOVE FCEI1-N-FINANZ-NUM        TO SO-FINANZ-NUM-INT
SJB071*SIB201       MOVE W-N-CONT-ACC              TO SO-KEY-INT
SHA041*      MOVE SPACES                    TO W-ID-RAPP-FIN
SHA041*      IF FCEI1-C-IDENTI-RAP > SPACES
SHA041*         MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SHA041*      ELSE
SHA041*- SERVIZIO: come censito in anagrafe generale:
SHA041*         MOVE SPACES                     TO W-FINANZ-PRE
SHA041*         IF FCEI1-C-FINANZ-PRE = '09'
SHA041*            MOVE FCEI1-C-FINANZ-PRE(2:1) TO W-FINANZ-PRE
SHA041*         ELSE
SHA041*            MOVE FCEI1-C-FINANZ-PRE      TO W-FINANZ-PRE
SHA041*         END-IF
SHA041*- CONTO: come censito in anagrafe generale:
SHA041*         MOVE ALL ZEROES                TO W-C-FINANZ-NUM
SHA041*         MOVE FCEI1-N-FINANZ-NUM        TO W-N-FINANZ-NUM
SHA041*         MOVE W-C-FINANZ-NUM            TO W-FINANZ-NUM
SHA041*         MOVE ALL ZEROES                TO W-APPO-FIN
SHA041*- FILIALE: per i finanziamenti fisso 'IST  ':
SHA041*         MOVE 'IST  '                   TO W-FILIA
SHA041*      END-IF
SHA041*      MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SHA041
SJB071
SJB071       MOVE SPACES                    TO W-ID-RAPP-FIN
SJB071       IF FCEI1-C-IDENTI-RAP > SPACES
SJB071          MOVE FCEI1-C-IDENTI-RAP     TO W-ID-RAPP-FIN
SJB071       ELSE
SJB071          MOVE '-'                    TO W-CAR-FISSO
SJB071          IF FAN00-F-CARTOL-FIN = 'S'
SJB071             MOVE 'CAR'               TO W-MUTUO-TIP
SJB071          ELSE
SJB071             MOVE 'ZZZ'               TO W-MUTUO-TIP
SJB071          END-IF
SJB071          MOVE '00053810149'          TO W-FISCAL-COD(1:11)
SJB211          MOVE ALL ZEROES             TO W-FISCAL-COD(12:5)
SJB071*- SERVIZIO: come censito in anagrafe generale:
SJB071          MOVE ALL ZEROES                 TO W-FINANZ-PRE
SJB211          IF FCEI1-C-FINANZ-PRE = '09'
SJB211             STRING FCEI1-C-FINANZ-PRE(2:1) '00'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          ELSE
SJB211             STRING FCEI1-C-FINANZ-PRE(1:2) '0'
SJB211              DELIMITED BY SIZE INTO W-FINANZ-PRE
SJB211          END-IF
SJB071*- CONTO: come censito in anagrafe generale:
SJB071          MOVE ZEROES                 TO W-C-FINANZ-NUM
SJB071          MOVE FCEI1-N-FINANZ-NUM     TO W-N-FINANZ-NUM
SJB071          MOVE W-C-FINANZ-NUM         TO W-FINANZ-NUM
SJB211          MOVE ALL ZEROES             TO W-APPO-FIN
SJB071*- FILIALE: per i finanziamenti fisso 'IST  ':
SJB211          MOVE 'IST00'                TO W-FILIA
SJB071       END-IF
SJB071       MOVE W-ID-RAPP-FIN             TO SO-ID-RAPP-FIN
SJB071
S1C251       IF FAN9Q-C-CONVEN-COD-O = 'RINEGOZ.'
CORRAD       OR FAN9Q-C-CONVEN-COD-O = 'RINEGOZI'
S1C251          MOVE FAN9Q-D-STIPUL-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
S1C251          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       ELSE
S1C251          MOVE FAN9Q-D-EROGAZ-OPE-O      TO W-APPO-DATA-X
SIB091                                            W-D-STIPUL-ADE
S1C251          MOVE W-APPX-GG             TO W-APP9-GG
S1C251          MOVE W-APPX-MM             TO W-APP9-MM
S1C251          MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251          MOVE W-APP9-GG         TO SO-DATA-STIPULA-INT(1:2)
S1C251          MOVE W-APP9-MM         TO SO-DATA-STIPULA-INT(3:2)
S1C251          MOVE W-APP9-SSAA       TO SO-DATA-STIPULA-INT(5:4)
SJB071*S1C251   COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-EROGAZ-FIN-O
SJB071          COMPUTE IMP-INIZ-INT-APPO ROUNDED = FAN9Q-I-STIPUL-FIN-O
S1C251       END-IF
S1G201*      COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
S1G201*                                             FCEI1-I-TOTANN-RAT-3
DEB>>>*      DISPLAY 'DATI NUOVI SONCO: '
S1G201       IF TROVATO-FIN-VALUTA
DEB>>>*         DISPLAY 'TROVATO-FIN-VALUTA'
S1G201          COMPUTE IMP-INIZ-INT-APPO ROUNDED =
S1G201                                            FCEI1-I-EROGAZ-FIN-VAL
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-VAL-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-VAL-3   TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-VAL-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP-VAL > ZEROES
SJB071          OR W-APPO-MORA            > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE-VAL > ZEROES
SNC091          OR W-I-NONTRAC-IMP-VAL    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                         FCEI1-I-NONDET-IMP-VAL +
SNC091                                         W-I-NONTRAC-IMP-VAL    +
SJB071                                         W-APPO-MORA            +
SJB071                                         FCEI1-I-ASSICU-ONE-VAL
SIB161*SHL121      MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071             MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       ELSE
SGB012*S1G201   COMPUTE IMP-RATE-PAG-INT-APPO ROUNDED =
SGB012          COMPUTE IMP-RATE-PAG-INT-ARRO ROUNDED =
S1G201                                          FCEI1-I-TOTANN-RAT-3
S5A281*S1G201   MOVE FCEI1-I-MORA-PAGAT-3       TO W-APPO-MORA
S5A281          COMPUTE W-APPO-MORA ROUNDED = FCEI1-I-MORA-PAGAT-3
S1C251          MOVE IMP-INIZ-INT-APPO          TO SO-IMP-INIZ-INT
SHL121          IF FCEI1-I-NONDET-IMP > ZEROES
SJB071          OR W-APPO-MORA        > ZEROES
SJB071          OR FCEI1-I-ASSICU-ONE > ZEROES
SNC091          OR W-I-NONTRAC-IMP    > ZEROES
SHL121             COMPUTE IMP-PEN-COS-NONDET ROUNDED =
SHL121                                            FCEI1-I-NONDET-IMP +
SNC091                                            W-I-NONTRAC-IMP    +
SJB071                                            W-APPO-MORA        +
SJB071                                            FCEI1-I-ASSICU-ONE
SIB161*SHL121     MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SJB071            MOVE IMP-PEN-COS-NONDET         TO SO-IMP-PEN-NON-DET
SHL121          END-IF
S1G201       END-IF
SJD121*      IF  W-F-EKFGT-SI
SJD121*          COMPUTE IMP-INIZ-COINT-APPO ROUNDED =
SJD121*                                           W-I-TOTIMP-TOT
SJD121*          MOVE IMP-INIZ-COINT-APPO       TO SO-IMP-INIZ-INT
SJD121*      END-IF
SGB012       MOVE IMP-RATE-PAG-INT-ARRO         TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O          TO IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'IMP-RATE-PAG-INT-APPO: '
DEB>>>*               IMP-RATE-PAG-INT-APPO
DEB>>>*      DISPLAY 'W-APPO-MORA          : '
DEB>>>*               W-APPO-MORA
S1C251       COMPUTE W-I-DELTA-MORA ROUNDED = IMP-RATE-PAG-INT-APPO
S1C251                                      - W-APPO-MORA
DEB>>>*      DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
displa*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' SO-IMP-RATE-PAG-INT
S1C251       MOVE IMP-RATE-PAG-INT-APPO       TO SO-IMP-RATE-PAG-INT
SLH051       IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051          MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051       END-IF
SLH051*
S2B161       IF   FCEI1-C-FINANZ-PRE NOT EQUAL '41'
S2B161       AND  FCEI1-C-FINANZ-PRE NOT EQUAL '42'
DEB>>>*        DISPLAY 'W-I-DELTA-MORA   : ' W-I-DELTA-MORA
DEB>>>*        DISPLAY 'IMP-INIZ-INT-APPO: ' IMP-INIZ-INT-APPO
S1C251         IF W-I-DELTA-MORA > IMP-INIZ-INT-APPO
DEB>>>          DISPLAY '|||||| ERRORE P020 PAG>MUTUO: ' W-N-FINANZ-NUM
SKB261          CONTINUE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'IMPORTO RATE PAGATE > https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  MUTUO'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P020'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251         END-IF
S2B161       END-IF
DEB>>>*      DISPLAY 'FLUSSO SONCO X ANAGRAFE TRIBUTARIA - NON COI'
S1C251*      COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = FCEI1-I-ANNUAL-INT-1
SGB012
S1C251       COMPUTE IMP-INT-ONE-INT-APPO ROUNDED = APPO-I-VOCE0  +
S1C251                                              APPO-I-VOCE2  +
S1C251                                              APPO-I-VOCE3  +
S1C251                                              APPO-I-VOCE7
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO: ' IMP-INT-ONE-INT-APPO
DEB>>>*      DISPLAY 'APPO-I-VOCE0: ' APPO-I-VOCE0
DEB>>>*      DISPLAY 'APPO-I-VOCE2: ' APPO-I-VOCE2
DEB>>>*      DISPLAY 'APPO-I-VOCE3: ' APPO-I-VOCE3
DEB>>>*      DISPLAY 'APPO-I-VOCE7: ' APPO-I-VOCE7
SGB012
SGB012       PERFORM IMPORTI-ANAGRAFE
SGB012       IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA-VAL +
SNB211*SGB012                                       W-I-SPERAT-ANA-VAL +
SGB012                                            W-I-SPEIST-ANA-VAL +
SGB012                                            W-I-IMPSOS-ANA-VAL +
SGB012                                            W-I-PENEST-ANA-VAL +
SGB012                                            W-I-COMINT-ANA-VAL +
SGB012                                            W-I-ONEACC-ANA-VAL +
SGB012                                            W-I-ONESAL-ANA-VAL +
SGB012                                            W-I-ONECER-ANA-VAL
SGB012       ELSE
SGB012          COMPUTE IMP-INT-ONE-INT-ARRO-NEW ROUNDED =
SGB012                                            W-I-INTVAR-ANA +
SNB211*SGB012                                           W-I-SPERAT-ANA +
SGB012                                            W-I-SPEIST-ANA +
SGB012                                            W-I-IMPSOS-ANA +
SGB012                                            W-I-PENEST-ANA +
SGB012                                            W-I-COMINT-ANA +
SGB012                                            W-I-ONEACC-ANA +
SGB012                                            W-I-ONESAL-ANA +
SGB012                                            W-I-ONECER-ANA
DEB>>>          DISPLAY 'W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>          DISPLAY 'W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>          DISPLAY 'W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>          DISPLAY 'W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>          DISPLAY 'W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>          DISPLAY 'W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>          DISPLAY 'W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>          DISPLAY 'W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>          DISPLAY 'W-I-ONECER-ANA: ' W-I-ONECER-ANA
SGB012       END-IF
SKA292
SKB181*- Qui verifico qual } l'importo maggiore tra i segnalati per
SKB181*  assegnare la corretta tipologia: per la nuova gestione del
SKB181*  mutuo "misto" la facciamo e "correggiamo" all'interno dei
SKB181*  singoi record.
SKB181       SET ALTRI-IMM-NO              TO TRUE
SJD121       IF  W-F-EKFGT-SI
SJD121           MOVE W-I-AGRARI-IPO       TO WAPPO-I-TIPOLO-MUT(1)
SJD121           MOVE 'I-AGRARI-IPO'       TO WAPPO-C-TIPOLO-TIP(1)
SJD121           MOVE W-I-ACQPRI-IPO       TO WAPPO-I-TIPOLO-MUT(2)
SJD121           MOVE 'I-ACQPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(2)
SJD121           MOVE W-I-ACQALT-IPO       TO WAPPO-I-TIPOLO-MUT(3)
SJD121           MOVE 'I-ACQALT-IPO'       TO WAPPO-C-TIPOLO-TIP(3)
SKC182*SJD121    MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182*SJD121    MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182*SJD121    MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182*SJD121    MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SKC182           MOVE W-I-RISPRI-IPO       TO WAPPO-I-TIPOLO-MUT(4)
SKC182           MOVE 'I-RISPRI-IPO'       TO WAPPO-C-TIPOLO-TIP(4)
SKC182           MOVE W-I-ALTFIN-IPO       TO WAPPO-I-TIPOLO-MUT(5)
SKC182           MOVE 'I-ALTFIN-IPO'       TO WAPPO-C-TIPOLO-TIP(5)
SJD121
SJD121           PERFORM ORDINA-IMPORTI
SJD121
SJD121           EVALUATE TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-AGRARI-IPO'
SJD121               SET AGRARIO-INT      TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQPRI-IPO'
SJD121               SET ABIT-PRIN-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ACQALT-IPO'
SKC182*SJD121    WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SJD121               SET ALTRI-IMM-INT    TO TRUE
SJD121           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-RISPRI-IPO'
SJD121               SET COST-RIST-INT    TO TRUE
SKC182           WHEN WAPPO-C-TIPOLO-TIP(5) = 'I-ALTFIN-IPO'
SKC182               SET ALTFIN-INT       TO TRUE
SJD121           END-EVALUATE
SKB181           IF ALTRI-IMM-INT
SKB181           AND W-I-AGRARI-IPO =  ZEROES
SKB181           AND W-I-ACQPRI-IPO =  ZEROES
SKB181           AND W-I-RISPRI-IPO =  ZEROES
SKB181              SET ALTRI-IMM-SI          TO TRUE
SKB181           END-IF
SJD121       END-IF
SKB181
SKB181       MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-INT-ONE-PAG-COINT-ARRO
SKB181       MOVE IMP-PEN-COS-NONDET       TO W-PEN-NON-DET-COINT-ARRO
SKA292*- Qui applico la % di DETRAZIONE MONO:
SKA292       IF W-F-EKFGT-SI
SKB181         IF ALTRI-IMM-SI
SKB181           CONTINUE
SKB181         ELSE
DEB>>>          DISPLAY 'APPLICO DETRAZIONE PF|'
SKA292          MOVE IMP-INT-ONE-INT-ARRO-NEW TO W-I-DETRAZ-IMP
SKA292                                           W-I-DETRAZ-APP
SKA292          PERFORM TRATTA-IMPORTO-DETRAIBILE
SKA292          MOVE W-I-DETRAZ-IMP TO IMP-INT-ONE-INT-ARRO-NEW
SKA292          COMPUTE W-I-NONDET-IMP = W-I-DETRAZ-APP -
SKA292                                   W-I-DETRAZ-IMP
SKA292          COMPUTE W-SO-IMP-PEN-NON-DET = IMP-PEN-COS-NONDET +
SKA292                                       W-I-NONDET-IMP
SKA292          MOVE W-SO-IMP-PEN-NON-DET    TO W-I-IMPORT-ARR
SKA292          PERFORM ARROTONDA-IMPORTO
SKA292          MOVE IARRU-I-IMPORT-ARR-O    TO SO-IMP-PEN-NON-DET
SKB181         END-IF
SKA292       END-IF
SKA292
SGB012       MOVE IMP-INT-ONE-INT-ARRO-NEW  TO W-I-IMPORT-ARR
SGB012       PERFORM ARROTONDA-IMPORTO
SGB012       MOVE IARRU-I-IMPORT-ARR-O      TO IMP-INT-ONE-INT-APPO-NEW
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO    : '
DEB>>>*               IMP-INT-ONE-INT-APPO
DEB>>>*      DISPLAY ' -->   APPO-I-VOCE0  : ' APPO-I-VOCE0
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE2  : ' APPO-I-VOCE2
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE3  : ' APPO-I-VOCE3
DEB>>>*      DISPLAY ' --> + APPO-I-VOCE7  : ' APPO-I-VOCE7
DEB>>>       DISPLAY 'IMP-INT-ONE-INT-ARRO-NEW 2: '
DEB>>>                IMP-INT-ONE-INT-ARRO-NEW
DEB>>>*      DISPLAY 'IMP-INT-ONE-INT-APPO-NEW: '
DEB>>>*               IMP-INT-ONE-INT-APPO-NEW
DEB>>>*      IF FCEI1-C-TIPO-FINAN(1:1) = 'V'
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-ANA-VAL: ' W-I-INTVAR-ANA-VAL
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-TOT-VAL: ' W-I-INTVAR-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-ANA-VAL: ' W-I-SPERAT-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-TOT-VAL: ' W-I-SPERAT-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-ANA-VAL: ' W-I-SPEIST-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-TOT-VAL: ' W-I-SPEIST-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-ANA-VAL: ' W-I-IMPSOS-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-TOT-VAL: ' W-I-IMPSOS-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-PENEST-ANA-VAL: ' W-I-PENEST-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-PENEST-TOT-VAL: ' W-I-PENEST-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-COMINT-ANA-VAL: ' W-I-COMINT-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-COMINT-TOT-VAL: ' W-I-COMINT-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-ANA-VAL: ' W-I-ONEACC-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-TOT-VAL: ' W-I-ONEACC-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-ANA-VAL: ' W-I-ONESAL-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-TOT-VAL: ' W-I-ONESAL-TOT-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONECER-ANA-VAL: ' W-I-ONECER-ANA-VAL
DEB>>>*      DISPLAY ' --> + W-I-ONECER-TOT-VAL: ' W-I-ONECER-TOT-VAL
DEB>>>*      DISPLAY '****'
DEB>>>*      ELSE
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-ANA: ' W-I-INTVAR-ANA
DEB>>>*      DISPLAY ' -->   W-I-INTVAR-TOT: ' W-I-INTVAR-TOT
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-ANA: ' W-I-SPERAT-ANA
DEB>>>*      DISPLAY ' --> + W-I-SPERAT-TOT: ' W-I-SPERAT-TOT
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-ANA: ' W-I-SPEIST-ANA
DEB>>>*      DISPLAY ' --> + W-I-SPEIST-TOT: ' W-I-SPEIST-TOT
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-ANA: ' W-I-IMPSOS-ANA
DEB>>>*      DISPLAY ' --> + W-I-IMPSOS-TOT: ' W-I-IMPSOS-TOT
DEB>>>*      DISPLAY ' --> + W-I-PENEST-ANA: ' W-I-PENEST-ANA
DEB>>>*      DISPLAY ' --> + W-I-PENEST-TOT: ' W-I-PENEST-TOT
DEB>>>*      DISPLAY ' --> + W-I-COMINT-ANA: ' W-I-COMINT-ANA
DEB>>>*      DISPLAY ' --> + W-I-COMINT-TOT: ' W-I-COMINT-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-ANA: ' W-I-ONEACC-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONEACC-TOT: ' W-I-ONEACC-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-ANA: ' W-I-ONESAL-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONESAL-TOT: ' W-I-ONESAL-TOT
DEB>>>*      DISPLAY ' --> + W-I-ONECER-ANA: ' W-I-ONECER-ANA
DEB>>>*      DISPLAY ' --> + W-I-ONECER-TOT: ' W-I-ONECER-TOT
DEB>>>*      DISPLAY '****'
DEB>>>*      END-IF
DEB>>>*      DISPLAY 'IMPORTI APPO '  APPO-I-VOCE0 ' '  APPO-I-VOCE2
DEB>>>*          ' '  APPO-I-VOCE3 ' ' APPO-I-VOCE7
SGB012*S1C251    MOVE IMP-INT-ONE-INT-APPO        TO SO-IMP-INT-ONE-INT
SGB012       MOVE IMP-INT-ONE-INT-APPO-NEW    TO SO-IMP-INT-ONE-INT
SGB012*S1C251       IF IMP-INT-ONE-INT-APPO > IMP-RATE-PAG-INT-APPO
SGB012       IF IMP-INT-ONE-INT-APPO-NEW > IMP-RATE-PAG-INT-APPO
DISPLA*      DISPLAY 'IMPORTI INTERESSI '
DISPLA*           IMP-RATE-PAG-INT-APPO ' ' IMP-INT-ONE-INT-APPO
DISPLA*           ' '  SO-IMP-INT-ONE-INT ' ' SO-IMP-RATE-PAG-INT
S1C251          MOVE SO-IMP-INT-ONE-INT       TO SO-IMP-RATE-PAG-INT
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121          IF RATE-A-ZERO-SI
SLC151*SLC121          AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151          IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121          END-IF
SLH051          IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051             MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051          END-IF
SLH051*
S1C251*      AND FAN9Q-D-ESTINZ-DAT-O ='0001-01-01'
S1C251*      AND FAN9Q-D-SCDPRI-DAT-O <= EKIFB-D-RIFERI-OPE
S1C251*         MOVE '0026'                   TO EKERR-C-COD-ERRORE(1)
S1C251*         SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251*         MOVE 'https://urldefense.com/v3/__http://AMM.RE__;!!LQkDIss!WG5Pcb8EPEZ2qvumQVZIR7Tlm7zgrMcbV4GLBpwI_JmW8fzE9yiYUxl-F8HwbL3kWU6B2XoZ-DVGZ5GOzUn8$  INTERESSI E ONERI > IMPORTO RATE PAGATE'
S1C251*                                    TO EKERR-X-DES-ERRORE(1)
S1C251*         MOVE 'P021'                TO EKERR-C-RIF-ERRORE(1)
S1C251*         PERFORM R-ERRORE-NON-GESTIBILE
S1C251       END-IF
SKB281       MOVE SO-IMP-RATE-PAG-INT       TO W-SO-IMP-RATE-PAG-COINT
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT 9: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT
DEB>>>*      DISPLAY 'SO-IMP-INT-ONE-INT FINE: '
DEB>>>*               SO-IMP-INT-ONE-INT
SOE142*SHA041       MOVE FCEI1-F-ESTINZ-TIP        TO SO-FLAG-ESTINZ-INT
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP = 'E'
SOE142             MOVE '3'                   TO SO-FLAG-ESTINZ-INT
SOE142         ELSE
SOE142             MOVE FCEI1-F-ESTINZ-TIP    TO SO-FLAG-ESTINZ-INT
SOE142         END-IF
DEBUG>*        DISPLAY 'SO-FLAG-ESTINZ-INT>' SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 SO-FLAG-ESTINZ-INT: '
DEB>>>*                        SO-FLAG-ESTINZ-INT
DEB>>>*      DISPLAY 'FX0709 W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
SKC182*- Se il MUTUO } ACCOLLATO (SO-FLAG-ESTINZ-INT a "4") ed il
SKC182*  flag PROPRIETA' non } valorizzato --> non lo comunico|
SKC182       SET ACCOL-NOPROP-NO            TO TRUE
SKC182       IF SO-FLAG-ESTINZ-INT = '4'
SKC182       AND W-F-PROPRI-IMM = 'N'
SKC182           SET ACCOL-NOPROP-SI        TO TRUE
DEB>>>*           DISPLAY 'SETTO ACCOL-NOPROP-SI|||'
SKC182       END-IF
SMK281
SMK281       MOVE SPACES                    TO SO-FLAG-OPESOC-INT
SMK281       MOVE SPACES                    TO SO-ID-MUTUO-CED-INT
SKB181
SKB181       IF  W-F-EKFGT-NO
SKB181
S1C251       SET NO-TROVATO-TIPO-FIN        TO TRUE
S1C251       IF FAN9Q-C-TIPO-FINAN-O = 'AGR'
SG0215       OR FAN9Q-C-TIPO-FINAN-O = 'MAG'
S1C251          MOVE 1                      TO SO-TIPO-MUTUO-INT
S1C251       ELSE
S1C251          IF (FAN9Q-C-TIPO-FINAN-O = 'MUT' OR 'VUT'
SIB201*SG0215          OR  'MAT')
SIB201          OR  'MAT' OR 'PIV' )
S1C251          AND FCEI1-C-GARANZ-TIP = 'I'
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '070'  OR '070A' OR
S1C251*                                         '070B' OR '071'  OR
S1C251*                                         '080A' OR '081'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '071A' OR '071'  OR
SG0215                                          '081'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 2                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251*           IF FAN9Q-C-DESFIN-APP-O EQUAL '010' OR '010A' OR
S1C251*                                         '011' OR '130B' OR
S1C251*                                         '130C'
SG0215            IF FAN9Q-C-DESFIN-APP-O EQUAL '011A' OR '011B' OR
SG0215                                          '011'
S1C251               SET TROVATO-TIPO-FIN     TO TRUE
S1C251               MOVE 4                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251            IF NO-TROVATO-TIPO-FIN
S1C251               MOVE 3                   TO  SO-TIPO-MUTUO-INT
S1C251            END-IF
S1C251          END-IF
S1C251       END-IF
SKB181
SKB181       END-IF
SKB181
SHL121
SIB161*SHL121       MOVE '0'                       TO SO-FLAG-MISTO-INT
SJB071       MOVE '0'                       TO SO-FLAG-MISTO-INT
SKB181       SET MUTUO-MISTO-NO             TO TRUE
SKB181       MOVE ZEROES                    TO W-I-ALTIMM-TOT
SJD121       IF  W-F-EKFGT-SI
SJD121           EVALUATE TRUE
SJD121           WHEN    W-I-AGRARI-IPO > 0
SJD121               MOVE '0'                 TO SO-FLAG-MISTO-INT
SKB181               SET MUTUO-MISTO-NO       TO TRUE
SJD121           WHEN OTHER
SKC182* Solo: EKFGT_I_ACQPRI_IPO
SKC182*       EKFGT_I_ACQALT_IPO
SKC182*       EKFGT_I_RISPRI_IPO sono detraibili.
SKC182* Per : EKFGT_I_ALTFIN_IPO non viene trattata.
SKC182*SKB181               COMPUTE W-I-ALTIMM-TOT = W-I-ACQALT-IPO +
SKC182*SKB181                                        W-I-ALTFIN-IPO
SJD121               IF (W-I-ACQPRI-IPO   > 0
SJD121               AND W-I-ACQPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ACQALT-IPO   > 0
SKB181*SJD121        AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SKC182               OR (W-I-ACQALT-IPO   > 0
SKC182               AND W-I-ACQALT-IPO   <  W-I-TOTFIN-IPO)
SJD121               OR (W-I-RISPRI-IPO   > 0
SJD121               AND W-I-RISPRI-IPO   <  W-I-TOTFIN-IPO)
SKB181*SJD121        OR (W-I-ALTFIN-IPO   > 0
SKB181*SJD121        AND W-I-ALTFIN-IPO   <  W-I-TOTFIN-IPO)
SKC182*SKB181        OR (W-I-ALTIMM-TOT   > 0
SKC182*SKB181        AND W-I-ALTIMM-TOT   <  W-I-TOTFIN-IPO)
SJD121                   MOVE '1'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-SI   TO TRUE
SJD121               ELSE
SJD121                   MOVE '0'             TO SO-FLAG-MISTO-INT
SKB181                   SET MUTUO-MISTO-NO   TO TRUE
SJD121               END-IF
SJD121            END-EVALUATE
SJD121       END-IF
SHL121
S1C251       MOVE IAN1I-C-FISCAL-COD-O      TO SO-CODICE-FIS-INT
S1C251       MOVE IAN1I-X-COGNOM-DES-O      TO SO-COGNOME-INT
S1C251       MOVE IAN1I-X-NOME-DES-O        TO SO-NOME-INT
S1C251       MOVE IAN1I-X-NASCIT-LOC-O      TO SO-COMSTA-NAS-INT
S1C251       MOVE IAN1I-C-PERSON-SEX-O      TO SO-SESSO-INT
S1C251       MOVE IAN1I-D-NASCIT-DAT-O      TO W-APPO-DATA-X
S1C251       MOVE W-APPX-GG                 TO W-APP9-GG
S1C251       MOVE W-APPX-MM                 TO W-APP9-MM
S1C251       MOVE W-APPX-SSAA               TO W-APP9-SSAA
S1C251       MOVE W-APP9-GG              TO SO-DATA-NASCITA-INT(1:2)
S1C251       MOVE W-APP9-MM              TO SO-DATA-NASCITA-INT(3:2)
S1C251       MOVE W-APP9-SSAA            TO SO-DATA-NASCITA-INT(5:4)
S1C251       MOVE SPACES                 TO FILLER-INT
S1C251       MOVE 'A'                    TO SO-CAR-CONTROLLO-INT
S1C251       MOVE W-C-FINE-RIGA(2:1)     TO SO-CAR-FINE-RIGA-INT(1:1)
S1C251       MOVE W-C-FINE-RIGA(4:1)     TO SO-CAR-FINE-RIGA-INT(2:1)
SKA292
SKA292*- Per STIPULATI nel 2019 verifico se ho FGT valorizzata: se no,
SKA292*  scrivo flusso parallelo:
DEB>>>*      DISPLAY 'FX2007 FAN9Q-D-STIPUL-OPE-O: 'FAN9Q-D-STIPUL-OPE-O
DEB>>>*      DISPLAY 'FX2007 FAN9Q-N-FINANZ-NUM-O: 'FAN9Q-N-FINANZ-NUM-O
SKA292       IF FAN9Q-D-STIPUL-OPE-O >= '2019-01-01'
SKA292          IF IFICOINT-SI
DEB>>>*      DISPLAY 'FX2007 IFICOINT-SI'
SKB181            IF MUTUO-MISTO-SI
DEB>>>               DISPLAY 'MUTUO MISTO|'
SKB181
SKB181               MOVE SONCORR2             TO W-SONCO-APPO
SKB181
SKB181               MOVE IAN1I-C-NDGNDG-COD-O TO W-C-NDGNDG-COD
SKB181               PERFORM REPERISCI-IMPORTI-FGT
SKB181               MOVE W-I-ACQPRI-IPO
SKB181                                   TO W-I-ACQPRI-IPO-APPO
SKB181               MOVE W-I-ACQALT-IPO
SKB181                                   TO W-I-ACQALT-IPO-APPO
SKB181               MOVE W-I-RISPRI-IPO
SKB181                                   TO W-I-RISPRI-IPO-APPO
SKB181               MOVE W-I-ALTFIN-IPO
SKB181                                   TO W-I-ALTFIN-IPO-APPO
SKB181               MOVE W-I-AGRARI-IPO
SKB181                                   TO W-I-AGRARI-IPO-APPO
SKB181               MOVE W-I-TOTFIN-IPO
SKB181                                   TO W-I-TOTFIN-IPO-APPO
SKB181               MOVE W-INT-ONE-PAG-COINT-ARRO
SKB181                                   TO W-I-INTONE-PRE-APPO
SKB181               MOVE W-PEN-NON-DET-COINT-ARRO
SKB181                                   TO W-I-PENNON-PRE-APPO
SKB261               MOVE W-SO-IMP-RATE-PAG-COINT
SKB261                                   TO W-I-TOTRAT-PAG-APPO
SKB181
SKB181               PERFORM GESTIONE-MISTO-PF
SKA292
SKB181               INITIALIZE             W-I-INTONE-PRE-APPO
SKB181                                      W-I-PENNON-PRE-APPO
SKB281                                      W-I-TOTRAT-PAG-APPO
SKB181
SKB181            ELSE
SKC182*             IF W-F-ALTFIN-SOLO-NO
DEB>>>*             DISPLAY 'SO-TIPO-MUTUO-INT: '
DEB>>>*                      SO-TIPO-MUTUO-INT
DEB>>>*             DISPLAY 'W-F-ACCOL-NOPROP: '
DEB>>>*                      W-F-ACCOL-NOPROP
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281              IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281                 MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281              END-IF
SLC043              IF SO-TIPO-MUTUO-INT NOT = '5'
SLC043              AND ACCOL-NOPROP-NO
DEB>>>                DISPLAY 'SCRITTURA-SONCO 6'
SKA292                PERFORM SCRITTURA-SONCO
SLC043              END-IF
SKC182*             END-IF
SKB181            END-IF
SKA292          ELSE
SKB181             MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB261             IF FAN00-C-TIPO-FINAN = 'AGR'
SKB261             OR FAN00-C-TIPO-FINAN = 'MAG'
SKB261                MOVE '1'                 TO SO-TIPO-MUTUO-INT
SKB261             ELSE
SKB261                IF FAN00-C-DESFIN-APP = '071A'
SKB261                OR FAN00-C-DESFIN-APP = '071'
SKB261                OR FAN00-C-DESFIN-APP = '081'
SKB261                   MOVE '2'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261                IF FAN00-C-DESFIN-APP = '011A'
SKB261                OR FAN00-C-DESFIN-APP = '011B'
SKB261                OR FAN00-C-DESFIN-APP = '011'
SKB261                   MOVE '4'              TO SO-TIPO-MUTUO-INT
SKB261                END-IF
SKB261             END-IF
SKA292             MOVE SONCORR2               TO SONCOR22
SKA292             PERFORM SCRITTURA-SONC2
SKA292          END-IF
SKA292       ELSE
DEB>>>          DISPLAY 'SCRITTURA-SONCO 7: 'SO-TIPO-MUTUO-INT
SKC182          IF SO-TIPO-MUTUO-INT NOT = '5'
SKC182          AND ACCOL-NOPROP-NO
DEB>>>          DISPLAY 'SCRITTURA-SONCO'
S1C251          PERFORM SCRITTURA-SONCO
SKC182          END-IF
SKA292       END-IF
SKA292
SGB012*- Ripristino dati Tremonti:
SGB012       IF TRM-SI
SGB012          MOVE WAFAN-AREA-TRM         TO FAN00-G-AREA-FAN
SGB012          MOVE WAFAN-AREA-FAN9-TRM    TO FAN9Q-G-AREA-O
SGB012       END-IF
S1C251      END-IF
S1C251     END-IF
SKB251
SKB251     PERFORM INIZIALIZZA-RICICLI
SJB071
SJB071*- Verifiche su flag propriet{ per cointestati:
SJB071     IF IAN1I-C-NGIURI-COD-O = 'COI'
SJB071        MOVE ZEROES                   TO W-X
SJB071        SET PRO-NO                    TO TRUE
SJB071        PERFORM VARYING W-X FROM 1 BY 1
SJB071         UNTIL W-K > 500
SJB071         OR W-C-NDGNDG-COD-COI(W-X) = SPACES OR LOW-VALUES
SJB071            IF W-C-PROPRI-IMM-COI(W-X) = '1'
SJB071               SET PRO-NO             TO TRUE
SJB071            END-IF
SJB071        END-PERFORM
SJB071
SJB071        IF PRO-NO
SJB071           MOVE '0231'                TO EKERR-C-COD-ERRORE(1)
SJB071           MOVE 'P024'                TO EKERR-C-RIF-ERRORE(1)
SJB071           MOVE 'FLAG PROPRIETA'' NON VALORIZZATO'
SJB071                                      TO EKERR-X-DES-ERRORE(1)
SJB071           PERFORM MESSAGGIO-WARNING
SJB071        END-IF
SJB071     END-IF
DEB>>>*    DISPLAY 'FINE FANT1 E SONCO'
090309     .

AGGTRI RECUPERA-PROV-NAS.
AGGTRI     MOVE 'RECUPERA-PROV-NAS'         TO IDBGU-X-LABEL-TRAC
AGGTRI     MOVE 3                           TO IDBGU-C-LIVELL-TRA
AGGTRI     PERFORM R-TRACE-LABEL.
AGGTRI
AGGTRI* CHIAMATA AD ANAGRAFE PER AVERE I DATI DELL'NDG DEL MUTUO
AGGTRI* NB: CHIAMO DIRETTAMENTE I MODLULI DI ANAGRAFE AGR033 E AGR080
AGGTRI* PERCHE' MI SERVONO DEI DATI CHE I MODULI INTERFACCIA ELISE DI
AGGTRI* CHIAMATA ALL'ANAGRAFE (EKIAN...) NON RESTITUISCONO.
AGGTRI
AGGTRI**** CHIAMATA A AGR0033
AGGTRI     INITIALIZE                          AGR33-AREA
AGGTRI     MOVE IAN1I-C-NDGNDG-COD-O        TO AGR33-I-NDG
AGGTRI     PERFORM CL-AGR0033
AGGTRI
AGGTRI     EVALUATE AGR33-S-FLAG
AGGTRI      WHEN '0'
AGGTRI        IF AGR33-O-NGIURI = 'PF   '
S1C251*          MOVE AGR33-O-PRNAS    TO     SO-PROV-NASCITA
S1C251           MOVE AGR33-O-PRNAS    TO     SO-PROVINCIA-COINT
S1C251                                        SO-PROVINCIA-INT
S1C251*          MOVE AGR33-O-PRNAS    TO     S1-PROV-NASCITA
AGGTRI           MOVE AGR33-O-PRNAS    TO     FANT1-X-LOCNAS-NDG(1:2)
                 IF AGR33-O-PRNAS EQUAL SPACES
                 IF IAN1I-C-FISCAL-COD-O(12:1) = 'Z'
S1C251*            MOVE 'EE'             TO     SO-PROV-NASCITA
S1C251             MOVE 'EE'             TO     SO-PROVINCIA-COINT
S1C251                                          SO-PROVINCIA-INT
S1C251*            MOVE 'EE'             TO     S1-PROV-NASCITA
TTTTTT             MOVE 'EE'             TO     FANT1-X-LOCNAS-NDG(1:2)
                 ELSE
                DISPLAY  'NON TROVATA PROVINCIA  DI NASCITA '
                         'PER  CITTADINI ITALIANO: 'IAN1I-C-FISCAL-COD-O
                 END-IF
                 END-IF
AGGTRI        END-IF
AGGTRI      WHEN '1'
AGGTRI        MOVE '0414'                   TO EKERR-C-COD-ERRORE(1)
AGGTRI        SET EKERR-ERR-GENERICO        TO TRUE
AGGTRI*  NDG NON PRESENTE IN ANAGRAFE
AGGTRI        MOVE AGR33-I-NDG              TO EKERR-X-DES-ERRORE(1)
AGGTRI        MOVE 'AGR33-I-NDG'            TO EKERR-X-DAT-ERRATO(1)
AGGTRI        MOVE '0001'                   TO EKERR-C-RIF-ERRORE(1)
AGGTRI        PERFORM ERRORE-GRAVE
AGGTRI      WHEN OTHER
AGGTRI         MOVE '0410'                  TO EKERR-C-COD-ERRORE(1)
AGGTRI         SET EKERR-ERR-GENERICO       TO TRUE
AGGTRI         STRING AGR33-S-FLAG
AGGTRI                ': ERRORE DI MODULO'
AGGTRI                DELIMITED BY SIZE
AGGTRI                                    INTO EKERR-X-DES-ERRORE(1)
AGGTRI         MOVE 'AGR33-I-NDG'           TO EKERR-X-DAT-ERRATO(1)
SHL121*AGGTRI  MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
SHL121         MOVE '0004'                  TO EKERR-C-RIF-ERRORE(1)
AGGTRI         PERFORM ERRORE-GRAVE
AGGTRI     END-EVALUATE
AGGTRI     .
090309*
090309 ESTRAI-NDG-COLLEGATI.
090309     MOVE 'ESTRAI-NDG-COLLEGATI'    TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     INITIALIZE IAN3I-G-GROUP-AREA
090309     SET IAN3I-LISTA-LEGAMI         TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN3I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN3I-C-CODICE-ABI-I
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO IAN3I-C-NDGNDG-COD-I
090309     EVALUATE IAN1I-C-NGIURI-COD-O
090309*    EVALUATE W-C-NGIURI-COD
090309     WHEN 'COI'
090309       MOVE '01'                    TO IAN3I-C-LEGAME-TIP-I
090309     WHEN 'DI'
090309*- 7 PER DITTA
090309       MOVE '07'                    TO IAN3I-C-LEGAME-TIP-I
090309     WHEN OTHER
090309*- 16 PER SOCIETA'
090309       MOVE '16'                    TO IAN3I-C-LEGAME-TIP-I
090309     END-EVALUATE.
090309
090309     PERFORM CL-EKIAN3IB
090309
090309     IF IAN3I-ERR-NON-TROVATO
090309     AND IAN1I-C-NGIURI-COD-O NOT = 'COI'
090309        MOVE '7'                   TO IAN3I-C-LEGAME-TIP-I
090309        PERFORM CL-EKIAN3IB
090309     END-IF
090309
090309     IF NOT IAN3I-OK
090309     AND NOT IAN3I-ERR-NON-TROVATO
090309         MOVE IAN3I-G-ESITO-AREA    TO EKERR-G-ESITO-AREA
090309         MOVE IAN3I-C-TIPO-ESITO    TO EKERR-C-TIPO-ESITO
090309         PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF.
090309*
090309 REPER-INTEST.
090309     MOVE 'REPER-INTEST'            TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL
090309
090309     INITIALIZE IAN1I-G-GROUP-AREA
090309     SET IAN1I-CTRL-NDGNDG          TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN1I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN1I-C-CODICE-ABI-I
090309     MOVE FAN9Q-C-NDGNDG-COD-O      TO IAN1I-C-NDGNDG-COD-I
080526     MOVE FAN9Q-G-AREA-O            TO IAN1I-G-AREA-FAN
090309
090309     PERFORM CL-EKIAN1IB
090309
090309     IF NOT IAN1I-OK
090309        MOVE IAN1I-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT    TO TRUE
090309        PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF
090309     .
090309*
090309 REPER-INTEST-COI.
090309     MOVE 'REPER-INTEST-COI'        TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL
090309
090309     INITIALIZE IAN1I-G-GROUP-AREA
090309     SET IAN1I-CTRL-NDGNDG          TO TRUE
090309     MOVE FAN9Q-C-GRUPPO-ABI-O      TO IAN1I-C-GRUPPO-ABI-I
090309     MOVE FAN9Q-C-CODICE-ABI-O      TO IAN1I-C-CODICE-ABI-I
090309     MOVE IAN3I-C-NDGNDG-COD-O(W-I) TO IAN1I-C-NDGNDG-COD-I
080526     MOVE FAN9Q-G-AREA-O            TO IAN1I-G-AREA-FAN
090309
090309     PERFORM CL-EKIAN1IB
090309
090309     IF NOT IAN1I-OK
090309        MOVE IAN1I-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
090309        SET EKERR-ERR-DATI-INPUT    TO TRUE
090309        PERFORM R-ERRORE-NON-GESTIBILE
090309     END-IF
090309*    DISPLAY 'IAN1I-X-NDGNDG-DES-O ' IAN1I-X-NDGNDG-DES-O
090309*    DISPLAY 'IAN1I-C-NDGNDG-COD-O 'IAN1I-C-NDGNDG-COD-O
090309*    DISPLAY 'IAN1I-C-LINGUA-COD-O 'IAN1I-C-LINGUA-COD-O
090309*    DISPLAY 'IAN1I-C-RESIDE-VIA-O 'IAN1I-C-RESIDE-VIA-O
090309*    DISPLAY 'IAN1I-C-RESIDE-NUM-O 'IAN1I-C-RESIDE-NUM-O
090309*    DISPLAY 'IAN1I-C-RESIDE-COM-O 'IAN1I-C-RESIDE-COM-O
090309*    DISPLAY 'IAN1I-C-RESIDE-CAP-O 'IAN1I-C-RESIDE-CAP-O
090309*    DISPLAY 'IAN1I-C-RESIDE-PRO-O 'IAN1I-C-RESIDE-PRO-O
090309*    DISPLAY 'IAN1I-C-RESIDE-NAZ-O 'IAN1I-C-RESIDE-NAZ-O
090309*    DISPLAY 'IAN1I-C-LINGUA-OPE-O 'IAN1I-C-LINGUA-OPE-O
090309     .
S1G201*
S1G201 IMPORTI-EKFER-VALUTA.
S1G201     MOVE 'IMPORTI-EKFER-VALUTA'    TO IDBGU-X-LABEL-TRAC
S1G201     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S1G201     PERFORM R-TRACE-LABEL.
S1G201*
S1G201     INITIALIZE FER9Q-G-GROUP-AREA
S1G201     SET FER9Q-SELECT-002               TO TRUE
S1G201     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FER9Q-C-GRUPPO-ABI-I
S1G201     MOVE FAN9Q-C-CODICE-ABI-O          TO FER9Q-C-CODICE-ABI-I
S1G201     MOVE FAN9Q-C-FINANZ-PRE-O          TO FER9Q-C-FINANZ-PRE-I
S1G201     MOVE FAN9Q-N-FINANZ-NUM-O          TO FER9Q-N-FINANZ-NUM-I
S1G201     MOVE 'DEF'                         TO FER9Q-C-EROGAZ-TIP-I
S1G201     PERFORM CL-EKFER9QB
S1G201
S1G201     IF NOT FER9Q-OK
S1G201        MOVE FER9Q-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
S1G201        SET EKERR-ERR-DATI-INPUT        TO TRUE
S1G201        PERFORM R-ERRORE-NON-GESTIBILE
S1G201     END-IF
S1G201     .
S1G201*
S5B091
S5B091 REPERIMENTO-LEGAMI-FIN.
S5B091     MOVE 'REPERIMENTO-LEGAMI-FIN'  TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL.
S5B091
S5B091     MOVE 1                         TO W-L
S5B091
S5B091*- ACCESSO NELLA EKFLF (TABELLA LEGAMI TRA FINANZIAMENTI)
S5B091*- PER RECUPERARE EVENTUALI LDF LEGATI AL FINANZIAMENTO
S5B091*- PRINCIPALE
S5B091     PERFORM VERIFICA-ESISTENZA-LEGAMI
S5B091
S5B091     IF FLF9Q-OK
S5B091        PERFORM UNTIL FLF9Q-ERR-NON-TROVATO
S5B091            PERFORM CTRL-DEFINIZIONE-LEGAME
S5B091*- CARICO NELLA TABELLA D'APPOGGIO SOLO I FINANZIAMENTI CHE
S5B091*- PREVEDONO LA CERTIFICAZIONE INTERESSI IN SINCRONIZZAZIONE:
S5B091            IF EKP10-C-SINCRO-CER = 'P'
S5B091              SET SI-LEGAMI-FIN         TO TRUE
S5B091              MOVE FLF9Q-C-FINANZ-PR2-O TO WAPPO-C-FINANZ-PRE(W-L)
S5B091              MOVE FLF9Q-N-FINANZ-NU2-O TO WAPPO-N-FINANZ-NUM(W-L)
S5B091              MOVE FLF9Q-C-MULTIL-COD-O TO WAPPO-C-MULTIL-COD(W-L)
S5B091              ADD 1                     TO W-L
S5B091            END-IF
S5B091
S5B091            SET FLF9Q-FETCUR-001        TO TRUE
S5B091            PERFORM CL-EKFLF9QB
S5B091        END-PERFORM
S5B091     END-IF
S5B091     SET FLF9Q-CLOCUR-001               TO TRUE
S5B091     PERFORM CL-EKFLF9QB.

S5B091
S5B091 VERIFICA-ESISTENZA-LEGAMI.
S5B091     MOVE 'VERIFICA-ESISTENZA-LEGAMI'   TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                             TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL
S5B091
S5B091     INITIALIZE                            FLF9Q-G-GROUP-AREA
S5B091     MOVE FAN9Q-C-CODICE-ABI-O          TO FLF9Q-C-GRUPPO-ABI-I
S5B091     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FLF9Q-C-CODICE-ABI-I
S5B091     MOVE FAN9Q-C-FINANZ-PRE-O          TO FLF9Q-C-CONTRA-PRE-I
S5B091     MOVE FAN9Q-N-FINANZ-NUM-O          TO FLF9Q-N-CONTRA-NUM-I
SOJ311*S5B091     MOVE EKSYS-D-SYSTEM-OPE    TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
S5B091     SET FLF9Q-OPEFET-001               TO TRUE
S5B091
S5B091     PERFORM CL-EKFLF9QB
S5B091
S5B091     IF  NOT FLF9Q-OK
S5B091     AND NOT FLF9Q-ERR-NON-TROVATO
S5B091        MOVE FLF9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
S5B091        SET EKERR-ERR-DATI-INPUT    TO TRUE
S5B091        PERFORM R-ERRORE-GESTIBILE
S5B091     END-IF.
S5B091*
SND171 VERIFICA-RINEGOZIATO.
SND171     MOVE 'VERIFICA-RINEGOZIATO     '   TO IDBGU-X-LABEL-TRAC
SND171     MOVE 3                             TO IDBGU-C-LIVELL-TRA
SND171     PERFORM R-TRACE-LABEL
SND171
SND171     INITIALIZE                            FLF9Q-G-GROUP-AREA
SND171                                           W-C-FINANZ-PRE-RIN
SND171                                           W-N-FINANZ-NUM-RIN
SND171     MOVE FAN9Q-C-CODICE-ABI-O          TO FLF9Q-C-GRUPPO-ABI-I
SND171     MOVE FAN9Q-C-GRUPPO-ABI-O          TO FLF9Q-C-CODICE-ABI-I
SND171     MOVE FAN9Q-C-FINANZ-PRE-O          TO FLF9Q-C-FINANZ-PR2-I
SND171     MOVE FAN9Q-N-FINANZ-NUM-O          TO FLF9Q-N-FINANZ-NU2-I
SOJ311*SND171     MOVE EKSYS-D-SYSTEM-OPE     TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
SND171     MOVE '00002'                       TO FLF9Q-C-MULTIL-COD-I
SND171     SET FLF9Q-SELECT-004               TO TRUE
SND171     PERFORM CL-EKFLF9QB
SND171*
SND171     IF  FLF9Q-OK
SND171     AND FLF9Q-C-MULTIL-COD-O = '00002'
DEB>>>*       DISPLAY 'SONO IL COFINANZIAMENTO COLLEGATO'
SND171        MOVE FLF9Q-C-FINANZ-PRE-O   TO W-C-FINANZ-PRE-RIN
SND171        MOVE FLF9Q-N-FINANZ-NUM-O   TO W-N-FINANZ-NUM-RIN
SND171     END-IF
SND171     .
S5B091
S5B091 CTRL-DEFINIZIONE-LEGAME.
S5B091     MOVE 'CTRL-DEFINIZIONE-LEGAME'     TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                             TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL
S5B091
S5B091*-- RECUPERO LA MODALITA' DI ACCENSIONE PREVISTA PER IL COD.LEGAME
S5B091     INITIALIZE                         ITB9Q-G-GROUP-AREA
S5B091     INITIALIZE                         EKP10-G-GROUP-AREA
S5B091     MOVE FAN9Q-C-CODICE-ABI-O      TO  EKP10-C-GRUPPO-ABI
S5B091     MOVE FAN9Q-C-GRUPPO-ABI-O      TO  EKP10-C-CODICE-ABI
S5B091     MOVE 'EKP10'                   TO  EKP10-C-NOME-TABEL
S5B091     MOVE FLF9Q-C-MULTIL-COD-O      TO  EKP10-C-MULTIL-COD
S5B091     MOVE EKP10-G-CHIAVE            TO  ITB9Q-G-CHIAVE
S5B091     SET ITB9Q-SELECT-001           TO TRUE
S5B091
S5B091     PERFORM CL-EKITB9QB
S5B091
S5B091     IF NOT ITB9Q-OK
S5B091        MOVE ITB9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
S5B091        SET EKERR-ERR-DATI-INPUT    TO TRUE
S5B091        PERFORM R-ERRORE-GESTIBILE
S5B091     ELSE
S5B091        MOVE ITB9Q-X-DATI-TABEL     TO EKP10-X-DATI-TABEL
S5B091     END-IF.
S5B091*

SGB012 GESTIONE-DETTAGLIO.
SGB012     MOVE 'GESTIONE-DETTAGLIO'      TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL
DEB>>>*    DISPLAY 'GESTIONE-DETTAGLIO'
SGB012
SGB012*-Tipo record:
090309     MOVE 'S'          TO PAPY-TIPO-REC OF PAPYRUS-REC-STP
SGB012*-Numero Finanziamento:
SGB012     MOVE FCEI1-N-FINANZ-NUM        TO NEW-NUMFIN-S
SGB012
SGB012*-Interessi
SGB012     IF  IMP-INT      <= ZEROES
SGB012     AND IMP-INT-EURO <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '01'                      TO ORD-STP
SGB012        MOVE 'Interessi'               TO DES-STP
SGB012        MOVE IMP-INT                   TO IMP-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        MOVE ZEROES                    TO IMP-STP-EURO
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012           MOVE IMP-INT-EURO           TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012        PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese incasso rata
SNC201*SGB012     IF  IMP-SPE-INC     <= ZEROES
SNC201*SGB012     AND IMP-SPE-INC-VAL <= ZEROES
SNC201*SGB012        CONTINUE
SNC201*SGB012     ELSE
SNC201*SGB012        INITIALIZE                        PAPY-IMPORTI
SNC201*SGB012        MOVE '02'                      TO ORD-STP
SNC201*SGB012        MOVE 'Spese incasso rata'      TO DES-STP
SNC201*SGB012        MOVE SPACES                    TO STR-STP
SNC201*SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SNC201*SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SNC201*SGB012           MOVE IMP-SPE-INC-VAL        TO IMP-STP
SNC201*SGB012           MOVE IMP-SPE-INC            TO IMP-STP-EURO
SNC201*SGB012           MOVE 'pari a euro '         TO STR-STP
SNC201*SGB012        ELSE
SNC201*SGB012           MOVE IMP-SPE-INC            TO IMP-STP
SNC201*SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SNC201*SGB012        END-IF
SNC201*SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SNC201*SGB012      ADD 1                          TO W-N-CONTA-PAPYR-STP
SNC201*SGB012        PERFORM SCRITTURA-PAPYR
SNC201*SGB012     END-IF
SGB012
SGB012*-Spese di istruttoria
SGB012     IF  IMP-SPE-IST     <= ZEROES
SGB012     AND IMP-SPE-IST-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '03'                      TO ORD-STP
SGB012        MOVE 'Spese di istruttoria'    TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-SPE-IST-VAL        TO IMP-STP
SGB012           MOVE IMP-SPE-IST            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-SPE-IST            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese erogazione mutuo a Stato Avanzamento Lavori
SGB012     IF  IMP-ONE-SAL     <= ZEROES
SGB012     AND IMP-ONE-SAL-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '04'                      TO ORD-STP
SGB012        MOVE 'Spese erogazione mutuo a Stato Avanzamento Lavori'
SGB012                                       TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-SAL-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-SAL            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-SAL            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SGB012*090309         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Compenso sostenuto per estinzione/riduzione anticipata del mutuo
SGB012     IF  IMP-PEN-EST     <= ZEROES
SGB012     AND IMP-PEN-EST-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '05'                      TO ORD-STP
SGB012        STRING 'Compenso sostenuto per estinzione/riduzione '
SGB012               'anticipata del mutuo'
SGB012                   DELIMITED BY SIZE
SGB012                                     INTO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-PEN-EST-VAL        TO IMP-STP
SGB012           MOVE IMP-PEN-EST            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-PEN-EST            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese accollo mutuo
SGB012     IF  IMP-ONE-ACC     <= ZEROES
SGB012     AND IMP-ONE-ACC-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '06'                      TO ORD-STP
SGB012        MOVE 'Spese accollo mutuo'     TO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-ACC-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-ACC            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-ACC            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Spese e oneri connessi al mutuo
SGB012     IF  IMP-ONE-VAR     <= ZEROES
SGB012     AND IMP-ONE-VAR-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                                PAPY-IMPORTI
SGB012        MOVE '07'                              TO ORD-STP
SGB012        MOVE 'Spese e oneri connessi al mutuo' TO DES-STP
SGB012        MOVE SPACES                            TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-ONE-VAR-VAL        TO IMP-STP
SGB012           MOVE IMP-ONE-VAR            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-ONE-VAR            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP                   TO REC-PAPYRUS
SGB012        ADD 1                               TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Imposta sostitutiva
SGB012     IF  IMP-IMP-SOS     <= ZEROES
SGB012     AND IMP-IMP-SOS-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                        PAPY-IMPORTI
SGB012        MOVE '08'                      TO ORD-STP
SGB012        STRING 'Imposta sostitutiva (D.P.R. 29/09/1973, n. 601 '
SGB012               'e s.m.)'
SGB012                   DELIMITED BY SIZE
SGB012                                     INTO DES-STP
SGB012        MOVE SPACES                    TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE IMP-IMP-SOS-VAL        TO IMP-STP
SGB012           MOVE IMP-IMP-SOS            TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '         TO STR-STP
SGB012        ELSE
SGB012           MOVE IMP-IMP-SOS            TO IMP-STP
SGB012           MOVE ZEROES                 TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP           TO REC-PAPYRUS
SGB012        ADD 1                          TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012
SGB012*-Commissioni di intervento
SGB012     IF  COM-INT     <= ZEROES
SGB012     AND COM-INT-VAL <= ZEROES
SGB012        CONTINUE
SGB012     ELSE
SGB012        INITIALIZE                          PAPY-IMPORTI
SGB012        MOVE '09'                        TO ORD-STP
SGB012        MOVE 'Commissioni di intervento' TO DES-STP
SGB012        MOVE SPACES                      TO STR-STP
SGB012        IF  FCEI1-C-TIPO-FINAN(1:1) = 'V'
SGB012        AND FCEI1-C-DIVISA-COD NOT = 'EUR'
SGB012           MOVE COM-INT-VAL              TO IMP-STP
SGB012           MOVE COM-INT                  TO IMP-STP-EURO
SGB012           MOVE 'pari a euro '           TO STR-STP
SGB012        ELSE
SGB012           MOVE COM-INT                  TO IMP-STP
SGB012           MOVE ZEROES                   TO IMP-STP-EURO
SGB012        END-IF
SGB012        MOVE PAPYRUS-REC-STP             TO REC-PAPYRUS
SGB012        ADD 1                            TO W-N-CONTA-PAPYR-STP
SOE142*SGB012         PERFORM SCRITTURA-PAPYR
DEBUG>*        DISPLAY 'FCEI1-F-ESTINZ-TIP>' FCEI1-F-ESTINZ-TIP
SOE142         IF  FCEI1-F-ESTINZ-TIP NOT = 'E'
SOE142             PERFORM SCRITTURA-PAPYR
SOE142         END-IF
SGB012     END-IF
SGB012     .

SGB012 IMPORTI-ANAGRAFE.
SGB012     MOVE 'IMPORTI-ANAGRAFE'        TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'FX1515 IMPORTI-ANAGRAFE'
SGB012
SGB012*- Per i conteggi di Anagrafe Tributaria utilizziamo solo valori
SGB012*- positivi.
SGB012     MOVE ZEROES                    TO W-I-INTVAR-ANA
SGB012                                       W-I-SPERAT-ANA
SGB012                                       W-I-SPEIST-ANA
SGB012                                       W-I-IMPSOS-ANA
SGB012                                       W-I-PENEST-ANA
SGB012                                       W-I-ONESAL-ANA
SGB012                                       W-I-ONEACC-ANA
SGB012                                       W-I-ONECER-ANA
SGB012                                       W-I-COMINT-ANA
SGB012                                       W-I-INTVAR-ANA-VAL
SGB012                                       W-I-SPERAT-ANA-VAL
SGB012                                       W-I-SPEIST-ANA-VAL
SGB012                                       W-I-IMPSOS-ANA-VAL
SGB012                                       W-I-PENEST-ANA-VAL
SGB012                                       W-I-ONESAL-ANA-VAL
SGB012                                       W-I-ONEACC-ANA-VAL
SGB012                                       W-I-ONECER-ANA-VAL
SGB012                                       W-I-COMINT-ANA-VAL
SGB012
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-ANA pre: ' W-I-INTVAR-ANA
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-TOT pre: ' W-I-INTVAR-TOT
SGB012     IF W-I-INTVAR-TOT > ZEROES
SGB012        MOVE W-I-INTVAR-TOT         TO W-I-INTVAR-ANA
SGB012     END-IF
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-ANA pos: ' W-I-INTVAR-ANA
DEB>>>*    DISPLAY 'FX1515 W-I-INTVAR-TOT pos: ' W-I-INTVAR-TOT
SGB012     IF W-I-SPERAT-TOT > ZEROES
SGB012        MOVE W-I-SPERAT-TOT         TO W-I-SPERAT-ANA
SGB012     END-IF
SGB012     IF W-I-SPEIST-TOT > ZEROES
SGB012        MOVE W-I-SPEIST-TOT         TO W-I-SPEIST-ANA
SGB012     END-IF
SGB012     IF W-I-IMPSOS-TOT > ZEROES
SGB012        MOVE W-I-IMPSOS-TOT         TO W-I-IMPSOS-ANA
SGB012     END-IF
SGB012     IF W-I-PENEST-TOT > ZEROES
SGB012        MOVE W-I-PENEST-TOT         TO W-I-PENEST-ANA
SGB012     END-IF
SGB012     IF W-I-ONESAL-TOT > ZEROES
SGB012        MOVE W-I-ONESAL-TOT         TO W-I-ONESAL-ANA
SGB012     END-IF
SGB012     IF W-I-ONEACC-TOT > ZEROES
SGB012        MOVE W-I-ONEACC-TOT         TO W-I-ONEACC-ANA
SGB012     END-IF
SGB012     IF W-I-ONECER-TOT > ZEROES
SGB012        MOVE W-I-ONECER-TOT         TO W-I-ONECER-ANA
SGB012     END-IF
SGB012     IF W-I-COMINT-TOT > ZEROES
SGB012        MOVE W-I-COMINT-TOT         TO W-I-COMINT-ANA
SGB012     END-IF
SGB012     IF W-I-INTVAR-TOT-VAL > ZEROES
SGB012        MOVE W-I-INTVAR-TOT-VAL     TO W-I-INTVAR-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-SPERAT-TOT-VAL > ZEROES
SGB012        MOVE W-I-SPERAT-TOT-VAL     TO W-I-SPERAT-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-SPEIST-TOT-VAL > ZEROES
SGB012        MOVE W-I-SPEIST-TOT-VAL     TO W-I-SPEIST-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-IMPSOS-TOT-VAL > ZEROES
SGB012        MOVE W-I-IMPSOS-TOT-VAL     TO W-I-IMPSOS-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-PENEST-TOT-VAL > ZEROES
SGB012        MOVE W-I-PENEST-TOT-VAL     TO W-I-PENEST-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONESAL-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONESAL-TOT-VAL     TO W-I-ONESAL-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONEACC-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONEACC-TOT-VAL     TO W-I-ONEACC-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-ONECER-TOT-VAL > ZEROES
SGB012        MOVE W-I-ONECER-TOT-VAL     TO W-I-ONECER-ANA-VAL
SGB012     END-IF
SGB012     IF W-I-COMINT-TOT-VAL > ZEROES
SGB012        MOVE W-I-COMINT-TOT-VAL     TO W-I-COMINT-ANA-VAL
SGB012     END-IF
SGB012     .

SKK132 CHIAMA-ANWR253.
SKK132     MOVE 'CHIAMA-ANWR253'          TO IDBGU-X-LABEL-TRAC
SKK132     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKK132     PERFORM R-TRACE-LABEL.
SKK132
SKK132     INITIALIZE IAN9I-G-GROUP-AREA
SKK132     SET IAN9I-INDPOS-CONTO             TO TRUE
SKK132     MOVE FAN9Q-C-GRUPPO-ABI-O          TO IAN9I-C-GRUPPO-ABI-I
SKK132     MOVE FAN9Q-C-CODICE-ABI-O          TO IAN9I-C-CODICE-ABI-I
SKK132     MOVE FAN9Q-C-COOPAG-CAB-O          TO IAN9I-C-FILIAL-COD-I
SKK132     MOVE '1  '                         TO IAN9I-C-SERVIZ-COD-I
SKK132     MOVE FAN9Q-C-COOPAG-NUM-O          TO IAN9I-C-COOGEN-NUM-I
SKK132     MOVE FAN9Q-C-DIVISA-OPE-O          TO IAN9I-C-DIVISA-COD-I
SKK132
SKK132     PERFORM CL-EKIAN9IB
SKK132
SKK132     IF NOT IAN9I-OK
SKK132        MOVE IAN9I-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
SKK132        SET EKERR-ERR-GENERICO          TO TRUE
SKK132        PERFORM R-ERRORE-GESTIBILE
SKK132     END-IF.
SKK132
SKK132
       VALORIZZA-DICPINTE.
           MOVE 'VALORIZZA-DICPINTE'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

      *-- ANNO ---------------------------------------------------------
           MOVE IFRB1-D-RIFERI-OPE        TO W-APPO-DATA-X
           MOVE W-APPX-SSAA               TO  ANNO
      *-----------------------------------------------------------------
      *--PROCEDURA------------------------------------------------------
           MOVE FCEI1-C-PROCED-TIP        TO  PROCEDURA
      *-----------------------------------------------------------------
           MOVE FCEI1-C-SERVIZ-COD        TO  TIPO-SERVIZIO
           MOVE 'I'                       TO  FLAG-OPERAZ
      *****MOVE FCEI1-C-NDGNDG-COD        TO  NDG
           MOVE FCEI1-C-NDGNDG-COD        TO  APPO-NDG-9-12
           MOVE APPO-NDG-9-12             TO  NDG
           MOVE FCEI1-C-FINFIL-GES        TO  FILIALE
           MOVE FCEI1-C-CATANA-COD        TO  CATEGORIA
           MOVE FCEI1-N-FINANZ-NUM        TO  RAPPORTO
      *WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
           MOVE '01'                      TO     VOCE0-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE0-DIV
KKKKKK* QUA 3
           COMPUTE    VOCE0-VAL  =    APPO-I-VOCE0 * 100
           MOVE '02'                      TO   VOCE1-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE1-DIV
           COMPUTE    VOCE1-VAL  =    APPO-I-VOCE1 * 100
           MOVE '03'                      TO     VOCE2-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE2-DIV
           COMPUTE    VOCE2-VAL  =    APPO-I-VOCE2 * 100
           MOVE '04'                      TO   VOCE3-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE3-DIV
           COMPUTE    VOCE3-VAL  =    APPO-I-VOCE3 * 100
           MOVE '05'                      TO     VOCE4-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE4-DIV
           COMPUTE    VOCE4-VAL  =    APPO-I-VOCE4 * 100
           MOVE '06'                      TO   VOCE5-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE5-DIV
           COMPUTE    VOCE5-VAL  =    APPO-I-VOCE5 * 100
           MOVE '07'                      TO     VOCE6-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE6-DIV
           COMPUTE    VOCE6-VAL  =    APPO-I-VOCE6 * 100
           MOVE '08'                      TO   VOCE7-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE7-DIV
           COMPUTE    VOCE7-VAL  =    APPO-I-VOCE7 * 100
           MOVE '09'                      TO     VOCE8-COD
           MOVE FCEI1-C-DIVISA-COD        TO     VOCE8-DIV
           COMPUTE    VOCE8-VAL  =    APPO-I-VOCE8 * 100
           MOVE '10'                      TO   VOCE9-COD
           MOVE FCEI1-C-DIVISA-COD        TO   VOCE9-DIV
           COMPUTE    VOCE9-VAL  =    APPO-I-VOCE9 * 100
      *MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
      *--FLAG-ERR-1-----------------------------------------------------
           IF FCEI1-C-ACCOLL-FLG = 'SI'
             MOVE 'W'                       TO  FLAG-ERR-1
           END-IF
      *-----------------------------------------------------------------
           MOVE ZEROES                    TO  RAPPORTO-ES
           MOVE ZEROES                    TO  TIPO-RAPP
           MOVE 'N'                       TO  FLAG-STMP-AUT
           .

       VALORIZZA-PAPYRRRC.
           MOVE 'VALORIZZA-PAPYRRRC'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

090309*    MOVE FCEI1-C-CARTOL-COD        TO SO-CODICE-CARTOL
090309*    MOVE '1'                       TO SO-TIPO-REC
      *--- SO-IDENTIF-MUTUO ------------------------------------------*
090309*    MOVE FCEI1-N-FINANZ-NUM        TO APPO-IDENTIF-MUTUO
090309*    MOVE APPO-IDENTIF-MUTUO        TO  SO-IDENTIF-MUTUO
      *---------------------------------------------------------------*
090309*    MOVE ZEROES                    TO SO-PROGR-COINTEST
090309*    MOVE '2'                       TO SO-TIPO-PREST-MUTUO
      *-- SO-AGEVOLATO -----------------------------------------------*
090309*    IF FCEI1-F-AGEVOL-FIN = 'N'
090309*      MOVE 0                         TO SO-AGEVOLATO
090309*    END-IF
090309*    IF FCEI1-F-AGEVOL-FIN = 'S'
090309*      MOVE 1                         TO SO-AGEVOLATO
090309*    END-IF
      *---------------------------------------------------------------*
      *--SO-DATA-EROGAZIONE ------------------------------------------*
090309*    MOVE FCEI1-D-EROGAZ-CON        TO W-APPO-DATA-X
090309*      MOVE W-APPX-GG             TO W-APP9-GG
090309*      MOVE W-APPX-MM             TO W-APP9-MM
090309*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
090309*
090309*      MOVE W-APP9-GG         TO SO-DATA-EROGAZIONE(1:2)
090309*      MOVE W-APP9-MM         TO SO-DATA-EROGAZIONE(3:2)
090309*      MOVE W-APP9-SSAA       TO SO-DATA-EROGAZIONE(5:)
      *---------------------------------------------------------------*
      *-- SO-IMPORIG-PREST -------------------------------------------*
090309*    COMPUTE SO-IMPORIG-PREST       = FCEI1-I-EROGAZ-FIN * 100
      *---------------------------------------------------------------*
090309*-- SO-IMPCORR-ANNO --------------------------------------------*
090309*    COMPUTE SO-IMPCORR-ANNO        = (APPO-I-VOCE0 +
090309*                                      APPO-I-VOCE7 +
090309*                                      APPO-I-VOCE8 ) * 100
090309*---------------------------------------------------------------*
090309*    MOVE ZEROES                    TO SO-NUMERO-INTESTAT
090309*    MOVE SPACES                    TO SO-CODFISC-INTESTAT
090309*    MOVE SPACES                    TO SO-ANAGRAFICI-INTESTATARIO
090309*    MOVE SPACES                    TO SO-COGNOME
090309*    MOVE SPACES                    TO SO-NOME
090309*    MOVE SPACES                    TO SO-SESSO
090309*    MOVE ZEROES                    TO SO-DATA-NASCITA
090309*    MOVE SPACES                    TO SO-LUOGO-NASCITA
090309*    MOVE SPACES                    TO SO-PROV-NASCITA
090309*    MOVE '1'                       TO SO-PROGR-RECORD
090309*---------------------------------------------------------------*
090309*    IF FCEI1-C-DIVISA-COD = 'ITL'
090309*      MOVE 'L'                       TO SO-TIPO-DIVISA
090309*    ELSE
090309*      MOVE 'E'                       TO SO-TIPO-DIVISA
090309*    END-IF
090309*       MOVE '0034'                 TO EKERR-C-COD-ERRORE(1)
090309*       MOVE '1455'                 TO EKERR-C-RIF-ERRORE(1)
TODOX *       MOVE 'CODICE DIVSA NON GESTITO '
TODOX *                                   TO EKERR-X-DES-ERRORE(1) (6:2)
TODOX *       PERFORM ERRORE-GRAVE
TODOX *    END-IF
      *---------------------------------------------------------------*
090309*    MOVE '50'                      TO SO-SETTORE
090309*    MOVE FCEI1-C-FINFIL-GES(2:)    TO SO-DIPENDENZA
090309*    MOVE FCEI1-N-FINANZ-NUM        TO SO-COE
090309*    MOVE FCEI1-C-NDGNDG-COD(4:)    TO SO-CODICE-RUBRICA
           .
      *

       VALORIZZA-SONCORRC.
           MOVE 'VALORIZZA-SONCORRC'      TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

S1C251*    MOVE FCEI1-C-CARTOL-COD        TO SO-CODICE-CARTOL
S1C251*    MOVE '1'                       TO SO-TIPO-REC
      *--- SO-IDENTIF-MUTUO ------------------------------------------*
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO APPO-IDENTIF-MUTUO
S1C251*    MOVE APPO-IDENTIF-MUTUO        TO  SO-IDENTIF-MUTUO
      *---------------------------------------------------------------*
S1C251*    MOVE ZEROES                    TO SO-PROGR-COINTEST
S1C251*    MOVE '2'                       TO SO-TIPO-PREST-MUTUO
      *-- SO-AGEVOLATO -----------------------------------------------*
S1C251*    IF FCEI1-F-AGEVOL-FIN = 'N'
S1C251*      MOVE 0                         TO SO-AGEVOLATO
S1C251*    END-IF
S1C251*    IF FCEI1-F-AGEVOL-FIN = 'S'
S1C251*      MOVE 1                         TO SO-AGEVOLATO
S1C251*    END-IF
      *---------------------------------------------------------------*
      *--SO-DATA-EROGAZIONE ------------------------------------------*
S1C251*    MOVE FCEI1-D-EROGAZ-CON        TO W-APPO-DATA-X
S1C251*      MOVE W-APPX-GG             TO W-APP9-GG
S1C251*      MOVE W-APPX-MM             TO W-APP9-MM
S1C251*      MOVE W-APPX-SSAA           TO W-APP9-SSAA
S1C251*
S1C251*      MOVE W-APP9-GG         TO SO-DATA-EROGAZIONE(1:2)
S1C251*      MOVE W-APP9-MM         TO SO-DATA-EROGAZIONE(3:2)
S1C251*      MOVE W-APP9-SSAA       TO SO-DATA-EROGAZIONE(5:)
      *---------------------------------------------------------------*
      *-- SO-IMPORIG-PREST -------------------------------------------*
S1C251*    COMPUTE SO-IMPORIG-PREST       = FCEI1-I-EROGAZ-FIN * 100
      *---------------------------------------------------------------*
      *-- SO-IMPCORR-ANNO --------------------------------------------*
S1C251*    COMPUTE SO-IMPCORR-ANNO        = (APPO-I-VOCE0 +
S1C251*                                      APPO-I-VOCE7 +
S1C251*                                      APPO-I-VOCE8 ) * 100
      *---------------------------------------------------------------*
S1C251*    MOVE ZEROES                    TO SO-NUMERO-INTESTAT
S1C251*    MOVE SPACES                    TO SO-CODFISC-INTESTAT
S1C251*    MOVE SPACES                    TO SO-ANAGRAFICI-INTESTATARIO
S1C251*    MOVE SPACES                    TO SO-COGNOME
S1C251*    MOVE SPACES                    TO SO-NOME
S1C251*    MOVE SPACES                    TO SO-SESSO
S1C251*    MOVE ZEROES                    TO SO-DATA-NASCITA
S1C251*    MOVE SPACES                    TO SO-LUOGO-NASCITA
S1C251*    MOVE SPACES                    TO SO-PROV-NASCITA
S1C251*    MOVE '1'                       TO SO-PROGR-RECORD
      *---------------------------------------------------------------*
S1C251*    IF FCEI1-C-DIVISA-COD = 'ITL'
S1C251*      MOVE 'L'                       TO SO-TIPO-DIVISA
S1C251*    ELSE
S1C251*      MOVE 'E'                       TO SO-TIPO-DIVISA
S1C251*    END-IF
S1C251*       MOVE '0034'                 TO EKERR-C-COD-ERRORE(1)
S1C251*       MOVE '1455'                 TO EKERR-C-RIF-ERRORE(1)
S1C251*       MOVE 'CODICE DIVSA NON GESTITO '
S1C251*                                   TO EKERR-X-DES-ERRORE(1) (6:2)
S1C251*       PERFORM ERRORE-GRAVE
S1C251*    END-IF
      *---------------------------------------------------------------*
S1C251*    MOVE '50'                      TO SO-SETTORE
S1C251*    MOVE FCEI1-C-FINFIL-GES(2:)    TO SO-DIPENDENZA
S1C251*    MOVE FCEI1-N-FINANZ-NUM        TO SO-COE
S1C251*    MOVE FCEI1-C-NDGNDG-COD(4:)    TO SO-CODICE-RUBRICA
           .
      *


       ELABORA-DICPINTE-TOT.
           MOVE 'ELABORA-DICPINTE-TOT'    TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

      *-- ANNO ---------------------------------------------------------
           MOVE IFRB1-D-RIFERI-OPE        TO W-APPO-DATA-X
           MOVE W-APPX-SSAA               TO  ANNO
      *-----------------------------------------------------------------
      *--PROCEDURA------------------------------------------------------
           MOVE APPO-OLD-PROCED           TO  PROCEDURA
      *-----------------------------------------------------------------
           MOVE APPO-OLD-SERVIZ           TO  TIPO-SERVIZIO
           MOVE 'T'                       TO  FLAG-OPERAZ
           MOVE ALL '9'                   TO  NDG
           MOVE ALL '9'                   TO  FILIALE
           MOVE ALL '9'                   TO  CATEGORIA
           MOVE ALL '9'                   TO  RAPPORTO
      *WWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWWW
           MOVE '01'                      TO     VOCE0-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE0-DIV
KKKKKK* QUA 4
           COMPUTE   VOCE0-VAL  =  APPO-I-VOCE0-TOT * 100
           MOVE '02'                      TO   VOCE1-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE1-DIV
           COMPUTE   VOCE1-VAL  =  APPO-I-VOCE1-TOT * 100
           MOVE '03'                      TO     VOCE2-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE2-DIV
           COMPUTE   VOCE2-VAL  =  APPO-I-VOCE2-TOT * 100
           MOVE '04'                      TO   VOCE3-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE3-DIV
           COMPUTE   VOCE3-VAL  =  APPO-I-VOCE3-TOT * 100
           MOVE '05'                      TO     VOCE4-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE4-DIV
           COMPUTE   VOCE4-VAL  =  APPO-I-VOCE4-TOT * 100
           MOVE '06'                      TO   VOCE5-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE5-DIV
           COMPUTE   VOCE5-VAL  =  APPO-I-VOCE5-TOT * 100
           MOVE '07'                      TO     VOCE6-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE6-DIV
           COMPUTE   VOCE6-VAL  =  APPO-I-VOCE6-TOT * 100
           MOVE '08'                      TO   VOCE7-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE7-DIV
           COMPUTE   VOCE7-VAL  =  APPO-I-VOCE7-TOT * 100
           MOVE '09'                      TO     VOCE8-COD
           MOVE APPO-OLD-DIVISA           TO     VOCE8-DIV
           COMPUTE   VOCE8-VAL  =  APPO-I-VOCE8-TOT * 100
           MOVE '10'                      TO   VOCE9-COD
           MOVE APPO-OLD-DIVISA           TO   VOCE9-DIV
           COMPUTE   VOCE9-VAL  =  APPO-I-VOCE9-TOT * 100
      *MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM
           MOVE SPACES                    TO  FLAG-ERR-1
           MOVE ZEROES                    TO  RAPPORTO-ES
           MOVE ZEROES                    TO  TIPO-RAPP
           MOVE SPACES                    TO  FLAG-STMP-AUT

           PERFORM SCRITTURA-DICPI

           INITIALIZE                     IMPORTI-VOCI-TOT
           .
SOB061 VERIFICA-RINEGOZIATO-FIGLIO.
SOB061     MOVE 'VERIFICA-RINEGOZIATO-FIGLIO'   TO IDBGU-X-LABEL-TRAC
SOB061     MOVE 3                               TO IDBGU-C-LIVELL-TRA
SOB061     PERFORM R-TRACE-LABEL
SOB061
SOB061     INITIALIZE                            FLF9Q-G-GROUP-AREA
SOB061                                           W-C-FINANZ-PRE-RIN
SOB061                                           W-N-FINANZ-NUM-RIN
SOB061     MOVE FCEI1-C-CODICE-ABI            TO FLF9Q-C-GRUPPO-ABI-I
SOB061     MOVE FCEI1-C-GRUPPO-ABI            TO FLF9Q-C-CODICE-ABI-I
SOB061     MOVE FCEI1-C-FINANZ-PRE            TO FLF9Q-C-FINANZ-PR2-I
SOB061     MOVE FCEI1-N-FINANZ-NUM            TO FLF9Q-N-FINANZ-NU2-I
SOJ311*SOB061   MOVE EKSYS-D-SYSTEM-OPE       TO FLF9Q-D-RIFERI-OPE-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE            TO FLF9Q-D-RIFERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLF9Q-D-RIFERI-OPE-I
SPA221     END-IF
SOB061     MOVE '00002'                       TO FLF9Q-C-MULTIL-COD-I
SOB061     SET FLF9Q-SELECT-004               TO TRUE
SOB061     PERFORM CL-EKFLF9QB
SOB061     .
      *
       F-PGM-CHIUDI-FILE.
           MOVE 'F-PGM-CHIUDI-FILE'       TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           CLOSE EKCERIO.
           CLOSE EKDICPI.
           CLOSE PAPYRUS.
090309     CLOSE EKSONCO.
SKA292     CLOSE EKSONC2.
090309     CLOSE EKFANT1.
090309*
      *
       F-PGM-FINE.
           MOVE 'F-PGM-FINE'              TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
           MOVE '0450'                      TO EKERR-C-COD-ERRORE(1)
           MOVE '0003'                      TO EKERR-C-RIF-ERRORE(1)
           MOVE W-N-READ                    TO W-N-DISPLAY
           MOVE W-N-DISPLAY                 TO EKERR-X-DES-ERRORE(1)
           PERFORM MESSAGGIO-WARNING
           MOVE '0451'                      TO EKERR-C-COD-ERRORE(1)
           MOVE '0004'                      TO EKERR-C-RIF-ERRORE(1)
           MOVE W-N-UPDATE                  TO W-N-DISPLAY
           MOVE W-N-DISPLAY                 TO EKERR-X-DES-ERRORE(1)
           PERFORM MESSAGGIO-WARNING
           DISPLAY '*************************************'
           MOVE W-N-READ                    TO W-N-DISPLAY
           DISPLAY 'REC. LETTI   IN CERIO :' W-N-DISPLAY
           MOVE W-N-UPDATE                  TO W-N-DISPLAY
           MOVE W-N-CONTA-DICPI             TO W-N-DISPLAY-1
           MOVE W-N-CONTA-PAPYR             TO W-N-DISPLAY-2
SGB012     MOVE W-N-CONTA-PAPYR-STP         TO W-N-DISPLAY-3
SJB071     MOVE W-N-CONTA-SONCO             TO W-N-DISPLAY-4
SKA292     MOVE W-N-CONTA-SONC2             TO W-N-DISPLAY-5
           DISPLAY 'SCRITTI IN DICPI      :' W-N-DISPLAY-1
           DISPLAY 'SCRITTI IN PAPYR      :' W-N-DISPLAY-2
SGB012     DISPLAY 'SCRITTI IN PAPYR SPESE:' W-N-DISPLAY-3
SJB071     DISPLAY 'SCRITTI IN SONCO      :' W-N-DISPLAY-4
SKA292     DISPLAY 'SCRITTI IN SONC2      :' W-N-DISPLAY-5
           DISPLAY '*************************************'
S1C251     IF TROVATO-COINT-PG
S1C251        MOVE '1277'                  TO EKERR-C-COD-ERRORE(1)
S1C251        SET EKERR-ERR-DATI-INPUT      TO TRUE
S1C251        MOVE 'NDG COINTESTATARIO PERSONA GIURIDICA'
S1C251                                     TO EKERR-X-DES-ERRORE(1)
S1C251        MOVE '0001'                  TO EKERR-C-RIF-ERRORE(1)
S1C251        PERFORM R-ERRORE-NON-GESTIBILE
S1C251     END-IF
S1C251     DISPLAY '*************************************'
           .
      *
      ******************************************************************
      *          F I N E     P A R T E    C O M U N E                  *
      ******************************************************************
      *
       C-LETTURA-FILE-INPUT.
           MOVE 'C-LETTURA-FILE-INPUT'          TO IDBGU-X-LABEL-TRAC
           MOVE 3                               TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL

           READ EKCERIO
              AT END      SET IFRB1-F-ELABOR-STA-OFF  TO TRUE
              NOT AT END  ADD  1                      TO W-N-READ
                          MOVE FCEI1-C-GRUPPO-ABI TO IFRB1-C-GRUPPO-ABI
                          MOVE FCEI1-C-CODICE-ABI TO IFRB1-C-CODICE-ABI
           END-READ
           IF NOT CERIO-STATUS-OK AND NOT CERIO-STATUS-EOF
              DISPLAY 'ERRORE READ  TRFE1: ' CERIO-STATUS
              MOVE '0257'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0005'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'CERIO'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE CERIO-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           END-IF

           IF CERIO-STATUS-OK
             MOVE FCEI1-C-GRUPPO-ABI            TO WD-C-GRUPPO-ABI
             MOVE FCEI1-C-CODICE-ABI            TO WD-C-CODICE-ABI
             MOVE FCEI1-C-FINANZ-PRE            TO WD-C-FINANZ-PRE
             MOVE FCEI1-N-FINANZ-NUM            TO WD-N-FINANZ-NUM
090325*      display  'Letta posizione  : '
090325*               FCEI1-C-FINANZ-PRE '/' FCEI1-N-FINANZ-NUM
           END-IF
           IF CERIO-STATUS-EOF
             MOVE SPACES                        TO WD-C-GRUPPO-ABI
             MOVE SPACES                        TO WD-C-CODICE-ABI
             MOVE SPACES                        TO WD-C-FINANZ-PRE
             MOVE ZEROES                        TO WD-N-FINANZ-NUM
           END-IF.

           IF W-N-READ = ZERO
              MOVE '0447'                   TO EKERR-C-COD-ERRORE(1)
              MOVE '0006'                   TO EKERR-C-RIF-ERRORE(1)
              MOVE 'NESSUN RECORD DA ELABORARE'
                                            TO EKERR-X-DES-ERRORE(1)
              PERFORM MESSAGGIO-WARNING
           END-IF
           .

       RIDEFINISCI-DATA.
           MOVE 'RIDEFINISCI-DATA'        TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           MOVE W-APPX-SSAA               TO W-APP9-SSAA
           MOVE W-APPX-MM                 TO W-APP9-MM
           MOVE W-APPX-GG                 TO W-APP9-GG
           .

       AGGIUNGI-1-GG.
           MOVE 'AGGIUNGI-1-GG'           TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           MOVE W-APPO-D-DATA-CTRL            TO IDATU-D-INPUT-SAMG
           MOVE 1                             TO IDATU-N-GG-INP-OUT
           SET IDATU-SOMMA-GIORNI             TO TRUE

           PERFORM CL-EKIDATUB

           IF NOT IDATU-OK
              MOVE IDATU-G-ESITO-AREA         TO EKERR-G-ESITO-AREA
              SET EKERR-ERR-DATI-INPUT        TO TRUE
              PERFORM ERRORE-GRAVE
           END-IF.

SJD121 CALCOLO-GIORNI-EFFETTIVI.
SJD121     MOVE 'CALCOLO-GIORNI-EFFETTIVI' TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                          TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL
SJD121
SJD121* CALCOLO I GIORNI DA DATA SCADENZA A DATA RIFERIMENTO
SJD121     INITIALIZE                         IDATU-G-GROUP-AREA
SJD121
SJD121     IF  W-D-INIRIS-CAL > EKIFB-D-RIFERI-OLD
SJD121         MOVE W-D-INIRIS-CAL         TO IDATU-D-INPUT-SAMG
SJD121     ELSE
SJD121         MOVE EKIFB-D-RIFERI-OPE(1:4)TO IDATU-D-INPUT-SAMG(1:4)
SJD121         MOVE '-01-01'               TO IDATU-D-INPUT-SAMG(5:6)
SJD121     END-IF
SJD121
SJD121     IF  W-D-FINRIS-CAL < EKIFB-D-RIFERI-OPE
SJD121         MOVE W-D-FINRIS-CAL         TO IDATU-D-INOUT-SAMG
SJD121     ELSE
SJD121         MOVE EKIFB-D-RIFERI-OPE     TO IDATU-D-INOUT-SAMG
SJD121     END-IF
SJD121
SJD121     SET IDATU-DELTA-DAT-GG          TO TRUE
SJD121     SET IDATU-SOLARE                TO TRUE
SJD121
SJD121     PERFORM CL-EKIDATUB
SJD121
SJD121     IF NOT IDATU-OK
SJD121        MOVE IDATU-G-ESITO-AREA      TO EKERR-G-ESITO-AREA
SJD121        SET EKERR-ERR-DATI-INPUT     TO TRUE
SJD121        PERFORM R-ERRORE-NON-GESTIBILE
SJD121     END-IF
SJD121
SJD121     MOVE IDATU-N-GG-INP-OUT         TO W-N-GG-RIST
SJD121
SJD121     MOVE 365                        TO W-N-GG-ANNO
SJD121     IF  IDATU-F-BISESTILE-SI
SJD121         MOVE 366                    TO W-N-GG-ANNO
SJD121     END-IF
SJD121     .
SGB012
SGB012 ARROTONDA-IMPORTO.
SGB012     MOVE 'ARROTONDA-IMPORTO'       TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
SGB012*
SGB012     INITIALIZE                        IARRU-G-GROUP-AREA
SGB012     SET IARRU-ARROTONDA-IMPORTO    TO TRUE
SGB012     MOVE 'C'                       TO IARRU-C-CODICE-ARR-I
SGB012     MOVE 1,00                      TO IARRU-N-NUMERO-ARR-I
SGB012     MOVE W-I-IMPORT-ARR            TO IARRU-I-IMPORT-ARR-I
DEB>>>*    MOVE W-I-IMPORT-ARR            TO W-I-IMPORT-APP
DEB>>>*    DISPLAY 'W-I-IMPORT-ARR: ' W-I-IMPORT-APP
SGB012
SGB012     PERFORM CL-EKIARRUB
SGB012
SGB012     IF NOT IARRU-OK
SGB012        MOVE IARRU-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SGB012        SET EKERR-ERR-DATI-INPUT    TO TRUE
SGB012        PERFORM ERRORE-GRAVE
SGB012     END-IF
DEB>>>*    MOVE IARRU-I-IMPORT-ARR-O      TO W-I-IMPORT-APP
DEB>>>*    DISPLAY 'IARRU-I-IMPORT-ARR-O: ' W-I-IMPORT-APP
SGB012
SGB012     MOVE ZEROES                    TO W-I-IMPORT-ARR
SGB012     .

SHL121 GESTIONE-PROPRIETA.
SHL121     MOVE 'GESTIONE-PROPRIETA'      TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'GESTIONE-PROPRIETA NDG: '
DEB>>>*                    IAN3I-C-NDGNDG-COD-O(W-I) ' - '
DEB>>>*                    FAN9Q-C-NDGNDG-COD-O
SHL121
SIB201     SET PROP-CAL-SI                  TO TRUE
SHL121     MOVE SPACES                      TO W-C-NATURA-DIR
SHL121                                         W-C-PROPRI-IMM
SIB091*SHL121     ADD 1                            TO W-X
SJB071     ADD 1                            TO W-X
SHL121
SHL121*- Estraggo tutti i beni legati ad NDG principale:
SHL121     INITIALIZE                        IFD4I-G-GROUP-AREA
SHL121     SET IFD4I-ELISE                  TO TRUE
SHL121     MOVE FCEI1-C-FINANZ-PRE          TO IFD4I-C-FINANZ-PRE
SHL121     MOVE FCEI1-N-FINANZ-NUM          TO IFD4I-N-FINANZ-NUM
SHL121     MOVE FAN9Q-C-NDGNDG-COD-O        TO IFD4I-C-NDGNDG-COD
SIB091*SHL121                                   W-C-NDGNDG-COD-COI(W-X)
SJB071                                         W-C-NDGNDG-COD-COI(W-X)
SHL121     MOVE FAN9Q-C-FILIAL-GES-O        TO IFD4I-C-FILIAL-GES
SHL121
SHL121     PERFORM CL-EKIFD4IB
SHL121
SHL121     IF IFD4I-OK
SHL121        MOVE ZEROES                   TO W-I-IMPFIN-IMM
SJB211        MOVE ZEROES                   TO W-I-IMPSTI-IMM
SHL121*- Verifico i beni ad uno ad uno:
SHL121        PERFORM VARYING W-W FROM 1 BY 1
SHL121          UNTIL (W-W > IFD4I-N-TOT-ELEMEN)
SHL121          OR IFD4I-N-ID-BENEIMM(W-W) = ZEROES
DEB>>>*            DISPLAY 'IFD4I-N-ID-BENEIMM(W-W): '
DEB>>>*                     IFD4I-N-ID-BENEIMM(W-W)
SHL121             PERFORM DATI-BENE-IMM
SHL121        END-PERFORM
SHL121     END-IF
SHL121
DEB>>>*    DISPLAY 'W-C-NATURA-DIR: ' W-C-NATURA-DIR
SHL121     IF W-C-NATURA-DIR > SPACES
SHL121        IF PROP-SI
SHL121           MOVE '1'                TO W-C-PROPRI-IMM
SHL121        ELSE
SHL121           MOVE '0'                TO W-C-PROPRI-IMM
SHL121        END-IF
SIB201     END-IF
SHL121
SHL121     IF ABIT-PRIN-COINT
SHL121     OR COST-RIST-COINT
SHL121        PERFORM CERCA-DATI-IMMOBILI
SHL121        IF W-C-GARANZ-ABT > SPACES
SHL121           IF W-C-GARANZ-ABT = '1C'
SHL121              MOVE '1'             TO W-C-PROPRI-IMM
SHL121           ELSE
SHL121              MOVE '0'             TO W-C-PROPRI-IMM
SHL121           END-IF
SIB201        ELSE
SIB201           MOVE '0'                TO W-C-PROPRI-IMM
SHL121        END-IF
SHL121     END-IF
SHL121
SHL121     IF AGRARIO-COINT
SHL121        MOVE SPACES                TO W-C-PROPRI-IMM
SHL121     END-IF
SIB201
SIB201     IF ALTRI-IMM-COINT
SIB201     AND W-C-PROPRI-IMM = SPACES
SIB201        MOVE '0'                   TO W-C-PROPRI-IMM
SIB201     END-IF
SHL121
SHL121     MOVE W-C-PROPRI-IMM           TO W-C-PROPRI-IMM-COI(W-X)
SIB201     MOVE SO-TIPO-MUTUO-COINT      TO W-C-TIPO-MUTUO-COI(W-X)
SIB201*SHL121     END-IF
SHL121
SHL121*- Se stipulato dopo il 2017-01-01 deve avere obbligatoriamente
SHL121*- flag propriet{ valorizzato:
SHL121     IF W-D-STIPUL-ADE >= '2017-01-01'
SHL121     AND W-C-PROPRI-IMM = SPACES
SIB201     AND NOT AGRARIO-COINT
SHL121        MOVE '0231'                   TO EKERR-C-COD-ERRORE(1)
SHL121        MOVE 'P023'                   TO EKERR-C-RIF-ERRORE(1)
SIB201*SHL121 MOVE 'FLAG PROPRIETA'' NON VALORIZZATO 1'
SIB201*SHL121                               TO EKERR-X-DES-ERRORE(1)
SIB201        STRING 'FLAG PROPRIETA'' '
SIB201               FCEI1-C-FINANZ-PRE'/'
SIB201               FCEI1-N-FINANZ-NUM ' NON VALORIZZATO 1'
SIB201                   DELIMITED BY SIZE
SIB201                                     INTO EKERR-X-DES-ERRORE(1)
SHL121        PERFORM MESSAGGIO-WARNING
SHL121     END-IF
SHL121     .

SKC182 ABITAZIONE-PRINCIPALE.
SKC182     MOVE 'ABITAZIONE-PRINCIPALE'   TO IDBGU-X-LABEL-TRAC
SKC182     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKC182     PERFORM R-TRACE-LABEL.
SKC182
SKC182     MOVE SPACES                    TO W-C-GARANZ-ABT
SKC182*- Abitazione principale: informazione reperibile dal campo
SKC182*  "C-GARANZ-ABT" - Garanzia abitativa" della tabella degli
SKC182*  "Immobili" EKFIM, laddove "1C" significa "Abitaz. principale"
SKC182     PERFORM CERCA-DATI-IMMOBILI
SKC182
SKC182     IF W-C-GARANZ-ABT > SPACES
SKC182        IF W-C-GARANZ-ABT = '1C'
SKC182           MOVE 'S'                 TO W-F-ABITAZ-PRI-APPO
SKC182        ELSE
SKC182           MOVE 'N'                 TO W-F-ABITAZ-PRI-APPO
SKC182        END-IF
SKC182     ELSE
SKC182        MOVE 'N'                    TO W-F-ABITAZ-PRI-APPO
SKC182     END-IF
SKC182     .

SHL121 CERCA-DATI-IMMOBILI.
SHL121     MOVE 'CERCA-DATI-IMMOBILI'     TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL.
SHL121
SHL121     MOVE SPACES                    TO W-C-GARANZ-ABT
SHL121
SHL121     INITIALIZE FIM9Q-G-GROUP-AREA.
SHL121     SET FIM9Q-SELECT-001           TO TRUE
SHL121     MOVE FAN9Q-C-CODICE-ABI-O      TO FIM9Q-C-GRUPPO-ABI
SHL121     MOVE FAN9Q-C-GRUPPO-ABI-O      TO FIM9Q-C-CODICE-ABI
SHL121     MOVE FAN9Q-C-FINANZ-PRE-O      TO FIM9Q-C-FINANZ-PRE
SHL121     MOVE FAN9Q-N-FINANZ-NUM-O      TO FIM9Q-N-FINANZ-NUM
SOJ311*SHL121     MOVE EKSYS-D-SYSTEM-OPE TO FIM9Q-D-RIFERI-OPE
SOJ311     MOVE EKIFB-D-RIFERI-OPE        TO FIM9Q-D-RIFERI-OPE
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FIM9Q-D-RIFERI-OPE
SPA221     END-IF
SHL121
SHL121     PERFORM CL-EKFIM9QB
SHL121
SHL121     IF NOT FIM9Q-OK
SHL121     AND NOT FIM9Q-ERR-NON-TROVATO
SHL121       MOVE FIM9Q-G-ESITO-AREA      TO EKERR-G-ESITO-AREA
SHL121       SET EKERR-ERR-DATI-INPUT     TO TRUE
SHL121       PERFORM R-ERRORE-NON-GESTIBILE
SHL121     END-IF.
SHL121
SHL121     IF FIM9Q-OK
SHL121       MOVE FIM9Q-C-GARANZ-ABT      TO W-C-GARANZ-ABT
SHL121     END-IF
SHL121     .

SHL121 DATI-BENE-IMM.
SHL121     MOVE 'DATI-BENE-IMM'           TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL.
DEB>>>*    DISPLAY 'DATI-BENE-IMM'
SHL121
SHL121     INITIALIZE                        IIM1I-G-GROUP-AREA
SHL121     MOVE FCEI1-C-CODICE-ABI        TO IIM1I-C-CODICE-ABI
SHL121     MOVE IFD4I-N-ID-BENEIMM(W-W)   TO IIM1I-N-ID-BENEIMM
250131     MOVE IFD4I-N-FINANZ-NUM        TO IIM1I-N-FINANZ-NUM
DEB>>>*    DISPLAY 'IFD4I-N-ID-BENEIMM(W-W): '
DEB>>>*             IFD4I-N-ID-BENEIMM(W-W)
SHL121
SHL121     PERFORM CL-EKIIM1IB
SHL121
SHL121     IF NOT IIM1I-OK
SHL121        MOVE IIM1I-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SHL121        SET EKERR-ERR-GENERICO      TO TRUE
SHL121        PERFORM R-ERRORE-NON-GESTIBILE
SHL121     END-IF
SHL121
SHL121*- Elaboro sempre il bene maggiore:
SHL121*    IF IIM1I-I-IMPFIN-IMM > W-I-IMPFIN-IMM
SJB211*SJB071     IF IIM1I-I-IMPFIN-IMM > W-I-IMPFIN-IMM
SJB211     IF IIM1I-I-IMPSTI-IMM > W-I-IMPSTI-IMM
SHL121       PERFORM VARYING W-Z FROM 1 BY 1
SHL121        UNTIL W-Z > 5
SHL121        OR IIM1I-C-NDGNDG-COD(W-Z) = SPACES OR LOW-VALUES
DEB>>>*        DISPLAY 'IIM1I-C-NDGNDG-COD(W-Z): '
DEB>>>*                 IIM1I-C-NDGNDG-COD(W-Z)
DEB>>>*        DISPLAY 'IAN3I-C-NDGNDG-COD-O(W-I): '
DEB>>>*                 IAN3I-C-NDGNDG-COD-O(W-I)
SHL121         IF IIM1I-C-NDGNDG-COD(W-Z) = IAN3I-C-NDGNDG-COD-O(W-I)
SHL121           MOVE IIM1I-C-NATURA-DIR(W-Z)   TO W-C-NATURA-DIR
SHL121                                             WS-TIPO-PRO
SHL121         END-IF
SIB201*        MOVE IIM1I-I-IMPFIN-IMM          TO W-I-IMPFIN-IMM
SJB211*SJB071         MOVE IIM1I-I-IMPFIN-IMM          TO W-I-IMPFIN-IMM
SJB211         MOVE IIM1I-I-IMPSTI-IMM          TO W-I-IMPSTI-IMM
SHL121       END-PERFORM
SHL121*    END-IF
SJB071     END-IF
SHL121     .
SHL121

SIB201 PROPRIETA-COI.
SIB201     MOVE 'PROPRIETA-COI'           TO IDBGU-X-LABEL-TRAC
SIB201     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SIB201     PERFORM R-TRACE-LABEL.
SIB201
SIB201*- Verifiche su flag propriet{ per cointestati:
SIB201     IF COI-SI
SIB201        MOVE ZEROES                   TO W-X
SIB201        SET PRO-NO                    TO TRUE
SIB201        SET SPA-NO                    TO TRUE
SIB201        SET TEST-NO                   TO TRUE
SIB201        PERFORM VARYING W-X FROM 1 BY 1
SIB201         UNTIL W-X > W-N-CONTA-IAN
SIB201            SET TEST-SI               TO TRUE
SIB201            IF W-C-PROPRI-IMM-COI(W-X) = '1'
SIB201               SET PRO-SI             TO TRUE
SIB201            END-IF
SIB201            IF W-C-PROPRI-IMM-COI(W-X) = SPACES
SIB201               SET SPA-SI             TO TRUE
SIB201            END-IF
SIB201        END-PERFORM
SIB201
SIB201        IF  PRO-NO
SIB201        AND SPA-NO
SIB201        AND TEST-SI
SIB201            MOVE '1'                  TO SO-PROPR-IMM-COINT
SIB201        END-IF
SIB201     END-IF
SIB201     .

090309*
090309 SCRITTURA-SONCO.
090309     MOVE 'SCRITTURA-SONCO'         TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
DEB>>>     DISPLAY 'SCRIVO SONCO: ' FCEI1-C-FINANZ-PRE '-'
DEB>>>                              FCEI1-N-FINANZ-NUM ' / '
DEB>>>                              FCEI1-C-NDGNDG-COD
090309*
090309     WRITE SONCORR2.
090309     IF NOT SONCO-STATUS-OK
090309        DISPLAY 'ERRORE WRITE SONCO: ' SONCO-STATUS
090309        MOVE '0131'                 TO EKERR-C-COD-ERRORE(1)
090309        MOVE '0007'                 TO EKERR-C-RIF-ERRORE(1)
090309        MOVE 'SONCO'                TO EKERR-X-DES-ERRORE(1) (1:5)
090309        MOVE SONCO-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
090309        PERFORM ERRORE-GRAVE
090309     ELSE
090309       ADD 1 TO W-N-CONTA-SONCO
090309       ADD 1 TO W-N-UPDATE
090309     END-IF.
SKA292
SKA292 SCRITTURA-SONC2.
SKA292     MOVE 'SCRITTURA-SONC2'         TO IDBGU-X-LABEL-TRAC
SKA292     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKA292     PERFORM R-TRACE-LABEL.
SKA292
DISPLA*    DISPLAY 'SCRIVO SONC2: '
SKA292     WRITE SONCOR22.
SKA292     IF NOT SONC2-STATUS-OK
SKA292        DISPLAY 'ERRORE WRITE SONC2: ' SONC2-STATUS
SKA292        MOVE '0131'                 TO EKERR-C-COD-ERRORE(1)
SKA292        MOVE '0009'                 TO EKERR-C-RIF-ERRORE(1)
SKA292        MOVE 'SONC2'                TO EKERR-X-DES-ERRORE(1) (1:5)
SKA292        MOVE SONC2-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
SKA292        PERFORM ERRORE-GRAVE
SKA292     ELSE
SKA292       ADD 1 TO W-N-CONTA-SONC2
SKA292       ADD 1 TO W-N-UPDATE
SKA292     END-IF.
SKA292*
090309 SCRITTURA-FANT1.
090309     MOVE 'SCRITTURA-FANT1'         TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309*
090309     INITIALIZE FANT1-G-AREA-RECORD
090309*    MOVE FANT1-G-APPO-RECORD       TO FANT1-G-AREA-RECORD
090309     COMPUTE W-N-FANT1-LEN = LENGTH OF FANT1-G-APPO-RECORD
DISPLA*    DISPLAY 'SCRIVO FANT1: '
090309     WRITE FANT1-G-AREA-RECORD      FROM FANT1-G-APPO-RECORD
090309     IF NOT FANT1-STATUS-OK
090309        DISPLAY 'ERRORE WRITE FANT1: ' FANT1-STATUS
090309        MOVE '0131'                 TO EKERR-C-COD-ERRORE(1)
090309        MOVE '0007'                 TO EKERR-C-RIF-ERRORE(1)
090309        MOVE 'FANT1'                TO EKERR-X-DES-ERRORE(1) (1:5)
090309        MOVE FANT1-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
090309        PERFORM ERRORE-GRAVE
090309     ELSE
090309       ADD 1 TO W-N-CONTA-FANT1
090309       ADD 1 TO W-N-UPDATE
090309     END-IF.
090309******************************************************************
      *
       SCRITTURA-DICPI.
           MOVE 'SCRITTURA-DICPI'         TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
      *
DISPLA*    DISPLAY 'SCRIVO DICPI: '
           WRITE DICPINTE.
           IF NOT DICPI-STATUS-OK
              DISPLAY 'ERRORE WRITE DICPI: ' DICPI-STATUS
              MOVE '0131'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0007'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'DICPI'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE DICPI-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           ELSE
             ADD 1 TO W-N-CONTA-DICPI
             ADD 1 TO W-N-UPDATE
           END-IF.
      *
       SCRITTURA-PAPYR.
           MOVE 'SCRITTURA-PAPYR'         TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.
DEBUG>*        DISPLAY 'SCRITTURA-PAPYR   >' REC-PAPYRUS(1:1)
      *
           WRITE REC-PAPYRUS.
           IF NOT PAPYR-STATUS-OK
              DISPLAY 'ERRORE WRITE PAPYR: ' PAPYR-STATUS
              MOVE '0131'                 TO EKERR-C-COD-ERRORE(1)
              MOVE '0007'                 TO EKERR-C-RIF-ERRORE(1)
              MOVE 'PAPYR'                TO EKERR-X-DES-ERRORE(1) (1:5)
              MOVE PAPYR-STATUS           TO EKERR-X-DES-ERRORE(1) (6:2)
              PERFORM ERRORE-GRAVE
           ELSE
             ADD 1 TO W-N-CONTA-PAPYR
             ADD 1 TO W-N-UPDATE
           END-IF.
      ******************************************************************
SID191 CHIAMA-ROUTINE-ANWC0302.

           INITIALIZE ANWC0302-AREA.
      *
           IF FAN00-C-FINANZ-PRE   = '09'
              MOVE '9  '              TO ANWC0302-I-CFTSERVI
           ELSE
              MOVE FAN00-C-FINANZ-PRE TO ANWC0302-I-CFTSERVI
           END-IF
           MOVE FAN00-C-FILIAL-GES(3:3) TO WS-FILIALE
           MOVE SPACE                 TO WS-FILIALE-X
           MOVE WS-FILIALE-5          TO ANWC0302-I-CRASPORT
           MOVE FCEI1-N-FINANZ-NUM    TO  WS-RAPPORTO-12
           MOVE WS-RAPPORTO-12        TO ANWC0302-I-NRACONTO
      *
           PERFORM RICERCA-ANAGRAFICA

           IF ANWC0302-S-CDRETCOD-OK
           OR ANWC0302-S-CDRETCOD-WRN
              SET SI-ELAB            TO TRUE
              ADD 1                  TO ANWR0302-RD
           ELSE
              DISPLAY 'ANWC0302-S-DERETCOD   '  ANWC0302-S-DERETCOD
              DISPLAY 'ANWC0302-I-CFTSERVI   '  ANWC0302-I-CFTSERVI
              DISPLAY 'ANWC0302-I-CRASPORT   '  ANWC0302-I-CRASPORT
              DISPLAY 'ANWC0302-I-NRACONTO   '  ANWC0302-I-NRACONTO
              DISPLAY 'ANWC0302-O-FLESTINTO  '  ANWC0302-O-FLESTINTO
              DISPLAY 'ERRORE CALL ROUTINE ANWR0302'
              DISPLAY 'SQLCODE ' ANWC0302-S-SQLCODE
              DISPLAY 'RC ' ANWC0302-S-CDRETCOD
                      '  '  ANWC0302-S-DERETCOD
           END-IF.

SJB071*VERIFICA-EKFDI.
SJB071*    MOVE 'VERIFICA-EKFDI'          TO IDBGU-X-LABEL-TRAC
SJB071*    MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJB071*    PERFORM R-TRACE-LABEL.
SJB071*
SJB071*    SET W-F-EKFDI-NO               TO TRUE
SJB071*    INITIALIZE                        FDI9Q-G-GROUP-AREA
SJB071*    SET  FDI9Q-SELECT-001          TO TRUE
SJB071*    MOVE FCEI1-C-GRUPPO-ABI        TO FDI9Q-C-GRUPPO-ABI-I
SJB071*    MOVE FCEI1-C-CODICE-ABI        TO FDI9Q-C-CODICE-ABI-I
SJB071*    MOVE FCEI1-C-FINANZ-PRE        TO FDI9Q-C-FINANZ-PRE-I
SJB071*    MOVE FCEI1-N-FINANZ-NUM        TO FDI9Q-N-FINANZ-NUM-I
SJB071*    MOVE IAN1I-C-NDGNDG-COD-O      TO FDI9Q-C-NDGNDG-COD-I
SJB071*    MOVE 1                         TO FDI9Q-N-PROGRE-NUM-I
SJB071*    MOVE EKIFB-D-RIFERI-OPE        TO FDI9Q-D-RIFERI-OPE-I
SJB071*    MOVE EKIFB-D-RIFERI-OPE        TO FDI9Q-D-RIFERI-OPE-I
SJB071*    MOVE EKSYS-T-SYSTEM-OPE        TO FDI9Q-T-INSERI-OPE-I
SJB071*
SJB071*    PERFORM CL-EKFDI9QB
SJB071*
SJB071*    IF NOT FDI9Q-OK
SJB071*    AND NOT FDI9Q-ERR-NON-TROVATO
SJB071*       MOVE FDI9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJB071*       MOVE FDI9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SJB071*       PERFORM R-ERRORE-NON-GESTIBILE
SJB071*    END-IF.
SJB071*    IF FDI9Q-OK
SJB071*       SET W-F-EKFDI-SI            TO TRUE
SJB071*    END-IF.
      * ================
       RICERCA-ANAGRAFICA.

           MOVE '05696'            TO ANWC0302-I-CCLCODBA.
           CALL WS-ANWR0302        USING  ANWC0302-AREA.

SJD291 RECUPERA-ID-ENTE.
SJD291     MOVE 'RECUPERA-ID-ENTE'        TO IDBGU-X-LABEL-TRAC.
SJD291     MOVE 3                         TO IDBGU-C-LIVELL-TRA.
SJD291     PERFORM R-TRACE-LABEL.
SJD291
SJD291     MOVE SPACES                    TO PAPY-TIPNTE-PRI
SJD291     INITIALIZE                        FDT9Q-G-GROUP-AREA
SJD291     SET  FDT9Q-SELECT-001          TO TRUE
SJD291     MOVE FCEI1-C-GRUPPO-ABI        TO FDT9Q-C-GRUPPO-ABI-I
SJD291     MOVE FCEI1-C-CODICE-ABI        TO FDT9Q-C-CODICE-ABI-I
SJD291     MOVE FCEI1-C-FINANZ-PRE        TO FDT9Q-C-FINANZ-PRE-I
SJD291     MOVE FCEI1-N-FINANZ-NUM        TO FDT9Q-N-FINANZ-NUM-I
SOJ311*SJD291     MOVE EKSYS-T-SYSTEM-OPE(1:10)  TO FDT9Q-D-INIZ-VALID-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE        TO FDT9Q-D-INIZ-VALID-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FDT9Q-D-INIZ-VALID-I
SPA221     END-IF
SJD291     MOVE 'N'                       TO FDT9Q-F-CARATT-ANN-I
SJD291     MOVE 'C-TIPNTE-PRI'            TO FDT9Q-C-CARATT-KEY-I
SJD291                                       W-C-DOMINI-DAT
SJD291     MOVE 1                         TO FDT9Q-N-PROGRE-ORD-I
SJD291*
SJD291     PERFORM CL-EKFDT9QB.
SJD291*
SJD291     IF NOT FDT9Q-OK
SJD291     AND NOT FDT9Q-ERR-NON-TROVATO
SJD291        MOVE FDT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD291        MOVE FDT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SJD291        PERFORM R-ERRORE-NON-GESTIBILE
SJD291     END-IF
SJD291
SJD291     IF FDT9Q-OK
SJD291     AND FDT9Q-V-CARATT-VAL-O > SPACES
SJD291        MOVE FDT9Q-V-CARATT-VAL-O   TO W-V-DOMINI-DAT
SJD291        PERFORM CONTROLLO-DOMINI
SJD291        MOVE IDM9Q-X-DOMINI-DAT-O   TO PAPY-TIPNTE-PRI
SJD291     END-IF
SJD291
SJD291     MOVE SPACES                    TO PAPY-IDENTE-PRI
SJD291     INITIALIZE                        FDT9Q-G-GROUP-AREA
SJD291     SET  FDT9Q-SELECT-001          TO TRUE
SJD291     MOVE FCEI1-C-GRUPPO-ABI        TO FDT9Q-C-GRUPPO-ABI-I
SJD291     MOVE FCEI1-C-CODICE-ABI        TO FDT9Q-C-CODICE-ABI-I
SJD291     MOVE FCEI1-C-FINANZ-PRE        TO FDT9Q-C-FINANZ-PRE-I
SJD291     MOVE FCEI1-N-FINANZ-NUM        TO FDT9Q-N-FINANZ-NUM-I
SOJ311*SJD291     MOVE EKSYS-T-SYSTEM-OPE(1:10)  TO FDT9Q-D-INIZ-VALID-I
SOJ311     MOVE EKIFB-D-RIFERI-OPE        TO FDT9Q-D-INIZ-VALID-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FDT9Q-D-INIZ-VALID-I
SPA221     END-IF
SJD291     MOVE 'N'                       TO FDT9Q-F-CARATT-ANN-I
SJD291     MOVE 'C-IDENTE-PRI'            TO FDT9Q-C-CARATT-KEY-I
SJD291     MOVE 1                         TO FDT9Q-N-PROGRE-ORD-I
SJD291*
SJD291     PERFORM CL-EKFDT9QB.
SJD291*
SJD291     IF NOT FDT9Q-OK
SJD291     AND NOT FDT9Q-ERR-NON-TROVATO
SJD291        MOVE FDT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD291        MOVE FDT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SJD291        PERFORM R-ERRORE-NON-GESTIBILE
SJD291     ELSE
SJD291        MOVE FDT9Q-V-CARATT-VAL-O   TO PAPY-IDENTE-PRI
SJD291     END-IF.

SJD291 CONTROLLO-DOMINI.
SJD291     MOVE 'CONTROLLO-DOMINI'        TO IDBGU-X-LABEL-TRAC
SJD291     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJD291     PERFORM R-TRACE-LABEL.
SJD291
SJD291     INITIALIZE                            IDM9Q-G-GROUP-AREA
SJD291     MOVE FCEI1-C-GRUPPO-ABI            TO IDM9Q-C-GRUPPO-ABI-I
SJD291     MOVE FCEI1-C-CODICE-ABI            TO IDM9Q-C-CODICE-ABI-I
SJD291     MOVE W-C-DOMINI-DAT                TO IDM9Q-C-DOMINI-DAT-I
SJD291     MOVE W-V-DOMINI-DAT                TO IDM9Q-V-DOMINI-DAT-I
SJD291     SET IDM9Q-SELECT-002               TO TRUE
SJD291
SJD291     PERFORM CL-EKIDM9QB
SJD291
SJD291     IF NOT IDM9Q-OK
SJD291        MOVE IDM9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD291        SET EKERR-ERR-DATI-INPUT    TO TRUE
SJD291        PERFORM R-ERRORE-GESTIBILE
SJD291     END-IF.
      *
SJD121 VERIFICA-EKFGT.
SJD121     MOVE 'VERIFICA-EKFGT'          TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL.
DEB>>>     DISPLAY 'VERIFICA-EKFGT PER NDG: 'W-C-NDGNDG-COD
DEB>>>             ' - POS: ' FCEI1-N-FINANZ-NUM
SJD121
SKA292     INITIALIZE                        W-F-PROPRI-IMM
SKA292                                       W-P-DETRAZ-PER
SKA292                                       W-P-PERCEN-APP
SKA292                                       W-D-INIRIS-PRE
SKA292                                       W-D-FINRIS-PRE
SKA292                                       W-I-ACQPRI-IPO
SKA292                                       W-I-ACQALT-IPO
SKA292                                       W-I-RISPRI-IPO
SKA292                                       W-I-ALTFIN-IPO
SKA292                                       W-I-AGRARI-IPO
SKA292                                       W-I-TOTFIN-IPO
SLC113                                       W-I-TOTFIN-IPO-NOLIQ
SJD121*- Se TROVO la tabella EKFTG valorizzata
SJD121*  setto W-F-EKFGT-SI che pilota tutti i ragionamenti su EKFGT:
SJD121     INITIALIZE                        FGT9Q-G-GROUP-AREA
SKA292*SJD121     SET  FGT9Q-SELECT-003          TO TRUE
SOJ041*SKA292     SET  FGT9Q-SELECT-005          TO TRUE
SOJ041     SET  FGT9Q-SELECT-007          TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SJD121     MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SJD121     MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SJD121     MOVE FCEI1-C-FINANZ-PRE        TO FGT9Q-C-FINANZ-PRE-I
SJD121     MOVE FCEI1-N-FINANZ-NUM        TO FGT9Q-N-FINANZ-NUM-I
SOJ041*S0J041     MOVE EKIFB-D-RIFERI-OPE TO FLG9Q-D-MOVIME-CON-I
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SKA292*SJD121     MOVE IAN1I-C-NDGNDG-COD-O      TO FGT9Q-C-NDGNDG-COD-I
SKA292     MOVE W-C-NDGNDG-COD            TO FGT9Q-C-NDGNDG-COD-I
SKA292*SJD121  MOVE 1                     TO FGT9Q-N-PROGRE-NUM-I
SKA292*SJD121  MOVE EKIFB-D-RIFERI-OPE    TO FGT9Q-D-RIFERI-OPE-I
SKA292*SJD121  MOVE EKIFB-D-RIFERI-OPE    TO FGT9Q-D-RIFERI-OPE-I
SKA292*SJD121  MOVE EKSYS-T-SYSTEM-OPE    TO FGT9Q-T-INSERI-OPE-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FGT9Q-D-RIFERI-OPE-I
SPA221     END-IF
SJD121
SJD121     PERFORM CL-EKFGT9QB
displa*    display 'C-GRUPPO-ABI ' FGT9Q-C-GRUPPO-ABI-I
displa*    display 'C-CODICE-ABI ' FGT9Q-C-CODICE-ABI-I
displa*    display 'C-FINANZ-PRE ' FGT9Q-C-FINANZ-PRE-I
displa*    display 'N-FINANZ-NUM ' FGT9Q-N-FINANZ-NUM-I
displa*    display 'NDGNDG-COD   ' FGT9Q-C-NDGNDG-COD-I
DISPLA     IF FGT9Q-ERR-NON-TROVATO
displa     display 'ERR-NON-TROVATO su FGT '
displa             FGT9Q-G-ESITO-AREA
DISPLA     END-IF
SJD121
SJD121     IF NOT FGT9Q-OK
SJD121     AND NOT FGT9Q-ERR-NON-TROVATO
SJD121        MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD121        MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SJD121        PERFORM R-ERRORE-NON-GESTIBILE
SJD121     END-IF
SKA292
SJD121     IF FGT9Q-OK
SKA292*SJD121     AND FGT9Q-P-DETRAZ-PER-O > ZEROES
SKA292        MOVE FGT9Q-F-PROPRI-IMM-O   TO W-F-PROPRI-IMM
DEB>>>*       DISPLAY 'FX0709 W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
SKA292        MOVE FGT9Q-P-DETRAZ-PER-O   TO W-P-DETRAZ-PER
SKA292                                       W-P-PERCEN-APP
SKA292        MOVE FGT9Q-D-INIRIS-PRE-O   TO W-D-INIRIS-PRE
SKA292        MOVE FGT9Q-D-FINRIS-PRE-O   TO W-D-FINRIS-PRE
SKA292
SKA292        MOVE FGT9Q-I-ACQPRI-IPO-O   TO W-I-ACQPRI-IPO
SKA292        MOVE FGT9Q-I-ACQALT-IPO-O   TO W-I-ACQALT-IPO
SKA292        MOVE FGT9Q-I-RISPRI-IPO-O   TO W-I-RISPRI-IPO
SKA292        MOVE FGT9Q-I-ALTFIN-IPO-O   TO W-I-ALTFIN-IPO
SKA292        MOVE FGT9Q-I-AGRARI-IPO-O   TO W-I-AGRARI-IPO
SKA292        MOVE FGT9Q-I-TOTFIN-IPO-O   TO W-I-TOTFIN-IPO
DEB>>>        DISPLAY 'W-F-EKFGT-SI: ' W-P-PERCEN-APP
DEB>>>        DISPLAY 'W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
DEB>>>        DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>        DISPLAY 'W-I-ACQALT-IPO: ' W-I-ACQALT-IPO
DEB>>>        DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>        DISPLAY 'W-I-ALTFIN-IPO: ' W-I-ALTFIN-IPO
DEB>>>        DISPLAY 'W-I-AGRARI-IPO: ' W-I-AGRARI-IPO
DEB>>>        DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>        DISPLAY 'W-T-INSERI-OPE: ' FGT9Q-T-INSERI-OPE-O
SKA292
SKA292        SET W-F-EKFGT-SI            TO TRUE
SKB261
SKB261        IF W-I-ALTFIN-IPO > ZEROES
SKB261        AND W-I-ACQPRI-IPO = ZEROES
SKB261        AND W-I-ACQALT-IPO = ZEROES
SKB261        AND W-I-RISPRI-IPO = ZEROES
SKB261        AND W-I-AGRARI-IPO = ZEROES
SLC113*SKB261            SET W-F-ALTFIN-SOLO-SI  TO TRUE
SLC113            CONTINUE
SKB261        END-IF
SLC113        IF COI-NO
SLC113           SET PF-MISTO-NO      TO TRUE
SLC113           COMPUTE W-I-TOTFIN-IPO-NOLIQ = W-I-TOTFIN-IPO
SLC113                                        - W-I-ALTFIN-IPO
SLC113*- Se PF con singola finalit{ (esclusa liquidit{) non sono misto:
SLC113           IF (W-I-ACQPRI-IPO > 0
SLC113           AND W-I-ACQPRI-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SLC113           OR (W-I-ACQALT-IPO > 0
SLC113           AND W-I-ACQALT-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SLC113           OR (W-I-RISPRI-IPO > 0
SLC113           AND W-I-RISPRI-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SLC113               SET PF-MISTO-SI      TO TRUE
SLC113           END-IF
SLC113        END-IF
SKB261     ELSE
DEB>>>        DISPLAY 'W-F-EKFGT-NO'
SKA292        MOVE 'N'                    TO W-F-PROPRI-IMM
SKA292        MOVE 100                    TO W-P-DETRAZ-PER
SKA292                                       W-P-PERCEN-APP
SKA292        MOVE '0001-01-01'           TO W-D-INIRIS-PRE
SKA292        MOVE '9999-12-31'           TO W-D-FINRIS-PRE
SKA292
SKA292        MOVE ZEROES                 TO W-I-ACQPRI-IPO
SKA292        MOVE ZEROES                 TO W-I-ACQALT-IPO
SKA292        MOVE ZEROES                 TO W-I-RISPRI-IPO
SKA292        MOVE ZEROES                 TO W-I-ALTFIN-IPO
SKA292        MOVE ZEROES                 TO W-I-AGRARI-IPO
SKA292        MOVE ZEROES                 TO W-I-TOTFIN-IPO
SJD121     END-IF
SND171     IF  W-F-EKFGT-NO
SND171         PERFORM VERIFICA-RINEGOZIATO
SND171         IF  W-C-FINANZ-PRE-RIN > SPACES
SND171             PERFORM VERIFICA-EKFGT-RIN
SND171         END-IF
SND171     END-IF
SJD121     .
      *
SND171 VERIFICA-EKFGT-RIN.
SND171     MOVE 'VERIFICA-EKFGT-RIN'      TO IDBGU-X-LABEL-TRAC
SND171     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SND171     PERFORM R-TRACE-LABEL.
DEB>>>     DISPLAY 'VERIFICA-EKFGT PER NDG: 'W-C-NDGNDG-COD
DEB>>>             ' - POS: ' FCEI1-N-FINANZ-NUM
SND171
SND171     INITIALIZE                        W-F-PROPRI-IMM
SND171                                       W-P-DETRAZ-PER
SND171                                       W-P-PERCEN-APP
SND171                                       W-D-INIRIS-PRE
SND171                                       W-D-FINRIS-PRE
SND171                                       W-I-ACQPRI-IPO
SND171                                       W-I-ACQALT-IPO
SND171                                       W-I-RISPRI-IPO
SND171                                       W-I-ALTFIN-IPO
SND171                                       W-I-AGRARI-IPO
SND171                                       W-I-TOTFIN-IPO
SND171                                       W-I-TOTFIN-IPO-NOLIQ
SND171*- Se TROVO la tabella EKFTG padre valorizzata
SND171*  setto W-F-EKFGT-SI che pilota tutti i ragionamenti su EKFGT:
SND171     INITIALIZE                        FGT9Q-G-GROUP-AREA
SOJ041*SND171     SET  FGT9Q-SELECT-005          TO TRUE
SOJ041     SET  FGT9Q-SELECT-007          TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SND171     MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SND171     MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SND171     MOVE W-C-FINANZ-PRE-RIN        TO FGT9Q-C-FINANZ-PRE-I
SND171     MOVE W-N-FINANZ-NUM-RIN        TO FGT9Q-N-FINANZ-NUM-I
SND171     MOVE W-C-NDGNDG-COD            TO FGT9Q-C-NDGNDG-COD-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FGT9Q-D-RIFERI-OPE-I
SPA221     END-IF
SND171
SND171     PERFORM CL-EKFGT9QB
SND171
SND171     IF NOT FGT9Q-OK
SND171     AND NOT FGT9Q-ERR-NON-TROVATO
SND171        MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SND171        MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SND171        PERFORM R-ERRORE-NON-GESTIBILE
SND171     END-IF
SND171
SND171     IF FGT9Q-OK
SND171        MOVE FGT9Q-F-PROPRI-IMM-O   TO W-F-PROPRI-IMM
SND171        MOVE FGT9Q-P-DETRAZ-PER-O   TO W-P-DETRAZ-PER
SND171                                       W-P-PERCEN-APP
SND171        MOVE FGT9Q-D-INIRIS-PRE-O   TO W-D-INIRIS-PRE
SND171        MOVE FGT9Q-D-FINRIS-PRE-O   TO W-D-FINRIS-PRE
SND171
SND171        MOVE FGT9Q-I-ACQPRI-IPO-O   TO W-I-ACQPRI-IPO
SND171        MOVE FGT9Q-I-ACQALT-IPO-O   TO W-I-ACQALT-IPO
SND171        MOVE FGT9Q-I-RISPRI-IPO-O   TO W-I-RISPRI-IPO
SND171        MOVE FGT9Q-I-ALTFIN-IPO-O   TO W-I-ALTFIN-IPO
SND171        MOVE FGT9Q-I-AGRARI-IPO-O   TO W-I-AGRARI-IPO
SND171        MOVE FGT9Q-I-TOTFIN-IPO-O   TO W-I-TOTFIN-IPO
DEB>>>        DISPLAY 'W-F-EKFGT-SI: ' W-P-PERCEN-APP
DEB>>>        DISPLAY 'W-F-PROPRI-IMM: ' W-F-PROPRI-IMM
DEB>>>        DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>        DISPLAY 'W-I-ACQALT-IPO: ' W-I-ACQALT-IPO
DEB>>>        DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>        DISPLAY 'W-I-ALTFIN-IPO: ' W-I-ALTFIN-IPO
DEB>>>        DISPLAY 'W-I-AGRARI-IPO: ' W-I-AGRARI-IPO
DEB>>>        DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>        DISPLAY 'W-T-INSERI-OPE 2: ' FGT9Q-T-INSERI-OPE-O
SND171*
SND171        SET W-F-EKFGT-SI            TO TRUE
SND171*
SND171        IF W-I-ALTFIN-IPO > ZEROES
SND171        AND W-I-ACQPRI-IPO = ZEROES
SND171        AND W-I-ACQALT-IPO = ZEROES
SND171        AND W-I-RISPRI-IPO = ZEROES
SND171        AND W-I-AGRARI-IPO = ZEROES
SND171            CONTINUE
SND171        END-IF
SND171        IF COI-NO
SND171           SET PF-MISTO-NO      TO TRUE
SND171           COMPUTE W-I-TOTFIN-IPO-NOLIQ = W-I-TOTFIN-IPO
SND171                                        - W-I-ALTFIN-IPO
SND171*- Se PF con singola finalit{ (esclusa liquidit{) non sono misto:
SND171           IF (W-I-ACQPRI-IPO > 0
SND171           AND W-I-ACQPRI-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SND171           OR (W-I-ACQALT-IPO > 0
SND171           AND W-I-ACQALT-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SND171           OR (W-I-RISPRI-IPO > 0
SND171           AND W-I-RISPRI-IPO <  W-I-TOTFIN-IPO-NOLIQ)
SND171               SET PF-MISTO-SI      TO TRUE
SND171           END-IF
SND171        END-IF
SND171     ELSE
DEB>>>        DISPLAY 'W-F-EKFGT-NO'
SND171        MOVE 'N'                    TO W-F-PROPRI-IMM
SND171        MOVE 100                    TO W-P-DETRAZ-PER
SND171                                       W-P-PERCEN-APP
SND171        MOVE '0001-01-01'           TO W-D-INIRIS-PRE
SND171        MOVE '9999-12-31'           TO W-D-FINRIS-PRE
SND171
SND171        MOVE ZEROES                 TO W-I-ACQPRI-IPO
SND171        MOVE ZEROES                 TO W-I-ACQALT-IPO
SND171        MOVE ZEROES                 TO W-I-RISPRI-IPO
SND171        MOVE ZEROES                 TO W-I-ALTFIN-IPO
SND171        MOVE ZEROES                 TO W-I-AGRARI-IPO
SND171        MOVE ZEROES                 TO W-I-TOTFIN-IPO
SND171     END-IF
SND171     .

SKB261 VERIFICA-EKFGT-TOT.
SKB261     MOVE 'VERIFICA-EKFGT-TOT'      TO IDBGU-X-LABEL-TRAC
SKB261     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB261     PERFORM R-TRACE-LABEL.
SKB261
DEB>>>*    DISPLAY 'VERIFICA-EKFGT-TOT: 'W-C-NDGNDG-COD
SKB261     INITIALIZE                        FGT9Q-G-GROUP-AREA
SOJ041*SKB261   SET  FGT9Q-SELECT-005          TO TRUE
SOJ041     SET  FGT9Q-SELECT-007          TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SKB261     MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SKB261     MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SKB261     MOVE FCEI1-C-FINANZ-PRE        TO FGT9Q-C-FINANZ-PRE-I
SKB261     MOVE FCEI1-N-FINANZ-NUM        TO FGT9Q-N-FINANZ-NUM-I
SKB261     MOVE W-C-NDGNDG-COD            TO FGT9Q-C-NDGNDG-COD-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FGT9Q-D-RIFERI-OPE-I
SPA221     END-IF
SKB261
SKB261     PERFORM CL-EKFGT9QB
SKB261
SKB261     IF NOT FGT9Q-OK
SKB261     AND NOT FGT9Q-ERR-NON-TROVATO
SKB261        MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SKB261        MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SKB261        PERFORM R-ERRORE-NON-GESTIBILE
SKB261     END-IF
SKB261
SKB261     IF FGT9Q-OK
DEB>>>*       DISPLAY 'EKFTG OK  NDG  ' FGT9Q-C-NDGNDG-COD-I
DEB>>>*       DISPLAY 'FGT9Q-F-PROPRI-IMM-O: '
DEB>>>*                       FGT9Q-F-PROPRI-IMM-O
SKB261        IF FGT9Q-I-AGRARI-IPO-O > ZEROES
SLC102           IF AGRARIO-COINT-NO
SLC102              ADD 1                 TO W-FINALI-TOT
SLC102           END-IF
SKB261           SET AGRARIO-COINT-SI     TO TRUE
SKC182           IF W-COI = 1
SKC182              ADD 1    TO W-FINALI
SKC182              SET AGRARIO-FINAL-SI    TO TRUE
SKC182           ELSE
SKC182              ADD 1    TO W-FINALI-N
SKC182              IF AGRARIO-FINAL-NO
SLC113*SKC182                 SET FINAL-MISTO-DIV  TO TRUE
SLC113                 CONTINUE
SKC182              END-IF
SKC182           END-IF
SKB261        END-IF
SKB261        IF FGT9Q-I-ACQPRI-IPO-O > ZEROES
SLC102           IF ABIT-PRIN-COINT-NO
SLC102              ADD 1                 TO W-FINALI-TOT
SLC102           END-IF
SKB261           SET ABIT-PRIN-COINT-SI   TO TRUE
SKC182           IF W-COI = 1
SKC182              ADD 1    TO W-FINALI
SKC182              SET ABIT-PRIN-FINAL-SI  TO TRUE
SKC182           ELSE
SKC182              ADD 1    TO W-FINALI-N
SKC182              IF ABIT-PRIN-FINAL-NO
SLC113*SKC182                 SET FINAL-MISTO-DIV  TO TRUE
SLC113                 CONTINUE
SKC182              END-IF
SKC182           END-IF
SKB261        END-IF
SKB261        IF FGT9Q-I-ACQALT-IPO-O > ZEROES
SKC182*SKB261        OR FGT9Q-I-ALTFIN-IPO-O > ZEROES
SLC102           IF ALTRI-IMM-COINT-NO
SLC102              ADD 1                 TO W-FINALI-TOT
SLC102           END-IF
SKB261           SET ALTRI-IMM-COINT-SI   TO TRUE
SKC182           IF W-COI = 1
SKC182              ADD 1    TO W-FINALI
SKC182              SET ALTRI-IMM-FINAL-SI  TO TRUE
SKC182           ELSE
SKC182              ADD 1    TO W-FINALI-N
SKC182              IF ALTRI-IMM-FINAL-NO
SLC113*SKC182                 SET FINAL-MISTO-DIV  TO TRUE
SLC113                 CONTINUE
SKC182              END-IF
SKC182           END-IF
SKB261        END-IF
SKB261        IF FGT9Q-I-RISPRI-IPO-O > ZEROES
SLC102           IF COST-RIST-COINT-NO
SLC102              ADD 1                 TO W-FINALI-TOT
SLC102           END-IF
SKB261           SET COST-RIST-COINT-SI   TO TRUE
SKC182           IF W-COI = 1
SKC182              ADD 1    TO W-FINALI
SKC182              SET COST-RIST-FINAL-SI  TO TRUE
SKC182           ELSE
SKC182              ADD 1    TO W-FINALI-N
SKC182              IF COST-RIST-FINAL-NO
SLC113*SKC182                 SET FINAL-MISTO-DIV  TO TRUE
SLC113                 CONTINUE
SKC182              END-IF
SKC182           END-IF
SKB261        END-IF
SKC182        IF FGT9Q-I-ALTFIN-IPO-O > ZEROES
SLH051*          Finalita non certificabile
SLH051*SLC102    IF ALTFIN-COINT-NO
SLH051*SLC102       ADD 1                 TO W-FINALI-TOT
SLH051*SLC102    END-IF
SKC182           SET ALTFIN-COINT-SI      TO TRUE
SKC182           IF W-COI = 1
SKC182              ADD 1    TO W-FINALI
SKC182              SET ALTFIN-FINAL-SI     TO TRUE
SKC182           ELSE
SKC182              ADD 1    TO W-FINALI-N
SKC182              IF ALTFIN-FINAL-NO
SLC113*SKC182                 SET FINAL-MISTO-DIV  TO TRUE
SLC113                 CONTINUE
SKC182              END-IF
SKC182           END-IF
SKC182        END-IF
SKB261     END-IF
DEB>>>*    DISPLAY 'W-FINALI    : ' W-FINALI
DEB>>>*    DISPLAY 'W-FINALI-N  : ' W-FINALI-N
DEB>>>*    DISPLAY 'W-FINALI-TOT: ' W-FINALI-TOT
SND171     IF  W-F-EKFGT-NO
SND171         PERFORM VERIFICA-RINEGOZIATO
SND171         IF  W-C-FINANZ-PRE-RIN > SPACES
SND171             PERFORM VERIFICA-EKFGT-TOT-RIN
SND171         END-IF
SND171     END-IF
SKB261     .
SND171 VERIFICA-EKFGT-TOT-RIN.
SND171     MOVE 'VERIFICA-EKFGT-TOT-RIN'  TO IDBGU-X-LABEL-TRAC
SND171     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SND171     PERFORM R-TRACE-LABEL.
SND171
SND171     INITIALIZE                        FGT9Q-G-GROUP-AREA
SOJ041*SND171   SET  FGT9Q-SELECT-005          TO TRUE
SOJ041     SET  FGT9Q-SELECT-007          TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SND171     MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SND171     MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SND171     MOVE W-C-FINANZ-PRE-RIN        TO FGT9Q-C-FINANZ-PRE-I
SND171     MOVE W-N-FINANZ-NUM-RIN        TO FGT9Q-N-FINANZ-NUM-I
SND171     MOVE W-C-NDGNDG-COD            TO FGT9Q-C-NDGNDG-COD-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FGT9Q-D-RIFERI-OPE-I
SPA221     END-IF
SND171
SND171     PERFORM CL-EKFGT9QB
SND171
SND171     IF NOT FGT9Q-OK
SND171     AND NOT FGT9Q-ERR-NON-TROVATO
SND171        MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SND171        MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SND171        PERFORM R-ERRORE-NON-GESTIBILE
SND171     END-IF
SND171
SND171     IF FGT9Q-OK
SND171        IF FGT9Q-I-AGRARI-IPO-O > ZEROES
SND171           IF AGRARIO-COINT-NO
SND171              ADD 1                 TO W-FINALI-TOT
SND171           END-IF
SND171           SET AGRARIO-COINT-SI     TO TRUE
SND171           IF W-COI = 1
SND171              ADD 1    TO W-FINALI
SND171              SET AGRARIO-FINAL-SI    TO TRUE
SND171           ELSE
SND171              ADD 1    TO W-FINALI-N
SND171              IF AGRARIO-FINAL-NO
SND171                 CONTINUE
SND171              END-IF
SND171           END-IF
SND171        END-IF
SND171        IF FGT9Q-I-ACQPRI-IPO-O > ZEROES
SND171           IF ABIT-PRIN-COINT-NO
SND171              ADD 1                 TO W-FINALI-TOT
SND171           END-IF
SND171           SET ABIT-PRIN-COINT-SI   TO TRUE
SND171           IF W-COI = 1
SND171              ADD 1    TO W-FINALI
SND171              SET ABIT-PRIN-FINAL-SI  TO TRUE
SND171           ELSE
SND171              ADD 1    TO W-FINALI-N
SND171              IF ABIT-PRIN-FINAL-NO
SND171                 CONTINUE
SND171              END-IF
SND171           END-IF
SND171        END-IF
SND171        IF FGT9Q-I-ACQALT-IPO-O > ZEROES
SND171           IF ALTRI-IMM-COINT-NO
SND171              ADD 1                 TO W-FINALI-TOT
SND171           END-IF
SND171           SET ALTRI-IMM-COINT-SI   TO TRUE
SND171           IF W-COI = 1
SND171              ADD 1    TO W-FINALI
SND171              SET ALTRI-IMM-FINAL-SI  TO TRUE
SND171           ELSE
SND171              ADD 1    TO W-FINALI-N
SND171              IF ALTRI-IMM-FINAL-NO
SND171                 CONTINUE
SND171              END-IF
SND171           END-IF
SND171        END-IF
SND171        IF FGT9Q-I-RISPRI-IPO-O > ZEROES
SND171           IF COST-RIST-COINT-NO
SND171              ADD 1                 TO W-FINALI-TOT
SND171           END-IF
SND171           SET COST-RIST-COINT-SI   TO TRUE
SND171           IF W-COI = 1
SND171              ADD 1    TO W-FINALI
SND171              SET COST-RIST-FINAL-SI  TO TRUE
SND171           ELSE
SND171              ADD 1    TO W-FINALI-N
SND171              IF COST-RIST-FINAL-NO
SND171                 CONTINUE
SND171              END-IF
SND171           END-IF
SND171        END-IF
SND171        IF FGT9Q-I-ALTFIN-IPO-O > ZEROES
SND171           SET ALTFIN-COINT-SI      TO TRUE
SND171           IF W-COI = 1
SND171              ADD 1    TO W-FINALI
SND171              SET ALTFIN-FINAL-SI     TO TRUE
SND171           ELSE
SND171              ADD 1    TO W-FINALI-N
SND171              IF ALTFIN-FINAL-NO
SND171                 CONTINUE
SND171              END-IF
SND171           END-IF
SND171        END-IF
SND171     END-IF
SND171     .

SKB181 REPERISCI-IMPORTI-FGT.
SKB181     MOVE 'REPERISCI-IMPORTI-FGT'   TO IDBGU-X-LABEL-TRAC
SKB181     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB181     PERFORM R-TRACE-LABEL.
SKB181
SKB181     INITIALIZE                        W-I-ACQPRI-IPO
SKB181                                       W-I-ACQALT-IPO
SKB181                                       W-I-RISPRI-IPO
SKB181                                       W-I-ALTFIN-IPO
SKB181                                       W-I-AGRARI-IPO
SKB181                                       W-I-TOTFIN-IPO
SKB181     INITIALIZE                        FGT9Q-G-GROUP-AREA
SOJ041*SKB181   SET  FGT9Q-SELECT-005          TO TRUE
SOJ041     SET  FGT9Q-SELECT-007          TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FGT9Q-D-RIFERI-OPE-I
SKB181     MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SKB181     MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SKB181     MOVE FCEI1-C-FINANZ-PRE        TO FGT9Q-C-FINANZ-PRE-I
SKB181     MOVE FCEI1-N-FINANZ-NUM        TO FGT9Q-N-FINANZ-NUM-I
SND171     IF  W-C-FINANZ-PRE-RIN > SPACES
SND171         MOVE W-C-FINANZ-PRE-RIN    TO FGT9Q-C-FINANZ-PRE-I
SND171         MOVE W-N-FINANZ-NUM-RIN    TO FGT9Q-N-FINANZ-NUM-I
SND171     END-IF
SKB181     MOVE W-C-NDGNDG-COD            TO FGT9Q-C-NDGNDG-COD-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FGT9Q-D-RIFERI-OPE-I
SPA221     END-IF
SKB181
SKB181     PERFORM CL-EKFGT9QB
SKB181
SKB181     IF NOT FGT9Q-OK
SKB181     AND NOT FGT9Q-ERR-NON-TROVATO
SKB181        MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SKB181        MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SKB181        PERFORM R-ERRORE-NON-GESTIBILE
SKB181     END-IF
SKB181
SKB181     IF FGT9Q-OK
SKB181        MOVE FGT9Q-I-ACQPRI-IPO-O   TO W-I-ACQPRI-IPO
SKB181        MOVE FGT9Q-I-ACQALT-IPO-O   TO W-I-ACQALT-IPO
SKB181        MOVE FGT9Q-I-RISPRI-IPO-O   TO W-I-RISPRI-IPO
SKB181        MOVE FGT9Q-I-ALTFIN-IPO-O   TO W-I-ALTFIN-IPO
SKB181        MOVE FGT9Q-I-AGRARI-IPO-O   TO W-I-AGRARI-IPO
SKB181        MOVE FGT9Q-I-TOTFIN-IPO-O   TO W-I-TOTFIN-IPO
SKB181     ELSE
SKB181        MOVE ZEROES                 TO W-I-ACQPRI-IPO
SKB181        MOVE ZEROES                 TO W-I-ACQALT-IPO
SKB181        MOVE ZEROES                 TO W-I-RISPRI-IPO
SKB181        MOVE ZEROES                 TO W-I-ALTFIN-IPO
SKB181        MOVE ZEROES                 TO W-I-AGRARI-IPO
SKB181        MOVE ZEROES                 TO W-I-TOTFIN-IPO
SKB181     END-IF
SKB181     .

SJD121*RICERCA-PERC-DETRAIBILE.
SJD121*    MOVE 'RICERCA-PERC-DETRAIBILE' TO IDBGU-X-LABEL-TRAC
SJD121*    MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJD121*    PERFORM R-TRACE-LABEL.
SJD121*
SJD121*    SET W-F-EKFGT-NO               TO TRUE
SJD121*    MOVE ZEROES                    TO W-P-DETRAZ-PER
SJD121*
SKA292*    INITIALIZE                        FGT9Q-G-GROUP-AREA
SKA292*    SET  FGT9Q-SELECT-005          TO TRUE
SKA292*    MOVE FCEI1-C-GRUPPO-ABI        TO FGT9Q-C-GRUPPO-ABI-I
SKA292*    MOVE FCEI1-C-CODICE-ABI        TO FGT9Q-C-CODICE-ABI-I
SKA292*    MOVE FCEI1-C-FINANZ-PRE        TO FGT9Q-C-FINANZ-PRE-I
SKA292*    MOVE FCEI1-N-FINANZ-NUM        TO FGT9Q-N-FINANZ-NUM-I
SKA292*    MOVE FCEI1-C-NDGNDG-COD        TO FGT9Q-C-NDGNDG-COD-I
SJD121*
SJD121*    PERFORM CL-EKFGT9QB
SJD121*
SJD121*    IF NOT FGT9Q-OK
SJD121*    AND NOT FGT9Q-ERR-NON-TROVATO
SJD121*       MOVE FGT9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD121*       MOVE FGT9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SJD121*       PERFORM R-ERRORE-NON-GESTIBILE
SJD121*    END-IF
SJD121*
SJD121*    IF FGT9Q-OK
SJD121*       MOVE FGT9Q-P-DETRAZ-PER-O   TO W-P-DETRAZ-PER
SJD121*                                      W-P-PERCEN-APP
SJD121*       MOVE FGT9Q-D-INIRIS-PRE-O   TO W-D-INIRIS-PRE
SJD121*       MOVE FGT9Q-D-FINRIS-PRE-O   TO W-D-FINRIS-PRE
SKA292*       MOVE FGT9Q-I-ACQPRI-IPO-O   TO W-I-ACQPRI-IPO
SJD121*       MOVE FGT9Q-I-RISPRI-IPO-O   TO W-I-RISPRI-IPO
SJD121*       MOVE FGT9Q-I-TOTFIN-IPO-O   TO W-I-TOTFIN-IPO
SJD121*       SET W-F-EKFGT-SI            TO TRUE
SJD121*    END-IF
SJD121*    .

SJD121 ORDINA-IMPORTI.
SJD121     MOVE 'ORDINA-IMPORTI'              TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                             TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL.
SJD121
SJD121     MOVE 1                             TO W-U
SJD121     MOVE 2                             TO W-E
SJD121
SJD121     PERFORM UNTIL W-E > 5
SJD121     OR WAPPO-C-TIPOLO-TIP(W-E) = SPACES OR LOW-VALUES
SJD121
SJD121       MOVE W-U                         TO W-STORE
SJD121       SET SCAMBIO-SI                   TO TRUE
SJD121
SJD121       PERFORM VARYING W-U FROM W-U BY -1
SJD121       UNTIL W-U = 0
SJD121       OR SCAMBIO-NO
SJD121         COMPUTE W-E = W-U + 1
SJD121         IF WAPPO-I-TIPOLO-MUT(W-E) < WAPPO-I-TIPOLO-MUT(W-U)
SJD121           PERFORM SCAMBIA-POSIZIONE
SJD121         ELSE
SJD121           SET SCAMBIO-NO               TO TRUE
SJD121         END-IF
SJD121       END-PERFORM
SJD121
SJD121       COMPUTE W-U = W-STORE + 1
SJD121       COMPUTE W-E = W-U + 1
SJD121     END-PERFORM.

SJD121 SCAMBIA-POSIZIONE.
SJD121     MOVE 'SCAMBIA-POSIZIONE'          TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                            TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL.
SJD121
SJD121     MOVE WAPPO-I-TIPOLO-MUT(W-U)    TO WAPPO-I-TIPOLO-SCA
SJD121     MOVE WAPPO-C-TIPOLO-TIP(W-U)    TO WAPPO-C-TIPOLO-SCA
SJD121
SJD121     MOVE WAPPO-I-TIPOLO-MUT(W-E)    TO WAPPO-I-TIPOLO-MUT(W-U)
SJD121     MOVE WAPPO-C-TIPOLO-TIP(W-E)    TO WAPPO-C-TIPOLO-TIP(W-U)
SJD121
SJD121     MOVE WAPPO-I-TIPOLO-SCA         TO WAPPO-I-TIPOLO-MUT(W-E)
SJD121     MOVE WAPPO-C-TIPOLO-SCA         TO WAPPO-C-TIPOLO-TIP(W-E)
SJD121     .

SJD121 CALCOLA-SCADENZA-RISTR.
SJD121     MOVE 'CALCOLA-SCADENZA-RISTR'   TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                          TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL
SJD121
SJD121     INITIALIZE                        IDATU-G-GROUP-AREA
SJD121     MOVE W-D-FINRIS-PRE            TO IDATU-D-INPUT-SAMG
SJD121     MOVE 6                         TO IDATU-N-MM-INP-OUT
SJD121     MOVE 'N'                       TO IDATU-F-PREV-FMESE
SJD121     SET IDATU-SOMMA-MESI           TO TRUE
SJD121
SJD121     PERFORM CL-EKIDATUB
SJD121
SJD121     IF NOT IDATU-OK
SJD121        MOVE IDATU-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SJD121        SET EKERR-ERR-DATI-INPUT    TO TRUE
SJD121        PERFORM R-ERRORE-NON-GESTIBILE
SJD121     END-IF
SJD121
SJD121     .

SKB251 ORDINA-TIPO.
SKB251     MOVE 'ORDINA-TIPO'                 TO IDBGU-X-LABEL-TRAC
SKB251     MOVE 3                             TO IDBGU-C-LIVELL-TRA
SKB251     PERFORM R-TRACE-LABEL.
SKB251
SKB251     MOVE 1                             TO W-U
SKB251     MOVE 2                             TO W-E
SKB251
SKB251     PERFORM UNTIL W-E > 20
SKB251     OR W-SO-TIPO-MUTUO-COINT-MIS(W-E) = ZEROES
SKB251
SKB251       MOVE W-U                         TO W-STORE
SKB251       SET SCAMBIO-SI                   TO TRUE
SKB251
SKB251       PERFORM VARYING W-U FROM W-U BY -1
SKB251       UNTIL W-U = 0
SKB251       OR SCAMBIO-NO
SKB251         COMPUTE W-E = W-U + 1
SKB251         IF W-SO-TIPO-MUTUO-COINT-MIS(W-E) <
SKB251            W-SO-TIPO-MUTUO-COINT-MIS(W-U)
SKB251           PERFORM SCAMBIA-POSIZIONE-TIPO
SKB251         ELSE
SKB251           SET SCAMBIO-NO               TO TRUE
SKB251         END-IF
SKB251       END-PERFORM
SKB251
SKB251       COMPUTE W-U = W-STORE + 1
SKB251       COMPUTE W-E = W-U + 1
SKB251     END-PERFORM.

SKB251 SCAMBIA-POSIZIONE-TIPO.
SKB251     MOVE 'SCAMBIA-POSIZIONE-TIPO'     TO IDBGU-X-LABEL-TRAC
SKB251     MOVE 3                            TO IDBGU-C-LIVELL-TRA
SKB251     PERFORM R-TRACE-LABEL.
SKB251
SKB251     MOVE W-SO-TIPO-MUTUO-COINT-MIS(W-U)
SKB251                                  TO WAPPO-TIPO-MUTUO-COINT-MIS
SKB251     MOVE W-SO-RECORD-DETTAGLIO-MIS(W-U)
SKB251                                  TO WAPPO-RECORD-DETTAGLIO-MIS
SKB251
SKB251     MOVE W-SO-TIPO-MUTUO-COINT-MIS(W-E)
SKB251                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-U)
SKB251     MOVE W-SO-RECORD-DETTAGLIO-MIS(W-E)
SKB251                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-U)
SKB251
SKB251     MOVE WAPPO-TIPO-MUTUO-COINT-MIS
SKB251                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-E)
SKB251     MOVE WAPPO-RECORD-DETTAGLIO-MIS
SKB251                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-E)
SKB251     .

SKA292 TRATTA-IMPORTO-DETRAIBILE.
SKA292     MOVE 'TRATTA-IMPORTO-DETRAIBILE' TO IDBGU-X-LABEL-TRAC
SKA292     MOVE 3                           TO IDBGU-C-LIVELL-TRA
SKA292     PERFORM R-TRACE-LABEL
DEB>>>*    DISPLAY 'TRATTA-IMPORTO-DETRAIBILE: ' W-I-DETRAZ-IMP
DEB>>>*    DISPLAY 'W-P-DETRAZ-PER: ' W-P-DETRAZ-PER
DEB>>>*    DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
DEB>>>*    DISPLAY 'W-I-TOTFIN-IPO: ' W-I-TOTFIN-IPO
DEB>>>*    DISPLAY 'W-D-INIRIS-PRE: ' W-D-INIRIS-PRE
DEB>>>*    DISPLAY 'W-D-FINRIS-PRE: ' W-D-FINRIS-PRE
DEB>>>*    DISPLAY 'W-I-ACQPRI-IPO: ' W-I-ACQPRI-IPO
DEB>>>*    DISPLAY 'W-I-RISPRI-IPO: ' W-I-RISPRI-IPO
SKA292
SKA292     IF  ( W-D-INIRIS-PRE > '0001-01-01'
SKA292     AND   W-D-FINRIS-PRE < '9999-12-31' )
SKA292     AND   W-I-RISPRI-IPO > ZEROES
SKA292*- Tratto gli interessi di ristrutturazione:
SKA292        PERFORM TRATTA-INTERESSI-RISTR
SKA292*- Applico la detrazione sul totale:
SKA292        IF W-P-DETRAZ-NEW > ZEROES
SKA292           COMPUTE W-I-DETRAZ-IMP = W-I-DETRAZ-IMP *
SKA292                                  ( W-P-DETRAZ-NEW / 100 )
SKA292        ELSE
SKA292           COMPUTE W-I-DETRAZ-IMP = W-I-DETRAZ-IMP *
SKA292                                  ( W-P-DETRAZ-PER / 100 )
SKA292        END-IF
SKA292     ELSE
SKA292*- Applico la detrazione:
SKA292        COMPUTE W-I-DETRAZ-IMP = W-I-DETRAZ-IMP *
SKA292                               ( W-P-DETRAZ-PER / 100 )
SKA292     END-IF
SKA292     .

SKA292 TRATTA-INTERESSI-RISTR.
SKA292     MOVE 'TRATTA-INTERESSI-RISTR'   TO IDBGU-X-LABEL-TRAC
SKA292     MOVE 3                          TO IDBGU-C-LIVELL-TRA
SKA292     PERFORM R-TRACE-LABEL
SKA292
SKA292     MOVE ZEROES                       TO W-P-DETRAZ-NEW
SKA292*- Gestione interessi da RISTRUTTURAZIONE:
SKA292
SKA292* 1) Calcolo periodo "a ristrutturazione":
SKA292     PERFORM CALCOLA-SCADENZA-RISTR
SKA292     MOVE IDATU-D-INOUT-SAMG   TO W-D-FINRIS-CAL
SKA292     MOVE W-D-INIRIS-PRE       TO W-D-INIRIS-CAL
SKA292
SKA292* 2) Lavoro SOLO giorni all'interno del periodo di dichiarazione:
SKA292     IF W-D-FINRIS-CAL >= EKIFB-D-RIFERI-OLD
SKA292     OR W-D-INIRIS-CAL <= EKIFB-D-RIFERI-OPE
SKA292     OR ( W-D-INIRIS-CAL >= EKIFB-D-RIFERI-OLD
SKA292     AND  W-D-FINRIS-CAL <= EKIFB-D-RIFERI-OPE )
SKA292         PERFORM CALCOLO-GIORNI-EFFETTIVI
SKA292
SKA292         IF W-N-GG-RIST > ZEROES
SKA292* 3) Calcolo il rateo degli interessi di ristrutturazione:
SKA292           COMPUTE W-I-RISPRI-RAT = ( W-I-RISPRI-IPO /
SKA292                                      W-N-GG-ANNO ) *
SKA292                                      W-N-GG-RIST
SKA292
SKA292* 4) Calcolo la nuova % di detrazione:
SKA292           COMPUTE W-P-DETRAZ-NEW = ( W-I-RISPRI-RAT +
SKA292                                      W-I-ACQPRI-IPO ) /
SKA292                                      W-I-TOTFIN-IPO
SKA292         END-IF
SKA292     END-IF
SKA292     .

SKA292 VERIFICA-IFICOINT.
SKA292     MOVE 'VERIFICA-IFICOINT'       TO IDBGU-X-LABEL-TRAC
SKA292     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKA292     PERFORM R-TRACE-LABEL
SKA292
SKA292     SET IFICOINT-NO                TO TRUE
SKA292*- Verifico se } stata salvata ANAGRAFE TRIBUTARIA:
SKA292     INITIALIZE FLG9Q-G-GROUP-AREA
SOJ041*SKA292 SET FLG9Q-SELECT-002           TO TRUE
SOJ041     SET FLG9Q-SELECT-004           TO TRUE
SOJ041     MOVE EKIFB-D-RIFERI-OPE        TO FLG9Q-D-MOVIME-CON-I
SKA292     MOVE FCEI1-C-GRUPPO-ABI        TO FLG9Q-C-GRUPPO-ABI-I
SKA292     MOVE FCEI1-C-CODICE-ABI        TO FLG9Q-C-CODICE-ABI-I
SKA292     MOVE FCEI1-C-FINANZ-PRE        TO FLG9Q-C-FINANZ-PRE-I
SKA292     MOVE FCEI1-N-FINANZ-NUM        TO FLG9Q-N-FINANZ-NUM-I
SPA221     IF FCEI1-C-ACCOLL-FLG = 'SI'
SPA221        MOVE FCEI1-D-ACCOLL-CON     TO FLG9Q-D-MOVIME-CON-I
SPA221     END-IF
SKA292
SKA292     MOVE 'IFICOINT'                TO FLG9Q-C-OPERAZ-COD-I
SKA292     MOVE 'F'                       TO FLG9Q-C-OPERAZ-TIP-I
SKA292
SKA292     PERFORM CL-EKFLG9QB
SKA292
SKA292     IF  NOT FLG9Q-OK
SKA292     AND NOT FLG9Q-ERR-NON-TROVATO
SKA292         MOVE FLG9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SKA292         PERFORM R-ERRORE-NON-GESTIBILE
SKA292     END-IF
SKA292
SKA292     IF FLG9Q-OK
SLC043*- Verifico che la DATA del LOG sia minore della data riferimento
SLC043*  per evitare di reperire IFICOINT futuri:
SLC043     AND FLG9Q-D-MOVIME-CON-O <= EKIFB-D-RIFERI-OPE
SLC043*- Se ho avuto ACCOLLO nell'anno, e sto trattatando ACCOLLATO:
SLC043       IF FCEI1-C-ACCOLL-FLG = 'SI'
DEB>>>         DISPLAY 'ACCOLLO: '
DEB>>>         DISPLAY 'FCEI1-C-ACCOLL-FLG: 'FCEI1-C-ACCOLL-FLG
DEB>>>         DISPLAY 'FCEI1-D-ACCOLL-CON: 'FCEI1-D-ACCOLL-CON
DEB>>>         DISPLAY 'FLG9Q-D-MOVIME-CON-O: '
DEB>>>                  FLG9Q-D-MOVIME-CON-O
SLC043*- Se ho IFICOINT, ma fa riferimento ad un inserimento successivo
SLC043*  rispetto alla data contabile di accollo:
SLC043         IF FLG9Q-D-MOVIME-CON-O > FCEI1-D-ACCOLL-CON
SLC043            CONTINUE
SLC043         ELSE
SLC043            SET IFICOINT-SI              TO TRUE
DEB>>>            DISPLAY 'ESISTE IFICOINT FLG|: ' FLG9Q-N-FINANZ-NUM-I
SLC043         END-IF
SLC043*- Se non ho avuto ACCOLLO nell'anno (il flag } su posizione
SLC043*  ACCOLLATA), oppure sto trattando ACCOLLANTE, vado a vecchio:
SLC043       ELSE
DEB>>>         DISPLAY 'ESISTE IFICOINT FLG|: ' FLG9Q-N-FINANZ-NUM-I
SKA292         SET IFICOINT-SI              TO TRUE
SLC043       END-IF
SOB061*Se non trova l'anagrafe tributaria verifica la presenza del
SOB061*legame di tipo "Rinegoziazione" attraverso un accesso alla
SOB061*tabella dei legami "EKFLF" ("Codice legame multilinea" =
SOB061*'00002') se viene trovato viene acceso ugualmete il flag
SOB061*IFICOINT-SI e poi verranno presi i dati del padre.
SOB061     ELSE
SOB061        PERFORM VERIFICA-RINEGOZIATO-FIGLIO
SOB061        IF  FLF9Q-OK
SOB061        AND FLF9Q-C-MULTIL-COD-O = '00002'
DEB>>>*          DISPLAY 'SONO IL COFINANZIAMENTO COLLEGATO'
SOB061           SET IFICOINT-SI              TO TRUE
SOB061        END-IF
SKA292     END-IF
SKA292     .

SKB181 GESTIONE-MISTO-COI.
SKB181     MOVE 'GESTIONE-MISTO-COI'      TO IDBGU-X-LABEL-TRAC
SKB181     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB181     PERFORM R-TRACE-LABEL
DEB>>>*    DISPLAY 'GESTIONE-MISTO-COI'
DEB>>>*    DISPLAY 'W-I-ACQPRI-IPO-APPO: ' W-I-ACQPRI-IPO-APPO
DEB>>>*    DISPLAY 'W-I-ACQALT-IPO-APPO: ' W-I-ACQALT-IPO-APPO
DEB>>>*    DISPLAY 'W-I-RISPRI-IPO-APPO: ' W-I-RISPRI-IPO-APPO
DEB>>>*    DISPLAY 'W-I-ALTFIN-IPO-APPO: ' W-I-ALTFIN-IPO-APPO
DEB>>>*    DISPLAY 'W-I-AGRARI-IPO-APPO: ' W-I-AGRARI-IPO-APPO
DEB>>>*    DISPLAY '***'
DEB>>>*- Se ho "W-I-ALTFIN-IPO-APPO" valorizzato, devo calcolare la
DEB>>>*  quotaparte e poi riaggiornare i totali su:
DEB>>>*   SO-IMP-PEN-COS-COINT
DEB>>>*   SO-PEN-NON-DET-COINT
DEB>>>*  aggiungendo questa quotaparte.
SKB181
SKB181     MOVE ZEROES                    TO W-P-AGRARIO
SKB181     MOVE ZEROES                    TO W-P-ABIT-PRIN
SKB181     MOVE ZEROES                    TO W-P-ALTRI-IMM
SKB181     MOVE ZEROES                    TO W-P-COST-RIST
SKB181     MOVE ZEROES                    TO W-P-PERC-MISTO
SKB251
SKB251     MOVE W-SO-IMP-INT-ONE-COINT    TO W-SO-IMP-INT-ONE-COINT-9
SKB251
SKC182* LIQUIDITA'
SKC182     IF W-I-ALTFIN-IPO-APPO > ZEROES
DEB>>>*       DISPLAY 'FX0409 ELABORO LIQUIDITA: ' W-I-ALTFIN-IPO-APPO
DEB>>>*
DEB>>>*       DISPLAY 'FX0409 W-SO-IMP-INT-ONE-COINT: '
DEB>>>*                       W-SO-IMP-INT-ONE-COINT
DEB>>>*       DISPLAY 'FX0409 W-SO-IMP-PEN-COS-COINT: '
DEB>>>*                       W-SO-IMP-PEN-COS-COINT
DEB>>>*       DISPLAY 'FX0409 W-I-TOTFIN-IPO-APPO   : '
DEB>>>*                       W-I-TOTFIN-IPO-APPO
DEB>>>*       DISPLAY 'FX0409 W-I-INTONE-PRE-APPO   : '
DEB>>>*                       W-I-INTONE-PRE-APPO
DEB>>>*       DISPLAY 'FX0409 W-I-PENNON-PRE-APPO   : '
DEB>>>*                       W-I-PENNON-PRE-APPO
DEB>>>*
SKC182        COMPUTE W-P-LIQUIDITA = ( W-I-ALTFIN-IPO-APPO /
SKC182                                W-I-TOTFIN-IPO-APPO )
SKC182        COMPUTE W-SO-LIQUIDITA = W-I-INTONE-PRE-APPO
SKC182                                 * W-P-LIQUIDITA
SKC182        ADD W-SO-LIQUIDITA          TO W-SO-IMP-LIQUIDITA
DEB>>>*       DISPLAY 'FX0409 W-P-LIQUIDITA : ' W-P-LIQUIDITA
DEB>>>*       DISPLAY 'FX0409 W-SO-LIQUIDITA: ' W-SO-LIQUIDITA
DEB>>>*       DISPLAY 'FX0409 W-SO-IMP-LIQUIDITA: ' W-SO-IMP-LIQUIDITA
SKC182     END-IF
SKB181
SKB181* AGRARIO
SKB181     IF W-I-AGRARI-IPO-APPO > ZEROES
DEB>>>*       DISPLAY 'FX0409 ELABORO AGRARIO: ' W-I-AGRARI-IPO-APPO
SKB261        SET AGRARIO-COINT-SI            TO TRUE
SKB261
SKB181        MOVE '1'                    TO SO-TIPO-MUTUO-COINT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB251        MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB251        MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB181        COMPUTE W-P-AGRARIO = ( W-I-AGRARI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-AGRARIO             TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-AGRARIO
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-AGRARIO
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-AGRARIO
SKC182        ADD W-SO-LIQUIDITA TO W-SO-PEN-NON-DET-CALC
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181*       MOVE IARRU-I-IMPORT-ARR-O   TO SO-INT-ONE-PAG-COINT
SKB251        MOVE IARRU-I-IMPORT-ARR-O   TO W-SO-INT-ONE-PAG-CALC
SKB251        ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251        IF W-V = W-N-CONTA-IAN
SKB251        AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-IMP-INT-ONE-COINT-9
SKB251           COMPUTE W-RESTO-APPR = W-SO-IMP-INT-ONE-COINT-9
SKB251                                - W-SO-INT-ONE-PAG-APPO-SUM
SKB251           IF  W-RESTO-APPR >= 1
SKB251           AND W-RESTO-APPR <= 3
SKB251               COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251                       W-SO-INT-ONE-PAG-CALC + W-RESTO-APPR
SKB251           END-IF
SKB251        END-IF
SKB251        MOVE W-SO-INT-ONE-PAG-CALC  TO SO-INT-ONE-PAG-COINT
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-PEN-NON-DET-COINT
SKB261                                       W-SO-PEN-NON-DET-9
SMB153                                       PEN-NON-DET-COINT-APPO
SMB153        MOVE SO-IMP-PEN-COS-COINT   TO IMP-PEN-COS-COINT
SMB153        PERFORM VERIFICA-PENALE
SMB153        MOVE SO-PEN-NON-DET-COINT   TO W-SO-PEN-NON-DET-9
SKB261
SKB261        MOVE '1'                 TO W-SO-TIPO-MUTUO-COINT-TOT(1)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(1)
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-TOT(1) 10: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-TOT(1)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(1)
SKB261        ADD W-SO-PEN-NON-DET-9
SKB261                                 TO W-SO-IMP-PEN-COS-COINT-TOT(1)
SKB261
SKB251*SKB181        PERFORM SCRITTURA-SONCO
SKB251        ADD 1                    TO W-M
SKB251        MOVE SO-TIPO-MUTUO-COINT TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB251*       MOVE SO-ID-COINT-COINT   TO W-SO-ID-COINT-COINT-MIS(W-M)
SKB251        MOVE SONCORR2            TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB251*SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261     ELSE
SKB261        IF AGRARIO-COINT-SI
SKB261           MOVE '1'                    TO SO-TIPO-MUTUO-COINT
SKB261           MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB261           MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB261           MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB261*          MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261           MOVE ZEROES                 TO SO-INT-ONE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-PEN-NON-DET-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-RATE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-COINT
SKB261
SKB261        MOVE '1'                 TO W-SO-TIPO-MUTUO-COINT-TOT(1)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(1)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(1)
SLC113*SKB261        ADD W-SO-PEN-NON-DET-9
SLC113*SKB261                          TO W-SO-IMP-PEN-COS-COINT-TOT(1)
SKB261
SKB261
SKB261           ADD 1                       TO W-M
SKB261           MOVE SO-TIPO-MUTUO-COINT
SKB261                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB261           MOVE SONCORR2
SKB261                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB261
SKB261           MOVE ZEROES                 TO W-P-PERC-RESTO
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB261           MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB261           MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261        END-IF
SKB181     END-IF
SKB181
SKB181* ABIT-PRIN
SKB181     IF W-I-ACQPRI-IPO-APPO > ZEROES
DEB>>>*       DISPLAY 'FX0409 ELABORO ABIT-PRIN: ' W-I-ACQPRI-IPO-APPO
SKB261        SET ABIT-PRIN-COINT-SI          TO TRUE
SKB181        MOVE '2'                    TO SO-TIPO-MUTUO-COINT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB251        MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB251        MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB181        COMPUTE W-P-ABIT-PRIN = ( W-I-ACQPRI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-ABIT-PRIN           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-ABIT-PRIN
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-ABIT-PRIN
SKB251*       ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251*       IF W-V = W-N-CONTA-IAN
SKB251*       AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-INT-ONE-PAG-APPO
SKB251*          COMPUTE W-RESTO-APPR = W-SO-INT-ONE-PAG-APPO
SKB251*                               - W-SO-INT-ONE-PAG-APPO-SUM
SKB251*          IF  W-RESTO-APPR >= 1
SKB251*          AND W-RESTO-APPR <= 3
SKB251*              COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251*                      W-SO-INT-ONE-PAG-CALC - W-RESTO-APPR
SKB251*          END-IF
SKB251*       END-IF
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-ABIT-PRIN
SKC182        ADD W-SO-LIQUIDITA TO W-SO-PEN-NON-DET-CALC
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181*       MOVE IARRU-I-IMPORT-ARR-O   TO SO-INT-ONE-PAG-COINT
SKB251        MOVE IARRU-I-IMPORT-ARR-O   TO W-SO-INT-ONE-PAG-CALC
SKB251        ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251        IF W-V = W-N-CONTA-IAN
SKB251        AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-IMP-INT-ONE-COINT-9
SKB251           COMPUTE W-RESTO-APPR = W-SO-IMP-INT-ONE-COINT-9
SKB251                                - W-SO-INT-ONE-PAG-APPO-SUM
SKB251           IF  W-RESTO-APPR >= 1
SKB251           AND W-RESTO-APPR <= 3
SKB251               COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251                       W-SO-INT-ONE-PAG-CALC + W-RESTO-APPR
SKB251           END-IF
SKB251        END-IF
SKB251        MOVE W-SO-INT-ONE-PAG-CALC  TO SO-INT-ONE-PAG-COINT
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-PEN-NON-DET-COINT
SKB261                                       W-SO-PEN-NON-DET-9
SMB153                                       PEN-NON-DET-COINT-APPO
SMB153        MOVE SO-IMP-PEN-COS-COINT   TO IMP-PEN-COS-COINT
SMB153        PERFORM VERIFICA-PENALE
SMB153        MOVE SO-PEN-NON-DET-COINT   TO W-SO-PEN-NON-DET-9
SKB261
SKB261        MOVE '2'                 TO W-SO-TIPO-MUTUO-COINT-TOT(2)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(2)
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-TOT(2) 11: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-TOT(2)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(2)
SKB261        ADD W-SO-PEN-NON-DET-9
SKB261                                 TO W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261
SKB251*SKB181        PERFORM SCRITTURA-SONCO
SKB251        ADD 1                    TO W-M
SKB251        MOVE SO-TIPO-MUTUO-COINT TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB251*       MOVE SO-ID-COINT-COINT   TO W-SO-ID-COINT-COINT-MIS(W-M)
SKB251        MOVE SONCORR2            TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB251*SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261     ELSE
SKB261        IF ABIT-PRIN-COINT-SI
SKB261           MOVE '2'                    TO SO-TIPO-MUTUO-COINT
SKB261           MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB261           MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB261           MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB261*          MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261           MOVE ZEROES                 TO SO-INT-ONE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-PEN-NON-DET-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-RATE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-COINT
SKB261        MOVE '2'                 TO W-SO-TIPO-MUTUO-COINT-TOT(2)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(2)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(2)
SLC113*SKB261        ADD W-SO-PEN-NON-DET-9
SLC113*SKB261                       TO W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261
SKB261
SKB261           ADD 1                       TO W-M
SKB261           MOVE SO-TIPO-MUTUO-COINT
SKB261                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB261           MOVE SONCORR2
SKB261                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB261
SKB261           MOVE ZEROES                 TO W-P-PERC-RESTO
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB261           MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB261           MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261        END-IF
SKB181     END-IF
SKB181
SKB181* ALTRI-IMM
SKB181     IF W-I-ACQALT-IPO-APPO > ZEROES
SKC182*SKB181     OR W-I-ALTFIN-IPO-APPO > ZEROES
DEB>>>*       DISPLAY 'FX0409 ELABORO ALTRI-IMM: ' W-I-ACQALT-IPO-APPO
SKB261        SET ALTRI-IMM-COINT-SI          TO TRUE
SKB181        MOVE '3'                    TO SO-TIPO-MUTUO-COINT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB251        MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB251        MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKC182*SKB181        COMPUTE W-P-ALTRI-IMM = ( ( W-I-ACQALT-IPO-APPO +
SKC182*SKB181                                    W-I-ALTFIN-IPO-APPO ) /
SKC182        COMPUTE W-P-ALTRI-IMM = ( W-I-ACQALT-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-ALTRI-IMM           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-ALTRI-IMM
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-ALTRI-IMM
DEB>>>*       DISPLAY 'FX0404 W-I-INTONE-PRE-APPO  : '
DEB>>>*                       W-I-INTONE-PRE-APPO
DEB>>>*       DISPLAY 'FX0404 W-P-ALTRI-IMM        : '
DEB>>>*                       W-P-ALTRI-IMM
DEB>>>*       DISPLAY 'FX0404 W-SO-INT-ONE-PAG-CALC: '
DEB>>>*                       W-SO-INT-ONE-PAG-CALC
SKB251*       ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251*       IF W-V = W-N-CONTA-IAN
SKB251*       AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-INT-ONE-PAG-APPO
SKB251*          COMPUTE W-RESTO-APPR = W-SO-INT-ONE-PAG-APPO
SKB251*                               - W-SO-INT-ONE-PAG-APPO-SUM
SKB251*          IF  W-RESTO-APPR >= 1
SKB251*          AND W-RESTO-APPR <= 3
SKB251*              COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251*                      W-SO-INT-ONE-PAG-CALC - W-RESTO-APPR
SKB251*          END-IF
SKB251*       END-IF
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-ALTRI-IMM
SKC182        ADD W-SO-LIQUIDITA TO W-SO-PEN-NON-DET-CALC
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181*       MOVE IARRU-I-IMPORT-ARR-O   TO SO-INT-ONE-PAG-COINT
SKB251        MOVE IARRU-I-IMPORT-ARR-O   TO W-SO-INT-ONE-PAG-CALC
SKB251        ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251        IF W-V = W-N-CONTA-IAN
SKB251        AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-IMP-INT-ONE-COINT-9
SKB251           COMPUTE W-RESTO-APPR = W-SO-IMP-INT-ONE-COINT-9
SKB251                                - W-SO-INT-ONE-PAG-APPO-SUM
SKB251           IF  W-RESTO-APPR >= 1
SKB251           AND W-RESTO-APPR <= 3
SKB251               COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251                       W-SO-INT-ONE-PAG-CALC + W-RESTO-APPR
SKB251           END-IF
SKB251        END-IF
SKB251        MOVE W-SO-INT-ONE-PAG-CALC  TO SO-INT-ONE-PAG-COINT
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-PEN-NON-DET-COINT
SKB261                                       W-SO-PEN-NON-DET-9
SMB153                                       PEN-NON-DET-COINT-APPO
SMB153        MOVE SO-IMP-PEN-COS-COINT   TO IMP-PEN-COS-COINT
SMB153        PERFORM VERIFICA-PENALE
SMB153        MOVE SO-PEN-NON-DET-COINT   TO W-SO-PEN-NON-DET-9
SKB261
SKB261        MOVE '3'                 TO W-SO-TIPO-MUTUO-COINT-TOT(3)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(3)
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-TOT(3) 13: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-TOT(3)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(3)
DEB>>>*       DISPLAY 'FX0404 W-SO-INT-ONE-PAG-CALC        : '
DEB>>>*                       W-SO-INT-ONE-PAG-CALC
DEB>>>*       DISPLAY 'FX0404 W-SO-IMP-INT-ONE-COINT-TOT(3): '
DEB>>>*                       W-SO-IMP-INT-ONE-COINT-TOT(3)
SKB261        ADD W-SO-PEN-NON-DET-9
SKB261                                 TO W-SO-IMP-PEN-COS-COINT-TOT(3)
SKB261
SKB251*SKB181        PERFORM SCRITTURA-SONCO
SKB251        ADD 1                    TO W-M
SKB251        MOVE SO-TIPO-MUTUO-COINT TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB251*       MOVE SO-ID-COINT-COINT   TO W-SO-ID-COINT-COINT-MIS(W-M)
SKB251        MOVE SONCORR2            TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB251*SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261     ELSE
SKB261        IF ALTRI-IMM-COINT-SI
DEB>>>*          DISPLAY 'FX1707 ELABORO QUI ALTRI-IMM-COINT-SI 2|'
SKB261           MOVE '3'                    TO SO-TIPO-MUTUO-COINT
SKB261           MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB261           MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB261           MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB261*          MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261           MOVE ZEROES                 TO SO-INT-ONE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-PEN-NON-DET-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-RATE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-COINT
SKB261        MOVE '3'                 TO W-SO-TIPO-MUTUO-COINT-TOT(3)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(3)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(3)
SLC113*SKB261        ADD W-SO-PEN-NON-DET-9
SLC113*SKB261                       TO W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261
SKB261
SKB261           ADD 1                       TO W-M
SKB261           MOVE SO-TIPO-MUTUO-COINT
SKB261                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB261           MOVE SONCORR2
SKB261                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB261
SKB261           MOVE ZEROES                 TO W-P-PERC-RESTO
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB261           MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB261           MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261        END-IF
SKB261
SKB181     END-IF
SKB181
SKB181* COST-RIST
SKB181     IF W-I-RISPRI-IPO-APPO > ZEROES
DEB>>>*       DISPLAY 'FX0409 ELABORO COST-RIST: ' W-I-RISPRI-IPO-APPO
SKB261        SET COST-RIST-COINT-SI          TO TRUE
SKB261
SKB181        MOVE '4'                    TO SO-TIPO-MUTUO-COINT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB251        MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB251        MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB181        COMPUTE W-P-COST-RIST = ( W-I-RISPRI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-COST-RIST           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-COST-RIST
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-COST-RIST
SKB251*       ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251*       IF W-V = W-N-CONTA-IAN
SKB251*       AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-INT-ONE-PAG-APPO
SKB251*          COMPUTE W-RESTO-APPR = W-SO-INT-ONE-PAG-APPO
SKB251*                               - W-SO-INT-ONE-PAG-APPO-SUM
SKB251*          IF  W-RESTO-APPR >= 1
SKB251*          AND W-RESTO-APPR <= 3
SKB251*              COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251*                      W-SO-INT-ONE-PAG-CALC - W-RESTO-APPR
SKB251*          END-IF
SKB251*       END-IF
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-COST-RIST
SKC182        ADD W-SO-LIQUIDITA TO W-SO-PEN-NON-DET-CALC
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181*       MOVE IARRU-I-IMPORT-ARR-O   TO SO-INT-ONE-PAG-COINT
SKB251        MOVE IARRU-I-IMPORT-ARR-O   TO W-SO-INT-ONE-PAG-CALC
SKB251        ADD W-SO-INT-ONE-PAG-CALC   TO W-SO-INT-ONE-PAG-APPO-SUM
SKB251        IF W-V = W-N-CONTA-IAN
SKB251        AND W-SO-INT-ONE-PAG-APPO-SUM < W-SO-IMP-INT-ONE-COINT-9
SKB251           COMPUTE W-RESTO-APPR = W-SO-IMP-INT-ONE-COINT-9
SKB251                                - W-SO-INT-ONE-PAG-APPO-SUM
SKB251           IF  W-RESTO-APPR >= 1
SKB251           AND W-RESTO-APPR <= 3
SKB251               COMPUTE W-SO-INT-ONE-PAG-CALC =
SKB251                       W-SO-INT-ONE-PAG-CALC + W-RESTO-APPR
SKB251           END-IF
SKB251        END-IF
SKB251        MOVE W-SO-INT-ONE-PAG-CALC  TO SO-INT-ONE-PAG-COINT
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-PEN-NON-DET-COINT
SKB261                                       W-SO-PEN-NON-DET-9
SMB153                                       PEN-NON-DET-COINT-APPO
SMB153        MOVE SO-IMP-PEN-COS-COINT   TO IMP-PEN-COS-COINT
SMB153        PERFORM VERIFICA-PENALE
SMB153        MOVE SO-PEN-NON-DET-COINT   TO W-SO-PEN-NON-DET-9
SKB261
SKB261        MOVE '4'                 TO W-SO-TIPO-MUTUO-COINT-TOT(4)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(4)
DEB>>>*        DISPLAY 'FX1503 W-SO-IMP-RATE-PAG-COINT-TOT(5) 14: '
DEB>>>*                        W-SO-IMP-RATE-PAG-COINT-TOT(5)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(4)
SKB261        ADD W-SO-PEN-NON-DET-9
SKB261                                 TO W-SO-IMP-PEN-COS-COINT-TOT(4)
SKB261
SKB251*SKB181        PERFORM SCRITTURA-SONCO
SKB251        ADD 1                    TO W-M
SKB251        MOVE SO-TIPO-MUTUO-COINT TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB251*       MOVE SO-ID-COINT-COINT   TO W-SO-ID-COINT-COINT-MIS(W-M)
SKB251        MOVE SONCORR2            TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB251*SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261     ELSE
SKB261        IF COST-RIST-COINT-SI
SKB261           MOVE '4'                    TO SO-TIPO-MUTUO-COINT
SKB261           MOVE '1'                    TO SO-FLAG-MISTO-COINT
SKB261           MOVE W-SO-IMP-INT-ONE-COINT TO SO-IMP-INT-ONE-COINT
SKB261           MOVE W-SO-IMP-PEN-COS-COINT TO SO-IMP-PEN-COS-COINT
SKB261*          MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261           MOVE ZEROES                 TO SO-INT-ONE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-PEN-NON-DET-COINT
CISP->*    DISPLAY'DNY-SO-PEN-NON-DET-COI15>'SO-PEN-NON-DET-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-RATE-PAG-COINT
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-COINT
SKB261        MOVE '4'                 TO W-SO-TIPO-MUTUO-COINT-TOT(4)
SKB261        ADD W-SO-IMP-RATE-PAG-COINT-APPO
SKB261                                 TO W-SO-IMP-RATE-PAG-COINT-TOT(4)
SKB261        ADD W-SO-INT-ONE-PAG-CALC
SKB261                                 TO W-SO-IMP-INT-ONE-COINT-TOT(4)
SLC113*SKB261        ADD W-SO-PEN-NON-DET-9
SLC113*SKB261                       TO W-SO-IMP-PEN-COS-COINT-TOT(2)
SKB261
SKB261
SKB261           ADD 1                       TO W-M
SKB261           MOVE SO-TIPO-MUTUO-COINT
SKB261                                 TO W-SO-TIPO-MUTUO-COINT-MIS(W-M)
SKB261           MOVE SONCORR2
SKB261                                 TO W-SO-RECORD-DETTAGLIO-MIS(W-M)
SKB261
SKB261           MOVE ZEROES                 TO W-P-PERC-RESTO
SKB261           MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB261           MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB261           MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB261           MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB261        END-IF
SKB181     END-IF
SKB181
SKB181     INITIALIZE                          W-I-INTONE-PRE-APPO
SKB181                                         W-I-PENNON-PRE-APPO
SKB251                                         W-SO-IMP-INT-ONE-COINT
SKB251                                         W-SO-IMP-INT-ONE-COINT-9
SKB251                                         W-SO-IMP-PEN-COS-COINT
SKB181     .

SKB181 GESTIONE-MISTO-PF.
SKB181     MOVE 'GESTIONE-MISTO-PF'       TO IDBGU-X-LABEL-TRAC
SKB181     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB181     PERFORM R-TRACE-LABEL
DEB>>>     DISPLAY 'GESTIONE-MISTO-PF'
SKB181
SKB181     MOVE ZEROES                    TO W-P-AGRARIO
SKB181     MOVE ZEROES                    TO W-P-ABIT-PRIN
SKB181     MOVE ZEROES                    TO W-P-ALTRI-IMM
SKB181     MOVE ZEROES                    TO W-P-COST-RIST
SKB181     MOVE ZEROES                    TO W-P-PERC-MISTO
SKC182     MOVE ZEROES                    TO W-I-NONDET-TOT
SKB181
SKB181* AGRARIO
SKB181     IF W-I-AGRARI-IPO-APPO > ZEROES
SKB181        MOVE '1'                    TO SO-TIPO-MUTUO-INT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-INT
SKB181        COMPUTE W-P-AGRARIO = ( W-I-AGRARI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-AGRARIO             TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-AGRARIO
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-AGRARIO
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-AGRARIO
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-INT-ONE-INT
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-PEN-NON-DET
SKB281        IF W-SO-INT-ONE-PAG-CALC > W-I-TOTRAT-PAG-APPO
SLC121*SKB281    MOVE W-SO-INT-ONE-PAG-CALC TO SO-IMP-RATE-PAG-INT
SLC121           MOVE W-SO-INT-ONE-PAG-CALC    TO W-I-IMPORT-ARR
SLC121           PERFORM ARROTONDA-IMPORTO
SLC121           MOVE IARRU-I-IMPORT-ARR-O     TO SO-IMP-RATE-PAG-INT
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121           IF RATE-A-ZERO-SI
SLC151*SLC121           AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121           END-IF
SLH051           IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051              MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051           END-IF
SMK281        ELSE
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281              MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281           END-IF
SKB281        END-IF
SKC182        IF ACCOL-NOPROP-NO
DEB>>>        DISPLAY 'SCRITTURA-SONCO 8'
SKB181        PERFORM SCRITTURA-SONCO
SKC182        END-IF
SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB181     END-IF
SKB181
SKB181* ABIT-PRIN
SKB181     IF W-I-ACQPRI-IPO-APPO > ZEROES
SKB181        MOVE '2'                    TO SO-TIPO-MUTUO-INT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-INT
SKB181        COMPUTE W-P-ABIT-PRIN = ( W-I-ACQPRI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
DEB>>>*       DISPLAY 'FX2007 W-I-ACQPRI-IPO-APPO: ' W-I-ACQPRI-IPO-APPO
DEB>>>*       DISPLAY 'FX2007 W-I-TOTFIN-IPO-APPO: ' W-I-TOTFIN-IPO-APPO
DEB>>>*       DISPLAY 'FX2007 W-P-ABIT-PRIN: ' W-P-ABIT-PRIN
SKB181        ADD W-P-ABIT-PRIN           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-ABIT-PRIN
DEB>>>*       DISPLAY 'FX2007 W-P-ABIT-PRIN 2: ' W-P-ABIT-PRIN
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-ABIT-PRIN
DEB>>>*       DISPLAY 'FX2007 W-I-INTONE-PRE-APPO  : '
DEB>>>*                       W-I-INTONE-PRE-APPO
DEB>>>*       DISPLAY 'FX2007 W-SO-INT-ONE-PAG-CALC: '
DEB>>>*                       W-SO-INT-ONE-PAG-CALC
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-ABIT-PRIN
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-INT-ONE-INT
DEB>>>*       DISPLAY 'FX2007 SO-IMP-INT-ONE-INT: '
DEB>>>*                       SO-IMP-INT-ONE-INT
SKC182        IF W-I-NONDET-TOT = ZEROES
SKC182        AND W-I-ALTFIN-IPO-APPO > ZEROES
SKC182            COMPUTE W-I-NONDET-TOT = W-I-INTONE-PRE-APPO   -
SKC182                                     W-SO-INT-ONE-PAG-CALC
SKC182            ADD W-I-NONDET-TOT TO W-SO-PEN-NON-DET-CALC
SLC113*SKC182            SET MUTUO-UNICA-FIN-INT TO TRUE
SKC182        END-IF
SLC113        IF PF-MISTO-NO
SLC113           SET MUTUO-UNICA-FIN-INT TO TRUE
SLC113        END-IF
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-PEN-NON-DET
SKB281        IF W-SO-INT-ONE-PAG-CALC > W-I-TOTRAT-PAG-APPO
SLC121*SKB281    MOVE W-SO-INT-ONE-PAG-CALC TO SO-IMP-RATE-PAG-INT
SLC121           MOVE W-SO-INT-ONE-PAG-CALC    TO W-I-IMPORT-ARR
SLC121           PERFORM ARROTONDA-IMPORTO
SLC121           MOVE IARRU-I-IMPORT-ARR-O     TO SO-IMP-RATE-PAG-INT
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121           IF RATE-A-ZERO-SI
SLC151*SLC121           AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121           END-IF
SLH051           IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051              MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051           END-IF
SMK281        ELSE
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281              MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281           END-IF
SKB281        END-IF
SKC182        IF ACCOL-NOPROP-NO
DEB>>>        DISPLAY 'SCRITTURA-SONCO 9'
SKB181        PERFORM SCRITTURA-SONCO
SKC182        END-IF
SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB181     END-IF
SKB181
SKB181* ALTRI-IMM
SKB181     IF W-I-ACQALT-IPO-APPO > ZEROES
SKC182*SKB181     OR W-I-ALTFIN-IPO-APPO > ZEROES
SKB181        MOVE '3'                    TO SO-TIPO-MUTUO-INT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-INT
SKC182*SKB181        COMPUTE W-P-ALTRI-IMM = ( ( W-I-ACQALT-IPO-APPO +
SKC182*SKB181                                    W-I-ALTFIN-IPO-APPO ) /
SKC182        COMPUTE W-P-ALTRI-IMM = ( W-I-ACQALT-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-ALTRI-IMM           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-ALTRI-IMM
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-ALTRI-IMM
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-ALTRI-IMM
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-INT-ONE-INT
SKC182        IF W-I-NONDET-TOT = ZEROES
SKC182        AND W-I-ALTFIN-IPO-APPO > ZEROES
SKC182            COMPUTE W-I-NONDET-TOT = W-I-INTONE-PRE-APPO   -
SKC182                                     W-SO-INT-ONE-PAG-CALC
SKC182            ADD W-I-NONDET-TOT TO W-SO-PEN-NON-DET-CALC
SLC113*SKC182            SET MUTUO-UNICA-FIN-INT TO TRUE
SKC182        END-IF
SLC113        IF PF-MISTO-NO
SLC113           SET MUTUO-UNICA-FIN-INT TO TRUE
SLC113        END-IF
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-PEN-NON-DET
SKB281        IF W-SO-INT-ONE-PAG-CALC > W-I-TOTRAT-PAG-APPO
SLC121*SKB281    MOVE W-SO-INT-ONE-PAG-CALC TO SO-IMP-RATE-PAG-INT
SLC121           MOVE W-SO-INT-ONE-PAG-CALC    TO W-I-IMPORT-ARR
SLC121           PERFORM ARROTONDA-IMPORTO
SLC121           MOVE IARRU-I-IMPORT-ARR-O     TO SO-IMP-RATE-PAG-INT
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121           IF RATE-A-ZERO-SI
SLC151*SLC121           AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121           END-IF
SLH051           IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051              MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051           END-IF
SMK281        ELSE
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281              MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281           END-IF
SKB281        END-IF
SKC182        IF ACCOL-NOPROP-NO
DEB>>>        DISPLAY 'SCRITTURA-SONCO 10'
SKB181        PERFORM SCRITTURA-SONCO
SKC182        END-IF
SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB181     END-IF
SKB181
SKB181* COST-RIST
SKB181     IF W-I-RISPRI-IPO-APPO > ZEROES
SKB181        MOVE '4'                    TO SO-TIPO-MUTUO-INT
SKB181        MOVE '1'                    TO SO-FLAG-MISTO-INT
SKB181        COMPUTE W-P-COST-RIST = ( W-I-RISPRI-IPO-APPO /
SKB181                                W-I-TOTFIN-IPO-APPO )
SKB181        ADD W-P-COST-RIST           TO W-P-PERC-MISTO
SKB181        IF  W-P-PERC-MISTO > 99
SKB181        AND W-P-PERC-MISTO < 100
SKB181            COMPUTE W-P-PERC-RESTO = 100 - W-P-PERC-MISTO
SKB181            ADD W-P-PERC-RESTO      TO W-P-COST-RIST
SKB181        END-IF
SKB181        COMPUTE W-SO-INT-ONE-PAG-CALC = W-I-INTONE-PRE-APPO
SKB181                                        * W-P-COST-RIST
SKB181        COMPUTE W-SO-PEN-NON-DET-CALC = W-I-PENNON-PRE-APPO
SKB181                                        * W-P-COST-RIST
SKB181        MOVE W-SO-INT-ONE-PAG-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-INT-ONE-INT
SKC182        IF W-I-NONDET-TOT = ZEROES
SKC182        AND W-I-ALTFIN-IPO-APPO > ZEROES
SKC182            COMPUTE W-I-NONDET-TOT = W-I-INTONE-PRE-APPO   -
SKC182                                     W-SO-INT-ONE-PAG-CALC
SKC182            ADD W-I-NONDET-TOT TO W-SO-PEN-NON-DET-CALC
SLC113*SKC182            SET MUTUO-UNICA-FIN-INT TO TRUE
SKC182        END-IF
SLC113        IF PF-MISTO-NO
SLC113           SET MUTUO-UNICA-FIN-INT TO TRUE
SLC113        END-IF
SKB181        MOVE W-SO-PEN-NON-DET-CALC  TO W-I-IMPORT-ARR
SKB181        PERFORM ARROTONDA-IMPORTO
SKB181        MOVE IARRU-I-IMPORT-ARR-O   TO SO-IMP-PEN-NON-DET
SKB281        IF W-SO-INT-ONE-PAG-CALC > W-I-TOTRAT-PAG-APPO
SLC121*SKB281    MOVE W-SO-INT-ONE-PAG-CALC TO SO-IMP-RATE-PAG-INT
SLC121           MOVE W-SO-INT-ONE-PAG-CALC    TO W-I-IMPORT-ARR
SLC121           PERFORM ARROTONDA-IMPORTO
SLC121           MOVE IARRU-I-IMPORT-ARR-O     TO SO-IMP-RATE-PAG-INT
SLC121*- Se nell'anno di contribuzione le rate sono a 0, e l'importo
SLC121*  delle penali non detraibili } maggiore dell'importo delle
SLC121*  rate pagate (se a zero } gi{ stato forzato con interesse e voci
SLC121*  detraibili, forzo il valore delle penali non detraibili, se no
SLC121*  il diagnostico scarta il record:
SLC151*SLC121           IF RATE-A-ZERO-SI
SLC151*SLC121           AND SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC151           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SLC121              MOVE SO-IMP-PEN-NON-DET   TO SO-IMP-RATE-PAG-INT
SLC121           END-IF
SLH051           IF SO-IMP-RATE-PAG-INT > SO-IMP-INIZ-INT
SLH051              MOVE SO-IMP-INIZ-INT          TO SO-IMP-RATE-PAG-INT
SLH051           END-IF
SMK281        ELSE
SMK281*- Forzatura per diagnostico: se l'importo delle rate pagate }
SMK281*  minore delle quote non detraibili, forzo l'importo rate pagate:
SMK281           IF SO-IMP-RATE-PAG-INT < SO-IMP-PEN-NON-DET
SMK281              MOVE SO-IMP-RATE-PAG-INT   TO SO-IMP-PEN-NON-DET
SMK281           END-IF
SKB281        END-IF
SKC182        IF ACCOL-NOPROP-NO
DEB>>>        DISPLAY 'SCRITTURA-SONCO 11'
SKB181        PERFORM SCRITTURA-SONCO
SKC182        END-IF
SKB181        MOVE W-SONCO-APPO           TO SONCORR2
SKB181        MOVE ZEROES                 TO W-P-PERC-RESTO
SKB181        MOVE ZEROES                 TO SO-IMP-INT-ONE-INT
SKB181        MOVE ZEROES                 TO SO-IMP-PEN-NON-DET
SKB181        MOVE ZEROES                 TO W-SO-INT-ONE-PAG-CALC
SKB181        MOVE ZEROES                 TO W-SO-PEN-NON-DET-CALC
SKB181     END-IF
SKB181
SKB181     INITIALIZE                          W-I-INTONE-PRE-APPO
SKB181                                         W-I-PENNON-PRE-APPO
SKB181     .

SKB251 APPROSSIMA-DETRAZ-ULT.
SKB251     MOVE 'APPROSSIMA-DETRAZ-ULT'   TO IDBGU-X-LABEL-TRAC
SKB251     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB251     PERFORM R-TRACE-LABEL
SKB251
SKB251     MOVE ZEROES                    TO W-SO-INT-ONE-PAG-COINT-9
SKB251     MOVE SO-IMP-INT-ONE-COINT      TO W-SO-INT-ONE-PAG-APPRO
SKB251
SKB251     IF W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251                                          < W-SO-INT-ONE-PAG-APPRO
SKB251        COMPUTE W-RESTO = W-SO-INT-ONE-PAG-APPRO
SKB251                        - W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251        MOVE SO-INT-ONE-PAG-COINT     TO W-SO-INT-ONE-PAG-COINT-9
SKB251
SKB251*- Approssimo interesse:
SKB251        COMPUTE W-SO-INT-ONE-PAG-COINT-9 =
SKB251                W-SO-INT-ONE-PAG-COINT-9 -
SKB251                W-RESTO
SKB251        MOVE W-SO-INT-ONE-PAG-COINT-9 TO SO-INT-ONE-PAG-COINT
SKB251
SKB251     END-IF
SKB251     .

SKB251 APPROSSIMA-DETRAZ.
SKB251     MOVE 'APPROSSIMA-DETRAZ'       TO IDBGU-X-LABEL-TRAC
SKB251     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB251     PERFORM R-TRACE-LABEL
SKB251
SKB251     MOVE ZEROES                    TO W-SO-IMP-INT-ONE-COINT-9
SKB251     MOVE SO-IMP-INT-ONE-COINT      TO W-SO-IMP-INT-ONE-APPRO
SKB251
SKB251     IF W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251                                          < W-SO-IMP-INT-ONE-APPRO
SKB251        COMPUTE W-RESTO = W-SO-IMP-INT-ONE-APPRO
SKB251                        - W-SO-INT-ONE-PAG-COINT-PRE-TOT(W-V)
SKB251        MOVE SO-IMP-INT-ONE-COINT     TO W-SO-IMP-INT-ONE-COINT-9
SKB251
SKB251*- Approssimo totale per ogni record:
SKB251        COMPUTE W-SO-IMP-INT-ONE-COINT-9 =
SKB251                W-SO-IMP-INT-ONE-COINT-9 -
SKB251                W-RESTO
SKB251
SKB251     END-IF
SKB251     .

SKB251 INIZIALIZZA-RICICLI.
SKB251     MOVE 'INIZIALIZZA-RICICLI'     TO IDBGU-X-LABEL-TRAC
SKB251     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKB251     PERFORM R-TRACE-LABEL
SKB251
SKB251     INITIALIZE W-ELEMENTO-SCA-MIS
SKB251     INITIALIZE W-ELEMENTO-SCA
SKB251     INITIALIZE W-SO-RECORD
SKB251     INITIALIZE W-SO-RECORD-MIS
SKB251     INITIALIZE W-SONCO-APPO
SKB251     INITIALIZE W-I-ACQPRI-IPO-APPO
SKB251     INITIALIZE W-I-ACQALT-IPO-APPO
SKB251     INITIALIZE W-I-RISPRI-IPO-APPO
SKB251     INITIALIZE W-I-ALTFIN-IPO-APPO
SKB251     INITIALIZE W-I-AGRARI-IPO-APPO
SKB251     INITIALIZE W-I-TOTFIN-IPO-APPO
SKB251     INITIALIZE W-I-INTONE-PRE-APPO
SKB251     INITIALIZE W-I-PENNON-PRE-APPO
SKB251     INITIALIZE W-P-AGRARIO
SKB251     INITIALIZE W-P-ABIT-PRIN
SKB251     INITIALIZE W-P-ALTRI-IMM
SKB251     INITIALIZE W-P-COST-RIST
SKB251     INITIALIZE W-P-PERC-MISTO
SKB251     INITIALIZE W-P-PERC-RESTO
SKB251     INITIALIZE W-SO-INT-ONE-PAG-APPO
SKB251     INITIALIZE W-SO-INT-ONE-PAG-APPO-SUM
SKB251     INITIALIZE W-SO-INT-ONE-PAG-APPRO
SKB251     INITIALIZE W-SO-IMP-INT-ONE-APPRO
SKB251     INITIALIZE W-RESTO
SKB251     INITIALIZE W-RESTO-APPR
SKB251     INITIALIZE W-SO-PEN-NON-DET-APPO
SKB251     INITIALIZE W-SO-INT-ONE-PAG-CALC
SKB251     INITIALIZE W-SO-PEN-NON-DET-CALC
SKB251     INITIALIZE W-SO-INT-ONE-PAG-ARR
SKB251     INITIALIZE W-SO-PEN-NON-DET-ARR
SKB251     INITIALIZE W-SO-INT-ONE-PAG-COINT-9
SKB251     INITIALIZE W-SO-IMP-INT-ONE-COINT-9
SKB251     INITIALIZE W-SO-PEN-NON-DET-COINT-9
SKB251     INITIALIZE W-INT-ONE-PAG-COINT-ARRO
SKB251     INITIALIZE W-PEN-NON-DET-COINT-ARRO
SKB251     INITIALIZE W-INT-ONE-PAG-COINT-ARRO-TOT
SKB251     INITIALIZE W-PEN-NON-DET-COINT-ARRO-TOT
SKB251     INITIALIZE W-SO-IMP-INT-ONE-COINT
SKB251     INITIALIZE W-SO-IMP-PEN-COS-COINT
SKB261     INITIALIZE W-SO-IMP-RATE-PAG-COINT
SKB261     INITIALIZE WAPPO-G-IMPORT-MIS-I
SKB261     INITIALIZE W-SO-IMP-RATE-PAG-COINT-APPO
SKB261     INITIALIZE W-SO-IMP-INT-ONE-COINT-APPO
SKB261     INITIALIZE W-SO-IMP-PEN-COS-COINT-APPO
SKB261     INITIALIZE W-SO-PEN-NON-DET-9
SKB261     SET W-F-ALTFIN-COI-NO TO TRUE
SKB251     .
SKB251
SKC051 ESTRAZIONE-ACCOLLO.
SKC051     MOVE 'ESTRAZIONE-ACCOLLO'      TO IDBGU-X-LABEL-TRAC
SKC051     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKC051     PERFORM R-TRACE-LABEL
SKC051
SKC051     SET FAC9Q-SELECT-002           TO TRUE
SKC051     MOVE FCEI1-C-GRUPPO-ABI        TO FAC9Q-C-GRUPPO-ABI-I
SKC051     MOVE FCEI1-C-CODICE-ABI        TO FAC9Q-C-CODICE-ABI-I
SKC051     MOVE FCEI1-C-FINANZ-PRE        TO FAC9Q-C-FINANZ-PRE-I
SKC051     MOVE FCEI1-N-FINANZ-NUM        TO FAC9Q-N-FINANZ-NUM-I
SKC051     MOVE EKIFB-D-RIFERI-OPE        TO FAC9Q-D-RIFERI-OPE-I
SKC051
SKC051     PERFORM CL-EKFAC9QB
SKC051
SKC051     IF NOT FAC9Q-OK
SKC051        MOVE FAC9Q-G-ESITO-AREA     TO EKERR-G-ESITO-AREA
SKC051        MOVE FAC9Q-C-TIPO-ESITO     TO EKERR-C-TIPO-ESITO
SKC051        PERFORM R-ERRORE-GESTIBILE
SKC051     END-IF
SKC051*- Se a data elaborazione (31/12) l'NDG "nuovo" dell'ultimo
SKC051*  accollo non corrisponde con l'NDG in input, sto trattando
SKC051*  un "accollato" (vecchio NDG):
SKC051     IF FAC9Q-C-NDGNDG-NEW-O NOT = FCEI1-C-NDGNDG-COD
SKC051        SET ACCOLLATO-SI            TO TRUE
SKC051     END-IF
SKC051     .
SMB153 VERIFICA-PENALE.
SMB153     MOVE 'VERIFICA-PENALE'         TO IDBGU-X-LABEL-TRAC
SMB153     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SMB153     PERFORM R-TRACE-LABEL
SMB153
SMB153     IF PEN-NON-DET-COINT-APPO > ZERO
SMB153        ADD PEN-NON-DET-COINT-APPO  TO W-I-PENALE
SMB153        IF (IMP-PEN-COS-COINT - W-I-PENALE) = 1
SMB153           ADD 1                    TO PEN-NON-DET-COINT-APPO
SMB153        END-IF
SMB153        IF (W-I-PENALE      - IMP-PEN-COS-COINT) = 1
SMB153           SUBTRACT 1             FROM PEN-NON-DET-COINT-APPO
SMB153        END-IF
SMB153        MOVE PEN-NON-DET-COINT-APPO TO SO-PEN-NON-DET-COINT
SMB153     END-IF
SMB153     .
SID191******************************************************************
      ******************************************************************
       CL-EKIDATUB.
           MOVE 'CL-EKIDATUB'             TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COPY EKIDATUC.
      *
      *
       CL-EKIDM9QB.
           MOVE 'CL-EKIDM9QB'             TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COPY EKIDM9QC.
      *
       CL-EKITB9QB.
           MOVE 'CL-EKITB9QB'             TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COPY EKITB9QC.
      *
090325*
090325 CL-AGR0033.
090325     MOVE 'CL-AGR0033        '      TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325     CALL AGR33-RT                  USING AGR33-AREA.
090325
090325 CL-AGR0080.
090325     MOVE 'CL-AGR0080       '       TO IDBGU-X-LABEL-TRAC
090325     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090325     PERFORM R-TRACE-LABEL.
090325
090325     CALL AGR80-RT                  USING AGR80-AREA.

S2B161 CL-EKINUMUB.
S2B161     MOVE 'CL-EKINUMUB     '        TO IDBGU-X-LABEL-TRAC
S2B161     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S2B161     PERFORM R-TRACE-LABEL

S2B161     COPY EKINUMUC.

       CL-EKIDB9QB.
           MOVE 'CL-EKIDB9QB'             TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COPY EKIDB9QC.
      *
090309 CL-EKFAN9QB.
090309     MOVE 'CL-EKFAN9QB'             TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     COPY EKFAN9QC.
      *
090309 CL-EKIAN1IB.
090309     MOVE 'CL-EKIAN1IB'             TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     COPY EKIAN1IC.
      *
090309 CL-EKIAN3IB.
090309     MOVE 'CL-EKIAN3IB'             TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     COPY EKIAN3IC.
090309*
090309 CL-EKIFILIB.
090309     MOVE 'CL-EKIFILIB'             TO IDBGU-X-LABEL-TRAC
090309     MOVE 3                         TO IDBGU-C-LIVELL-TRA
090309     PERFORM R-TRACE-LABEL.
090309
090309     COPY EKIFILIC.
090309*
       CL-EKIER9QB.
           MOVE 'CL-EKIER9QB'             TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL.

           COPY EKIER9QC.

S9K101 CL-EKFCONUB.
S9K101     MOVE 'CL-EKFCONUB'              TO IDBGU-X-LABEL-TRAC        01090001
S9K101     MOVE 3                          TO IDBGU-C-LIVELL-TRA        01100001
S9K101     PERFORM R-TRACE-LABEL                                        01110001

           COPY EKFCONUC.

S1G201 CL-EKFER9QB.
S1G201     MOVE 'CL-EKFER9QB'             TO IDBGU-X-LABEL-TRAC
S1G201     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S1G201     PERFORM R-TRACE-LABEL.
S1G201
S1G201     COPY EKFER9QC.

S5B091 CL-EKFLF9QB.
S5B091     MOVE 'CL-EKFLF9QB         '    TO IDBGU-X-LABEL-TRAC
S5B091     MOVE 3                         TO IDBGU-C-LIVELL-TRA
S5B091     PERFORM R-TRACE-LABEL
S5B091*
S5B091     COPY EKFLF9QC.
S5B091*
SGB012 CL-EKIARRUB.
SGB012     MOVE 'CL-EKIARRUB'             TO IDBGU-X-LABEL-TRAC
SGB012     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SGB012     PERFORM R-TRACE-LABEL.
SGB012
SGB012     COPY EKIARRUC.

SHL121 CL-EKIFD4IB.
SHL121     MOVE 'CL-EKIFD4IB         '    TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL
SHL121     COPY EKIFD4IC.
SHL121*
SHL121 CL-EKIIM1IB.
SHL121     MOVE 'CL-EKIIM1IB         '    TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL
SHL121     COPY EKIIM1IC.
SHL121
SHL121 CL-EKFIM9QB.
SHL121     MOVE 'CL-EKFIM9QB     '        TO IDBGU-X-LABEL-TRAC
SHL121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SHL121     PERFORM R-TRACE-LABEL
SHL121     COPY EKFIM9QC.

SJD291 CL-EKFDT9QB.
SJD291     MOVE 'CL-EKFDT9QB         '    TO IDBGU-X-LABEL-TRAC
SJD291     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJD291     PERFORM R-TRACE-LABEL
SJD291     COPY EKFDT9QC.

SJD121 CL-EKFGT9QB.
SJD121     MOVE 'CL-EKFGT9QB'             TO IDBGU-X-LABEL-TRAC
SJD121     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJD121     PERFORM R-TRACE-LABEL.
SJD121*
SJD121     COPY EKFGT9QC.
SJB071*
SJB071*CL-EKFDI9QB.
SJB071*    MOVE 'CL-EKFDI9QB'             TO IDBGU-X-LABEL-TRAC
SJB071*    MOVE 3                         TO IDBGU-C-LIVELL-TRA
SJB071*    PERFORM R-TRACE-LABEL.
SJB071*
SJB071*    COPY EKFDI9QC.
SKA292
SKA292 CL-EKFLG9QB.
SKA292     MOVE 'CL-EKFLG9QB     '        TO IDBGU-X-LABEL-TRAC
SKA292     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKA292     PERFORM R-TRACE-LABEL
SKA292     COPY EKFLG9QC.
SKC051
SKC051 CL-EKFAC9QB.
SKC051     MOVE 'CL-EKFAC9QB'             TO IDBGU-X-LABEL-TRAC
SKC051     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKC051     PERFORM R-TRACE-LABEL
SKC051     COPY EKFAC9QC.
SKC051
SKK132 CL-EKIAN9IB.
SKK132     MOVE 'CL-EKIAN9IB         '    TO IDBGU-X-LABEL-TRAC
SKK132     MOVE 3                         TO IDBGU-C-LIVELL-TRA
SKK132     PERFORM R-TRACE-LABEL
SKK132     COPY EKIAN9IC.
SKK132
       CL-LOG.
           COPY EKILOGUC.
      *
       CL-DEBUG.
           COPY EKIDBGUC.
      *
       ERRORE-GRAVE.
           MOVE 'ERRORE-GRAVE'            TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL

           MOVE WD-CHIAVE-MSG              TO IMSG1-CHIAVE-MSG
           PERFORM R-ERRORE-NON-GESTIBILE
           .
       ERRORE-GRAVE-DB.
           MOVE 'ERRORE-GRAVE-DB'         TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL

           MOVE WD-CHIAVE-MSG              TO IMSG1-CHIAVE-MSG
           PERFORM R-ERRORE-DB
           .
       MESSAGGIO-WARNING.
           MOVE 'MESSAGGIO-WARNING'       TO IDBGU-X-LABEL-TRAC
           MOVE 3                         TO IDBGU-C-LIVELL-TRA
           PERFORM R-TRACE-LABEL

           MOVE WD-CHIAVE-MSG              TO IMSG1-CHIAVE-MSG
           SET EKERR-ERR-GESTIBILE        TO TRUE
           PERFORM R-ERRORE-GESTIBILE
           .